<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–Ø–ø–æ–Ω–∏—è 2026: General Plan</title>
    
    <!-- LIBRARIES -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://api-maps.yandex.ru/2.1/?apikey=5912b65b-5a13-482f-bf3c-6a11282b5100&lang=ru_RU" type="text/javascript"></script>

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Merriweather:ital,wght@0,700;1,400&display=swap" rel="stylesheet">

    <style>
        :root {
            --bg-primary: #fcfbf9;
            --bg-secondary: #ffffff;
            --text-primary: #292524;
            --text-secondary: #57534e;
            --border-color: #e7e5e4;
            --accent-color: #e11d48;
        }

        /* Dark theme */
        @media (prefers-color-scheme: dark) {
            :root {
                --bg-primary: #1c1917;
                --bg-secondary: #292524;
                --text-primary: #e7e5e4;
                --text-secondary: #a8a29e;
                --border-color: #44403c;
            }

            .bg-white { background-color: #292524 !important; }
            .bg-stone-50 { background-color: #1c1917 !important; }
            .bg-stone-100 { background-color: #292524 !important; }
            .text-stone-900 { color: #e7e5e4 !important; }
            .text-stone-800 { color: #d6d3d1 !important; }
            .text-stone-600 { color: #a8a29e !important; }
            .text-stone-500 { color: #78716c !important; }
            .border-stone-200 { border-color: #44403c !important; }
            .border-stone-300 { border-color: #57534e !important; }

            #map-container { background: #292524 !important; }

            .ymaps-2-1-79-balloon__content {
                background: #292524 !important;
            }
            .balloon-title { color: #e7e5e4 !important; }
            .balloon-desc { color: #a8a29e !important; }
        }

        body {
            font-family: 'Noto Sans', sans-serif;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            -webkit-tap-highlight-color: transparent;
            transition: background-color 0.3s ease;
        }

        h1, h2, h3, .serif-font { font-family: 'Merriweather', serif; }
        .hide-scroll::-webkit-scrollbar { display: none; }
        .hide-scroll { -ms-overflow-style: none; scrollbar-width: none; }
        .mobile-safe-bottom { padding-bottom: env(safe-area-inset-bottom); }
        
        /* Enhanced animations */
        .fade-in {
            animation: fadeIn 0.4s cubic-bezier(0.16, 1, 0.3, 1);
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(8px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .slide-in-right {
            animation: slideInRight 0.3s cubic-bezier(0.16, 1, 0.3, 1);
        }
        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* Card hover effects */
        .card-hover {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
        }
        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 24px rgba(0,0,0,0.1);
        }

        /* Pulse animation for urgent items */
        @keyframes pulse-subtle {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        .badge-urgent {
            animation: pulse-subtle 2s ease-in-out infinite;
        }

        /* Timeline gradient */
        .timeline-line {
            background: linear-gradient(180deg, #e11d48 0%, #f97316 50%, #0891b2 100%);
        }

        /* Skeleton loading */
        .skeleton {
            background: linear-gradient(90deg, #e7e5e4 25%, #f5f5f4 50%, #e7e5e4 75%);
            background-size: 200% 100%;
            animation: skeleton-loading 1.5s ease-in-out infinite;
        }
        @keyframes skeleton-loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        @media (prefers-color-scheme: dark) {
            .skeleton {
                background: linear-gradient(90deg, #292524 25%, #3f3f46 50%, #292524 75%);
                background-size: 200% 100%;
            }
        }

        #map-container {
            height: 100%;
            min-height: 700px;
            width: 100%;
            border-radius: 12px;
            z-index: 1;
            background: #e5e7eb;
            overflow: hidden;
            position: relative;
        }

        /* Map skeleton */
        .map-skeleton {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, #e7e5e4 25%, #f5f5f4 50%, #e7e5e4 75%);
            background-size: 200% 100%;
            animation: skeleton-loading 1.5s ease-in-out infinite;
            z-index: 10;
            border-radius: 12px;
        }

        /* Progress bar */
        .progress-bar-container {
            position: relative;
            overflow: hidden;
        }
        .progress-bar-fill {
            transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Enhanced badges */
        .badge {
            display: inline-flex;
            align-items: center;
            padding: 3px 10px;
            border-radius: 6px;
            font-size: 0.65rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            box-shadow: 0 1px 2px rgba(0,0,0,0.05), inset 0 1px 0 rgba(255,255,255,0.1);
            transition: all 0.2s ease;
        }
        .badge:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .badge-base { background: #f0fdf4; color: #15803d; border: 1px solid #bbf7d0; }
        .badge-trip { background: #eff6ff; color: #1d4ed8; border: 1px solid #bfdbfe; }
        .badge-time { background: #fff7ed; color: #9a3412; border: 1px solid #fed7aa; margin-right: 6px; }
        .badge-road { background: #172554; color: #bfdbfe; border: 1px solid #1d4ed8; }
        .badge-casual { background: #f0fdf4; color: #166534; border: 1px solid #86efac; }
        .badge-history { background: #fff1f2; color: #9f1239; border: 1px solid #fecdd3; }
        .badge-local { background: #f0fdf4; color: #15803d; border: 1px solid #bbf7d0; }
        .badge-sweet { background: #fff7ed; color: #c2410c; border: 1px solid #fed7aa; }
        .badge-tech { background: #eff6ff; color: #1d4ed8; border: 1px solid #bfdbfe; }
        .badge-soul { background: #fdf4ff; color: #86198f; border: 1px solid #f0abfc; }
        .badge-onsen { background: #fff1f2; color: #be123c; border: 1px solid #fda4af; }
        .badge-design { background: #f5f3ff; color: #5b21b6; border: 1px solid #ddd6fe; }
        .badge-vibe { background: #fdf4ff; color: #86198f; border: 1px solid #f0abfc; }
        .badge-value { background: #ecfccb; color: #3f6212; border: 1px solid #d9f99d; }
        .badge-art { background: #fefce8; color: #854d0e; border: 1px solid #fde68a; }
        .badge-nature { background: #ecfdf5; color: #065f46; border: 1px solid #6ee7b7; }
        .badge-relax { background: #f0f9ff; color: #075985; border: 1px solid #7dd3fc; }
        .badge-trek { background: #f5f3ff; color: #5b21b6; border: 1px solid #c4b5fd; }

        /* Premium gradient badge */
        .badge-premium {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
        }

        .tag-pill {
            display: inline-flex;
            align-items: center;
            padding: 2px 8px;
            border-radius: 999px;
            font-size: .65rem;
            font-weight: 700;
            border: 1px solid #e7e5e4;
            background: #fafaf9;
            color: #44403c;
            transition: all 0.2s ease;
        }
        .tag-pill:hover {
            background: #e7e5e4;
            transform: scale(1.05);
        }

        .segmented-control {
            background: #e7e5e4;
            padding: 4px;
            border-radius: 8px;
            display: flex;
        }
        .segment-btn {
            flex: 1;
            text-align: center;
            padding: 8px 0;
            font-size: 13px;
            font-weight: 600;
            border-radius: 6px;
            color: #57534e;
            transition: all 0.2s;
            cursor: pointer;
        }
        .segment-active {
            background: white;
            color: #1c1917;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }

        @media (prefers-color-scheme: dark) {
            .segmented-control { background: #44403c; }
            .segment-btn { color: #a8a29e; }
            .segment-active { background: #292524; color: #e7e5e4; }
        }

        /* Floating Action Button */
        .fab {
            position: fixed;
            bottom: 80px;
            right: 16px;
            width: 56px;
            height: 56px;
            background: linear-gradient(135deg, #e11d48 0%, #f97316 100%);
            color: white;
            border-radius: 50%;
            box-shadow: 0 4px 12px rgba(225, 29, 72, 0.4);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 40;
        }
        .fab:hover {
            transform: scale(1.1) rotate(90deg);
            box-shadow: 0 6px 20px rgba(225, 29, 72, 0.6);
        }
        .fab:active {
            transform: scale(0.95);
        }

        @media (min-width: 768px) {
            .fab {
                bottom: 24px;
            }
        }

        /* Toast notifications */
        .toast {
            position: fixed;
            top: 80px;
            right: 16px;
            padding: 12px 20px;
            border-radius: 8px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            z-index: 9999;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            font-weight: 600;
            transform: translateX(400px);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            max-width: 90vw;
        }
        .toast.show {
            transform: translateX(0);
        }
        .toast-success { background: #10b981; color: white; }
        .toast-error { background: #ef4444; color: white; }
        .toast-info { background: #3b82f6; color: white; }

        /* Search input */
        .search-input {
            transition: all 0.3s ease;
        }
        .search-input:focus {
            box-shadow: 0 0 0 3px rgba(225, 29, 72, 0.1);
        }

        /* Stats cards */
        .stat-card {
            background: linear-gradient(135deg, var(--from), var(--to));
            border-radius: 12px;
            padding: 16px;
            transition: all 0.3s ease;
        }
        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
        }

        /* Image placeholder gradients */
        .img-placeholder-1 { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .img-placeholder-2 { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
        .img-placeholder-3 { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
        .img-placeholder-4 { background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); }
        .img-placeholder-5 { background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); }
        .img-placeholder-6 { background: linear-gradient(135deg, #30cfd0 0%, #330867 100%); }

        /* Day marker with check */
        .day-marker {
            position: relative;
        }
        .day-marker::after {
            content: '‚úì';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 16px;
            font-weight: bold;
            color: #10b981;
        }
        .day-completed .day-marker::after {
            opacity: 1;
        }

        /* Theme toggle button */
        .theme-toggle {
            position: fixed;
            top: 70px;
            right: 16px;
            width: 40px;
            height: 40px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 100;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .theme-toggle:hover {
            transform: scale(1.1);
        }

        /* Yandex Maps Balloon Styling */
        .ymaps-2-1-79-balloon__layout {
            border-radius: 8px !important;
            overflow: hidden !important;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15) !important;
        }

        .ymaps-2-1-79-balloon__content {
            padding: 12px !important;
            min-width: 200px !important;
            max-width: 280px !important;
        }

        .balloon-title {
            font-size: 14px !important;
            font-weight: 700 !important;
            color: #1c1917 !important;
            margin-bottom: 4px !important;
            line-height: 1.2 !important;
        }

        .balloon-desc {
            font-size: 12px !important;
            line-height: 1.5 !important;
            color: #57534e !important;
        }

        @media (max-width: 420px) {
            .ymaps-2-1-79-balloon__content {
                min-width: 180px !important;
                max-width: 85vw !important;
            }
        }

        /* Smooth scrolling */
        html {
            scroll-behavior: smooth;
        }

        /* Bottom Sheet Modal */
        .bottom-sheet-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 9998;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        .bottom-sheet-overlay.show {
            opacity: 1;
        }

        .bottom-sheet {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--bg-secondary);
            border-top-left-radius: 20px;
            border-top-right-radius: 20px;
            box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.15);
            z-index: 9999;
            max-height: 85vh;
            overflow-y: auto;
            transform: translateY(100%);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .bottom-sheet.show {
            transform: translateY(0);
        }

        .bottom-sheet-handle {
            width: 40px;
            height: 4px;
            background: #d4d4d8;
            border-radius: 2px;
            margin: 12px auto 16px;
        }

        .route-detail-map {
            height: 450px;
            width: 100%;
            border-radius: 12px;
            overflow: hidden;
        }

        @media (min-width: 768px) {
            .route-detail-map {
                height: 100%;
                min-height: 450px;
            }
        }
    </style>
</head>
<body class="antialiased flex flex-col min-h-screen pb-20 md:pb-0">

    <!-- Theme Toggle -->
    <div class="theme-toggle" onclick="toggleTheme()" title="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É">
        <span id="theme-icon">üåô</span>
    </div>

    <header class="bg-white border-b border-stone-200 sticky top-0 z-50 shadow-sm safe-top">
        <div class="max-w-6xl mx-auto px-4 h-14 md:h-16 flex items-center justify-between">
            <div class="flex items-center gap-3">
                <div class="w-8 h-8 bg-teal-800 rounded flex items-center justify-center text-white font-serif font-bold text-lg">JP</div>
                <div>
                    <div class="font-bold text-base md:text-lg leading-tight text-stone-900">Japan 2026</div>
                    <div class="text-[10px] md:text-xs text-stone-500 font-medium">General Plan</div>
                </div>
            </div>
            <nav class="hidden md:flex gap-1" id="desktop-nav"></nav>
        </div>
    </header>

    <!-- Progress Bar -->
    <div id="progress-bar-container" class="hidden sticky top-14 md:top-16 bg-white border-b border-stone-200 z-40 shadow-sm"></div>

    <main class="flex-grow w-full max-w-6xl mx-auto px-3 md:px-4 py-4 md:py-8 h-full">
        <div id="app-view" class="fade-in h-full"></div>
    </main>

    <nav class="md:hidden fixed bottom-0 left-0 w-full bg-white border-t border-stone-200 z-50 mobile-safe-bottom shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.05)]">
        <div class="grid grid-cols-6 h-16" id="mobile-bottom-nav"></div>
    </nav>

    <!-- Floating Action Button -->
    <div class="fab" onclick="showQuickActions()" title="–ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <path d="M12 4v16m8-8H4" />
        </svg>
    </div>

    <script>
        // ============================================
        // üîë CONFIGURATION
        // ============================================
        const YANDEX_API_KEY = '5912b65b-5a13-482f-bf3c-6a11282b5100';
        const TRIP_START_DATE = new Date('2026-04-15');
        const THEME_KEY = 'jp2026_theme';

        // ============================================
        // üõ†Ô∏è HELPER FUNCTIONS
        // ============================================
        const isMobile = () => window.innerWidth <= 768;
        const qs = (sel, root=document) => root.querySelector(sel);
        const qsa = (sel, root=document) => Array.from(root.querySelectorAll(sel));
        const safe = (v, fallback='') => (v === undefined || v === null ? fallback : v);

        // Theme management
        let currentTheme = localStorage.getItem(THEME_KEY) || 'auto';

        function toggleTheme() {
            const themes = ['auto', 'light', 'dark'];
            const currentIndex = themes.indexOf(currentTheme);
            currentTheme = themes[(currentIndex + 1) % themes.length];
            localStorage.setItem(THEME_KEY, currentTheme);
            applyTheme();
            showToast('–¢–µ–º–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∞: ' + (currentTheme === 'auto' ? '–ê–≤—Ç–æ' : currentTheme === 'light' ? '–°–≤–µ—Ç–ª–∞—è' : '–¢–µ–º–Ω–∞—è'), 'info');
        }

        function applyTheme() {
            const icon = document.getElementById('theme-icon');
            if (currentTheme === 'light') {
                document.documentElement.style.colorScheme = 'light';
                icon.textContent = '‚òÄÔ∏è';
            } else if (currentTheme === 'dark') {
                document.documentElement.style.colorScheme = 'dark';
                icon.textContent = 'üåô';
            } else {
                document.documentElement.style.colorScheme = 'light dark';
                icon.textContent = 'üåó';
            }
        }

        // Toast notifications
        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;

            const icon = type === 'success' ? '‚úì' : type === 'error' ? '‚úó' : '‚Ñπ';
            toast.innerHTML = `<span>${icon}</span><span>${message}</span>`;

            document.body.appendChild(toast);

            setTimeout(() => toast.classList.add('show'), 10);

            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // Quick actions menu
        function showQuickActions() {
            const actions = [
                { label: '–î–æ–±–∞–≤–∏—Ç—å –≤ —á–µ–∫–ª–∏—Å—Ç', action: () => { switchView('info'); changeInfo('logistics'); setTimeout(() => document.getElementById('add-check-item')?.click(), 200); } },
                { label: '–ü–æ–∏—Å–∫ –ø–æ –ø–ª–∞–Ω—É', action: () => { switchView('itinerary'); setTimeout(() => document.getElementById('search-input')?.focus(), 200); } },
                { label: '–≠–∫—Å–ø–æ—Ä—Ç –≤ PDF', action: () => showToast('–§—É–Ω–∫—Ü–∏—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ', 'info') }
            ];

            const menu = actions.map((a, i) => `<button onclick="(${a.action})(); closeQuickMenu();" class="w-full text-left px-4 py-3 hover:bg-stone-50 transition-colors">${a.label}</button>`).join('');

            const overlay = document.createElement('div');
            overlay.id = 'quick-menu-overlay';
            overlay.className = 'fixed inset-0 bg-black bg-opacity-30 z-[60] fade-in';
            overlay.onclick = closeQuickMenu;

            const menuDiv = document.createElement('div');
            menuDiv.id = 'quick-menu';
            menuDiv.className = 'fixed bottom-20 right-4 bg-white rounded-xl shadow-2xl overflow-hidden z-[70] slide-in-right';
            menuDiv.innerHTML = menu;

            document.body.appendChild(overlay);
            document.body.appendChild(menuDiv);
        }

        function closeQuickMenu() {
            document.getElementById('quick-menu-overlay')?.remove();
            document.getElementById('quick-menu')?.remove();
        }

        // Calculate days until trip
        function getDaysUntilTrip() {
            const now = new Date();
            const diff = TRIP_START_DATE - now;
            return Math.ceil(diff / (1000 * 60 * 60 * 24));
        }

        // Render progress bar
        function renderProgressBar() {
            const container = document.getElementById('progress-bar-container');
            if (currentState.view !== 'itinerary') {
                container.classList.add('hidden');
                return;
            }

            const days = getDaysUntilTrip();
            const totalDays = 365; // Assuming planning started ~1 year before
            const progress = Math.max(0, Math.min(100, ((totalDays - days) / totalDays) * 100));

            container.classList.remove('hidden');
            container.innerHTML = `
                <div class="max-w-6xl mx-auto px-4 py-3">
                    <div class="flex justify-between text-xs mb-2">
                        <span class="font-bold text-stone-600">–î–æ –ø–æ–µ–∑–¥–∫–∏</span>
                        <span class="font-bold" style="color: ${days < 30 ? '#e11d48' : '#0891b2'}">${days} ${days === 1 ? '–¥–µ–Ω—å' : days < 5 ? '–¥–Ω—è' : '–¥–Ω–µ–π'}</span>
                    </div>
                    <div class="h-2 bg-stone-200 rounded-full overflow-hidden progress-bar-container">
                        <div class="h-full bg-gradient-to-r from-red-500 via-orange-500 to-blue-500 progress-bar-fill" style="width: ${progress}%"></div>
                    </div>
                </div>
            `;
        }

        // ================= DATA =================

        // New unified itinerary based on detailed plans
        const itinerary = [
            // –û—Å–∞–∫–∞ (15-18)
            { day: "15", date: "–°—Ä", month: "04", city: "–û—Å–∞–∫–∞", title: "–ü—Ä–∏–±—ã—Ç–∏–µ", type: "base", desc: "–ü—Ä–∏–ª–µ—Ç 11:45. –°–±–æ—Ä–∫–∞ –≤–µ–ª–æ—Å–∏–ø–µ–¥–æ–≤. –í–µ—á–µ—Ä–Ω–∏–π –î–æ—Ç–æ–Ω–±–æ—Ä–∏.", details: null },
            { day: "16", date: "–ß—Ç", month: "04", city: "–û—Å–∞–∫–∞", title: "–Æ–∂–Ω–∞—è –û—Å–∞–∫–∞, —Ä—ã–Ω–∫–∏ –∏ –≥—Ä–∞—Ñ—Ñ–∏—Ç–∏", type: "trip", desc: "Kuromon, Sumiyoshi Taisha, Kitakagaya Art, –°–∏–Ω—Å—ç–∫–∞–π, –ê–º–µ—Ä–∏–∫–∞-–º—É—Ä–∞.", details: "osaka-0" },
            { day: "17", date: "–ü—Ç", month: "04", city: "–ö–æ–±–µ", title: "–í–µ–ª–æ–ø—Ä–æ–±–µ–≥ –≤ –ö–æ–±–µ", type: "trip", desc: "35-40 –∫–º –¥–æ –ö–æ–±–µ. –ß–∞–π–Ω–∞—Ç–∞—É–Ω, –ø–æ—Ä—Ç, Kitano. –û–±—Ä–∞—Ç–Ω–æ –≤–µ–ª–æ –∏–ª–∏ –ø–æ–µ–∑–¥.", details: "osaka-1" },
            { day: "18", date: "–°–±", month: "04", city: "–û—Å–∞–∫–∞ ‚Üí –ö–∏–æ—Ç–æ", title: "–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –û—Å–∞–∫–∞ + –ø–µ—Ä–µ–µ–∑–¥", type: "base", desc: "–ó–∞–º–æ–∫ –û—Å–∞–∫–∞, –ú–æ–Ω–µ—Ç–Ω—ã–π –¥–≤–æ—Ä (—Å–∞–∫—É—Ä–∞), –¢—ç–Ω–º–∞, –ù–∞–∫–∞–¥–∑–∞–∫–∏-—á–æ. –í–µ—á–µ—Ä–æ–º –ø–æ–µ–∑–¥ –≤ –ö–∏–æ—Ç–æ.", details: "osaka-2" },
            // –ö–∏–æ—Ç–æ (18-21)
            { day: "18", date: "–°–±", month: "04", city: "–ö–∏–æ—Ç–æ", title: "–ì–∏–æ–Ω –∏ –•–∏–≥–∞—Å–∏—è–º–∞", type: "base", desc: "–ö–∏—ë–º–∏–¥–∑—É-–¥—ç—Ä–∞, –ø–∞—Ä–∫ –ú—ç—Ä—É—è–º–∞, —Ä–µ–∫–∞ –ö–∞–º–æ, –ü–æ–Ω—Ç—ë-—Ç—ë.", details: "kyoto-0" },
            { day: "19", date: "–í—Å", month: "04", city: "–ö–∏–æ—Ç–æ", title: "–ê—Ä–∞—Å–∏—è–º–∞ –∏ –ø—Ä–∏—Ä–æ–¥–∞", type: "base", desc: "–ë–∞–º–±—É–∫–æ–≤–∞—è —Ä–æ—â–∞, –º–æ—Å—Ç –¢–æ–≥—ç—Ü—É–∫—ë, –ø–∞—Ä–∫ –æ–±–µ–∑—å—è–Ω, –æ–Ω—Å—ç–Ω.", details: "kyoto-1" },
            { day: "20", date: "–ü–Ω", month: "04", city: "–ö–∏–æ—Ç–æ", title: "–°–µ–≤–µ—Ä–Ω—ã–π –ö–∏–æ—Ç–æ + –§–∏–ª–æ—Å–æ—Ñ—Å–∫–∏–π –ø—É—Ç—å", type: "base", desc: "–ö–∏–Ω–∫–∞–∫—É-–¥–∑–∏, –†—ë–∞–Ω–¥–∑–∏, –ì–∏–Ω–∫–∞–∫—É–¥–∑–∏, –§–∏–ª–æ—Å–æ—Ñ—Å–∫–∏–π –ø—É—Ç—å.", details: "kyoto-2" },
            // –§—É–∫—É–æ–∫–∞ (21-24)
            { day: "21", date: "–í—Ç", month: "04", city: "–§—É–∫—É–æ–∫–∞", title: "–ü—Ä–∏–µ–∑–¥ + –ü–∞—Ä–∫–∏ –∏ —Ä–∞–º–µ–Ω", type: "base", desc: "–°–∏–Ω–∫–∞–Ω—Å—ç–Ω –∏–∑ –ö–∏–æ—Ç–æ. –ü–∞—Ä–∫ –ú–∞–∏–¥–∑—É—Ä—É, Y's Road, —Ä–∞–º–µ–Ω ShinShin.", details: "fukuoka-0" },
            { day: "22", date: "–°—Ä", month: "04", city: "–§—É–∫—É–æ–∫–∞", title: "–ü–æ–±–µ—Ä–µ–∂—å–µ Munakata-Shikanoshima", type: "trip", desc: "51 –∫–º –≤–µ–ª–æ. –°–≤—è—Ç–∏–ª–∏—â–µ –ú—É–Ω–∞–∫–∞—Ç–∞, –æ—Å—Ç—Ä–æ–≤ –®–∏–∫–∞–Ω–æ—Å–∏–º–∞.", details: "fukuoka-1" },
            { day: "23", date: "–ß—Ç", month: "04", city: "–ò—Ç–æ—Å–∏–º–∞", title: "–ò—Ç–æ—Å–∏–º–∞ –∏ –æ–Ω—Å—ç–Ω", type: "trip", desc: "30 –∫–º –≤–µ–ª–æ. –°–∫–∞–ª—ã Futamigaura, –º–æ—Ä—Å–∫–∞—è –¥–æ—Ä–æ–≥–∞, –æ–Ω—Å—ç–Ω Kirara-no-Yu.", details: "fukuoka-2" },
            // –•–∏—Ä–æ—Å–∏–º–∞ (24-27)
            { day: "24", date: "–ü—Ç", month: "04", city: "–•–∏—Ä–æ—Å–∏–º–∞", title: "–ü—Ä–∏–µ–∑–¥ + –ò—Å—Ç–æ—Ä–∏—è", type: "base", desc: "–°–∏–Ω–∫–∞–Ω—Å—ç–Ω –∏–∑ –§—É–∫—É–æ–∫–∏. Peace Memorial Park, —Ä–∞–º–µ–Ω Youki.", details: "hiroshima-0" },
            { day: "25", date: "–°–±", month: "04", city: "–ú–∏—è–¥–∑–∏–º–∞", title: "–•–∞–π–∫–∏–Ω–≥: Miyajima + Mt. Misen", type: "trip", desc: "–•—Ä–∞–º –ò—Ü—É–∫—É—Å–∏–º–∞, –ø–ª–∞–≤–∞—é—â–∏–µ —Ç–æ—Ä–∏–∏, —Ö–∞–π–∫ –Ω–∞ –≥–æ—Ä—É –ú–∏—Å—ç–Ω.", details: "hiroshima-1" },
            { day: "26", date: "–í—Å", month: "04", city: "–û–Ω–æ–º–∏—Ç–∏", title: "–í–µ–ª–æ–¥–µ–Ω—å: Shimanami Kaido", type: "trip", desc: "50-70 –∫–º. –ú–æ—Å—Ç—ã —á–µ—Ä–µ–∑ –æ—Å—Ç—Ä–æ–≤–∞. ONOMICHI U2, Grumpy Bike Shop.", details: "hiroshima-2" },
            // –§–∏–Ω–∞–ª
            { day: "27", date: "–ü–Ω", month: "04", city: "–û—Å–∞–∫–∞", title: "–í–æ–∑–≤—Ä–∞—â–µ–Ω–∏–µ", type: "base", desc: "–°–∏–Ω–∫–∞–Ω—Å—ç–Ω –•–∏—Ä–æ—Å–∏–º–∞ ‚Üí –û—Å–∞–∫–∞. –§–∏–Ω–∞–ª—å–Ω–∞—è –±–∞–∑–∞.", details: null },
            { day: "28", date: "–í—Ç", month: "04", city: "–û—Å–∞–∫–∞", title: "–í—ã–ª–µ—Ç", type: "base", desc: "–¢—Ä–∞–Ω—Å—Ñ–µ—Ä –≤ –∞—ç—Ä–æ–ø–æ—Ä—Ç KIX. 18:10.", details: null }
        ];

        const mapLocations = [
            { name: "–û—Å–∞–∫–∞", coords: [34.6937, 135.5023], desc: "–ë–∞–∑–∞ 1 (3) + –§–∏–Ω–∞–ª (2)" },
            { name: "–ö–∏–æ—Ç–æ", coords: [35.0116, 135.7681], desc: "–ë–∞–∑–∞ 2 (3 –Ω–æ—á–∏)" },
            { name: "–§—É–∫—É–æ–∫–∞", coords: [33.5902, 130.4207], desc: "–ë–∞–∑–∞ 3 (3 –Ω–æ—á–∏)" },
            { name: "–•–∏—Ä–æ—Å–∏–º–∞", coords: [34.3853, 132.4553], desc: "–ë–∞–∑–∞ 4 (3 –Ω–æ—á–∏)" }
        ];

        const pointsOfInterest = [
            { name: "–ê–≤–∞–¥–∑–∏", coords: [34.5930, 135.0190], desc: "–í–µ–ª–æ-–¥–µ–Ω—å: –ö—Ä—É–≥ –≤–æ–∫—Ä—É–≥ –æ—Å—Ç—Ä–æ–≤–∞ –ê–≤–∞–¥–∑–∏ (Awaichi). –ü–æ–ª–Ω—ã–π 150–∫–º –∏–ª–∏ —á–∞—Å—Ç—å." },
            { name: "–ö–æ–±–µ", coords: [34.6901, 135.1955], desc: "–ì–æ—Ä—ã –∏ –ü–æ—Ä—Ç: –í–æ–¥–æ–ø–∞–¥ Nunobiki, Meriken Park, –∫–æ—Ñ–µ –∏ –≥–æ–≤—è–¥–∏–Ω–∞ –ö–æ–±–µ." },
            { name: "–®–∏–º–∞–Ω–∞–º–∏ –ö–∞–π–¥–æ", coords: [34.2563, 133.0256], desc: "–í–µ–ª–æ-–º–∞—Ä—à—Ä—É—Ç: 70–∫–º —á–µ—Ä–µ–∑ 6 –æ—Å—Ç—Ä–æ–≤–æ–≤ –∏ –º–æ—Å—Ç—ã. –ö–ª–∞—Å—Å–∏–∫–∞ —è–ø–æ–Ω—Å–∫–æ–≥–æ –≤–µ–ª–æ—Ç—É—Ä–∏–∑–º–∞." },
            { name: "–ò—Ç–æ—Å–∏–º–∞", coords: [33.6133, 130.1983], desc: "–í–µ–ª–æ-—Å–ø–æ—Ç: –ö—Ä–∞—Å–∏–≤–∞—è –¥–æ—Ä–æ–≥–∞ –≤–¥–æ–ª—å –æ–∫–µ–∞–Ω–∞ –Ω–∞ –∑–∞–∫–∞—Ç–µ. –ò–¥–µ–∞–ª—å–Ω–æ –¥–ª—è –≤–µ—á–µ—Ä–Ω–µ–π –ø–æ–µ–∑–¥–∫–∏." },
            { name: "–ú–∏—è–¥–∑–∏–º–∞", coords: [34.2958, 132.3197], desc: "–°–≤—è—â–µ–Ω–Ω—ã–π –æ—Å—Ç—Ä–æ–≤: –ü–ª–∞–≤–∞—é—â–∏–µ –≤–æ—Ä–æ—Ç–∞ —Ç–æ—Ä–∏–∏, –≥–æ—Ä–∞ –ú–∏—Å—ç–Ω, –æ–ª–µ–Ω–∏." },
            { name: "–û–Ω–æ–º–∏—Ç–∏", coords: [34.4095, 133.2049], desc: "–°—Ç–∞—Ä—Ç –®–∏–º–∞–Ω–∞–º–∏: –†–µ—Ç—Ä–æ-–≥–æ—Ä–æ–¥, —Ö—Ä–∞–º—ã –Ω–∞ —Ö–æ–ª–º–∞—Ö, U2 –≤–µ–ª–æ–∫–æ–º–ø–ª–µ–∫—Å." }
        ];

        const veloPlan = {
            title: "–í–µ–ª–æ-–ì–∏–¥",
            groups: [
                {
                    name: "üö¥ –û—Å–Ω–æ–≤–Ω—ã–µ –ú–∞—Ä—à—Ä—É—Ç—ã",
                    color: "bg-blue-900 text-white",
                    routes: [
                        {
                            id: "awaichi",
                            name: "Awaichi (Awaji)",
                            badge: "badge-road",
                            desc: "–ö—Ä—É–≥ –≤–æ–∫—Ä—É–≥ –æ—Å—Ç—Ä–æ–≤–∞ –ê–≤–∞–¥–∑–∏. –ü–æ–ª–Ω—ã–π 150–∫–º –∏–ª–∏ —á–∞—Å—Ç—å.",
                            distance: "150 –∫–º",
                            gradient: "–°—Ä–µ–¥–Ω–∏–π: 2%, –ú–∞–∫—Å: 8%",
                            elevation: "+800m",
                            duration: "6-8 —á–∞—Å–æ–≤",
                            difficulty: "–°—Ä–µ–¥–Ω—è—è",
                            highlights: ["–ü–ª—è–∂–∏", "–•—Ä–∞–º—ã", "–í–∏–¥—ã –Ω–∞ –æ–∫–µ–∞–Ω"],
                            center: [34.5930, 135.0190],
                            mapLink: "https://www.google.com/maps/d/viewer?mid=1XnKFzYFJH6LkGC_awaichi"
                            // track: [
                            //     [34.5930, 135.0190], [34.6100, 135.0100], [34.6400, 134.9800],
                            //     [34.6800, 134.9500], [34.7000, 134.9300], [34.7100, 134.9100],
                            //     [34.7000, 134.8900], [34.6700, 134.8800], [34.6300, 134.8700],
                            //     [34.5800, 134.8800], [34.5400, 134.9100], [34.5200, 134.9500],
                            //     [34.5100, 135.0000], [34.5300, 135.0400], [34.5600, 135.0600],
                            //     [34.5930, 135.0190]
                            // ]
                        },
                        {
                            id: "shimanami",
                            name: "Shimanami Kaido",
                            badge: "badge-road",
                            desc: "70–∫–º —á–µ—Ä–µ–∑ 6 –æ—Å—Ç—Ä–æ–≤–æ–≤ –∏ –º–æ—Å—Ç—ã. –ö–ª–∞—Å—Å–∏–∫–∞.",
                            distance: "70 –∫–º",
                            gradient: "–°—Ä–µ–¥–Ω–∏–π: 3%, –ú–∞–∫—Å: 12%",
                            elevation: "+600m",
                            duration: "4-6 —á–∞—Å–æ–≤",
                            difficulty: "–°—Ä–µ–¥–Ω—è—è-–í—ã—Å–æ–∫–∞—è",
                            highlights: ["6 –º–æ—Å—Ç–æ–≤", "–û—Å—Ç—Ä–æ–≤–∞", "–í–∏–¥—ã —Å –º–æ—Å—Ç–æ–≤"],
                            center: [34.2563, 133.0256],
                            mapLink: "https://www.google.com/maps/d/viewer?mid=1shimanami"
                            // track: [
                            //     [34.4095, 133.2049], [34.4000, 133.1800], [34.3700, 133.1400],
                            //     [34.3400, 133.1000], [34.3100, 133.0600], [34.2800, 133.0200],
                            //     [34.2563, 132.9800], [34.2400, 132.9400], [34.2200, 132.9000],
                            //     [34.2000, 132.8600], [34.1800, 132.8200]
                            // ]
                        },
                        {
                            id: "kamo",
                            name: "Kamo River",
                            badge: "badge-casual",
                            desc: "–ö–∏–æ—Ç–æ. –†–∞—Å—Å–ª–∞–±–ª–µ–Ω–Ω–∞—è –µ–∑–¥–∞ –≤–¥–æ–ª—å —Ä–µ–∫–∏.",
                            distance: "25 –∫–º",
                            gradient: "–°—Ä–µ–¥–Ω–∏–π: 1%, –ú–∞–∫—Å: 3%",
                            elevation: "+50m",
                            duration: "2-3 —á–∞—Å–∞",
                            difficulty: "–õ–µ–≥–∫–∞—è",
                            highlights: ["–†–µ–∫–∞", "–ü–∞—Ä–∫–∏", "–•—Ä–∞–º—ã"],
                            center: [35.0116, 135.7681],
                            mapLink: "https://www.google.com/maps/d/viewer?mid=1kamo"
                            // track: [
                            //     [35.0400, 135.7681], [35.0350, 135.7700], [35.0250, 135.7720],
                            //     [35.0150, 135.7740], [35.0050, 135.7760], [34.9950, 135.7780],
                            //     [34.9850, 135.7800], [34.9750, 135.7780], [34.9650, 135.7760],
                            //     [34.9750, 135.7740], [34.9850, 135.7720], [35.0000, 135.7700],
                            //     [35.0116, 135.7681]
                            // ]
                        },
                        {
                            id: "itoshima",
                            name: "Itoshima Sunset",
                            badge: "badge-road",
                            desc: "–§—É–∫—É–æ–∫–∞. –ö—Ä–∞—Å–∏–≤–∞—è –¥–æ—Ä–æ–≥–∞ –≤–¥–æ–ª—å –æ–∫–µ–∞–Ω–∞.",
                            distance: "45 –∫–º",
                            gradient: "–°—Ä–µ–¥–Ω–∏–π: 2%, –ú–∞–∫—Å: 6%",
                            elevation: "+200m",
                            duration: "3-4 —á–∞—Å–∞",
                            difficulty: "–°—Ä–µ–¥–Ω—è—è",
                            highlights: ["–ó–∞–∫–∞—Ç—ã", "–ü–ª—è–∂–∏", "–°–µ—Ä—Ñ–∏–Ω–≥"],
                            center: [33.6133, 130.1983],
                            mapLink: "https://www.google.com/maps/d/viewer?mid=1itoshima"
                            // track: [
                            //     [33.5902, 130.4207], [33.5950, 130.3900], [33.6000, 130.3600],
                            //     [33.6050, 130.3300], [33.6100, 130.3000], [33.6133, 130.2700],
                            //     [33.6150, 130.2400], [33.6133, 130.2100], [33.6100, 130.1983],
                            //     [33.6050, 130.1700], [33.6000, 130.1500]
                            // ]
                        },
                        {
                            id: "route308",
                            name: "Route 308 ‚Äî ÊöóÂ≥† (Kuragari Pass)",
                            badge: "badge-road",
                            desc: "Osaka (Higashi-Osaka) ‚Üí Nara (Ikoma). –°–∞–º—ã–π –∂—ë—Å—Ç–∫–∏–π –ø–æ–¥—ä—ë–º –Ω–∞ –≥—Ä–∞–Ω–∏—Ü–µ –ø—Ä–µ—Ñ–µ–∫—Ç—É—Ä.",
                            distance: "‚âà30 –∫–º",
                            gradient: "–£—á–∞—Å—Ç–∫–∞–º–∏ –æ—á–µ–Ω—å –∫—Ä—É—Ç–æ (–ø–µ—Ä–µ–≤–∞–ª ÊöóÂ≥†)",
                            elevation: "+650m",
                            duration: "3‚Äì4 —á–∞—Å–∞",
                            difficulty: "–û—á–µ–Ω—å –≤—ã—Å–æ–∫–∞—è",
                            highlights: ["ÊöóÂ≥† (Kuragari Pass)", "–≥—Ä–∞–Ω–∏—Ü–∞ Osaka‚ÜîNara", "—á–µ–ª–ª–µ–Ω–¥–∂-–ø–æ–¥—ä—ë–º"],
                            center: [34.66583, 135.67139],
                            mapLink: "https://www.google.com/maps?q=34.66583,135.67139"
                            // track: []
                        }
                    ]
                }
            ],
            tips: ["–ü–∞—Ä–æ–º –Ω–∞ –ê–≤–∞–¥–∑–∏ –∏–∑ –ê–∫–∞—Å–∏.", "–ù–∞ –ø–æ–µ–∑–¥–∞—Ö –≤–µ–ª–æ—Å–∏–ø–µ–¥—ã —Ç–æ–ª—å–∫–æ –≤ —á–µ—Ö–ª–∞—Ö."]
        };

        const foodIntel = [
            { id: "osaka", city: "–û—Å–∞–∫–∞", places: [{name:"551 Horai", dish:"Butaman"}, {name:"Endo Sushi", dish:"Sushi"}, {name:"Daruma", dish:"Kushikatsu"}] },
            { id: "kyoto", city: "–ö–∏–æ—Ç–æ", places: [{name:"Honke Owariya", dish:"Soba"}, {name:"Inoda Coffee", dish:"Breakfast"}, {name:"Gogyo", dish:"Burnt Ramen"}] },
            { id: "kobe", city: "–ö–æ–±–µ", places: [{name:"Steakland", dish:"Kobe Beef", why:"–î–æ—Å—Ç—É–ø–Ω—ã–π –ª–∞–Ω—á."}, {name:"Nishimura", dish:"Coffee", why:"–†–µ—Ç—Ä–æ."}, {name:"Roushouki", dish:"Pork Buns", why:"–ß–∞–π–Ω–∞—Ç–∞—É–Ω."}] },
            { id: "kokura", city: "–ö–æ–∫—É—Ä–∞", places: [{name:"Tanga Market", dish:"Uni Don", why:"–†—ã–Ω–æ—á–Ω–∞—è –µ–¥–∞."}, {name:"Tetsunabe", dish:"Iron Gyoza", why:"–ì—ë–¥–∑–∞ –≤ —á—É–≥—É–Ω–µ."}, {name:"Bear Fruits", dish:"Yaki Curry", why:"–ó–∞–ø–µ—á–µ–Ω–Ω–æ–µ –∫–∞—Ä—Ä–∏."}] },
            { id: "fukuoka", city: "–§—É–∫—É–æ–∫–∞", places: [{name:"Shin-Shin", dish:"Tonkotsu"}, {name:"Yatai Stalls", dish:"Street Food"}] },
            { id: "hiroshima", city: "–•–∏—Ä–æ—Å–∏–º–∞", places: [{name:"Hassho", dish:"Okonomiyaki"}, {name:"Bakudanya", dish:"Tsukemen"}] },
            { id: "onomichi", city: "–û–Ω–æ–º–∏—Ç–∏", places: [{name:"U2", dish:"Pasta"}, {name:"Ichibankan", dish:"Ramen"}] }
        ];

        const sightsIntel = [
            { id: "osaka", city: "–û—Å–∞–∫–∞", places: [{name: "Kaiyukan", type: "Aqua", badge: "badge-tech", detail: "–í–µ—á–µ—Ä."}, {name: "TeamLab", type: "Art", badge: "badge-art", detail: "–°–∞–¥."}] },
            { id: "kobe", city: "–ö–æ–±–µ", places: [{name: "Nunobiki Falls", type: "Nature", badge: "badge-nature", detail: "–í–æ–¥–æ–ø–∞–¥ —É –≤–æ–∫–∑–∞–ª–∞."}, {name: "Meriken Park", type: "View", badge: "badge-local", detail: "–ü–æ—Ä—Ç."}] },
            { id: "kyoto", city: "–ö–∏–æ—Ç–æ", places: [{name: "Fushimi Inari", type: "Hike", badge: "badge-history", detail: "–£—Ç—Ä–æ."}, {name: "Arashiyama", type: "Nature", badge: "badge-relax", detail: "–ë–∞–º–±—É–∫."}] },
            { id: "kokura", city: "–ö–æ–∫—É—Ä–∞", places: [{name: "Kokura Castle", type: "History", badge: "badge-history", detail: "–ó–∞–º–æ–∫."}, {name: "Mt. Sarakura", type: "View", badge: "badge-nature", detail: "–ù–æ—á–Ω–æ–π –≤–∏–¥."}] },
            { id: "fukuoka", city: "–§—É–∫—É–æ–∫–∞", places: [{name: "Dazaifu", type: "Shrine", badge: "badge-history", detail: "–•—Ä–∞–º."}, {name: "Canal City", type: "Shop", badge: "badge-tech", detail: "–¢–¶."}] },
            { id: "hiroshima", city: "–•–∏—Ä–æ—Å–∏–º–∞", places: [{name: "Peace Park", type: "History", badge: "badge-history", detail: "–ú—É–∑–µ–π."}, {name: "Miyajima", type: "Nature", badge: "badge-trek", detail: "–ì–æ—Ä–∞ –ú–∏—Å—ç–Ω."}] }
        ];

        const accommodations = [
            { 
                id: "osaka", 
                city: "–û—Å–∞–∫–∞", 
                dates: "15-18.04 & 27-28.04",
                desc: "–ë–∞–∑–∞ 1 (3 –Ω–æ—á–∏) + –§–∏–Ω–∞–ª (1 –Ω–æ—á—å)", 
                status: "pending",
                coords: [34.6937, 135.5023],
                booking: null
            },
            { 
                id: "kyoto", 
                city: "–ö–∏–æ—Ç–æ", 
                dates: "18-21.04",
                desc: "–ë–∞–∑–∞ 2 (3 –Ω–æ—á–∏)", 
                status: "booked",
                coords: [34.9987, 135.7780],
                booking: {
                    name: "–¢–∞—É–Ω—Ö–∞—É—Å –≤ –•–∏–≥–∞—Å–∏—è–º–∞-–∫—É",
                    type: "–¢–∞—É–Ω—Ö–∞—É—Å",
                    badge: "badge-local",
                    rating: "4.86",
                    rooms: "2 —Å–ø–∞–ª—å–Ω–∏",
                    beds: "9 –∫—Ä–æ–≤–∞—Ç–µ–π",
                    bath: "1,5 –≤–∞–Ω–Ω–æ–π",
                    link: "https://www.airbnb.ru/rooms/1197837020382401498",
                    district: "–•–∏–≥–∞—Å–∏—è–º–∞-–∫—É",
                    photo: "https://a0.muscache.com/im/pictures/hosting/Hosting-1197837020382401498/original/7c6a8e6e-8c1a-4e8a-9c1a-4e8a9c1a4e8a.jpeg"
                }
            },
            { 
                id: "kokura", 
                city: "–§—É–∫—É–æ–∫–∞ / –ö–æ–∫—É—Ä–∞", 
                dates: "21-24.04",
                desc: "–ë–∞–∑–∞ 3 (3 –Ω–æ—á–∏)", 
                status: "booked",
                coords: [33.5903, 130.4181],
                booking: {
                    name: "–î–æ–º –≤ –•–∞–∫–∞—Ç–∞-–∫—É",
                    type: "–î–æ–º",
                    badge: "badge-vibe",
                    rating: "4.64",
                    rooms: "4 —Å–ø–∞–ª—å–Ω–∏",
                    beds: "4 –∫—Ä–æ–≤–∞—Ç–∏",
                    bath: "1 –≤–∞–Ω–Ω–∞—è",
                    link: "https://www.airbnb.ru/rooms/50755487",
                    district: "–•–∞–∫–∞—Ç–∞-–∫—É",
                    photo: "https://a0.muscache.com/im/pictures/miso/Hosting-50755487/original/a1b2c3d4-e5f6-7890-abcd-ef1234567890.jpeg"
                }
            },
            { 
                id: "hiroshima", 
                city: "–•–∏—Ä–æ—Å–∏–º–∞", 
                dates: "24-27.04",
                desc: "–ë–∞–∑–∞ 4 (3 –Ω–æ—á–∏)", 
                status: "booked",
                coords: [34.3963, 132.4467],
                booking: {
                    name: "–ñ–∏–ª—å—ë –≤ –ù–∏—Å–∏",
                    type: "–ñ–∏–ª—å—ë",
                    badge: "badge-design",
                    rating: "4.89",
                    rooms: "4 —Å–ø–∞–ª—å–Ω–∏",
                    beds: "7 –∫—Ä–æ–≤–∞—Ç–µ–π",
                    bath: "1,5 –≤–∞–Ω–Ω–æ–π",
                    link: "https://www.airbnb.ru/rooms/1347366679538438479",
                    district: "–ù–∏—Å–∏-–∫—É",
                    photo: "https://a0.muscache.com/im/pictures/hosting/Hosting-1347366679538438479/original/12345678-abcd-efgh-ijkl-mnopqrstuvwx.jpeg"
                }
            }
        ];

        // ============================================
        // üìã DETAILED DAILY PLANS
        // ============================================
        const detailedPlans = {
            osaka: {
                city: "–û—Å–∞–∫–∞",
                dates: "15-18 –∞–ø—Ä–µ–ª—è",
                days: [
                    {
                        date: "16 –∞–ø—Ä–µ–ª—è",
                        title: "–Æ–∂–Ω–∞—è –û—Å–∞–∫–∞, —Ä—ã–Ω–∫–∏ –∏ –≥—Ä–∞—Ñ—Ñ–∏—Ç–∏",
                        distance: "~20 –∫–º –≤–µ–ª–æ + 8-10 –∫–º –ø–µ—à–∫–æ–º",
                        items: [
                            { time: "08:00-09:00", title: "–†—ã–Ω–æ–∫ Kuromon Ichiba", desc: "–ó–∞–≤—Ç—Ä–∞–∫ –Ω–∞ –∑–Ω–∞–º–µ–Ω–∏—Ç–æ–º —Ä—ã–Ω–∫–µ. –°—É—à–∏, —Å–∞—à–∏–º–∏, —É—Å—Ç—Ä–∏—Ü—ã, —Ç–∞–∫–æ-—è–∫–∏ –æ—Ç Takoyaki Wanaka.", type: "food", coords: [34.6628, 135.5058] },
                            { time: "09:30-11:00", title: "–°–≤—è—Ç–∏–ª–∏—â–µ Sumiyoshi Taisha", desc: "7 –∫–º –Ω–∞ —é–≥. –î—Ä–µ–≤–Ω–µ–π—à–∏–π —Ö—Ä–∞–º III –≤–µ–∫–∞, –∫—Ä–∞—Å–Ω—ã–π –º–æ—Å—Ç Taiko-bashi.", type: "sight", coords: [34.6128, 135.4928] },
                            { time: "11:00-12:30", title: "Kitakagaya Art District", desc: "3 –∫–º. –ö–≤–∞—Ä—Ç–∞–ª —Å—Ç—Ä–∏—Ç-–∞—Ä—Ç–∞, –º—É—Ä–∞–ª—ã Ben Eine, –≥–∞–ª–µ—Ä–µ–∏ Chidori-Bunka.", type: "art", coords: [34.6283, 135.4683] },
                            { time: "13:00-14:30", title: "–°–∏–Ω—Å—ç–∫–∞–π + –±–∞—à–Ω—è Ts≈´tenkaku", desc: "4 –∫–º. –†–µ—Ç—Ä–æ-—Ä–∞–π–æ–Ω, –∫—É—à–∏–∫–∞—Ü—É –≤ Daruma, —Ä–µ—Ç—Ä–æ-–∏–≥—Ä—ã Smartball.", type: "sight", coords: [34.6525, 135.5063] },
                            { time: "15:00-17:00", title: "–ê–º–µ—Ä–∏–∫–∞-–º—É—Ä–∞", desc: "2 –∫–º. –ú–æ–ª–æ–¥—ë–∂–Ω–∞—è –∫—É–ª—å—Ç—É—Ä–∞, –≥—Ä–∞—Ñ—Ñ–∏—Ç–∏ Peace on Earth, –≤–∏–Ω—Ç–∞–∂.", type: "art", coords: [34.6722, 135.4997] },
                            { time: "18:00-21:00", title: "–í–µ—á–µ—Ä –≤ –ù–∞–º–±–∞", desc: "–†–∞–º–µ–Ω Ryukishin RIZE –∏–ª–∏ Hanamaruken, –ø—Ä–æ–≥—É–ª–∫–∞ –ø–æ –î–æ—Ç–æ–Ω–±–æ—Ä–∏.", type: "food", coords: [34.6687, 135.5013] }
                        ]
                    },
                    {
                        date: "17 –∞–ø—Ä–µ–ª—è",
                        title: "–í–µ–ª–æ–ø—Ä–æ–±–µ–≥ –≤ –ö–æ–±–µ",
                        distance: "~80 –∫–º (—Ç—É–¥–∞-–æ–±—Ä–∞—Ç–Ω–æ) –∏–ª–∏ 40 –∫–º + –ø–æ–µ–∑–¥",
                        items: [
                            { time: "07:30-11:30", title: "–û—Å–∞–∫–∞ ‚Üí –ö–æ–±–µ", desc: "35-40 –∫–º –ø–æ —Ç—Ä–∞—Å—Å–µ ‚Ññ2. –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤ –ù–∏—Å–∏–Ω–æ–º–∏—è, –º—É–∑–µ–π —Å–∞–∫–µ Hakutsuru.", type: "velo", coords: [34.6901, 135.1955] },
                            { time: "12:00-14:00", title: "–ß–∞–π–Ω–∞—Ç–∞—É–Ω –ù–∞–Ω–∫–∏–Ω–º–∞—Ç–∏", desc: "–°—è–æ–ª—É–Ω–±–∞–æ, –º–∞–Ω—å—Ç–æ—É, —É–ª–∏—á–Ω–∞—è –µ–¥–∞. –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: Ramen Kai (—Ü—É–∫—ç–º–µ–Ω —Å –Ω–∏–±–æ—Å–∏).", type: "food", coords: [34.6878, 135.1783] },
                            { time: "14:00-16:30", title: "–ü–æ—Ä—Ç –ö–æ–±–µ", desc: "Meriken Park, BE KOBE, Harborland, –∫–æ–ª–µ—Å–æ –æ–±–æ–∑—Ä–µ–Ω–∏—è, Kitano Ijinkan.", type: "sight", coords: [34.6833, 135.1867] },
                            { time: "17:00-20:30", title: "–í–æ–∑–≤—Ä–∞—â–µ–Ω–∏–µ + –æ–Ω—Å—ç–Ω", desc: "–û–±—Ä–∞—Ç–Ω–æ –≤–µ–ª–æ –∏–ª–∏ –ø–æ–µ–∑–¥ Hanshin. Spa World –∏–ª–∏ Naniwa no Yu.", type: "relax", coords: [34.6525, 135.5063] }
                        ]
                    },
                    {
                        date: "18 –∞–ø—Ä–µ–ª—è",
                        title: "–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –∏ —Å–µ–≤–µ—Ä–Ω–∞—è –û—Å–∞–∫–∞",
                        distance: "~25 –∫–º –≤–µ–ª–æ + 5-7 –∫–º –ø–µ—à–∫–æ–º",
                        items: [
                            { time: "09:00-11:00", title: "–ó–∞–º–æ–∫ –û—Å–∞–∫–∞", desc: "5 –∫–º. –ü–∞—Ä–∫ —Å —Å–∞–∫—É—Ä–æ–π, –º—É–∑–µ–π –≤ –∑–∞–º–∫–µ, —Å–∞–¥ Nishinomaru.", type: "sight", coords: [34.6873, 135.5262] },
                            { time: "11:00-12:30", title: "–ú–æ–Ω–µ—Ç–Ω—ã–π –¥–≤–æ—Ä (Sakura no Torinuke)", desc: "2 –∫–º. 560–º –∞–ª–ª–µ—è –∏–∑ 350 –¥–µ—Ä–µ–≤—å–µ–≤ —Å–∞–∫—É—Ä—ã (11-17 –∞–ø—Ä–µ–ª—è).", type: "nature", coords: [34.6917, 135.5183] },
                            { time: "13:00-14:30", title: "–¢—ç–Ω–º–∞ + –¢—ç–Ω–¥–∑–∏–Ω–±–∞—à–∏-—Å—É–¥–∑–∏", desc: "–°–∞–º–∞—è –¥–ª–∏–Ω–Ω–∞—è —Ç–æ—Ä–≥–æ–≤–∞—è –≥–∞–ª–µ—Ä–µ—è (2.6 –∫–º). –û–∫–æ–Ω–æ–º–∏—è–∫–∏ –≤ Ajinoya.", type: "food", coords: [34.7033, 135.5117] },
                            { time: "15:00-17:00", title: "–ù–∞–∫–∞–¥–∑–∞–∫–∏-—á–æ", desc: "2 –∫–º. –•–∏–ø—Å—Ç–µ—Ä—Å–∫–∏–π –∫–≤–∞—Ä—Ç–∞–ª, –≤–∏–Ω—Ç–∞–∂, –∫–∞—Ñ–µ –≤ —Å—Ç–∞—Ä—ã—Ö –¥–æ–º–∞—Ö.", type: "art", coords: [34.7083, 135.5067] },
                            { time: "17:30-19:30", title: "Umeda Sky Building", desc: "–ó–∞–∫–∞—Ç —Å –≤—ã—Å–æ—Ç—ã 173–º. –†–∞–º–µ–Ω Kadoya Shokudo –∏–ª–∏ Butakin.", type: "sight", coords: [34.7050, 135.4900] }
                        ]
                    }
                ]
            },
            kyoto: {
                city: "–ö–∏–æ—Ç–æ",
                dates: "18-21 –∞–ø—Ä–µ–ª—è (–≤—ã–µ–∑–¥ —É—Ç—Ä–æ–º 21)",
                days: [
                    {
                        date: "18 –∞–ø—Ä–µ–ª—è",
                        title: "–ì–∏–æ–Ω –∏ –•–∏–≥–∞—Å–∏—è–º–∞",
                        distance: "~5 –∫–º –ø–µ—à–∫–æ–º",
                        items: [
                            { time: "–£—Ç—Ä–æ", title: "–ö–∏—ë–º–∏–¥–∑—É-–¥—ç—Ä–∞", desc: "–î–µ—Ä–µ–≤—è–Ω–Ω—ã–π —Ö—Ä–∞–º –Ω–∞ —Ö–æ–ª–º–µ. –ü–æ–¥—ä—ë–º –ø–æ –ù–∏–Ω–µ–Ω-–¥–∑–∞–∫–∞/–°–∞–Ω–Ω–µ–Ω-–¥–∑–∞–∫–∞.", type: "sight", coords: [34.9949, 135.7850] },
                            { time: "–î–µ–Ω—å", title: "–ü–∞—Ä–∫ –ú—ç—Ä—É—è–º–∞ + –Ø—Å–∞–∫–∞", desc: "–ì–ª–∞–≤–Ω—ã–π –ø–∞—Ä–∫ —Å–∞–∫—É—Ä—ã —Å –≥–∏–≥–∞–Ω—Ç—Å–∫–æ–π –ø–ª–∞–∫—É—á–µ–π –≤–∏—à–Ω–µ–π. –í–µ—á–µ—Ä–Ω—è—è –ø–æ–¥—Å–≤–µ—Ç–∫–∞.", type: "nature", coords: [35.0036, 135.7808] },
                            { time: "–í–µ—á–µ—Ä", title: "–†–µ–∫–∞ –ö–∞–º–æ + –ü–æ–Ω—Ç—ë-—Ç—ë", desc: "–ü—Ä–æ–≥—É–ª–∫–∞ –≤–¥–æ–ª—å —Ä–µ–∫–∏, —Å—Ç–∞—Ä–∏–Ω–Ω–∞—è –∞–ª–ª–µ—è —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤.", type: "food", coords: [35.0050, 135.7700] },
                            { time: "–£–∂–∏–Ω", title: "Menya Inoichi", desc: "Michelin-—Ä–∞–º–µ–Ω —Å –±—É–ª—å–æ–Ω–æ–º –∏–∑ –º–æ—Ä–µ–ø—Ä–æ–¥—É–∫—Ç–æ–≤.", type: "food", coords: [35.0033, 135.7683] }
                        ]
                    },
                    {
                        date: "19 –∞–ø—Ä–µ–ª—è",
                        title: "–ê—Ä–∞—Å–∏—è–º–∞ –∏ –ø—Ä–∏—Ä–æ–¥–∞",
                        distance: "~16 –∫–º –≤–µ–ª–æ",
                        items: [
                            { time: "–£—Ç—Ä–æ", title: "–ë–∞–º–±—É–∫–æ–≤–∞—è —Ä–æ—â–∞", desc: "8 –∫–º –æ—Ç —Ü–µ–Ω—Ç—Ä–∞. –ó–Ω–∞–º–µ–Ω–∏—Ç–∞—è –∞–ª–ª–µ—è –≤—ã—Å–æ–∫–∏—Ö –±–∞–º–±—É–∫–æ–≤.", type: "nature", coords: [35.0168, 135.6713] },
                            { time: "–î–µ–Ω—å", title: "–ú–æ—Å—Ç –¢–æ–≥—ç—Ü—É–∫—ë + —Ä–µ–∫–∞ –•–æ–∑—É", desc: "–§–æ—Ç–æ–≥–µ–Ω–∏—á–Ω—ã–π –¥–µ—Ä–µ–≤—è–Ω–Ω—ã–π –º–æ—Å—Ç, –≤–∏–¥ –Ω–∞ —Ö–æ–ª–º—ã.", type: "sight", coords: [35.0142, 135.6778] },
                            { time: "–î–µ–Ω—å", title: "–ü–∞—Ä–∫ –æ–±–µ–∑—å—è–Ω –ò–≤–∞—Ç–∞—è–º–∞", desc: "15-20 –º–∏–Ω –ø–æ–¥—ä—ë–º, –ø–∞–Ω–æ—Ä–∞–º–∞ –ö–∏–æ—Ç–æ, –º–∞–∫–∞–∫–∏.", type: "nature", coords: [35.0108, 135.6742] },
                            { time: "–ü–æ–ª–¥–µ–Ω—å", title: "–û–Ω—Å—ç–Ω Arashiyama", desc: "Sagano Onsen Tenzanoyu ‚Äî —Ö–ª–æ—Ä–∏–¥–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏.", type: "relax", coords: [35.0183, 135.6817] }
                        ]
                    },
                    {
                        date: "20 –∞–ø—Ä–µ–ª—è",
                        title: "–°–µ–≤–µ—Ä–Ω—ã–π –ö–∏–æ—Ç–æ + –§–∏–ª–æ—Å–æ—Ñ—Å–∫–∏–π –ø—É—Ç—å",
                        distance: "~15 –∫–º –≤–µ–ª–æ/–ø–µ—à–∫–æ–º",
                        items: [
                            { time: "–£—Ç—Ä–æ", title: "–ö–∏–Ω–∫–∞–∫—É-–¥–∑–∏ (–ó–æ–ª–æ—Ç–æ–π –ø–∞–≤–∏–ª—å–æ–Ω)", desc: "–ó–æ–ª–æ—Ç–æ–π –ø–∞–≤–∏–ª—å–æ–Ω –Ω–∞ –ø—Ä—É–¥—É.", type: "sight", coords: [35.0394, 135.7292] },
                            { time: "–î–µ–Ω—å", title: "–†—ë–∞–Ω–¥–∑–∏ + –ù–∏–Ω–Ω–∞-–¥–∑–∏", desc: "–ö–∞–º–µ–Ω–Ω—ã–π —Å–∞–¥. –û–º—É—Ä–æ-—Å–∞–∫—É—Ä–∞ ‚Äî —Ü–≤–µ—Ç—ë—Ç –ø–æ–∑–∂–µ –æ–±—ã—á–Ω–æ–π.", type: "sight", coords: [35.0345, 135.7183] },
                            { time: "–î–µ–Ω—å", title: "–ì–∏–Ω–∫–∞–∫—É–¥–∑–∏ + –§–∏–ª–æ—Å–æ—Ñ—Å–∫–∏–π –ø—É—Ç—å", desc: "2-3 –∫–º –≤–¥–æ–ª—å –∫–∞–Ω–∞–ª–∞ —Å —Å–∞–∫—É—Ä–æ–π –¥–æ –ù–∞–Ω–∑—ç–Ω-–¥–∑–∏.", type: "nature", coords: [35.0267, 135.7983] },
                            { time: "–í–µ—á–µ—Ä", title: "Honke Daiichi Asahi", desc: "–ê—É—Ç–µ–Ω—Ç–∏—á–Ω—ã–π —Ä–∞–º–µ–Ω —É —Å—Ç–∞–Ω—Ü–∏–∏ –ö–∏–æ—Ç–æ. –ü–æ—Å–ª–µ–¥–Ω–∏–π –≤–µ—á–µ—Ä!", type: "food", coords: [34.9858, 135.7583] }
                        ]
                    }
                ]
            },
            fukuoka: {
                city: "–§—É–∫—É–æ–∫–∞",
                dates: "21-24 –∞–ø—Ä–µ–ª—è (–≤—ã–µ–∑–¥ —É—Ç—Ä–æ–º 24)",
                days: [
                    {
                        date: "21 –∞–ø—Ä–µ–ª—è",
                        title: "–ü—Ä–∏–µ–∑–¥ + –ü–∞—Ä–∫–∏ –∏ —Ä–∞–º–µ–Ω",
                        distance: "~15 –∫–º –≤–µ–ª–æ",
                        items: [
                            { time: "–£—Ç—Ä–æ", title: "–ü—Ä–∏–µ–∑–¥ –∏–∑ –ö–∏–æ—Ç–æ", desc: "–°–∏–Ω–∫–∞–Ω—Å—ç–Ω –ö–∏–æ—Ç–æ ‚Üí –•–∞–∫–∞—Ç–∞ (~2.5 —á–∞—Å–∞).", type: "transport", coords: [33.5897, 130.4208] },
                            { time: "12:00-13:00", title: "–†–∞–º–µ–Ω ShinShin", desc: "40+ –ª–µ—Ç. –ö—Ä–µ–º–æ–≤—ã–π —Ç–æ–Ω–∫–æ—Ü—É, —Ç–æ–Ω–∫–∞—è –ª–∞–ø—à–∞.", type: "food", coords: [33.5897, 130.4208] },
                            { time: "14:00-16:00", title: "–ü–∞—Ä–∫ –ú–∞–∏–¥–∑—É—Ä—É + –û—Ö–æ—Ä–∏", desc: "–†—É–∏–Ω—ã –∑–∞–º–∫–∞ –§—É–∫—É–æ–∫–∞, 1000 —Å–∞–∫—É—Ä, –æ–∑–µ—Ä–æ.", type: "nature", coords: [33.5858, 130.3842] },
                            { time: "16:30-18:00", title: "Y's Road Fukuoka Tenjin", desc: "–ö—Ä—É–ø–Ω–µ–π—à–∏–π –≤–µ–ª–æ–º–∞–≥–∞–∑–∏–Ω. 300+ –≤–µ–ª–æ—Å–∏–ø–µ–¥–æ–≤, –æ–¥–µ–∂–¥–∞.", type: "shop", coords: [33.5892, 130.3983] },
                            { time: "19:00-20:30", title: "Ichiran –∏–ª–∏ IPPUDO", desc: "–ö—É–ª—å—Ç–æ–≤—ã–π —Ç–æ–Ω–∫–æ—Ü—É-—Ä–∞–º–µ–Ω.", type: "food", coords: [33.5897, 130.4208] }
                        ]
                    },
                    {
                        date: "22 –∞–ø—Ä–µ–ª—è",
                        title: "–ü–æ–±–µ—Ä–µ–∂—å–µ Munakata-Shikanoshima",
                        distance: "~51 –∫–º –≤–µ–ª–æ",
                        items: [
                            { time: "09:00-10:00", title: "–°–≤—è—Ç–∏–ª–∏—â–µ –ú—É–Ω–∞–∫–∞—Ç–∞ –¢–∞–π—Å—è", desc: "–í—Å–µ–º–∏—Ä–Ω–æ–µ –Ω–∞—Å–ª–µ–¥–∏–µ, —Ç—Ä–∏ –±–æ–≥–∏–Ω–∏ –º–æ—Ä—è.", type: "sight", coords: [33.8300, 130.5133] },
                            { time: "10:15-11:00", title: "Michi-no-Eki Munakata", desc: "–§–µ—Ä–º–µ—Ä—Å–∫–∏–π —Ä—ã–Ω–æ–∫, —Ä—ã–±–∞, –ø–µ–∫–∞—Ä–Ω—è.", type: "food", coords: [33.8117, 130.5283] },
                            { time: "11:00-13:00", title: "–í–µ–ª–æ –≤–¥–æ–ª—å –ø–æ–±–µ—Ä–µ–∂—å—è", desc: "Miyajidake Shrine (11–º —à–∏–º—ç–Ω–∞–≤–∞), –æ—Å—Ç—Ä–æ–≤ –®–∏–∫–∞–Ω–æ—Å–∏–º–∞.", type: "velo", coords: [33.6833, 130.3167] },
                            { time: "14:00-16:00", title: "–ü–ª—è–∂–∏ –®–∏–∫–∞–Ω–æ—à–∏–º—ã", desc: "–ú–∞—è–∫, –ø–ª—è–∂ Umi, –º–æ—Ä—Å–∫–∏–µ –ø–∞–Ω–æ—Ä–∞–º—ã.", type: "nature", coords: [33.6833, 130.3167] },
                            { time: "19:00-20:30", title: "Ramen Stadium", desc: "–§—É–¥-–∫–æ—Ä—Ç –≤ Canal City. –ù–µ—Å–∫–æ–ª—å–∫–æ –≤–∏–¥–æ–≤ —Ä–∞–º–µ–Ω–∞.", type: "food", coords: [33.5897, 130.4108] }
                        ]
                    },
                    {
                        date: "23 –∞–ø—Ä–µ–ª—è",
                        title: "–ò—Ç–æ—Å–∏–º–∞ –∏ –æ–Ω—Å—ç–Ω",
                        distance: "~30 –∫–º –≤–µ–ª–æ",
                        items: [
                            { time: "09:00-10:30", title: "Sakurai Futamigaura", desc: "–°–∫–∞–ª—ã-—Å—É–ø—Ä—É–≥–∏ —Å —Ä–∏—Ç—É–∞–ª—å–Ω—ã–º –∫–∞–Ω–∞—Ç–æ–º.", type: "sight", coords: [33.6117, 130.1617] },
                            { time: "10:45-12:00", title: "–ú–æ—Ä—Å–∫–∞—è –¥–æ—Ä–æ–≥–∞ –ò—Ç–æ—à–∏–º–∞", desc: "Keya no Oto ‚Äî –º–æ—Ä—Å–∫–∞—è –∞—Ä–∫–∞, —Å–∫–∞–ª–∏—Å—Ç—ã–µ –ø–ª—è–∂–∏.", type: "nature", coords: [33.6283, 130.1283] },
                            { time: "12:15-13:15", title: "–û–±–µ–¥ –≤ –ò—Ç–æ—à–∏–º–∞", desc: "–°–≤–µ–∂–∏–µ —É—Å—Ç—Ä–∏—Ü—ã, –∫—Ä–µ–≤–µ—Ç–∫–∏, —Ç–∞–∫–æ—è–∫–∏.", type: "food", coords: [33.6117, 130.1617] },
                            { time: "13:30-15:30", title: "Onsen Nijo Kirara-no-Yu", desc: "–†–∞–¥–æ–Ω–æ–≤—ã–π –æ–Ω—Å—ç–Ω. –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –∏ –æ—Ç–∫—Ä—ã—Ç—ã–µ –≤–∞–Ω–Ω—ã.", type: "relax", coords: [33.5283, 130.2117] },
                            { time: "18:00-19:30", title: "–†–∞–º–µ–Ω Ichiryu", desc: "–ù–∞—Å—ã—â–µ–Ω–Ω—ã–π —Ç–æ–Ω–∫–æ—Ü—É. –ü–æ—Å–ª–µ–¥–Ω–∏–π –≤–µ—á–µ—Ä –≤ –§—É–∫—É–æ–∫–µ!", type: "food", coords: [33.5897, 130.4208] }
                        ]
                    }
                ]
            },
            hiroshima: {
                city: "–•–∏—Ä–æ—Å–∏–º–∞",
                dates: "24-27 –∞–ø—Ä–µ–ª—è (–≤—ã–µ–∑–¥ —É—Ç—Ä–æ–º 27)",
                days: [
                    {
                        date: "24 –∞–ø—Ä–µ–ª—è",
                        title: "–ü—Ä–∏–µ–∑–¥ + –ò—Å—Ç–æ—Ä–∏—è",
                        distance: "~10 –∫–º –≤–µ–ª–æ",
                        items: [
                            { time: "–£—Ç—Ä–æ", title: "–ü—Ä–∏–µ–∑–¥ –∏–∑ –§—É–∫—É–æ–∫–∏", desc: "–°–∏–Ω–∫–∞–Ω—Å—ç–Ω –•–∞–∫–∞—Ç–∞ ‚Üí –•–∏—Ä–æ—Å–∏–º–∞ (~1 —á–∞—Å).", type: "transport", coords: [34.3853, 132.4553] },
                            { time: "–î–µ–Ω—å", title: "–ó–∞—Å–µ–ª–µ–Ω–∏–µ + —Ä–∞—Å–∫–∞—Ç–∫–∞", desc: "30-60 –º–∏–Ω –≤–¥–æ–ª—å —Ä–µ–∫, –ø–ª–æ—Å–∫–æ –¥–ª—è —Ñ–∏–∫—Å–æ–≤.", type: "velo", coords: [34.3853, 132.4553] },
                            { time: "–í–µ—á–µ—Ä", title: "Peace Memorial Park", desc: "A-Bomb Dome, –º—É–∑–µ–π, –º–µ–º–æ—Ä–∏–∞–ª.", type: "sight", coords: [34.3955, 132.4536] },
                            { time: "–£–∂–∏–Ω", title: "Chukasoba Youki (ÈôΩÊ∞ó)", desc: "–ö–ª–∞—Å—Å–∏–∫–∞ —Ö–∏—Ä–æ—Å–∏–º—Å–∫–æ–≥–æ —Ä–∞–º–µ–Ω–∞.", type: "food", coords: [34.3917, 132.4583] }
                        ]
                    },
                    {
                        date: "25 –∞–ø—Ä–µ–ª—è",
                        title: "–•–∞–π–∫–∏–Ω–≥: Miyajima + Mt. Misen",
                        distance: "–•–∞–π–∫–∏–Ω–≥ ~6 –∫–º",
                        items: [
                            { time: "–£—Ç—Ä–æ", title: "–ü–æ–µ–∑–¥ –¥–æ Miyajimaguchi", desc: "–í–µ–ª–æ—Å–∏–ø–µ–¥—ã –æ—Å—Ç–∞–≤–∏—Ç—å –Ω–∞ –º–∞—Ç–µ—Ä–∏–∫–µ.", type: "transport", coords: [34.2958, 132.3197] },
                            { time: "–î–µ–Ω—å", title: "–û—Å—Ç—Ä–æ–≤ –ú–∏—è–¥–∑–∏–º–∞", desc: "–•—Ä–∞–º –ò—Ü—É–∫—É—Å–∏–º–∞, –ø–ª–∞–≤–∞—é—â–∏–µ —Ç–æ—Ä–∏–∏, –æ–ª–µ–Ω–∏.", type: "sight", coords: [34.2958, 132.3197] },
                            { time: "–î–µ–Ω—å", title: "Mt. Misen —Ö–∞–π–∫", desc: "–í–≤–µ—Ä—Ö –ø–µ—à–∫–æ–º, –≤–Ω–∏–∑ ropeway (–∏–ª–∏ –Ω–∞–æ–±–æ—Ä–æ—Ç).", type: "nature", coords: [34.2783, 132.3117] },
                            { time: "–í–µ—á–µ—Ä", title: "Hiroshima tsukemen", desc: "–•–æ–ª–æ–¥–Ω–∞—è –ª–∞–ø—à–∞ + –æ—Å—Ç—Ä—ã–π —Å–æ—É—Å.", type: "food", coords: [34.3917, 132.4583] }
                        ]
                    },
                    {
                        date: "26 –∞–ø—Ä–µ–ª—è",
                        title: "–í–µ–ª–æ–¥–µ–Ω—å: Onomichi + Shimanami",
                        distance: "~50-70 –∫–º –≤–µ–ª–æ",
                        items: [
                            { time: "–£—Ç—Ä–æ", title: "–ü–æ–µ–∑–¥ –¥–æ Onomichi", desc: "–†–µ—Ç—Ä–æ-–≥–æ—Ä–æ–¥, —Ö—Ä–∞–º—ã –Ω–∞ —Ö–æ–ª–º–∞—Ö.", type: "transport", coords: [34.4095, 133.2049] },
                            { time: "–î–µ–Ω—å", title: "Shimanami Kaido out&back", desc: "–ú–æ—Å—Ç—ã —á–µ—Ä–µ–∑ –æ—Å—Ç—Ä–æ–≤–∞. –¢–µ–º–ø –¥–ª—è —Ñ–∏–∫—Å–æ–≤.", type: "velo", coords: [34.3667, 133.0833] },
                            { time: "–ü–∏—Ç-—Å—Ç–æ–ø", title: "ONOMICHI U2 + GIANT STORE", desc: "–í–µ–ª–æ–∫–æ–º–ø–ª–µ–∫—Å, –∫–æ—Ñ–µ, –º–∞–≥–∞–∑–∏–Ω.", type: "shop", coords: [34.4083, 133.2017] },
                            { time: "–í–µ—á–µ—Ä", title: "Grumpy Bike Shop + —É–∂–∏–Ω", desc: "–û–¥–µ–∂–¥–∞/–∞–∫—Å–µ—Å—Å—É–∞—Ä—ã. –ü–æ—Å–ª–µ–¥–Ω–∏–π –≤–µ—á–µ—Ä!", type: "shop", coords: [34.3917, 132.4583] }
                        ]
                    }
                ]
            }
        };

        const logisticsData = [
            { type: "JR Pass", icon: "üé´", title: "Sanyo-San'in Area Pass", detail: "7 –¥–Ω–µ–π (¬•23,000). –ê–∫—Ç–∏–≤–∞—Ü–∏—è 21.04. –ü–æ–∫—Ä—ã–≤–∞–µ—Ç –•–∏—Ä–æ—Å–∏–º—É, –ö–æ–∫—É—Ä—É –∏ –≤–æ–∑–≤—Ä–∞—Ç.", vital: "–ò–¥–µ–∞–ª—å–Ω–æ." },
            { type: "–ë–∞–≥–∞–∂", icon: "üöö", title: "Yamato", detail: "–ö–∏–æ—Ç–æ -> –•–∏—Ä–æ—Å–∏–º–∞.<br>–•–∏—Ä–æ—Å–∏–º–∞ -> –û—Å–∞–∫–∞.", vital: "–ù–∞–ª–µ–≥–∫–µ." }
        ];
        
        const checklistData = [
            { id: 1, text: "–ö—É–ø–∏—Ç—å Rinko Bags", done: false, urgent: true },
            { id: 2, text: "–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–µ–ª–∏", done: false },
            { id: 3, text: "JR Pass –í–∞—É—á–µ—Ä", done: false }
        ];

        // ============================================
        // üìù CHECKLIST with LocalStorage
        // ============================================
        const CHECKLIST_KEY = 'jp2026_checklist_v1';

        function loadChecklist() {
            const saved = localStorage.getItem(CHECKLIST_KEY);
            if (!saved) return checklistData;
            try { return JSON.parse(saved); } catch { return checklistData; }
        }

        function saveChecklist(list) {
            localStorage.setItem(CHECKLIST_KEY, JSON.stringify(list));
        }

        let checklist = loadChecklist();
        let filteredItinerary = [...itinerary];

        // --- RENDERERS ---
        let currentState = {
            view: 'itinerary',
            infoSubTab: 'logistics',
            selectedFoodCityId: 'osaka',
            selectedSightsCityId: 'osaka',
            selectedHotelCityId: 'osaka',
            mapInstance: null,
            searchQuery: ''
        };

        // ============================================
        // üîó URL STATE MANAGEMENT
        // ============================================
        function readUrlState() {
            const u = new URL(window.location.href);
            const view = u.searchParams.get('view');
            const sub = u.searchParams.get('sub');
            const city = u.searchParams.get('city');

            if (view) currentState.view = view;
            if (sub && currentState.view === 'info') currentState.infoSubTab = sub;

            if (city) {
                if (currentState.view === 'food') currentState.selectedFoodCityId = city;
                if (currentState.view === 'sights') currentState.selectedSightsCityId = city;
                // if (currentState.view === 'hotels') currentState.selectedHotelCityId = city;
            }
        }

        function writeUrlState() {
            const u = new URL(window.location.href);
            u.searchParams.set('view', currentState.view);

            if (currentState.view === 'info') u.searchParams.set('sub', currentState.infoSubTab);
            else u.searchParams.delete('sub');

            if (['food','sights'/* ,'hotels' */].includes(currentState.view)) {
                const city =
                    currentState.view === 'food' ? currentState.selectedFoodCityId :
                    currentState.view === 'sights' ? currentState.selectedSightsCityId :
                    currentState.selectedHotelCityId;
                u.searchParams.set('city', city);
            } else {
                u.searchParams.delete('city');
            }

            history.replaceState(null, '', u.toString());
        }

        // ============================================
        // üó∫Ô∏è YANDEX MAP
        // ============================================
        function loadYandexMap(containerId) {
            const container = document.getElementById(containerId);
            if (!container) return;

            // Show skeleton
            container.innerHTML = '<div class="map-skeleton"></div>';

            if (window.ymaps) {
                ymaps.ready(() => initMap(containerId));
            } else {
                const s = document.createElement('script');
                s.src = `https://api-maps.yandex.ru/2.1/?apikey=${YANDEX_API_KEY}&lang=ru_RU`;
                s.onload = () => ymaps.ready(() => initMap(containerId));
                document.head.appendChild(s);
            }
        }

        function initMap(id) {
            const container = document.getElementById(id);
            if (!container) return;

            // Remove skeleton
            container.innerHTML = '';

            const map = new ymaps.Map(id, {
                center: [34.5, 133.5],
                zoom: 7,
                controls: ['zoomControl']
            });

            // Save reference for quick jump
            window.yandexMap = map;

            const isMobile = window.innerWidth <= 768;

            function makePlacemark({ coords, name, desc, preset, isMobile }) {
                const balloonContent = `
                    <div class="balloon-title">${name}</div>
                    <div class="balloon-desc">${desc}</div>
                `;

                const placemark = new ymaps.Placemark(
                    coords,
                    {
                        iconCaption: name,
                        balloonContentBody: balloonContent
                    },
                    {
                        preset,
                        hideIconOnBalloonOpen: false,
                        balloonOffset: [0, -32],
                        balloonMaxWidth: 280,
                        balloonAutoPan: true,
                        balloonCloseButton: isMobile
                    }
                );

                if (isMobile) {
                    placemark.events.add('click', () => {
                        placemark.balloon.open();
                    });
                } else {
                    placemark.events.add('mouseenter', () => {
                        placemark.balloon.open();
                    });
                    placemark.events.add('mouseleave', () => {
                        placemark.balloon.close();
                    });
                    placemark.events.add('mousedown', () => placemark.balloon.open());
                }

                return placemark;
            }

            // Route line removed - only city markers
            // const coords = mapLocations.map(l => l.coords);
            // map.geoObjects.add(new ymaps.Polyline(coords, {}, {
            //     strokeColor: "#e11d48",
            //     strokeWidth: 4
            // }));

            mapLocations.forEach(l => {
                const placemark = makePlacemark({
                    coords: l.coords,
                    name: l.name,
                    desc: l.desc,
                    preset: 'islands#redDotIconWithCaption',
                    isMobile
                });
                map.geoObjects.add(placemark);
            });

            pointsOfInterest.forEach(poi => {
                const placemark = makePlacemark({
                    coords: poi.coords,
                    name: poi.name,
                    desc: poi.desc,
                    preset: 'islands#blueDotIconWithCaption',
                    isMobile
                });
                map.geoObjects.add(placemark);
            });

            showToast('–ö–∞—Ä—Ç–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞', 'success');
        }

        // ============================================
        // üîç SEARCH & FILTER
        // ============================================
        function filterItinerary(query) {
            currentState.searchQuery = query.toLowerCase();
            if (!query) {
                filteredItinerary = [...itinerary];
            } else {
                filteredItinerary = itinerary.filter(item =>
                    item.title.toLowerCase().includes(query) ||
                    item.city.toLowerCase().includes(query) ||
                    item.desc.toLowerCase().includes(query)
                );
            }
            renderCurrentView();
        }

        // ============================================
        // üì± SWIPE GESTURES
        // ============================================
        let touchStartX = 0;
        let touchEndX = 0;

        document.addEventListener('touchstart', e => {
            touchStartX = e.touches[0].clientX;
        });

        document.addEventListener('touchend', e => {
            touchEndX = e.changedTouches[0].clientX;
            handleSwipe();
        });

        function handleSwipe() {
            const diff = touchEndX - touchStartX;
            const threshold = 100;

            if (Math.abs(diff) < threshold) return;

            const views = ['itinerary', 'map', 'velo', 'accommodation', 'info'];
            const currentIndex = views.indexOf(currentState.view);

            if (diff > 0 && currentIndex > 0) {
                // Swipe right - previous
                switchView(views[currentIndex - 1]);
            } else if (diff < 0 && currentIndex < views.length - 1) {
                // Swipe left - next
                switchView(views[currentIndex + 1]);
            }
        }

        // ============================================
        // üé® RENDERING
        // ============================================
        function renderDesktopNav() {
            const tabs = [
                {id:'itinerary',label:'üìÖ –ü–ª–∞–Ω'},
                {id:'map',label:'üó∫Ô∏è –ö–∞—Ä—Ç–∞'},
                {id:'velo',label:'üö¥ –í–µ–ª–æ'},
                {id:'accommodation',label:'üè† –ñ–∏–ª—å—ë'},
                {id:'info',label:'‚ÑπÔ∏è –ò–Ω—Ñ–æ'}
            ];
            document.getElementById('desktop-nav').innerHTML = tabs.map(t =>
                `<button onclick="switchView('${t.id}')" class="px-3 py-2 rounded-md transition-all ${
                    currentState.view === t.id ? 'bg-stone-900 text-white' : 'text-stone-600 hover:bg-stone-100'
                }">${t.label}</button>`
            ).join('');
        }

        function renderMobileNav() {
            const tabs = [
                { id: 'itinerary', label: '–ü–ª–∞–Ω', icon: '<path d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />' },
                { id: 'map', label: '–ö–∞—Ä—Ç–∞', icon: '<path d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7" />' },
                { id: 'velo', label: '–í–µ–ª–æ', icon: '<path d="M13 10V3L4 14h7v7l9-11h-7z" />' },
                { id: 'accommodation', label: '–ñ–∏–ª—å—ë', icon: '<path d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />' },
                { id: 'info', label: '–ò–Ω—Ñ–æ', icon: '<path d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />' }
            ];
            document.getElementById('mobile-bottom-nav').innerHTML = tabs.map(t =>
                `<button onclick="switchView('${t.id}')" class="flex flex-col items-center justify-center w-full transition-colors ${
                    currentState.view === t.id ? 'text-stone-900' : 'text-stone-400'
                }">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">${t.icon}</svg>
                    <span class="text-[10px] font-bold">${t.label}</span>
                </button>`
            ).join('');
        }

        function switchView(id) {
            currentState.view = id;
            currentState.searchQuery = '';
            filteredItinerary = [...itinerary];
            renderDesktopNav();
            renderMobileNav();
            renderCurrentView();
            renderProgressBar();
            writeUrlState();
            window.scrollTo(0,0);
        }

        // Quick jump functions for day cards
        function quickJumpTo(view, cityRef) {
            if (view === 'food') {
                currentState.view = 'food';
                currentState.selectedFoodCityId = cityRef;
            } else if (view === 'sights') {
                currentState.view = 'sights';
                currentState.selectedSightsCityId = cityRef;
            }
            renderDesktopNav();
            renderMobileNav();
            renderCurrentView();
            writeUrlState();
            window.scrollTo(0,0);
        }

        function quickJumpToMap(cityName) {
            currentState.view = 'map';
            renderDesktopNav();
            renderMobileNav();
            renderCurrentView();
            writeUrlState();

            // Focus on city marker after map loads
            setTimeout(() => {
                const cityCoords = mapLocations.find(loc => loc.name === cityName);
                if (cityCoords && window.yandexMap) {
                    window.yandexMap.setCenter(cityCoords.coords, 12, {
                        duration: 500
                    });
                }
            }, 500);
        }

        function renderCurrentView() {
            const el = document.getElementById('app-view');
            el.innerHTML = '';

            if(currentState.view === 'itinerary') renderItinerary(el);
            if(currentState.view === 'map') renderMap(el);
            if(currentState.view === 'velo') renderVelo(el);
            if(currentState.view === 'accommodation') renderAccommodation(el);
            if(currentState.view === 'info') renderInfo(el);
        }

        function renderItinerary(c) {
            const days = getDaysUntilTrip();

            // Get details from detailedPlans by key like "osaka-0"
            const getDetails = (detailsKey) => {
                if (!detailsKey) return null;
                const [city, dayIdx] = detailsKey.split('-');
                const plan = detailedPlans[city];
                if (!plan || !plan.days[dayIdx]) return null;
                return plan.days[dayIdx];
            };

            const typeIcon = (type) => {
                const icons = { food: 'üçú', sight: '‚õ©Ô∏è', art: 'üé®', nature: 'üå∏', velo: 'üö¥', relax: '‚ô®Ô∏è', shop: 'üõí', transport: 'üöÉ' };
                return icons[type] || 'üìç';
            };

            let h = `
                <div class="space-y-4 pb-20">
                    <!-- Stats -->
                    <div class="grid grid-cols-3 gap-3 mb-6">
                        <div class="stat-card" style="--from: #fef2f2; --to: #fee2e2;">
                            <div class="text-2xl font-bold text-red-600">${days}</div>
                            <div class="text-xs text-red-600">–¥–Ω–µ–π –æ—Å—Ç–∞–ª–æ—Å—å</div>
                        </div>
                        <div class="stat-card" style="--from: #eff6ff; --to: #dbeafe;">
                            <div class="text-2xl font-bold text-blue-600">14</div>
                            <div class="text-xs text-blue-600">–¥–Ω–µ–π –ø–æ–µ–∑–¥–∫–∏</div>
                        </div>
                        <div class="stat-card" style="--from: #f0fdf4; --to: #dcfce7;">
                            <div class="text-2xl font-bold text-green-600">4</div>
                            <div class="text-xs text-green-600">–±–∞–∑–æ–≤—ã—Ö –≥–æ—Ä–æ–¥–∞</div>
                        </div>
                    </div>
            `;

            filteredItinerary.forEach((item, idx) => {
                const badgeClass = item.type === 'base' ? 'badge-base' : 'badge-trip';
                const badgeText = item.type === 'base' ? '–ë–ê–ó–ê' : '–í–´–ï–ó–î';
                const isExpanded = expandedItineraryDays[idx];
                const details = getDetails(item.details);

                h += `
                    <div class="flex gap-3 relative">
                        <div class="absolute left-[18px] top-8 bottom-[-16px] w-[2px] timeline-line z-0 ${idx === filteredItinerary.length-1 ? 'hidden' : ''}"></div>
                        <div class="flex-shrink-0 z-10 text-center">
                            <div class="w-10 h-10 rounded-full bg-white border-2 border-stone-300 flex items-center justify-center shadow-sm">
                                <div class="text-[10px] font-bold text-stone-600 leading-none">
                                    <div class="uppercase text-[8px] text-stone-400">${item.date}</div>
                                    ${item.day}
                                </div>
                            </div>
                        </div>
                        <div class="flex-grow bg-white rounded-lg border border-stone-200 shadow-sm overflow-hidden">
                            <div class="p-3 ${details ? 'cursor-pointer hover:bg-stone-50' : ''}" ${details ? `onclick="toggleItineraryDay(${idx})"` : ''}>
                                <div class="flex justify-between items-start mb-2">
                                    <span class="text-[10px] px-2 py-0.5 rounded-full bg-stone-100 text-stone-600 font-bold">üìç ${item.city}</span>
                                    <span class="badge ${badgeClass}">${badgeText}</span>
                                </div>
                                <h3 class="font-bold text-stone-900 text-base mb-1">${item.title}</h3>
                                <p class="text-stone-600 text-xs leading-relaxed">${item.desc}</p>
                                
                                ${details ? `
                                    <div class="flex items-center justify-between mt-2 pt-2 border-t border-stone-100 text-xs text-stone-400">
                                        <span>${details.distance}</span>
                                        <span class="flex items-center gap-1">
                                            ${isExpanded ? '–°–≤–µ—Ä–Ω—É—Ç—å' : '–ü–æ–¥—Ä–æ–±–Ω–µ–µ'}
                                            <svg class="w-4 h-4 transition-transform ${isExpanded ? 'rotate-180' : ''}" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                                            </svg>
                                        </span>
                                    </div>
                                ` : ''}
                            </div>
                            
                            ${isExpanded && details ? `
                                <div class="border-t border-stone-200 bg-stone-50">
                                    ${details.items.map(spot => `
                                        <div class="p-3 border-b border-stone-100 last:border-b-0 flex gap-3">
                                            <div class="text-xl flex-shrink-0">${typeIcon(spot.type)}</div>
                                            <div class="flex-1 min-w-0">
                                                <div class="text-[10px] font-mono text-stone-400 mb-0.5">${spot.time}</div>
                                                <div class="font-bold text-sm text-stone-900">${spot.title}</div>
                                                <div class="text-xs text-stone-500 mt-0.5">${spot.desc}</div>
                                                ${spot.coords ? `
                                                    <a href="https://www.google.com/maps?q=${spot.coords[0]},${spot.coords[1]}" 
                                                       target="_blank" onclick="event.stopPropagation()"
                                                       class="inline-flex items-center gap-1 text-[10px] text-blue-600 mt-1 hover:underline">
                                                        üìç –û—Ç–∫—Ä—ã—Ç—å –Ω–∞ –∫–∞—Ä—Ç–µ
                                                    </a>
                                                ` : ''}
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                            ` : ''}
                        </div>
                    </div>
                `;
            });

            c.innerHTML = h + "</div>";
        }

        let expandedItineraryDays = {};
        window.toggleItineraryDay = (idx) => {
            expandedItineraryDays[idx] = !expandedItineraryDays[idx];
            renderCurrentView();
        };

        function renderMap(c) {
            c.innerHTML = `
                <div class="h-full flex flex-col space-y-4">
                    <div class="bg-white p-3 rounded-xl border border-stone-200 shadow-sm">
                        <h2 class="font-bold text-lg">üó∫Ô∏è –ú–∞—Ä—à—Ä—É—Ç (General)</h2>
                        <p class="text-xs text-stone-500">–ß–µ—Ç–∫–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å –±–∞–∑–∞–º–∏. –ù–∞–≤–µ–¥–∏—Ç–µ –Ω–∞ –º–∞—Ä–∫–µ—Ä—ã –¥–ª—è –¥–µ—Ç–∞–ª–µ–π.</p>
                    </div>
                    <div id="map-container" class="flex-grow shadow-md border border-stone-300 relative"></div>
                </div>
            `;
            loadYandexMap('map-container');
        }

        // ============================================
        // üö¥ ROUTE DETAIL BOTTOM SHEET
        // ============================================

        function getAllRoutes() {
            return veloPlan.groups.flatMap(g => g.routes);
        }

        function showRouteDetailById(routeId) {
            const route = getAllRoutes().find(r => r.id === routeId);
            if (!route) return showToast('–ú–∞—Ä—à—Ä—É—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω', 'error');
            showRouteDetail(route);
        }

        function showRouteDetail(route) {
            // Create overlay
            const overlay = document.createElement('div');
            overlay.className = 'bottom-sheet-overlay';
            overlay.onclick = closeRouteDetail;

            // Create bottom sheet
            const sheet = document.createElement('div');
            sheet.className = 'bottom-sheet';
            sheet.id = 'route-detail-sheet';

            // Difficulty color
            const difficultyColor = route.difficulty === '–õ–µ–≥–∫–∞—è' ? 'text-green-600 bg-green-50' :
                                   route.difficulty === '–°—Ä–µ–¥–Ω—è—è' ? 'text-orange-600 bg-orange-50' :
                                   'text-red-600 bg-red-50';

            sheet.innerHTML = `
                <div class="bottom-sheet-handle"></div>
                <div class="px-6 pb-6">
                    <!-- Header -->
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <h2 class="text-2xl font-bold text-stone-900 mb-1">${route.name}</h2>
                            <p class="text-sm text-stone-600">${route.desc}</p>
                        </div>
                        <button onclick="closeRouteDetail()" class="p-2 hover:bg-stone-100 rounded-full transition-colors">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                                <path d="M6 18L18 6M6 6l12 12" />
                            </svg>
                        </button>
                    </div>

                    <!-- Two Column Layout -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <!-- Left Column: Info -->
                        <div>
                            <!-- Stats Grid -->
                            <div class="grid grid-cols-2 gap-3 mb-4">
                                <div class="bg-blue-50 p-3 rounded-lg">
                                    <div class="text-xs text-blue-600 font-bold">–†–∞—Å—Å—Ç–æ—è–Ω–∏–µ</div>
                                    <div class="text-lg font-bold text-blue-900">${route.distance}</div>
                                </div>
                                <div class="bg-purple-50 p-3 rounded-lg">
                                    <div class="text-xs text-purple-600 font-bold">–ù–∞–±–æ—Ä –≤—ã—Å–æ—Ç—ã</div>
                                    <div class="text-lg font-bold text-purple-900">${route.elevation}</div>
                                </div>
                                <div class="bg-green-50 p-3 rounded-lg">
                                    <div class="text-xs text-green-600 font-bold">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å</div>
                                    <div class="text-lg font-bold text-green-900">${route.duration}</div>
                                </div>
                                <div class="${difficultyColor} p-3 rounded-lg">
                                    <div class="text-xs font-bold">–°–ª–æ–∂–Ω–æ—Å—Ç—å</div>
                                    <div class="text-lg font-bold">${route.difficulty}</div>
                                </div>
                            </div>

                            <!-- Gradient -->
                            <div class="bg-white border border-stone-200 rounded-lg p-4 mb-4">
                                <h3 class="font-bold text-sm text-stone-900 mb-2">üìà –ì—Ä–∞–¥–∏–µ–Ω—Ç</h3>
                                <p class="text-sm text-stone-600">${route.gradient}</p>
                            </div>

                            <!-- Highlights -->
                            <div class="mb-4">
                                <h3 class="font-bold text-sm text-stone-900 mb-2">‚ú® –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏</h3>
                                <div class="flex flex-wrap gap-2">
                                    ${route.highlights.map(h => `<span class="tag-pill">${h}</span>`).join('')}
                                </div>
                            </div>
                        </div>

                        <!-- Right Column: Map -->
                        <div class="flex flex-col">
                            <div id="route-map-container" class="route-detail-map bg-stone-100 flex-1"></div>
                        </div>
                    </div>

                    <!-- Actions -->
                    <div class="flex gap-3 mt-4">
                        <a href="${route.mapLink}" target="_blank"
                           class="flex-1 text-center bg-blue-600 text-white font-bold py-3 rounded-lg hover:bg-blue-700 transition-colors">
                            –û—Ç–∫—Ä—ã—Ç—å –≤ Google Maps
                        </a>
                        <button onclick="closeRouteDetail()"
                                class="px-6 bg-stone-200 text-stone-700 font-bold rounded-lg hover:bg-stone-300 transition-colors">
                            –ó–∞–∫—Ä—ã—Ç—å
                        </button>
                    </div>
                </div>
            `;

            document.body.appendChild(overlay);
            document.body.appendChild(sheet);

            // Trigger animations
            setTimeout(() => {
                overlay.classList.add('show');
                sheet.classList.add('show');
            }, 10);

            // Initialize mini map
            setTimeout(() => initRouteMap(route), 300);

            showToast(`–ú–∞—Ä—à—Ä—É—Ç: ${route.name}`, 'info');
        }

        function closeRouteDetail() {
            const overlay = document.querySelector('.bottom-sheet-overlay');
            const sheet = document.getElementById('route-detail-sheet');

            if (overlay) {
                overlay.classList.remove('show');
                setTimeout(() => overlay.remove(), 300);
            }

            if (sheet) {
                sheet.classList.remove('show');
                setTimeout(() => sheet.remove(), 300);
            }
        }

        async function initRouteMap(route) {
            const container = document.getElementById('route-map-container');
            if (!container || !window.ymaps) return;

            ymaps.ready(async () => {
                const map = new ymaps.Map('route-map-container', {
                    center: route.center,
                    zoom: 11,
                    controls: ['zoomControl']
                });

                // 1) –ï—Å–ª–∏ –µ—Å—Ç—å track ‚Äî —Ä–∏—Å—É–µ–º —Å—Ä–∞–∑—É
                if (Array.isArray(route.track) && route.track.length >= 2) {
                    drawTrack(map, route.track, route.name);
                    return;
                }

                // 2) –ï—Å–ª–∏ –µ—Å—Ç—å GPX ‚Äî –≥—Ä—É–∑–∏–º, –ø–∞—Ä—Å–∏–º, —Ä–∏—Å—É–µ–º
                if (route.gpxUrl) {
                    try {
                        const coords = await loadGpxCoords(route.gpxUrl);
                        if (coords.length >= 2) {
                            drawTrack(map, coords, route.name);
                            return;
                        }
                    } catch (e) {
                        console.warn('GPX load/parse failed', e);
                    }
                }

                // 3) Fallback ‚Äî –ø—Ä–æ—Å—Ç–æ –º–∞—Ä–∫–µ—Ä
                const placemark = new ymaps.Placemark(route.center, { balloonContent: route.name }, {
                    preset: 'islands#blueDotIcon'
                });
                map.geoObjects.add(placemark);
            });
        }

        function drawTrack(map, coords, name) {
            const line = new ymaps.Polyline(coords, { hintContent: name }, {
                strokeColor: "#e11d48",
                strokeWidth: 4,
                strokeOpacity: 0.9
            });

            map.geoObjects.add(line);

            // –ú–∞—Ä–∫–µ—Ä—ã "—Å—Ç–∞—Ä—Ç/—Ñ–∏–Ω–∏—à"
            const start = coords[0];
            const end = coords[coords.length - 1];

            map.geoObjects.add(new ymaps.Placemark(start, { iconCaption: 'Start' }, { preset: 'islands#greenDotIcon' }));
            map.geoObjects.add(new ymaps.Placemark(end, { iconCaption: 'Finish' }, { preset: 'islands#redDotIcon' }));

            // –ü–æ–¥–æ–≥–Ω–∞—Ç—å –∫–∞—Ä—Ç—É –ø–æ–¥ –º–∞—Ä—à—Ä—É—Ç
            const bounds = line.geometry.getBounds();
            if (bounds) {
                map.setBounds(bounds, { checkZoomRange: true, zoomMargin: 20 });
            }
        }

        async function loadGpxCoords(url) {
            const res = await fetch(url);
            if (!res.ok) throw new Error(`Failed to fetch GPX: ${res.status}`);
            const text = await res.text();

            const xml = new DOMParser().parseFromString(text, "application/xml");
            const trkpts = Array.from(xml.getElementsByTagName("trkpt"));

            // GPX —Ö—Ä–∞–Ω–∏—Ç lat/lon –≤ –∞—Ç—Ä–∏–±—É—Ç–∞—Ö, Yandex –∂–¥—ë—Ç [lat, lon]
            return trkpts
                .map(p => [Number(p.getAttribute("lat")), Number(p.getAttribute("lon"))])
                .filter(([lat, lon]) => Number.isFinite(lat) && Number.isFinite(lon));
        }

        function renderVelo(c) {
            let h = `
                <div class="space-y-6 pb-20">
                    <div class="bg-stone-50 border border-stone-200 p-4 rounded-xl">
                        <h2 class="font-bold text-lg mb-2">üö¥ –û–±—â–∏–µ –ú–∞—Ä—à—Ä—É—Ç—ã</h2>
                        ${veloPlan.tips.map(t=>`<p class="text-xs text-stone-600 mb-1 border-l-2 border-red-500 pl-2">${t}</p>`).join('')}
                    </div>
            `;

            veloPlan.groups.forEach(g => {
                h += `
                    <div class="rounded-xl overflow-hidden shadow-sm mb-4">
                        <div class="${g.color} p-3 font-bold text-sm">${g.name}</div>
                        <div class="bg-white border-x border-b border-stone-200 p-4 space-y-3">
                `;
                g.routes.forEach(r => h += `
                    <div class="card-hover p-2 rounded-lg cursor-pointer" onclick="showRouteDetailById('${r.id}')">
                        <div class="flex justify-between items-baseline">
                            <h4 class="font-bold text-sm text-stone-800">${r.name}</h4>
                            <span class="badge ${r.badge}">${r.badge.split('-')[1].toUpperCase()}</span>
                        </div>
                        <p class="text-xs text-stone-500 mt-1">${r.desc}</p>
                    </div>
                `);
                h += `</div></div>`;
            });

            c.innerHTML = h + "</div>";
        }

        function renderListWithTabs(c, data, sid, cb, rend, icon) {
            let h = `
                <div class="flex flex-col md:flex-row gap-4 md:gap-6 h-full pb-20">
                    <div class="sticky top-14 md:top-0 z-30 bg-[#fcfbf9] pt-2 pb-2 md:w-1/4">
                        <div class="md:hidden flex overflow-x-auto hide-scroll gap-2 pb-1">
                            ${data.map(i=>`
                                <button onclick="window.upSel('${i.id}')"
                                    class="flex-shrink-0 px-4 py-2 rounded-full border text-xs font-bold whitespace-nowrap transition-all ${
                                        sid===i.id ? 'bg-stone-900 text-white' : 'bg-white text-stone-600 border-stone-200 hover:bg-stone-50'
                                    }">
                                    ${i.city}
                                </button>
                            `).join('')}
                        </div>
                        <div class="hidden md:flex flex-col gap-2">
                            ${data.map(i=>`
                                <button onclick="window.upSel('${i.id}')"
                                    class="text-left px-4 py-3 rounded-lg border transition-all ${
                                        sid===i.id ? 'bg-stone-900 text-white' : 'bg-white text-stone-600 hover:bg-stone-50'
                                    }">
                                    <span class="font-bold text-sm">${i.city}</span>
                                </button>
                            `).join('')}
                        </div>
                    </div>
                    <div class="w-full md:w-3/4">${rend(data.find(x=>x.id===sid), icon)}</div>
                </div>
            `;
            c.innerHTML = h;
            window.upSel = cb;
        }

        function renderSightsDetails(c, i) {
            return `
                <div class="bg-white rounded-xl border border-stone-200 shadow-sm overflow-hidden fade-in">
                    <div class="bg-stone-100 p-4 border-b border-stone-200">
                        <h2 class="text-2xl font-serif font-bold text-stone-900 flex justify-between">
                            ${c.city} <span class="opacity-20">${i}</span>
                        </h2>
                    </div>
                    <div class="divide-y divide-stone-100">
                        ${c.places.map(p=>`
                            <div class="p-4 card-hover">
                                <div class="flex justify-between items-start mb-1">
                                    <h3 class="font-bold text-base text-stone-900">${p.name}</h3>
                                    <span class="badge ${p.badge}">${p.type}</span>
                                </div>
                                <p class="text-stone-600 text-xs mb-2">${p.detail}</p>
                                <a href="https://yandex.ru/maps/?text=${encodeURIComponent(p.name + ' ' + c.city)}"
                                   target="_blank"
                                   class="text-[10px] text-blue-600 font-bold border border-blue-100 bg-blue-50 px-2 py-1 rounded inline-block hover:bg-blue-100 transition-colors">
                                   üìç –ù–∞ –∫–∞—Ä—Ç–µ
                                </a>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        function renderFoodDetails(c, i) {
            return `
                <div class="bg-white rounded-xl border border-stone-200 shadow-sm overflow-hidden fade-in">
                    <div class="bg-stone-100 p-4 border-b border-stone-200">
                        <h2 class="text-2xl font-serif font-bold text-stone-900 flex justify-between">
                            ${c.city} <span class="opacity-20">${i}</span>
                        </h2>
                    </div>
                    <div class="divide-y divide-stone-100">
                        ${c.places.map(p=>`
                            <div class="p-4 card-hover">
                                <div class="flex justify-between items-start">
                                    <h3 class="font-bold text-stone-900">${p.name}</h3>
                                    <span class="text-xs bg-stone-100 px-2 py-0.5 rounded text-stone-600 font-bold">${safe(p.dish,'')}</span>
                                </div>
                                ${p.why ? `<p class="text-stone-600 text-xs mt-1 italic mb-2">"${p.why}"</p>` : ``}
                                ${p.tags?.length ? `<div class="flex flex-wrap gap-2 mb-2">${p.tags.map(t=>`<span class="tag-pill">${t}</span>`).join('')}</div>` : ``}
                                ${p.url ? `<a href="${p.url}" target="_blank" class="text-[10px] text-stone-700 font-bold border border-stone-200 bg-stone-50 px-2 py-1 rounded inline-block mr-2 hover:bg-stone-100 transition-colors">üîó –°–∞–π—Ç</a>` : ``}
                                <a href="https://yandex.ru/maps/?text=${encodeURIComponent(p.name+' '+c.city)}"
                                   target="_blank"
                                   class="text-[10px] text-blue-600 font-bold border border-blue-100 bg-blue-50 px-2 py-1 rounded inline-block hover:bg-blue-100 transition-colors">
                                   üìç –ù–∞ –∫–∞—Ä—Ç–µ
                                </a>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        // TEMPORARILY DISABLED - Hotels tab
        // function renderHotelDetails(c, i) {
        //     return `
        //         <div class="bg-white rounded-xl border border-stone-200 shadow-sm overflow-hidden fade-in">
        //             <div class="bg-stone-100 p-4 border-b border-stone-200">
        //                 <h2 class="text-2xl font-serif font-bold text-stone-900 flex justify-between">
        //                     ${c.city} <span class="opacity-20">${i}</span>
        //                 </h2>
        //                 <p class="text-xs text-stone-600 mt-1 italic">${c.desc}</p>
        //             </div>
        //             <div class="divide-y divide-stone-100">
        //                 ${c.places.map(p=>`
        //                     <div class="p-4 card-hover">
        //                         <div class="flex justify-between items-start mb-1">
        //                             <h3 class="font-bold text-stone-900">${p.name}</h3>
        //                             <span class="badge ${p.badge}">${p.type}</span>
        //                         </div>
        //                         <p class="text-stone-600 text-xs mt-1 leading-relaxed">"${p.why}"</p>
        //                         <div class="flex justify-between items-center mt-3">
        //                             <span class="text-xs font-mono text-stone-500 bg-stone-50 px-2 py-1 rounded">${p.price}</span>
        //                             <a href="https://www.booking.com/searchresults.ru.html?ss=${encodeURIComponent(p.name + ' ' + c.city)}"
        //                                target="_blank"
        //                                class="text-[10px] text-white font-bold bg-blue-600 px-3 py-1.5 rounded hover:bg-blue-700 transition-colors shadow-sm">
        //                                Booking.com &rarr;
        //                             </a>
        //                         </div>
        //                     </div>
        //                 `).join('')}
        //             </div>
        //         </div>
        //     `;
        // }

        function renderAccommodation(el) {
            const statusBadge = (status) => {
                if (status === 'booked') return '<span class="badge badge-base">‚úì –ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–æ</span>';
                return '<span class="badge badge-time">‚è≥ –ò—â–µ–º</span>';
            };

            const renderBookingCard = (acc, index) => {
                if (!acc.booking) {
                    return `
                        <div class="p-6 text-center">
                            <div class="text-4xl mb-3">üîç</div>
                            <p class="text-stone-500 text-sm">–ñ–∏–ª—å—ë –ø–æ–∫–∞ –Ω–µ –≤—ã–±—Ä–∞–Ω–æ</p>
                            <a href="https://www.airbnb.ru/s/${encodeURIComponent(acc.city + ', –Ø–ø–æ–Ω–∏—è')}/homes" 
                               target="_blank"
                               class="inline-block mt-4 text-sm font-bold bg-gradient-to-r from-rose-500 to-pink-500 text-white px-4 py-2 rounded-lg hover:opacity-90 transition-opacity shadow-md">
                                –ò—Å–∫–∞—Ç—å –Ω–∞ Airbnb ‚Üí
                            </a>
                        </div>
                    `;
                }

                const b = acc.booking;
                return `
                    <div class="p-4">
                        <div class="flex justify-between items-start mb-3">
                            <div>
                                <h3 class="font-bold text-stone-900 text-lg">${b.name}</h3>
                                <div class="flex items-center gap-2 mt-1">
                                    <span class="badge ${b.badge}">${b.type}</span>
                                    <span class="text-yellow-500 text-sm">‚òÖ ${b.rating}</span>
                                    ${b.district ? `<span class="text-xs text-stone-400">üìç ${b.district}</span>` : ''}
                                </div>
                            </div>
                        </div>
                        
                        <!-- Mini Map -->
                        <div id="acc-map-${acc.id}" class="h-40 w-full rounded-lg mb-4 bg-stone-100 overflow-hidden"></div>
                        
                        <div class="grid grid-cols-3 gap-2 text-xs text-stone-600 mb-4">
                            <div class="bg-stone-50 p-2 rounded text-center">
                                <div class="font-bold text-stone-800">ÔøΩÔ∏è ${b.rooms}</div>
                            </div>
                            <div class="bg-stone-50 p-2 rounded text-center">
                                <div class="font-bold text-stone-800">ÔøΩÔ∏è ${b.beds}</div>
                            </div>
                            <div class="bg-stone-50 p-2 rounded text-center">
                                <div class="font-bold text-stone-800">üöø ${b.bath}</div>
                            </div>
                        </div>
                        <a href="${b.link}" 
                           target="_blank"
                           class="block w-full text-center text-sm font-bold bg-gradient-to-r from-rose-500 to-pink-500 text-white px-4 py-3 rounded-lg hover:opacity-90 transition-opacity shadow-md">
                            –û—Ç–∫—Ä—ã—Ç—å –Ω–∞ Airbnb ‚Üí
                        </a>
                    </div>
                `;
            };

            el.innerHTML = `
                <div class="space-y-4 pb-20">
                    <div class="text-center mb-6">
                        <h1 class="text-2xl font-serif font-bold text-stone-900">üè† –ñ–∏–ª—å—ë</h1>
                        <p class="text-sm text-stone-500 mt-1">–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–µ—Å—Ç–∞ –¥–ª—è –Ω–æ—á—ë–≤–æ–∫</p>
                    </div>
                    
                    <div class="grid gap-4">
                        ${accommodations.map((acc, i) => `
                            <div class="bg-white rounded-xl border border-stone-200 shadow-sm overflow-hidden card-hover fade-in">
                                <div class="bg-stone-100 p-4 border-b border-stone-200">
                                    <div class="flex justify-between items-start">
                                        <div>
                                            <h2 class="text-xl font-serif font-bold text-stone-900">${acc.city}</h2>
                                            <p class="text-xs text-stone-500 mt-1">${acc.dates}</p>
                                        </div>
                                        ${statusBadge(acc.status)}
                                    </div>
                                    <p class="text-xs text-stone-600 mt-2 italic">${acc.desc}</p>
                                </div>
                                ${renderBookingCard(acc, i)}
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;

            // Initialize mini maps after DOM is ready
            setTimeout(() => initAccommodationMaps(), 100);
        }

        function initAccommodationMaps() {
            if (typeof ymaps === 'undefined') return;
            
            ymaps.ready(() => {
                accommodations.forEach(acc => {
                    if (!acc.booking || !acc.coords) return;
                    
                    const mapContainer = document.getElementById(`acc-map-${acc.id}`);
                    if (!mapContainer) return;
                    
                    const miniMap = new ymaps.Map(mapContainer, {
                        center: acc.coords,
                        zoom: 15,
                        controls: ['zoomControl']
                    }, {
                        suppressMapOpenBlock: true
                    });

                    const b = acc.booking;
                    const balloonContent = `
                        <div style="width: 220px; font-family: 'Noto Sans', sans-serif;">
                            <div style="width: 100%; height: 120px; background: linear-gradient(135deg, #f43f5e 0%, #ec4899 100%); border-radius: 8px 8px 0 0; display: flex; align-items: center; justify-content: center;">
                                <span style="font-size: 48px;">üè†</span>
                            </div>
                            <div style="padding: 12px;">
                                <div style="font-weight: 700; font-size: 14px; color: #1c1917; margin-bottom: 4px;">${b.name}</div>
                                <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                                    <span style="color: #f59e0b; font-size: 12px;">‚òÖ ${b.rating}</span>
                                    <span style="font-size: 11px; color: #78716c;">${b.district || acc.city}</span>
                                </div>
                                <div style="font-size: 11px; color: #57534e; margin-bottom: 10px;">
                                    ${b.rooms} ¬∑ ${b.beds} ¬∑ ${b.bath}
                                </div>
                                <a href="${b.link}" target="_blank" 
                                   style="display: block; text-align: center; background: linear-gradient(135deg, #f43f5e 0%, #ec4899 100%); 
                                          color: white; padding: 8px 12px; border-radius: 6px; text-decoration: none; 
                                          font-size: 12px; font-weight: 600;">
                                    –û—Ç–∫—Ä—ã—Ç—å –Ω–∞ Airbnb ‚Üí
                                </a>
                            </div>
                        </div>
                    `;

                    const placemark = new ymaps.Placemark(acc.coords, {
                        balloonContent: balloonContent,
                        hintContent: `üè† ${b.name} ‚òÖ${b.rating}`
                    }, {
                        preset: 'islands#redHomeIcon',
                        balloonPanelMaxMapArea: 0,
                        hideIconOnBalloonOpen: false
                    });

                    miniMap.geoObjects.add(placemark);
                    miniMap.behaviors.disable('scrollZoom');
                    
                    // Open balloon on marker hover
                    placemark.events.add('mouseenter', function() {
                        placemark.balloon.open();
                    });
                });
            });
        }

        // ============================================
        // üìã DETAILED PLANS RENDERING
        // ============================================
        let selectedPlanCity = 'osaka';
        let expandedDays = {};

        function renderDetailedPlans(el) {
            const cities = Object.keys(detailedPlans);
            const plan = detailedPlans[selectedPlanCity];

            const typeIcon = (type) => {
                const icons = {
                    food: 'üçú',
                    sight: '‚õ©Ô∏è',
                    art: 'üé®',
                    nature: 'üå∏',
                    velo: 'üö¥',
                    relax: '‚ô®Ô∏è',
                    shop: 'üõí',
                    transport: 'üöÉ'
                };
                return icons[type] || 'üìç';
            };

            const typeBadge = (type) => {
                const badges = {
                    food: 'badge-sweet',
                    sight: 'badge-history',
                    art: 'badge-design',
                    nature: 'badge-nature',
                    velo: 'badge-road',
                    relax: 'badge-onsen',
                    shop: 'badge-tech',
                    transport: 'badge-trip'
                };
                return badges[type] || 'badge-local';
            };

            el.innerHTML = `
                <div class="space-y-4 pb-20">
                    <div class="text-center mb-4">
                        <h1 class="text-2xl font-serif font-bold text-stone-900">üìã –î–µ—Ç–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω</h1>
                        <p class="text-sm text-stone-500 mt-1">–ü–æ–¥—Ä–æ–±–Ω–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –ø–æ –¥–Ω—è–º</p>
                    </div>

                    <!-- City Tabs -->
                    <div class="flex gap-2 overflow-x-auto hide-scroll pb-2">
                        ${cities.map(cityId => {
                            const c = detailedPlans[cityId];
                            return `
                                <button onclick="selectPlanCity('${cityId}')" 
                                    class="flex-shrink-0 px-4 py-2 rounded-full text-sm font-bold transition-all ${
                                        selectedPlanCity === cityId 
                                            ? 'bg-stone-900 text-white' 
                                            : 'bg-stone-100 text-stone-600 hover:bg-stone-200'
                                    }">
                                    ${c.city}
                                </button>
                            `;
                        }).join('')}
                    </div>

                    <!-- City Header -->
                    <div class="bg-gradient-to-r from-rose-500 to-orange-500 rounded-xl p-4 text-white">
                        <h2 class="text-xl font-bold">${plan.city}</h2>
                        <p class="text-sm opacity-90">${plan.dates}</p>
                        <p class="text-xs mt-2 opacity-75">${plan.days.length} –¥–Ω–µ–π –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ</p>
                    </div>

                    <!-- Days -->
                    <div class="space-y-3">
                        ${plan.days.map((day, dayIndex) => {
                            const isExpanded = expandedDays[`${selectedPlanCity}-${dayIndex}`];
                            return `
                                <div class="bg-white rounded-xl border border-stone-200 shadow-sm overflow-hidden">
                                    <button onclick="togglePlanDay('${selectedPlanCity}', ${dayIndex})" 
                                        class="w-full p-4 flex justify-between items-center hover:bg-stone-50 transition-colors">
                                        <div class="text-left">
                                            <div class="font-bold text-stone-900">${day.date}</div>
                                            <div class="text-sm text-stone-600">${day.title}</div>
                                            <div class="text-xs text-stone-400 mt-1">${day.distance}</div>
                                        </div>
                                        <svg class="w-5 h-5 text-stone-400 transition-transform ${isExpanded ? 'rotate-180' : ''}" 
                                             fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                                        </svg>
                                    </button>
                                    
                                    ${isExpanded ? `
                                        <div class="border-t border-stone-100 divide-y divide-stone-50">
                                            ${day.items.map(item => `
                                                <div class="p-4 hover:bg-stone-50 transition-colors">
                                                    <div class="flex gap-3">
                                                        <div class="text-2xl">${typeIcon(item.type)}</div>
                                                        <div class="flex-1">
                                                            <div class="flex items-start justify-between gap-2">
                                                                <div>
                                                                    <span class="text-xs text-stone-400 font-mono">${item.time}</span>
                                                                    <h4 class="font-bold text-stone-900">${item.title}</h4>
                                                                </div>
                                                                <span class="badge ${typeBadge(item.type)} flex-shrink-0">${item.type}</span>
                                                            </div>
                                                            <p class="text-sm text-stone-600 mt-1">${item.desc}</p>
                                                            ${item.coords ? `
                                                                <a href="https://www.google.com/maps?q=${item.coords[0]},${item.coords[1]}" 
                                                                   target="_blank"
                                                                   class="inline-flex items-center gap-1 text-xs text-blue-600 mt-2 hover:underline">
                                                                    <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                                                                              d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                                                                              d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
                                                                    </svg>
                                                                    –û—Ç–∫—Ä—ã—Ç—å –Ω–∞ –∫–∞—Ä—Ç–µ
                                                                </a>
                                                            ` : ''}
                                                        </div>
                                                    </div>
                                                </div>
                                            `).join('')}
                                        </div>
                                    ` : ''}
                                </div>
                            `;
                        }).join('')}
                    </div>
                </div>
            `;
        }

        window.selectPlanCity = (cityId) => {
            selectedPlanCity = cityId;
            renderCurrentView();
        };

        window.togglePlanDay = (cityId, dayIndex) => {
            const key = `${cityId}-${dayIndex}`;
            expandedDays[key] = !expandedDays[key];
            renderCurrentView();
        };

        function renderChecklistBlock() {
            const urgent = (x) => x.urgent ? 'border-red-200 bg-red-50' : 'border-stone-200 bg-white';
            return `
                <div class="bg-white rounded-xl border border-stone-200 shadow-sm overflow-hidden">
                    <div class="bg-stone-100 p-4 border-b border-stone-200">
                        <h3 class="font-bold text-stone-900">‚úÖ –ß–µ–∫–ª–∏—Å—Ç</h3>
                        <p class="text-xs text-stone-600 mt-1">–°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ –≤ –±—Ä–∞—É–∑–µ—Ä–µ</p>
                    </div>
                    <div class="p-4 space-y-2">
                        ${checklist.map(item => `
                            <label class="flex items-center gap-3 p-3 rounded-lg border ${urgent(item)} cursor-pointer hover:shadow-sm transition-all card-hover">
                                <input type="checkbox" ${item.done ? 'checked' : ''} data-id="${item.id}" class="w-4 h-4 cursor-pointer">
                                <div class="flex-1">
                                    <div class="font-bold text-sm ${item.done ? 'line-through text-stone-400' : 'text-stone-800'}">${item.text}</div>
                                    ${item.note ? `<div class="text-xs text-stone-500 mt-1">${item.note}</div>` : ``}
                                </div>
                                ${item.urgent ? `<span class="badge badge-time badge-urgent">URGENT</span>` : ``}
                            </label>
                        `).join('')}
                        <button id="add-check-item" class="w-full mt-2 text-sm font-bold bg-stone-900 text-white py-2 rounded-lg hover:bg-stone-800 transition-colors">
                            + –î–æ–±–∞–≤–∏—Ç—å
                        </button>
                    </div>
                </div>
            `;
        }

        function bindChecklistHandlers(root=document) {
            qsa('input[type="checkbox"][data-id]', root).forEach(ch => {
                ch.addEventListener('change', (e) => {
                    const id = Number(e.target.getAttribute('data-id'));
                    checklist = checklist.map(x => x.id === id ? {...x, done: e.target.checked} : x);
                    saveChecklist(checklist);
                    showToast(e.target.checked ? '–ó–∞–¥–∞—á–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ ‚úì' : '–û—Ç–º–µ–Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è', 'success');
                });
            });

            const addBtn = qs('#add-check-item', root);
            if (addBtn) addBtn.addEventListener('click', () => {
                const text = prompt('–ù–æ–≤—ã–π –ø—É–Ω–∫—Ç —á–µ–∫–ª–∏—Å—Ç–∞:');
                if (!text) return;
                const id = Math.max(0, ...checklist.map(x => x.id)) + 1;
                checklist = [{ id, text, done:false, urgent:false }, ...checklist];
                saveChecklist(checklist);
                renderCurrentView();
                showToast('–ü—É–Ω–∫—Ç –¥–æ–±–∞–≤–ª–µ–Ω!', 'success');
            });
        }

        function renderInfo(c) {
            c.innerHTML = `
                <div class="space-y-6 pb-20">
                    <div id="info-content">${getInfoHTML()}</div>
                </div>
            `;
            setTimeout(() => bindChecklistHandlers(document.getElementById('app-view')), 0);
        }

        function changeInfo(tab) {
            currentState.infoSubTab = tab;
            renderInfo(document.getElementById('app-view'));
            writeUrlState();
        }

        function getInfoHTML() {
            return `
                <div class="space-y-3">
                    ${logisticsData.map(l=>`
                        <div class="bg-white p-4 rounded-xl border border-stone-200 shadow-sm card-hover">
                            <h3 class="font-bold">${l.icon} ${l.title}</h3>
                            <p class="text-sm mt-1">${l.detail}</p>
                            ${l.vital?`<div class="mt-2 text-xs text-red-600 font-bold bg-red-50 p-2 rounded">${l.vital}</div>`:''}
                        </div>
                    `).join('')}
                    ${renderChecklistBlock()}
                </div>
            `;
        }

        window.upSel = (id) => {
            // if (currentState.view === 'hotels') currentState.selectedHotelCityId = id;
            if (currentState.view === 'sights') currentState.selectedSightsCityId = id;
            else currentState.selectedFoodCityId = id;
            renderCurrentView();
            writeUrlState();
        };

        function init() {
            applyTheme();
            readUrlState();
            loadYandexMap('map-container');
            renderDesktopNav();
            renderMobileNav();
            renderCurrentView();
            renderProgressBar();
            window.addEventListener('popstate', () => {
                readUrlState();
                renderDesktopNav();
                renderMobileNav();
                renderCurrentView();
                renderProgressBar();
            });

            // Show welcome toast
            setTimeout(() => {
                showToast('üóæ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –Ø–ø–æ–Ω–∏–∏ 2026!', 'info');
            }, 500);
        }

        init();
    </script>
</body>
</html>