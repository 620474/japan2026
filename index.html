<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–Ø–ø–æ–Ω–∏—è 2026: Grand Master Plan</title>
    
    <!-- LIBRARIES -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Yandex Maps v2.1 -->
    <script src="https://api-maps.yandex.ru/2.1/?apikey=5912b65b-5a13-482f-bf3c-6a11282b5100&lang=ru_RU" type="text/javascript"></script>

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Merriweather:ital,wght@0,700;1,400&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Noto Sans', sans-serif; background-color: #fcfbf9; color: #292524; -webkit-tap-highlight-color: transparent; }
        h1, h2, h3, .serif-font { font-family: 'Merriweather', serif; }
        
        .hide-scroll::-webkit-scrollbar { display: none; }
        .hide-scroll { -ms-overflow-style: none; scrollbar-width: none; }
        .mobile-safe-bottom { padding-bottom: env(safe-area-inset-bottom); }
        .fade-in { animation: fadeIn 0.3s cubic-bezier(0.16, 1, 0.3, 1); }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        
        #map-container { height: 100%; min-height: 500px; width: 100%; border-radius: 12px; z-index: 1; background: #e5e7eb; overflow: hidden; }

        /* Badges */
        .badge { display: inline-flex; align-items: center; padding: 2px 8px; border-radius: 4px; font-size: 0.65rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.05em; }
        .badge-base { background: #f0fdf4; color: #15803d; border: 1px solid #bbf7d0; } 
        .badge-trip { background: #eff6ff; color: #1d4ed8; border: 1px solid #bfdbfe; }
        .badge-onsen { background: #fdf2f8; color: #be185d; border: 1px solid #fbcfe8; }
        .badge-time { background: #fff7ed; color: #9a3412; border: 1px solid #fed7aa; margin-right: 6px; }
        
        /* Category Badges */
        .badge-history { background: #fff1f2; color: #9f1239; border: 1px solid #fecdd3; }
        .badge-local { background: #f0fdf4; color: #15803d; border: 1px solid #bbf7d0; }
        .badge-sweet { background: #fff7ed; color: #c2410c; border: 1px solid #fed7aa; }
        .badge-tech { background: #eff6ff; color: #1d4ed8; border: 1px solid #bfdbfe; }
        .badge-soul { background: #fdf4ff; color: #86198f; border: 1px solid #f0abfc; }
        
        /* Hotel Badges */
        .badge-hotel-biz { background: #f3f4f6; color: #374151; border: 1px solid #d1d5db; }
        .badge-hotel-lux { background: #faf5ff; color: #6b21a8; border: 1px solid #e9d5ff; }
        .badge-hotel-ryokan { background: #fffbeb; color: #92400e; border: 1px solid #fcd34d; }

        .segmented-control { background: #e7e5e4; padding: 4px; border-radius: 8px; display: flex; }
        .segment-btn { flex: 1; text-align: center; padding: 8px 0; font-size: 13px; font-weight: 600; border-radius: 6px; color: #57534e; transition: all 0.2s; }
        .segment-active { background: white; color: #1c1917; box-shadow: 0 1px 2px rgba(0,0,0,0.1); }
    </style>
</head>
<body class="antialiased flex flex-col min-h-screen pb-20 md:pb-0">

    <header class="bg-white border-b border-stone-200 sticky top-0 z-50 shadow-sm safe-top">
        <div class="max-w-6xl mx-auto px-4 h-14 md:h-16 flex items-center justify-between">
            <div class="flex items-center gap-3">
                <div class="w-8 h-8 bg-stone-800 rounded flex items-center justify-center text-white font-serif font-bold text-lg">JP</div>
                <div>
                    <div class="font-bold text-base md:text-lg leading-tight text-stone-900">Japan 2026</div>
                    <div class="text-[10px] md:text-xs text-stone-500 font-medium">Grand Master Plan</div>
                </div>
            </div>
            <nav class="hidden md:flex gap-1" id="desktop-nav"></nav>
        </div>
    </header>

    <main class="flex-grow w-full max-w-6xl mx-auto px-3 md:px-4 py-4 md:py-8 h-full">
        <div id="app-view" class="fade-in h-full"></div>
    </main>

    <nav class="md:hidden fixed bottom-0 left-0 w-full bg-white border-t border-stone-200 z-50 mobile-safe-bottom shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.05)]">
        <div class="grid grid-cols-6 h-16" id="mobile-bottom-nav"></div>
    </nav>

    <script>
        // ================= DATA =================

        const itinerary = [
            { day: "15.04", date: "–°—Ä", city: "–û—Å–∞–∫–∞", title: "–ü—Ä–∏–±—ã—Ç–∏–µ", time: "–î–µ–Ω—å", type: "base", desc: "–ë–∞–∑–∞: –û—Å–∞–∫–∞ (3 –Ω–æ—á–∏).", food_ref: "osaka", sight_ref: "osaka", hotel_ref: "osaka" },
            { day: "16.04", date: "–ß—Ç", city: "–û—Å–∞–∫–∞", title: "–ó–∞–º–æ–∫ –∏ –û–∫–µ–∞–Ω–∞—Ä–∏—É–º", time: "–í–µ—Å—å –¥–µ–Ω—å", type: "base", desc: "–£—Ç—Ä–æ: –ó–∞–º–æ–∫. –í–µ—á–µ—Ä: Kaiyukan.", food_ref: "osaka", sight_ref: "osaka", hotel_ref: "osaka" },
            { day: "17.04", date: "–ü—Ç", city: "–ö–æ–±–µ", title: "–í—ã–µ–∑–¥ –∫ –º–æ—Ä—é", time: "–í–µ—Å—å –¥–µ–Ω—å", type: "trip", desc: "–≠–ª–µ–∫—Ç—Ä–∏—á–∫–∞ (20 –º–∏–Ω). –ú—è—Å–æ –ö–æ–±–µ.", food_ref: "kobe", sight_ref: "kobe", hotel_ref: "osaka" },
            { day: "18.04", date: "–°–±", city: "–ö–∏–æ—Ç–æ", title: "–°–º–µ–Ω–∞ –ë–∞–∑—ã", time: "–£—Ç—Ä–æ", type: "base", desc: "–ü–µ—Ä–µ–µ–∑–¥ (30 –º–∏–Ω). –ë–∞–∑–∞: –ö–∏–æ—Ç–æ (3 –Ω–æ—á–∏).", food_ref: "kyoto", sight_ref: "kyoto", hotel_ref: "kyoto" },
            { day: "19.04", date: "–í—Å", city: "–ö–∏–æ—Ç–æ", title: "–§—É—Å–∏–º–∏ –ò–Ω–∞—Ä–∏", time: "07:00", type: "base", desc: "–¢–æ—Ä–∏–∏ –±–µ–∑ —Ç–æ–ª–ø + –ó–æ–ª–æ—Ç–æ–π –ü–∞–≤–∏–ª—å–æ–Ω.", food_ref: "kyoto", sight_ref: "kyoto", hotel_ref: "kyoto" },
            { day: "20.04", date: "–ü–Ω", city: "–ù–∞—Ä–∞", title: "–û–ª–µ–Ω–∏", time: "–í–µ—Å—å –¥–µ–Ω—å", type: "trip", desc: "–ë–æ–ª—å—à–æ–π –ë—É–¥–¥–∞ –∏ –ø–∞—Ä–∫.", food_ref: "nara", sight_ref: "nara", hotel_ref: "kyoto" },
            { day: "21.04", date: "–í—Ç", city: "–û–∫–∞—è–º–∞", title: "–ê–∫—Ç–∏–≤–∞—Ü–∏—è –ü–∞—Å—Å–∞", time: "–£—Ç—Ä–æ", type: "trip", desc: "‚ö° –°—Ç–∞—Ä—Ç JR Pass! –ó–∞–º–æ–∫ –û–∫–∞—è–º–∞.", food_ref: "okayama", sight_ref: "okayama", hotel_ref: "takamatsu" },
            { day: "21.04", date: "–í—Ç", city: "–¢–∞–∫–∞–º–∞—Ü—É", title: "–†—ë–∫–∞–Ω —É –û–∫–µ–∞–Ω–∞", time: "16:00", type: "base", desc: "–ü–æ–µ–∑–¥ —á–µ—Ä–µ–∑ –º–æ—Ä–µ. –û–Ω—Å—ç–Ω —Å –≤–∏–¥–æ–º –Ω–∞ –æ—Å—Ç—Ä–æ–≤–∞.", food_ref: "takamatsu", sight_ref: "takamatsu", hotel_ref: "takamatsu" },
            { day: "22.04", date: "–°—Ä", city: "–û–Ω–æ–º–∏—Ç–∏", title: "–®–∏–º–∞–Ω–∞–º–∏ –ö–∞–π–¥–æ", time: "–£—Ç—Ä–æ", type: "trip", desc: "–í–µ–ª–æ—Å–∏–ø–µ–¥—ã. –ù–æ—á—å –≤ –•–∏—Ä–æ—Å–∏–º–µ.", food_ref: "onomichi", sight_ref: "velo", hotel_ref: "hiroshima" },
            { day: "23.04", date: "–ß—Ç", city: "–•–∏—Ä–æ—Å–∏–º–∞", title: "–ü–µ—Ä–µ–µ–∑–¥", time: "–£—Ç—Ä–æ", type: "base", desc: "–ü–∞—Ä–∫ –ú–∏—Ä–∞. –ë–∞–∑–∞: –•–∏—Ä–æ—Å–∏–º–∞ (2 –Ω–æ—á–∏).", food_ref: "hiroshima", sight_ref: "hiroshima", hotel_ref: "hiroshima" },
            { day: "24.04", date: "–ü—Ç", city: "–ú–∏—è–¥–∑–∏–º–∞", title: "–°–≤—è—â–µ–Ω–Ω—ã–π –æ—Å—Ç—Ä–æ–≤", time: "–í–µ—Å—å –¥–µ–Ω—å", type: "trip", desc: "–ü–∞—Ä–æ–º. –•—Ä–∞–º –ò—Ü—É–∫—É—Å–∏–º–∞.", food_ref: "miyajima", sight_ref: "miyajima", hotel_ref: "hiroshima" },
            { day: "25.04", date: "–°–±", city: "–•–∏–º—ç–¥–∑–∏", title: "–ë–µ–ª—ã–π –ó–∞–º–æ–∫", time: "–£—Ç—Ä–æ", type: "trip", desc: "–û—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–æ –ø—É—Ç–∏. –ó–∞–º–æ–∫ –•–∏–º—ç–¥–∑–∏.", food_ref: "himeji", sight_ref: "himeji", hotel_ref: "osaka" },
            { day: "25.04", date: "–°–±", city: "–û—Å–∞–∫–∞", title: "–§–∏–Ω–∞–ª –ë–∞–∑–∞", time: "–í–µ—á–µ—Ä", type: "base", desc: "–§–∏–Ω–∞–ª: –û—Å–∞–∫–∞ (3 –Ω–æ—á–∏).", food_ref: "osaka", sight_ref: "osaka", hotel_ref: "osaka" },
            { day: "26.04", date: "–í—Å", city: "–û—Å–∞–∫–∞", title: "–°–≤–æ–±–æ–¥–Ω—ã–π –¥–µ–Ω—å", time: "Flex", type: "base", desc: "USJ –∏–ª–∏ –®–æ–ø–∏–Ω–≥.", food_ref: "osaka", sight_ref: "osaka", hotel_ref: "osaka" },
            { day: "27.04", date: "–ü–Ω", city: "–û—Å–∞–∫–∞", title: "–ó–∞–∫—É–ø–∫–∞", time: "–î–µ–Ω—å", type: "base", desc: "–°—É–≤–µ–Ω–∏—Ä—ã.", food_ref: "osaka", sight_ref: "osaka", hotel_ref: "osaka" },
            { day: "28.04", date: "–í—Ç", city: "–í—ã–ª–µ—Ç", title: "–î–æ–º–æ–π", time: "18:10", type: "base", desc: "KIX.", food_ref: "osaka", sight_ref: "osaka", hotel_ref: "osaka" }
        ];

        const mapLocations = [
            { name: "–û—Å–∞–∫–∞", coords: [34.6937, 135.5023], desc: "–ë–∞–∑–∞ 1" },
            { name: "–ö–∏–æ—Ç–æ", coords: [35.0116, 135.7681], desc: "–ë–∞–∑–∞ 2" },
            { name: "–¢–∞–∫–∞–º–∞—Ü—É", coords: [34.3428, 134.0466], desc: "–†—ë–∫–∞–Ω Hanajukai" },
            { name: "–û–Ω–æ–º–∏—Ç–∏", coords: [34.4063, 133.1956], desc: "–í–µ–ª–æ" },
            { name: "–•–∏—Ä–æ—Å–∏–º–∞", coords: [34.3853, 132.4553], desc: "–ë–∞–∑–∞ 4" },
            { name: "–•–∏–º—ç–¥–∑–∏", coords: [34.8394, 134.6939], desc: "–ó–∞–º–æ–∫" },
            { name: "–ù–∞—Ä–∞", coords: [34.6851, 135.8048], desc: "–û–ª–µ–Ω–∏" }
        ];

        const hotelIntel = [
            {
                id: "osaka",
                city: "–û—Å–∞–∫–∞",
                desc: "–í—ã–±–∏—Ä–∞–π—Ç–µ Namba –∏–ª–∏ Umeda. Onyado Nono ‚Äî —Ç–æ–ø –≤—ã–±–æ—Ä.",
                places: [
                    { name: "Onyado Nono Namba", type: "City Onsen", badge: "badge-onsen", price: "¬•¬•", why: "–í–µ—Å—å –æ—Ç–µ–ª—å —É—Å—Ç–µ–ª–µ–Ω —Ç–∞—Ç–∞–º–∏ (—Ö–æ–¥–∏–º –±–æ—Å–∏–∫–æ–º). –®–∏–∫–∞—Ä–Ω—ã–π –æ–Ω—Å—ç–Ω –∏ –±–µ—Å–ø–ª–∞—Ç–Ω–∞—è –ª–∞–ø—à–∞ –≤–µ—á–µ—Ä–æ–º." },
                    { name: "Cross Hotel Osaka", type: "–°—Ç–∏–ª—å", badge: "badge-hotel-lux", price: "¬•¬•¬•", why: "–ü—Ä—è–º–æ –Ω–∞ —É–ª–∏—Ü–µ –î–æ—Ç–æ–Ω–±–æ—Ä–∏. –í—ã—à–µ–ª ‚Äî –∏ —Ç—ã –≤ —Ü–µ–Ω—Ç—Ä–µ –Ω–µ–æ–Ω–æ–≤–æ–≥–æ –±–µ–∑—É–º–∏—è." },
                    { name: "Sotetsu Fresa Inn", type: "–ë—é–¥–∂–µ—Ç", badge: "badge-hotel-biz", price: "¬•", why: "–ß–∏—Å—Ç–æ, –¥–µ—à–µ–≤–æ, —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ. –ò–¥–µ–∞–ª—å–Ω–æ, –µ—Å–ª–∏ –æ—Ç–µ–ª—å –Ω—É–∂–µ–Ω —Ç–æ–ª—å–∫–æ –¥–ª—è —Å–Ω–∞." }
                ]
            },
            {
                id: "kyoto",
                city: "–ö–∏–æ—Ç–æ",
                desc: "–õ—É—á—à–µ –≤—Å–µ–≥–æ –∂–∏—Ç—å —É —Å—Ç–∞–Ω—Ü–∏–∏ (–ª–æ–≥–∏—Å—Ç–∏–∫–∞) –∏–ª–∏ –≤ –ì–∏–æ–Ω–µ (–∞—Ç–º–æ—Å—Ñ–µ—Ä–∞).",
                places: [
                    { name: "The Thousand Kyoto", type: "–õ—é–∫—Å", badge: "badge-hotel-lux", price: "¬•¬•¬•¬•", why: "–®–µ–¥–µ–≤—Ä –º–∏–Ω–∏–º–∞–ª–∏–∑–º–∞ –≤ 2 –º–∏–Ω—É—Ç–∞—Ö –æ—Ç –≤–æ–∫–∑–∞–ª–∞. –¢–∏—Ö–æ –∫–∞–∫ –≤ —Ö—Ä–∞–º–µ." },
                    { name: "Hotel Resol Trinity", type: "–ê—Ç–º–æ—Å—Ñ–µ—Ä–∞", badge: "badge-hotel-biz", price: "¬•¬•", why: "–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —è–ø–æ–Ω—Å–∫–∏–π —Å—Ç–∏–ª—å, –æ—Ç–ª–∏—á–Ω—ã–µ –∑–∞–≤—Ç—Ä–∞–∫–∏ –∏ –≤–∞–Ω–Ω—ã." },
                    { name: "Piece Hostel Sanjo", type: "–•–æ—Å—Ç–µ–ª/–ü—Ä–∞–π–≤–∞—Ç", badge: "badge-local", price: "¬•", why: "–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–π –¥–∏–∑–∞–π–Ω–µ—Ä—Å–∫–∏–π —Ö–æ—Å—Ç–µ–ª. –ï—Å—Ç—å –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ –Ω–æ–º–µ—Ä–∞." }
                ]
            },
            {
                id: "takamatsu",
                city: "–¢–∞–∫–∞–º–∞—Ü—É",
                desc: "–ì–ª–∞–≤–Ω–∞—è –Ω–æ—á—å –ø–æ–µ–∑–¥–∫–∏ ‚Äî —Ä—ë–∫–∞–Ω —Å –≤–∏–¥–æ–º –Ω–∞ –º–æ—Ä–µ.",
                places: [
                    { name: "Kiyomi Sanso Hanajukai", type: "–†—ë–∫–∞–Ω", badge: "badge-hotel-ryokan", price: "¬•¬•¬•", why: "–ü–∞–Ω–æ—Ä–∞–º–Ω—ã–π –æ–Ω—Å—ç–Ω —Å –≤–∏–¥–æ–º –Ω–∞ –í–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ –º–æ—Ä–µ –∏ –æ—Å—Ç—Ä–æ–≤–∞. –£–∂–∏–Ω –ö–∞–π—Å—ç–∫–∏ –≤–∫–ª—é—á–µ–Ω." },
                    { name: "JR Hotel Clement", type: "–í–∏–¥", badge: "badge-hotel-biz", price: "¬•¬•", why: "–í—ã—Å–æ—Ç–∫–∞ –≤ –ø–æ—Ä—Ç—É. –í–∏–¥ –Ω–∞ –º–æ—Ä–µ, –Ω–æ –¥–µ—à–µ–≤–ª–µ —Ä—ë–∫–∞–Ω–∞." }
                ]
            },
            {
                id: "hiroshima",
                city: "–•–∏—Ä–æ—Å–∏–º–∞",
                desc: "–û—Ç–µ–ª–∏ —É –≤–æ–∫–∑–∞–ª–∞ (—É–¥–æ–±–Ω–æ –¥–ª—è –ø–æ–µ–∑–¥–æ–≤) –∏–ª–∏ —É –ü–∞—Ä–∫–∞ –ú–∏—Ä–∞.",
                places: [
                    { name: "Sheraton Grand", type: "–ö–æ–º—Ñ–æ—Ä—Ç", badge: "badge-hotel-lux", price: "¬•¬•¬•", why: "–ü—Ä—è–º–æ —É –≤—ã—Ö–æ–¥–∞ –∏–∑ –°–∏–Ω–∫–∞–Ω—Å—ç–Ω–∞. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –∫–æ–º—Ñ–æ—Ä—Ç." },
                    { name: "The Knot Hiroshima", type: "–î–∏–∑–∞–π–Ω", badge: "badge-hotel-biz", price: "¬•¬•", why: "–û—á–µ–Ω—å —Å—Ç–∏–ª—å–Ω—ã–π –æ—Ç–µ–ª—å —Å –±–∞—Ä–æ–º –Ω–∞ –∫—Ä—ã—à–µ –∏ –≤–∏–¥–æ–º –Ω–∞ –ü–∞—Ä–∫ –ú–∏—Ä–∞." },
                    { name: "Miyajima Coral Hotel", type: "–õ–æ–≥–∏—Å—Ç–∏–∫–∞", badge: "badge-local", price: "¬•", why: "–£ –ø–∞—Ä–æ–º–Ω–æ–π –ø–µ—Ä–µ–ø—Ä–∞–≤—ã (–Ω–∞ –º–∞—Ç–µ—Ä–∏–∫–µ). –£–¥–æ–±–Ω–æ –¥–ª—è —Ä–∞–Ω–Ω–µ–≥–æ —Å—Ç–∞—Ä—Ç–∞ –Ω–∞ –æ—Å—Ç—Ä–æ–≤." }
                ]
            }
        ];

        const veloPlan = {
            title: "–í–µ–ª–æ-–ì–∏–¥",
            subtitle: "–ú–∞—Ä—à—Ä—É—Ç—ã –¥–ª—è –æ—Ç–¥—ã—Ö–∞",
            routes: [
                { id: "kyoto", name: "–ö–∏–æ—Ç–æ: –†–µ–∫–∞ –ö–∞–º–æ", tag: "–†–µ–ª–∞–∫—Å", desc: "–í–¥–æ–ª—å —Ä–µ–∫–∏ Kamo. –ü–∏–∫–Ω–∏–∫ –Ω–∞ –±–µ—Ä–µ–≥—É.", steps: ["–ê—Ä–µ–Ω–¥–∞: Kyoto Station", "–î–æ Demachiyanagi", "–ü–∏–∫–Ω–∏–∫"] },
                { id: "nara", name: "–ù–∞—Ä–∞: –ü–∞—Ä–∫ –û–ª–µ–Ω–µ–π", tag: "–ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ", desc: "–û–±—ä–µ–∑–¥ —Ç–æ–ª–ø—ã —Ç—É—Ä–∏—Å—Ç–æ–≤ –≤ –æ–≥—Ä–æ–º–Ω–æ–º –ø–∞—Ä–∫–µ.", steps: ["–ê—Ä–µ–Ω–¥–∞: Kintetsu-Nara", "–ö–æ—Ä–º–ª–µ–Ω–∏–µ –æ–ª–µ–Ω–µ–π", "–ö–∞—Å—É–≥–∞ –¢–∞–π—Å—è"] },
                { id: "setoda", name: "–®–∏–º–∞–Ω–∞–º–∏: –õ–∏–º–æ–Ω–Ω—ã–π –†–∞–π", tag: "–•–∞–π–ª–∞–π—Ç", desc: "–°–∞–º–∞—è –∫—Ä–∞—Å–∏–≤–∞—è —á–∞—Å—Ç—å –º–∞—Ä—à—Ä—É—Ç–∞ –Ω–∞ –æ—Å—Ç—Ä–æ–≤–µ –ò–∫—É—á–∏–¥–∑–∏–º–∞.", steps: ["–ü–∞—Ä–æ–º –¥–æ Setoda", "–ê—Ä–µ–Ω–¥–∞ Mamachari", "Sunset Beach", "–•—Ä–∞–º Kosanji"] }
            ]
        };

        const foodIntel = [
            { id: "osaka", city: "–û—Å–∞–∫–∞", places: [{name:"551 Horai", dish:"Butaman"}, {name:"Endo Sushi", dish:"Sushi"}, {name:"Daruma", dish:"Kushikatsu"}, {name:"Rikuro", dish:"Cheesecake"}] },
            { id: "kyoto", city: "–ö–∏–æ—Ç–æ", places: [{name:"Honke Owariya", dish:"Soba"}, {name:"Inoda Coffee", dish:"–ó–∞–≤—Ç—Ä–∞–∫"}, {name:"Gogyo", dish:"Burnt Ramen"}] },
            { id: "takamatsu", city: "–¢–∞–∫–∞–º–∞—Ü—É", places: [{name:"Hanajukai Ryokan", dish:"Kaiseki", why:"–£–∂–∏–Ω –≤ –Ω–æ–º–µ—Ä–µ", price:"–í–∫–ª—é—á–µ–Ω–æ"}, {name:"Udon Baka Ichidai", dish:"Kama Butter Udon", why:"–ö—É–ª—å—Ç–æ–≤–æ–µ –º–µ—Å—Ç–æ", price:"¬•600"}] },
            { id: "okayama", city: "–û–∫–∞—è–º–∞", places: [{name:"Nomura", dish:"Demi-Katsudon"}, {name:"Aeon Mall", dish:"Fruit Parfait"}] },
            { id: "onomichi", city: "–û–Ω–æ–º–∏—Ç–∏", places: [{name:"Ichibankan", dish:"Ramen"}, {name:"U2", dish:"Cafe"}, {name:"Yamaneko", dish:"Pudding"}] },
            { id: "hiroshima", city: "–•–∏—Ä–æ—Å–∏–º–∞", places: [{name:"Hassho", dish:"Okonomiyaki"}, {name:"Shigetomi", dish:"Beer"}, {name:"Musashi", dish:"Bento"}] },
            { id: "miyajima", city: "–ú–∏—è–¥–∑–∏–º–∞", places: [{name:"Ueno", dish:"Anago"}, {name:"Momijido", dish:"Agemomiji"}, {name:"Kakiya", dish:"Oysters"}] },
            { id: "himeji", city: "–•–∏–º—ç–¥–∑–∏", places: [{name:"Yamayoshi", dish:"Himeji Oden"}, {name:"Koba & More", dish:"Ramen"}] }
        ];

        const sightsIntel = [
            { id: "osaka", city: "–û—Å–∞–∫–∞", places: [{name: "Kaiyukan", type: "–û–∫–µ–∞–Ω–∞—Ä–∏—É–º", badge: "badge-tech", detail: "–ö–∏—Ç–æ–≤–∞—è –∞–∫—É–ª–∞."}, {name: "TeamLab", type: "–ê—Ä—Ç", badge: "badge-art", detail: "–ù–æ—á–Ω–æ–π —Å–∞–¥."}] },
            { id: "kyoto", city: "–ö–∏–æ—Ç–æ", places: [{name: "Fushimi Inari", type: "–•–∞–π–∫", badge: "badge-nature", detail: "1000 –≤–æ—Ä–æ—Ç."}, {name: "Kiyomizu-dera", type: "–•—Ä–∞–º", badge: "badge-history", detail: "–¢–µ—Ä—Ä–∞—Å–∞."}] },
            { id: "takamatsu", city: "–¢–∞–∫–∞–º–∞—Ü—É", places: [{name: "Ritsurin Garden", type: "–°–∞–¥", badge: "badge-nature", detail: "3 –∑–≤–µ–∑–¥—ã –ú–∏—à–ª–µ–Ω. –ß–∞–π–Ω—ã–π –¥–æ–º–∏–∫."}, {name: "Seto Ohashi", type: "–ú–æ—Å—Ç", badge: "badge-tech", detail: "–ü—Ä–æ–µ–∑–¥ –Ω–∞ –ø–æ–µ–∑–¥–µ."}] },
            { id: "nara", city: "–ù–∞—Ä–∞", places: [{name: "Todai-ji", type: "–ë—É–¥–¥–∞", badge: "badge-spiritual", detail: "–ì–∏–≥–∞–Ω—Ç—Å–∫–∏–π –ë—É–¥–¥–∞."}, {name: "–ü–∞—Ä–∫", type: "–û–ª–µ–Ω–∏", badge: "badge-nature", detail: "–û–ª–µ–Ω–∏."}] },
            { id: "himeji", city: "–•–∏–º—ç–¥–∑–∏", places: [{name: "–ó–∞–º–æ–∫ –•–∏–º—ç–¥–∑–∏", type: "–Æ–ù–ï–°–ö–û", badge: "badge-history", detail: "–°–∞–º—ã–π –∫—Ä–∞—Å–∏–≤—ã–π –∑–∞–º–æ–∫ –Ø–ø–æ–Ω–∏–∏."}] },
            { id: "hiroshima", city: "–•–∏—Ä–æ—Å–∏–º–∞", places: [{name: "–ü–∞—Ä–∫ –ú–∏—Ä–∞", type: "–ü–∞–º—è—Ç—å", badge: "badge-history", detail: "–ú—É–∑–µ–π."}, {name: "Orizuru Tower", type: "–í–∏–¥", badge: "badge-tech", detail: "–û—Ä–∏–≥–∞–º–∏."}] },
            { id: "miyajima", city: "–ú–∏—è–¥–∑–∏–º–∞", places: [{name: "Daisho-in", type: "–•—Ä–∞–º", badge: "badge-spiritual", detail: "500 —Å—Ç–∞—Ç—É–π."}, {name: "Torii", type: "–í–æ—Ä–æ—Ç–∞", badge: "badge-local", detail: "–í–æ –≤—Ä–µ–º—è –ø—Ä–∏–ª–∏–≤–∞."}] }
        ];

        const logisticsData = [
            { type: "JR Pass", icon: "üé´", title: "Kansai-Hiroshima Area Pass", detail: "–°—Ç–æ–∏–º–æ—Å—Ç—å: ¬•17,000 (5 –¥–Ω–µ–π).", vital: "–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å 21.04! –ü–æ–∫—Ä—ã–≤–∞–µ—Ç –û–∫–∞—è–º—É, –¢–∞–∫–∞–º–∞—Ü—É, –•–∏—Ä–æ—Å–∏–º—É, –•–∏–º—ç–¥–∑–∏." },
            { type: "–ë–∞–≥–∞–∂", icon: "üöö", title: "Yamato Transport", detail: "1. 21.04: –ö–∏–æ—Ç–æ -> –•–∏—Ä–æ—Å–∏–º–∞.<br>2. 25.04: –•–∏—Ä–æ—Å–∏–º–∞ -> –û—Å–∞–∫–∞.", vital: "–ù–∞ –°–∏–∫–æ–∫—É –Ω–∞–ª–µ–≥–∫–µ!" }
        ];
        
        const checklistData = [{ id: 1, text: "–ö—É–ø–∏—Ç—å –∞–≤–∏–∞–±–∏–ª–µ—Ç—ã", done: true }, { id: 2, text: "–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å 4 –±–∞–∑—ã + –†—ë–∫–∞–Ω", done: true }, { id: 3, text: "–ö—É–ø–∏—Ç—å Pass (Kansai-Hiroshima)", done: false }];
        const budgetData = { labels: ['–û—Ç–µ–ª–∏', '–ï–¥–∞', '–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç', '–®–æ–ø–∏–Ω–≥'], data: [190000, 95000, 27000, 80000], total: 392000 };

        // --- APP STATE ---
        let currentState = { view: 'itinerary', infoSubTab: 'logistics', selectedFoodCityId: 'osaka', selectedSightsCityId: 'osaka', selectedHotelCityId: 'osaka', mapInstance: null };

        // --- RENDERERS ---
        function init() { renderDesktopNav(); renderMobileNav(); renderCurrentView(); }

        function renderDesktopNav() {
            const tabs = [ {id:'itinerary',label:'üìÖ –ü–ª–∞–Ω'}, {id:'map',label:'üó∫Ô∏è –ö–∞—Ä—Ç–∞'}, {id:'hotels',label:'üõèÔ∏è –ñ–∏–ª—å–µ'}, {id:'sights',label:'‚õ©Ô∏è –ú–µ—Å—Ç–∞'}, {id:'velo',label:'üö¥ –í–µ–ª–æ'}, {id:'food',label:'üçú –ï–¥–∞'}, {id:'info',label:'‚ÑπÔ∏è –ò–Ω—Ñ–æ'} ];
            document.getElementById('desktop-nav').innerHTML = tabs.map(t => `<button onclick="switchView('${t.id}')" class="px-3 py-2 rounded-md ${currentState.view === t.id ? 'bg-stone-100 font-bold' : 'text-stone-600 hover:bg-stone-50'}">${t.label}</button>`).join('');
        }

        function renderMobileNav() {
            const tabs = [
                { id: 'itinerary', label: '–ü–ª–∞–Ω', icon: '<path d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />' },
                { id: 'map', label: '–ö–∞—Ä—Ç–∞', icon: '<path d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7" />' },
                { id: 'hotels', label: '–ñ–∏–ª—å–µ', icon: '<path d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />' },
                { id: 'food', label: '–ï–¥–∞', icon: '<path d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />' },
                { id: 'info', label: '–ò–Ω—Ñ–æ', icon: '<path d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />' },
                { id: 'sights', label: '–ú–µ—Å—Ç–∞', icon: '<path d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" />' } // 6th item might overflow on small screens, handled by grid
            ];
            // Render only first 6
            document.getElementById('mobile-bottom-nav').innerHTML = tabs.slice(0,6).map(t => `<button onclick="switchView('${t.id}')" class="flex flex-col items-center justify-center w-full ${currentState.view === t.id ? 'text-stone-900' : 'text-stone-400'}"><svg class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">${t.icon}</svg><span class="text-[10px] font-bold">${t.label}</span></button>`).join('');
        }

        function switchView(id) { currentState.view = id; renderDesktopNav(); renderMobileNav(); renderCurrentView(); window.scrollTo(0,0); }

        function renderCurrentView() {
            const el = document.getElementById('app-view'); el.innerHTML = '';
            if(currentState.view === 'itinerary') renderItinerary(el);
            if(currentState.view === 'map') renderMap(el);
            if(currentState.view === 'hotels') renderListWithTabs(el, hotelIntel, currentState.selectedHotelCityId, (id)=>{currentState.selectedHotelCityId=id;renderCurrentView()}, renderHotelDetails, 'üõèÔ∏è');
            if(currentState.view === 'sights') renderListWithTabs(el, sightsIntel, currentState.selectedSightsCityId, (id)=>{currentState.selectedSightsCityId=id;renderCurrentView()}, renderSightsDetails, '‚õ©Ô∏è');
            if(currentState.view === 'velo') renderVelo(el);
            if(currentState.view === 'food') renderListWithTabs(el, foodIntel, currentState.selectedFoodCityId, (id)=>{currentState.selectedFoodCityId=id;renderCurrentView()}, renderFoodDetails, 'üçú');
            if(currentState.view === 'info') renderInfo(el);
        }

        function renderItinerary(c) {
            let h = `<div class="space-y-4 pb-20">`;
            itinerary.forEach((i, idx) => {
                const badgeClass = i.type === 'base' ? 'badge-base' : 'badge-trip';
                const badgeText = i.type === 'base' ? '–ë–ê–ó–ê' : (i.title.includes("–†—ë–∫–∞–Ω") ? '–†–Å–ö–ê–ù' : '–í–´–ï–ó–î');
                const badgeColorClass = i.title.includes("–†—ë–∫–∞–Ω") ? 'badge-onsen' : badgeClass;
                const timeBadge = i.time ? `<span class="badge badge-time">${i.time}</span>` : '';
                h += `<div class="flex gap-3 relative"><div class="absolute left-[18px] top-8 bottom-[-16px] w-[2px] bg-stone-200 z-0 ${idx === itinerary.length-1 ? 'hidden' : ''}"></div><div class="flex-shrink-0 z-10 text-center"><div class="w-10 h-10 rounded-full bg-white border-2 border-stone-300 flex items-center justify-center shadow-sm"><div class="text-[10px] font-bold text-stone-600 leading-none"><div class="uppercase text-[8px] text-stone-400">${i.date}</div>${i.day.split('.')[0]}</div></div></div><div class="flex-grow bg-white rounded-lg border border-stone-200 p-3 shadow-sm"><div class="flex justify-between items-start mb-1"><div>${timeBadge}<h3 class="font-bold text-stone-900 text-sm inline">${i.title}</h3></div><span class="badge ${badgeColorClass}">${badgeText}</span></div><div class="text-[10px] text-stone-400 font-bold mb-1">üìç ${i.city}</div><p class="text-stone-600 text-xs mb-2">${i.desc}</p></div></div>`;
            });
            c.innerHTML = h + "</div>";
        }

        function renderMap(c) {
            c.innerHTML = `<div class="h-full flex flex-col space-y-4"><div class="bg-white p-3 rounded-xl border border-stone-200 shadow-sm"><h2 class="font-bold text-lg">üó∫Ô∏è –Ø–Ω–¥–µ–∫—Å –ö–∞—Ä—Ç—ã</h2><p class="text-xs text-stone-500">–ú–∞—Ä—à—Ä—É—Ç: Kansai-Shikoku-Hiroshima</p></div><div id="map-container" class="flex-grow shadow-md border border-stone-300 relative"></div></div>`;
            
            ymaps.ready(() => {
                const map = new ymaps.Map("map-container", {
                    center: [34.5, 134.5], 
                    zoom: 7,
                    controls: ['zoomControl', 'fullscreenControl']
                });

                const routePoints = mapLocations.map(l => l.coords);
                const polyline = new ymaps.Polyline(routePoints, {}, { strokeColor: "#e11d48", strokeWidth: 4, strokeOpacity: 0.8 });
                map.geoObjects.add(polyline);

                mapLocations.forEach(loc => {
                    const placemark = new ymaps.Placemark(loc.coords, { balloonContentHeader: loc.name, balloonContentBody: loc.desc }, { preset: 'islands#redDotIcon' });
                    map.geoObjects.add(placemark);
                });

                map.setBounds(map.geoObjects.getBounds(), {checkZoomRange: true, zoomMargin: 50});
            });
        }

        function renderVelo(c) {
            let h = `<div class="space-y-6 pb-20"><div class="bg-blue-50 border border-blue-100 p-5 rounded-xl"><h2 class="font-bold text-xl text-blue-900">üö¥ –í–µ–ª–æ-–ú–∞—Ä—à—Ä—É—Ç—ã</h2><p class="text-xs text-blue-700 mb-4">–í –∫–∞–∂–¥–æ–º –∫–ª—é—á–µ–≤–æ–º –≥–æ—Ä–æ–¥–µ</p>`;
            veloPlan.routes.forEach(r => { h += `<div class="bg-white p-4 rounded-lg shadow-sm mb-3"><div class="flex justify-between mb-1"><h3 class="font-bold text-sm">${r.name}</h3><span class="text-[10px] bg-blue-100 text-blue-800 px-2 rounded pt-0.5">${r.tag}</span></div><p class="text-xs text-stone-600 italic mb-2">${r.desc}</p><ul class="list-disc list-inside text-xs text-stone-700">${r.steps.map(s=>`<li>${s}</li>`).join('')}</ul></div>`; });
            c.innerHTML = h + "</div></div>";
        }

        function renderListWithTabs(c, data, sid, cb, rend, icon) {
             let h=`<div class="flex flex-col md:flex-row gap-4 md:gap-6 h-full pb-20"><div class="sticky top-14 md:top-0 z-30 bg-[#fcfbf9] pt-2 pb-2 md:w-1/4"><div class="md:hidden flex overflow-x-auto hide-scroll gap-2 pb-1">${data.map(i=>`<button onclick="window.upSel('${i.id}')" class="flex-shrink-0 px-4 py-2 rounded-full border text-xs font-bold whitespace-nowrap transition-all ${sid===i.id?'bg-stone-800 text-white border-stone-800':'bg-white text-stone-600 border-stone-200'}">${i.city}</button>`).join('')}</div><div class="hidden md:flex flex-col gap-2">${data.map(i=>`<button onclick="window.upSel('${i.id}')" class="text-left px-4 py-3 rounded-lg border transition-all ${sid===i.id?'bg-stone-800 text-white':'bg-white text-stone-600 hover:bg-stone-50'}"><span class="font-bold text-sm">${i.city}</span></button>`).join('')}</div></div><div class="w-full md:w-3/4">${rend(data.find(x=>x.id===sid), icon)}</div></div>`;
             c.innerHTML=h; window.upSel=cb;
        }

        function renderSightsDetails(c,i) { return `<div class="bg-white rounded-xl border border-stone-200 shadow-sm overflow-hidden fade-in"><div class="bg-stone-100 p-4 border-b border-stone-200"><h2 class="text-2xl font-serif font-bold text-stone-900 flex justify-between">${c.city} <span class="opacity-20">${i}</span></h2></div><div class="divide-y divide-stone-100">${c.places.map(p=>`<div class="p-4"><div class="flex justify-between items-start mb-1"><h3 class="font-bold text-base text-stone-900">${p.name}</h3><span class="badge ${p.badge}">${p.type}</span></div><p class="text-stone-600 text-xs mb-2">${p.detail}</p><a href="https://yandex.ru/maps/?text=${p.name} ${c.city}" target="_blank" class="text-[10px] text-blue-600 font-bold border border-blue-100 bg-blue-50 px-2 py-1 rounded inline-block">üìç –ù–∞ –∫–∞—Ä—Ç–µ</a></div>`).join('')}</div></div>`; }
        function renderFoodDetails(c,i) { return `<div class="bg-white rounded-xl border border-stone-200 shadow-sm overflow-hidden fade-in"><div class="bg-stone-100 p-4 border-b border-stone-200"><h2 class="text-2xl font-serif font-bold text-stone-900 flex justify-between">${c.city} <span class="opacity-20">${i}</span></h2></div><div class="divide-y divide-stone-100">${c.places.map(p=>`<div class="p-4"><div class="flex justify-between items-start"><h3 class="font-bold text-stone-900">${p.name}</h3><span class="text-xs bg-stone-100 px-2 py-0.5 rounded text-stone-600 font-bold">${p.dish}</span></div><p class="text-stone-600 text-xs mt-1 italic mb-2">"${p.why}"</p><div class="flex justify-between items-center"><span class="text-[10px] text-stone-400 font-mono">${p.price}</span><a href="https://yandex.ru/maps/?text=${p.name} ${c.city}" target="_blank" class="text-[10px] text-blue-600 font-bold border border-blue-100 bg-blue-50 px-2 py-1 rounded">üìç –ù–∞ –∫–∞—Ä—Ç–µ</a></div></div>`).join('')}</div></div>`; }
        
        function renderHotelDetails(c,i) { 
            return `
            <div class="bg-white rounded-xl border border-stone-200 shadow-sm overflow-hidden fade-in">
                <div class="bg-stone-100 p-4 border-b border-stone-200">
                    <h2 class="text-2xl font-serif font-bold text-stone-900 flex justify-between">${c.city} <span class="opacity-20">${i}</span></h2>
                    <p class="text-xs text-stone-600 mt-1 italic">${c.desc}</p>
                </div>
                <div class="divide-y divide-stone-100">
                    ${c.places.map(p=>`
                        <div class="p-4">
                            <div class="flex justify-between items-start mb-1">
                                <h3 class="font-bold text-stone-900">${p.name}</h3>
                                <span class="badge ${p.badge}">${p.type}</span>
                            </div>
                            <p class="text-stone-600 text-xs mt-1 leading-relaxed">"${p.why}"</p>
                            <div class="flex justify-between items-center mt-3">
                                <span class="text-xs font-mono text-stone-500 bg-stone-50 px-2 py-1 rounded">${p.price}</span>
                                <a href="https://yandex.ru/maps/?text=${p.name} ${c.city}" target="_blank" class="text-[10px] text-blue-600 font-bold border border-blue-100 bg-blue-50 px-2 py-1 rounded">üìç –ù–∞ –∫–∞—Ä—Ç–µ</a>
                            </div>
                        </div>
                    `).join('')}
                </div>
            </div>`; 
        }

        function renderInfo(c) {
            c.innerHTML = `
            <div class="space-y-6 pb-20">
                <div class="segmented-control sticky top-0 z-20">
                    <button onclick="changeInfo('logistics')" class="segment-btn ${currentState.infoSubTab==='logistics'?'segment-active':''}">–õ–æ–≥–∏—Å—Ç–∏–∫–∞</button>
                    <button onclick="changeInfo('budget')" class="segment-btn ${currentState.infoSubTab==='budget'?'segment-active':''}">–ë—é–¥–∂–µ—Ç</button>
                </div>
                <div id="info-content">${getInfoHTML()}</div>
            </div>`;
            if(currentState.infoSubTab==='budget') setTimeout(initChart, 100);
        }

        function changeInfo(tab) { currentState.infoSubTab = tab; renderInfo(document.getElementById('app-view')); }

        function getInfoHTML() {
            if(currentState.infoSubTab === 'logistics') return `<div class="space-y-3">${logisticsData.map(l=>`<div class="bg-white p-4 rounded-xl border border-stone-200 shadow-sm"><h3 class="font-bold">${l.icon} ${l.title}</h3><p class="text-sm mt-1">${l.detail}</p>${l.vital?`<div class="mt-2 text-xs text-red-600 font-bold bg-red-50 p-2 rounded">${l.vital}</div>`:''}</div>`).join('')}</div>`;
            return `<div class="bg-white p-6 rounded-xl border border-stone-200 shadow-sm"><canvas id="budgetChart"></canvas><div class="text-center mt-4 font-bold text-xl">~¬•392,000</div><p class="text-center text-xs text-stone-500">–Ω–∞ 1 —á–µ–ª (—Å —É—á–µ—Ç–æ–º —Ä—ë–∫–∞–Ω–∞)</p></div>`;
        }

        function initChart() {
            new Chart(document.getElementById('budgetChart'), {
                type: 'doughnut',
                data: { labels: budgetData.labels, datasets: [{ data: budgetData.data, backgroundColor: ['#e7e5e4','#f97316','#047857','#d6d3d1'], borderWidth:0 }] },
                options: { plugins: { legend: { position: 'bottom' } } }
            });
        }

        function jumpToFood(id){currentState.selectedFoodCityId=id;switchView('food');}
        function jumpToSights(id){if(id==='velo'){switchView('velo');return;}currentState.selectedSightsCityId=id;switchView('sights');}
        
        // Global callback
        window.upSel = (id) => {
            if (currentState.view === 'hotels') currentState.selectedHotelCityId = id;
            else if (currentState.view === 'sights') currentState.selectedSightsCityId = id;
            else currentState.selectedFoodCityId = id;
            renderCurrentView();
        };

        init();
    </script>
</body>
</html>
