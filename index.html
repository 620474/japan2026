<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–Ø–ø–æ–Ω–∏—è 2026: General Plan</title>
    
    <!-- LIBRARIES -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://api-maps.yandex.ru/2.1/?apikey=5912b65b-5a13-482f-bf3c-6a11282b5100&lang=ru_RU" type="text/javascript"></script>

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Merriweather:ital,wght@0,700;1,400&display=swap" rel="stylesheet">

    <style>
        :root {
            --bg-primary: #fcfbf9;
            --bg-secondary: #ffffff;
            --text-primary: #292524;
            --text-secondary: #57534e;
            --border-color: #e7e5e4;
            --accent-color: #e11d48;
        }

        /* Dark theme */
        @media (prefers-color-scheme: dark) {
            :root {
                --bg-primary: #1c1917;
                --bg-secondary: #292524;
                --text-primary: #e7e5e4;
                --text-secondary: #a8a29e;
                --border-color: #44403c;
            }

            .bg-white { background-color: #292524 !important; }
            .bg-stone-50 { background-color: #1c1917 !important; }
            .bg-stone-100 { background-color: #292524 !important; }
            .text-stone-900 { color: #e7e5e4 !important; }
            .text-stone-800 { color: #d6d3d1 !important; }
            .text-stone-600 { color: #a8a29e !important; }
            .text-stone-500 { color: #78716c !important; }
            .border-stone-200 { border-color: #44403c !important; }
            .border-stone-300 { border-color: #57534e !important; }

            #map-container { background: #292524 !important; }

            .ymaps-2-1-79-balloon__content {
                background: #292524 !important;
            }
            .balloon-title { color: #e7e5e4 !important; }
            .balloon-desc { color: #a8a29e !important; }
        }

        body {
            font-family: 'Noto Sans', sans-serif;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            -webkit-tap-highlight-color: transparent;
            transition: background-color 0.3s ease;
        }

        h1, h2, h3, .serif-font { font-family: 'Merriweather', serif; }
        .hide-scroll::-webkit-scrollbar { display: none; }
        .hide-scroll { -ms-overflow-style: none; scrollbar-width: none; }
        .mobile-safe-bottom { padding-bottom: env(safe-area-inset-bottom); }
        
        /* Enhanced animations */
        .fade-in {
            animation: fadeIn 0.4s cubic-bezier(0.16, 1, 0.3, 1);
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(8px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .slide-in-right {
            animation: slideInRight 0.3s cubic-bezier(0.16, 1, 0.3, 1);
        }
        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* Card hover effects */
        .card-hover {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
        }
        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 24px rgba(0,0,0,0.1);
        }

        /* Pulse animation for urgent items */
        @keyframes pulse-subtle {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        .badge-urgent {
            animation: pulse-subtle 2s ease-in-out infinite;
        }

        /* Timeline gradient */
        .timeline-line {
            background: linear-gradient(180deg, #e11d48 0%, #f97316 50%, #0891b2 100%);
        }

        /* Skeleton loading */
        .skeleton {
            background: linear-gradient(90deg, #e7e5e4 25%, #f5f5f4 50%, #e7e5e4 75%);
            background-size: 200% 100%;
            animation: skeleton-loading 1.5s ease-in-out infinite;
        }
        @keyframes skeleton-loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        @media (prefers-color-scheme: dark) {
            .skeleton {
                background: linear-gradient(90deg, #292524 25%, #3f3f46 50%, #292524 75%);
                background-size: 200% 100%;
            }
        }

        #map-container {
            height: 100%;
            min-height: 700px;
            width: 100%;
            border-radius: 12px;
            z-index: 1;
            background: #e5e7eb;
            overflow: hidden;
            position: relative;
        }

        /* Map skeleton */
        .map-skeleton {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, #e7e5e4 25%, #f5f5f4 50%, #e7e5e4 75%);
            background-size: 200% 100%;
            animation: skeleton-loading 1.5s ease-in-out infinite;
            z-index: 10;
            border-radius: 12px;
        }

        /* Progress bar */
        .progress-bar-container {
            position: relative;
            overflow: hidden;
        }
        .progress-bar-fill {
            transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Enhanced badges */
        .badge {
            display: inline-flex;
            align-items: center;
            padding: 3px 10px;
            border-radius: 6px;
            font-size: 0.65rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            box-shadow: 0 1px 2px rgba(0,0,0,0.05), inset 0 1px 0 rgba(255,255,255,0.1);
            transition: all 0.2s ease;
        }
        .badge:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .badge-base { background: #f0fdf4; color: #15803d; border: 1px solid #bbf7d0; }
        .badge-trip { background: #eff6ff; color: #1d4ed8; border: 1px solid #bfdbfe; }
        .badge-time { background: #fff7ed; color: #9a3412; border: 1px solid #fed7aa; margin-right: 6px; }
        .badge-road { background: #172554; color: #bfdbfe; border: 1px solid #1d4ed8; }
        .badge-casual { background: #f0fdf4; color: #166534; border: 1px solid #86efac; }
        .badge-history { background: #fff1f2; color: #9f1239; border: 1px solid #fecdd3; }
        .badge-local { background: #f0fdf4; color: #15803d; border: 1px solid #bbf7d0; }
        .badge-sweet { background: #fff7ed; color: #c2410c; border: 1px solid #fed7aa; }
        .badge-tech { background: #eff6ff; color: #1d4ed8; border: 1px solid #bfdbfe; }
        .badge-soul { background: #fdf4ff; color: #86198f; border: 1px solid #f0abfc; }
        .badge-onsen { background: #fff1f2; color: #be123c; border: 1px solid #fda4af; }
        .badge-design { background: #f5f3ff; color: #5b21b6; border: 1px solid #ddd6fe; }
        .badge-vibe { background: #fdf4ff; color: #86198f; border: 1px solid #f0abfc; }
        .badge-value { background: #ecfccb; color: #3f6212; border: 1px solid #d9f99d; }
        .badge-art { background: #fefce8; color: #854d0e; border: 1px solid #fde68a; }
        .badge-nature { background: #ecfdf5; color: #065f46; border: 1px solid #6ee7b7; }
        .badge-relax { background: #f0f9ff; color: #075985; border: 1px solid #7dd3fc; }
        .badge-trek { background: #f5f3ff; color: #5b21b6; border: 1px solid #c4b5fd; }

        /* Premium gradient badge */
        .badge-premium {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
        }

        .tag-pill {
            display: inline-flex;
            align-items: center;
            padding: 2px 8px;
            border-radius: 999px;
            font-size: .65rem;
            font-weight: 700;
            border: 1px solid #e7e5e4;
            background: #fafaf9;
            color: #44403c;
            transition: all 0.2s ease;
        }
        .tag-pill:hover {
            background: #e7e5e4;
            transform: scale(1.05);
        }

        .segmented-control {
            background: #e7e5e4;
            padding: 4px;
            border-radius: 8px;
            display: flex;
        }
        .segment-btn {
            flex: 1;
            text-align: center;
            padding: 8px 0;
            font-size: 13px;
            font-weight: 600;
            border-radius: 6px;
            color: #57534e;
            transition: all 0.2s;
            cursor: pointer;
        }
        .segment-active {
            background: white;
            color: #1c1917;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }

        @media (prefers-color-scheme: dark) {
            .segmented-control { background: #44403c; }
            .segment-btn { color: #a8a29e; }
            .segment-active { background: #292524; color: #e7e5e4; }
        }

        /* Floating Action Button */
        .fab {
            position: fixed;
            bottom: 80px;
            right: 16px;
            width: 56px;
            height: 56px;
            background: linear-gradient(135deg, #e11d48 0%, #f97316 100%);
            color: white;
            border-radius: 50%;
            box-shadow: 0 4px 12px rgba(225, 29, 72, 0.4);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 40;
        }
        .fab:hover {
            transform: scale(1.1) rotate(90deg);
            box-shadow: 0 6px 20px rgba(225, 29, 72, 0.6);
        }
        .fab:active {
            transform: scale(0.95);
        }

        @media (min-width: 768px) {
            .fab {
                bottom: 24px;
            }
        }

        /* Toast notifications */
        .toast {
            position: fixed;
            top: 80px;
            right: 16px;
            padding: 12px 20px;
            border-radius: 8px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            z-index: 9999;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            font-weight: 600;
            transform: translateX(400px);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            max-width: 90vw;
        }
        .toast.show {
            transform: translateX(0);
        }
        .toast-success { background: #10b981; color: white; }
        .toast-error { background: #ef4444; color: white; }
        .toast-info { background: #3b82f6; color: white; }

        /* Search input */
        .search-input {
            transition: all 0.3s ease;
        }
        .search-input:focus {
            box-shadow: 0 0 0 3px rgba(225, 29, 72, 0.1);
        }

        /* Stats cards */
        .stat-card {
            background: linear-gradient(135deg, var(--from), var(--to));
            border-radius: 12px;
            padding: 16px;
            transition: all 0.3s ease;
        }
        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
        }

        /* Image placeholder gradients */
        .img-placeholder-1 { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .img-placeholder-2 { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
        .img-placeholder-3 { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
        .img-placeholder-4 { background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); }
        .img-placeholder-5 { background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); }
        .img-placeholder-6 { background: linear-gradient(135deg, #30cfd0 0%, #330867 100%); }

        /* Day marker with check */
        .day-marker {
            position: relative;
        }
        .day-marker::after {
            content: '‚úì';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 16px;
            font-weight: bold;
            color: #10b981;
        }
        .day-completed .day-marker::after {
            opacity: 1;
        }

        /* Theme toggle button */
        .theme-toggle {
            position: fixed;
            top: 70px;
            right: 16px;
            width: 40px;
            height: 40px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 100;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .theme-toggle:hover {
            transform: scale(1.1);
        }

        /* Yandex Maps Balloon Styling */
        .ymaps-2-1-79-balloon__layout {
            border-radius: 8px !important;
            overflow: hidden !important;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15) !important;
        }

        .ymaps-2-1-79-balloon__content {
            padding: 12px !important;
            min-width: 200px !important;
            max-width: 280px !important;
        }

        .balloon-title {
            font-size: 14px !important;
            font-weight: 700 !important;
            color: #1c1917 !important;
            margin-bottom: 4px !important;
            line-height: 1.2 !important;
        }

        .balloon-desc {
            font-size: 12px !important;
            line-height: 1.5 !important;
            color: #57534e !important;
        }

        @media (max-width: 420px) {
            .ymaps-2-1-79-balloon__content {
                min-width: 180px !important;
                max-width: 85vw !important;
            }
        }

        /* Smooth scrolling */
        html {
            scroll-behavior: smooth;
        }

        /* Bottom Sheet Modal */
        .bottom-sheet-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 9998;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        .bottom-sheet-overlay.show {
            opacity: 1;
        }

        .bottom-sheet {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--bg-secondary);
            border-top-left-radius: 20px;
            border-top-right-radius: 20px;
            box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.15);
            z-index: 9999;
            max-height: 85vh;
            overflow-y: auto;
            transform: translateY(100%);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .bottom-sheet.show {
            transform: translateY(0);
        }

        .bottom-sheet-handle {
            width: 40px;
            height: 4px;
            background: #d4d4d8;
            border-radius: 2px;
            margin: 12px auto 16px;
        }

        .route-detail-map {
            height: 450px;
            width: 100%;
            border-radius: 12px;
            overflow: hidden;
        }

        @media (min-width: 768px) {
            .route-detail-map {
                height: 100%;
                min-height: 450px;
            }
        }
    </style>
</head>
<body class="antialiased flex flex-col min-h-screen pb-20 md:pb-0">

    <!-- Theme Toggle -->
    <div class="theme-toggle" onclick="toggleTheme()" title="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É">
        <span id="theme-icon">üåô</span>
    </div>

    <header class="bg-white border-b border-stone-200 sticky top-0 z-50 shadow-sm safe-top">
        <div class="max-w-6xl mx-auto px-4 h-14 md:h-16 flex items-center justify-between">
            <div class="flex items-center gap-3">
                <div class="w-8 h-8 bg-teal-800 rounded flex items-center justify-center text-white font-serif font-bold text-lg">JP</div>
                <div>
                    <div class="font-bold text-base md:text-lg leading-tight text-stone-900">Japan 2026</div>
                    <div class="text-[10px] md:text-xs text-stone-500 font-medium">General Plan</div>
                </div>
            </div>
            <nav class="hidden md:flex gap-1" id="desktop-nav"></nav>
        </div>
    </header>

    <!-- Progress Bar -->
    <div id="progress-bar-container" class="hidden sticky top-14 md:top-16 bg-white border-b border-stone-200 z-40 shadow-sm"></div>

    <main class="flex-grow w-full max-w-6xl mx-auto px-3 md:px-4 py-4 md:py-8 h-full">
        <div id="app-view" class="fade-in h-full"></div>
    </main>

    <nav class="md:hidden fixed bottom-0 left-0 w-full bg-white border-t border-stone-200 z-50 mobile-safe-bottom shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.05)]">
        <div class="grid grid-cols-6 h-16" id="mobile-bottom-nav"></div>
    </nav>

    <!-- Floating Action Button -->
    <div class="fab" onclick="showQuickActions()" title="–ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <path d="M12 4v16m8-8H4" />
        </svg>
    </div>

    <script>
        // ============================================
        // üîë CONFIGURATION
        // ============================================
        const YANDEX_API_KEY = '5912b65b-5a13-482f-bf3c-6a11282b5100';
        const TRIP_START_DATE = new Date('2026-04-15');
        const THEME_KEY = 'jp2026_theme';

        // ============================================
        // üõ†Ô∏è HELPER FUNCTIONS
        // ============================================
        const isMobile = () => window.innerWidth <= 768;
        const qs = (sel, root=document) => root.querySelector(sel);
        const qsa = (sel, root=document) => Array.from(root.querySelectorAll(sel));
        const safe = (v, fallback='') => (v === undefined || v === null ? fallback : v);

        // Theme management
        let currentTheme = localStorage.getItem(THEME_KEY) || 'auto';

        function toggleTheme() {
            const themes = ['auto', 'light', 'dark'];
            const currentIndex = themes.indexOf(currentTheme);
            currentTheme = themes[(currentIndex + 1) % themes.length];
            localStorage.setItem(THEME_KEY, currentTheme);
            applyTheme();
            showToast('–¢–µ–º–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∞: ' + (currentTheme === 'auto' ? '–ê–≤—Ç–æ' : currentTheme === 'light' ? '–°–≤–µ—Ç–ª–∞—è' : '–¢–µ–º–Ω–∞—è'), 'info');
        }

        function applyTheme() {
            const icon = document.getElementById('theme-icon');
            if (currentTheme === 'light') {
                document.documentElement.style.colorScheme = 'light';
                icon.textContent = '‚òÄÔ∏è';
            } else if (currentTheme === 'dark') {
                document.documentElement.style.colorScheme = 'dark';
                icon.textContent = 'üåô';
            } else {
                document.documentElement.style.colorScheme = 'light dark';
                icon.textContent = 'üåó';
            }
        }

        // Toast notifications
        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;

            const icon = type === 'success' ? '‚úì' : type === 'error' ? '‚úó' : '‚Ñπ';
            toast.innerHTML = `<span>${icon}</span><span>${message}</span>`;

            document.body.appendChild(toast);

            setTimeout(() => toast.classList.add('show'), 10);

            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // Quick actions menu
        function showQuickActions() {
            const actions = [
                { label: '–î–æ–±–∞–≤–∏—Ç—å –≤ —á–µ–∫–ª–∏—Å—Ç', action: () => { switchView('info'); changeInfo('logistics'); setTimeout(() => document.getElementById('add-check-item')?.click(), 200); } },
                { label: '–ü–æ–∏—Å–∫ –ø–æ –ø–ª–∞–Ω—É', action: () => { switchView('itinerary'); setTimeout(() => document.getElementById('search-input')?.focus(), 200); } },
                { label: '–≠–∫—Å–ø–æ—Ä—Ç –≤ PDF', action: () => showToast('–§—É–Ω–∫—Ü–∏—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ', 'info') }
            ];

            const menu = actions.map((a, i) => `<button onclick="(${a.action})(); closeQuickMenu();" class="w-full text-left px-4 py-3 hover:bg-stone-50 transition-colors">${a.label}</button>`).join('');

            const overlay = document.createElement('div');
            overlay.id = 'quick-menu-overlay';
            overlay.className = 'fixed inset-0 bg-black bg-opacity-30 z-[60] fade-in';
            overlay.onclick = closeQuickMenu;

            const menuDiv = document.createElement('div');
            menuDiv.id = 'quick-menu';
            menuDiv.className = 'fixed bottom-20 right-4 bg-white rounded-xl shadow-2xl overflow-hidden z-[70] slide-in-right';
            menuDiv.innerHTML = menu;

            document.body.appendChild(overlay);
            document.body.appendChild(menuDiv);
        }

        function closeQuickMenu() {
            document.getElementById('quick-menu-overlay')?.remove();
            document.getElementById('quick-menu')?.remove();
        }

        // Calculate days until trip
        function getDaysUntilTrip() {
            const now = new Date();
            const diff = TRIP_START_DATE - now;
            return Math.ceil(diff / (1000 * 60 * 60 * 24));
        }

        // Render progress bar
        function renderProgressBar() {
            const container = document.getElementById('progress-bar-container');
            if (currentState.view !== 'itinerary') {
                container.classList.add('hidden');
                return;
            }

            const days = getDaysUntilTrip();
            const totalDays = 365; // Assuming planning started ~1 year before
            const progress = Math.max(0, Math.min(100, ((totalDays - days) / totalDays) * 100));

            container.classList.remove('hidden');
            container.innerHTML = `
                <div class="max-w-6xl mx-auto px-4 py-3">
                    <div class="flex justify-between text-xs mb-2">
                        <span class="font-bold text-stone-600">–î–æ –ø–æ–µ–∑–¥–∫–∏</span>
                        <span class="font-bold" style="color: ${days < 30 ? '#e11d48' : '#0891b2'}">${days} ${days === 1 ? '–¥–µ–Ω—å' : days < 5 ? '–¥–Ω—è' : '–¥–Ω–µ–π'}</span>
                    </div>
                    <div class="h-2 bg-stone-200 rounded-full overflow-hidden progress-bar-container">
                        <div class="h-full bg-gradient-to-r from-red-500 via-orange-500 to-blue-500 progress-bar-fill" style="width: ${progress}%"></div>
                    </div>
                </div>
            `;
        }

        // ================= DATA =================

        const itinerary = [
            { day: "15.04", date: "–°—Ä", city: "–û—Å–∞–∫–∞", title: "–ü—Ä–∏–±—ã—Ç–∏–µ", time: "–î–µ–Ω—å", type: "base", desc: "–ü—Ä–∏–ª–µ—Ç 11:45. –ë–∞–∑–∞: –û—Å–∞–∫–∞ (3 –Ω–æ—á–∏). –°–±–æ—Ä–∫–∞ –≤–µ–ª–æ—Å–∏–ø–µ–¥–æ–≤. –í–µ—á–µ—Ä–Ω–∏–π –î–æ—Ç–æ–Ω–±–æ—Ä–∏.", food_ref: "osaka", sight_ref: "osaka", hotel_ref: "osaka", imgClass: "img-placeholder-1" },
            { day: "16.04", date: "–ß—Ç", city: "–ê–≤–∞–¥–∑–∏", title: "Awaichi", time: "06:00", type: "trip", desc: "–í–µ–ª–æ—Å–∏–ø–µ–¥–Ω—ã–π –¥–µ–Ω—å –Ω–∞ –æ—Å—Ç—Ä–æ–≤–µ –ê–≤–∞–¥–∑–∏. –ö—Ä—É–≥–æ–≤–æ–π –º–∞—Ä—à—Ä—É—Ç (150–∫–º) –∏–ª–∏ –ø—Ä–æ–≥—É–ª–æ—á–Ω—ã–π –ø–æ —Å–µ–≤–µ—Ä—É.", food_ref: "kobe", sight_ref: "velo", hotel_ref: "osaka", imgClass: "img-placeholder-2" },
            { day: "17.04", date: "–ü—Ç", city: "–ö–æ–±–µ", title: "–ü–æ—Ä—Ç –∏ –ì–æ—Ä—ã", time: "08:00", type: "trip", desc: "–†–∞–¥–∏–∞–ª—å–Ω—ã–π –≤—ã–µ–∑–¥. –í–æ–¥–æ–ø–∞–¥—ã –ù—É–Ω–æ–±–∏–∫–∏, –≥–æ—Ä–∞ –†–æ–∫–∫–æ, –Ω–∞–±–µ—Ä–µ–∂–Ω–∞—è. –û–±–µ–¥ —Å –º—è—Å–æ–º –ö–æ–±–µ.", food_ref: "kobe", sight_ref: "kobe", hotel_ref: "osaka", imgClass: "img-placeholder-3" },
            { day: "18.04", date: "–°–±", city: "–ö–∏–æ—Ç–æ", title: "–ü–µ—Ä–µ–µ–∑–¥", time: "–£—Ç—Ä–æ", type: "base", desc: "–ü–æ–µ–∑–¥ –≤ –ö–∏–æ—Ç–æ. –ë–∞–∑–∞: –ö–∏–æ—Ç–æ (3 –Ω–æ—á–∏). –í–µ—á–µ—Ä–Ω–∏–π –ì–∏–æ–Ω –∏ –ü–æ–Ω—Ç–æ—Ç—ë.", food_ref: "kyoto", sight_ref: "kyoto", hotel_ref: "kyoto", imgClass: "img-placeholder-4" },
            { day: "19.04", date: "–í—Å", city: "–ö–∏–æ—Ç–æ", title: "–í–µ–ª–æ-–¥–µ–Ω—å", time: "07:00", type: "base", desc: "–ü–æ–µ–∑–¥–∫–∞ –Ω–∞ —Å–µ–≤–µ—Ä –∫ –≥–æ—Ä–∞–º –∏–ª–∏ –Ω–∞ –≤–æ—Å—Ç–æ–∫ –∫ –æ–∑–µ—Ä—É –ë–∏–≤–∞.", food_ref: "biwa", sight_ref: "velo", hotel_ref: "kyoto", imgClass: "img-placeholder-5" },
            { day: "20.04", date: "–ü–Ω", city: "–ö–∏–æ—Ç–æ", title: "–ö—É–ª—å—Ç—É—Ä–∞", time: "–î–µ–Ω—å", type: "base", desc: "–ü–µ—à–∏–π –¥–µ–Ω—å. –ó–æ–ª–æ—Ç–æ–π –ø–∞–≤–∏–ª—å–æ–Ω, –°–∞–¥ –∫–∞–º–Ω–µ–π, –ë–∞–º–±—É–∫–æ–≤–∞—è —Ä–æ—â–∞ (–ê—Ä–∞—Å–∏—è–º–∞).", food_ref: "kyoto", sight_ref: "kyoto", hotel_ref: "kyoto", imgClass: "img-placeholder-6" },
            { day: "21.04", date: "–í—Ç", city: "–•–∏—Ä–æ—Å–∏–º–∞", title: "–ó–∞–ø–∞–¥", time: "–£—Ç—Ä–æ", type: "base", desc: "–ê–∫—Ç–∏–≤–∞—Ü–∏—è –ü–∞—Å—Å–∞. –°–∏–Ω–∫–∞–Ω—Å—ç–Ω. –ë–∞–∑–∞: –•–∏—Ä–æ—Å–∏–º–∞ (3 –Ω–æ—á–∏). –ü–∞—Ä–∫ –ú–∏—Ä–∞.", food_ref: "hiroshima", sight_ref: "hiroshima", hotel_ref: "hiroshima", imgClass: "img-placeholder-1" },
            { day: "22.04", date: "–°—Ä", city: "–ú–∏—è–¥–∑–∏–º–∞", title: "–û—Å—Ç—Ä–æ–≤", time: "–î–µ–Ω—å", type: "trip", desc: "–ü–∞—Ä–æ–º. –•—Ä–∞–º –ò—Ü—É–∫—É—Å–∏–º–∞. –•–∞–π–∫–∏–Ω–≥ –Ω–∞ –≥–æ—Ä—É –ú–∏—Å—ç–Ω.", food_ref: "miyajima", sight_ref: "miyajima", hotel_ref: "hiroshima", imgClass: "img-placeholder-2" },
            { day: "23.04", date: "–ß—Ç", city: "–û–Ω–æ–º–∏—Ç–∏", title: "–®–∏–º–∞–Ω–∞–º–∏", time: "07:00", type: "trip", desc: "–í–µ–ª–æ—Å–∏–ø–µ–¥–Ω—ã–π –¥–µ–Ω—å: –®–∏–º–∞–Ω–∞–º–∏ –ö–∞–π–¥–æ (—á–µ—Ä–µ–∑ –º–æ—Å—Ç—ã).", food_ref: "onomichi", sight_ref: "velo", hotel_ref: "hiroshima", imgClass: "img-placeholder-3" },
            { day: "24.04", date: "–ü—Ç", city: "–ö–æ–∫—É—Ä–∞", title: "–ö—é—Å—é", time: "–£—Ç—Ä–æ", type: "base", desc: "–°–∏–Ω–∫–∞–Ω—Å—ç–Ω. –ë–∞–∑–∞: –ö–æ–∫—É—Ä–∞ (3 –Ω–æ—á–∏). –ó–∞–º–æ–∫, –†—ã–Ω–æ–∫ –¢–∞–Ω–≥–∞.", food_ref: "kokura", sight_ref: "kokura", hotel_ref: "kokura", imgClass: "img-placeholder-4" },
            { day: "25.04", date: "–°–±", city: "–§—É–∫—É–æ–∫–∞", title: "–ì–∞—Å—Ç—Ä–æ–Ω–æ–º–∏—è", time: "10:00", type: "trip", desc: "–†–∞–¥–∏–∞–ª—å–Ω—ã–π –≤—ã–µ–∑–¥ –≤ –•–∞–∫–∞—Ç—É (15 –º–∏–Ω). –†–∞–º–µ–Ω, —à–æ–ø–∏–Ω–≥, –Ø—Ç–∞–π.", food_ref: "fukuoka", sight_ref: "fukuoka", hotel_ref: "kokura", imgClass: "img-placeholder-5" },
            { day: "26.04", date: "–í—Å", city: "–ò—Ç–æ—Å–∏–º–∞", title: "–û–∫–µ–∞–Ω", time: "09:00", type: "trip", desc: "–í–µ–ª–æ—Å–∏–ø–µ–¥–Ω–∞—è –ø—Ä–æ–≥—É–ª–∫–∞ –≤–¥–æ–ª—å –ø–æ–±–µ—Ä–µ–∂—å—è (Sunset Road).", food_ref: "fukuoka", sight_ref: "velo", hotel_ref: "kokura", imgClass: "img-placeholder-6" },
            { day: "27.04", date: "–ü–Ω", city: "–û—Å–∞–∫–∞", title: "–í–æ–∑–≤—Ä–∞—Ç", time: "–î–µ–Ω—å", type: "base", desc: "–°–∏–Ω–∫–∞–Ω—Å—ç–Ω –ö–æ–∫—É—Ä–∞ -> –û—Å–∞–∫–∞. –§–∏–Ω–∞–ª—å–Ω–∞—è –±–∞–∑–∞ (2 –Ω–æ—á–∏). –£–ø–∞–∫–æ–≤–∫–∞.", food_ref: "osaka", sight_ref: "osaka", hotel_ref: "osaka", imgClass: "img-placeholder-1" },
            { day: "28.04", date: "–í—Ç", city: "–í—ã–ª–µ—Ç", title: "–î–æ–º–æ–π", time: "18:10", type: "base", desc: "–¢—Ä–∞–Ω—Å—Ñ–µ—Ä –≤ –∞—ç—Ä–æ–ø–æ—Ä—Ç KIX.", food_ref: "osaka", sight_ref: "osaka", hotel_ref: "osaka", imgClass: "img-placeholder-2" }
        ];

        const mapLocations = [
            { name: "–û—Å–∞–∫–∞", coords: [34.6937, 135.5023], desc: "–ë–∞–∑–∞ 1 (3) + –§–∏–Ω–∞–ª (2)" },
            { name: "–ö–∏–æ—Ç–æ", coords: [35.0116, 135.7681], desc: "–ë–∞–∑–∞ 2 (3 –Ω–æ—á–∏)" },
            { name: "–•–∏—Ä–æ—Å–∏–º–∞", coords: [34.3853, 132.4553], desc: "–ë–∞–∑–∞ 3 (3 –Ω–æ—á–∏)" },
            { name: "–§—É–∫—É–æ–∫–∞", coords: [33.5902, 130.4207], desc: "–ë–∞–∑–∞ 4 (3 –Ω–æ—á–∏)" }
        ];

        const pointsOfInterest = [
            { name: "–ê–≤–∞–¥–∑–∏", coords: [34.5930, 135.0190], desc: "–í–µ–ª–æ-–¥–µ–Ω—å: –ö—Ä—É–≥ –≤–æ–∫—Ä—É–≥ –æ—Å—Ç—Ä–æ–≤–∞ –ê–≤–∞–¥–∑–∏ (Awaichi). –ü–æ–ª–Ω—ã–π 150–∫–º –∏–ª–∏ —á–∞—Å—Ç—å." },
            { name: "–ö–æ–±–µ", coords: [34.6901, 135.1955], desc: "–ì–æ—Ä—ã –∏ –ü–æ—Ä—Ç: –í–æ–¥–æ–ø–∞–¥ Nunobiki, Meriken Park, –∫–æ—Ñ–µ –∏ –≥–æ–≤—è–¥–∏–Ω–∞ –ö–æ–±–µ." },
            { name: "–®–∏–º–∞–Ω–∞–º–∏ –ö–∞–π–¥–æ", coords: [34.2563, 133.0256], desc: "–í–µ–ª–æ-–º–∞—Ä—à—Ä—É—Ç: 70–∫–º —á–µ—Ä–µ–∑ 6 –æ—Å—Ç—Ä–æ–≤–æ–≤ –∏ –º–æ—Å—Ç—ã. –ö–ª–∞—Å—Å–∏–∫–∞ —è–ø–æ–Ω—Å–∫–æ–≥–æ –≤–µ–ª–æ—Ç—É—Ä–∏–∑–º–∞." },
            { name: "–ò—Ç–æ—Å–∏–º–∞", coords: [33.6133, 130.1983], desc: "–í–µ–ª–æ-—Å–ø–æ—Ç: –ö—Ä–∞—Å–∏–≤–∞—è –¥–æ—Ä–æ–≥–∞ –≤–¥–æ–ª—å –æ–∫–µ–∞–Ω–∞ –Ω–∞ –∑–∞–∫–∞—Ç–µ. –ò–¥–µ–∞–ª—å–Ω–æ –¥–ª—è –≤–µ—á–µ—Ä–Ω–µ–π –ø–æ–µ–∑–¥–∫–∏." },
            { name: "–ú–∏—è–¥–∑–∏–º–∞", coords: [34.2958, 132.3197], desc: "–°–≤—è—â–µ–Ω–Ω—ã–π –æ—Å—Ç—Ä–æ–≤: –ü–ª–∞–≤–∞—é—â–∏–µ –≤–æ—Ä–æ—Ç–∞ —Ç–æ—Ä–∏–∏, –≥–æ—Ä–∞ –ú–∏—Å—ç–Ω, –æ–ª–µ–Ω–∏." },
            { name: "–û–Ω–æ–º–∏—Ç–∏", coords: [34.4095, 133.2049], desc: "–°—Ç–∞—Ä—Ç –®–∏–º–∞–Ω–∞–º–∏: –†–µ—Ç—Ä–æ-–≥–æ—Ä–æ–¥, —Ö—Ä–∞–º—ã –Ω–∞ —Ö–æ–ª–º–∞—Ö, U2 –≤–µ–ª–æ–∫–æ–º–ø–ª–µ–∫—Å." }
        ];

        const veloPlan = {
            title: "–í–µ–ª–æ-–ì–∏–¥",
            groups: [
                {
                    name: "üö¥ –û—Å–Ω–æ–≤–Ω—ã–µ –ú–∞—Ä—à—Ä—É—Ç—ã",
                    color: "bg-blue-900 text-white",
                    routes: [
                        {
                            id: "awaichi",
                            name: "Awaichi (Awaji)",
                            badge: "badge-road",
                            desc: "–ö—Ä—É–≥ –≤–æ–∫—Ä—É–≥ –æ—Å—Ç—Ä–æ–≤–∞ –ê–≤–∞–¥–∑–∏. –ü–æ–ª–Ω—ã–π 150–∫–º –∏–ª–∏ —á–∞—Å—Ç—å.",
                            distance: "150 –∫–º",
                            gradient: "–°—Ä–µ–¥–Ω–∏–π: 2%, –ú–∞–∫—Å: 8%",
                            elevation: "+800m",
                            duration: "6-8 —á–∞—Å–æ–≤",
                            difficulty: "–°—Ä–µ–¥–Ω—è—è",
                            highlights: ["–ü–ª—è–∂–∏", "–•—Ä–∞–º—ã", "–í–∏–¥—ã –Ω–∞ –æ–∫–µ–∞–Ω"],
                            center: [34.5930, 135.0190],
                            mapLink: "https://www.google.com/maps/d/viewer?mid=1XnKFzYFJH6LkGC_awaichi"
                            // track: [
                            //     [34.5930, 135.0190], [34.6100, 135.0100], [34.6400, 134.9800],
                            //     [34.6800, 134.9500], [34.7000, 134.9300], [34.7100, 134.9100],
                            //     [34.7000, 134.8900], [34.6700, 134.8800], [34.6300, 134.8700],
                            //     [34.5800, 134.8800], [34.5400, 134.9100], [34.5200, 134.9500],
                            //     [34.5100, 135.0000], [34.5300, 135.0400], [34.5600, 135.0600],
                            //     [34.5930, 135.0190]
                            // ]
                        },
                        {
                            id: "shimanami",
                            name: "Shimanami Kaido",
                            badge: "badge-road",
                            desc: "70–∫–º —á–µ—Ä–µ–∑ 6 –æ—Å—Ç—Ä–æ–≤–æ–≤ –∏ –º–æ—Å—Ç—ã. –ö–ª–∞—Å—Å–∏–∫–∞.",
                            distance: "70 –∫–º",
                            gradient: "–°—Ä–µ–¥–Ω–∏–π: 3%, –ú–∞–∫—Å: 12%",
                            elevation: "+600m",
                            duration: "4-6 —á–∞—Å–æ–≤",
                            difficulty: "–°—Ä–µ–¥–Ω—è—è-–í—ã—Å–æ–∫–∞—è",
                            highlights: ["6 –º–æ—Å—Ç–æ–≤", "–û—Å—Ç—Ä–æ–≤–∞", "–í–∏–¥—ã —Å –º–æ—Å—Ç–æ–≤"],
                            center: [34.2563, 133.0256],
                            mapLink: "https://www.google.com/maps/d/viewer?mid=1shimanami"
                            // track: [
                            //     [34.4095, 133.2049], [34.4000, 133.1800], [34.3700, 133.1400],
                            //     [34.3400, 133.1000], [34.3100, 133.0600], [34.2800, 133.0200],
                            //     [34.2563, 132.9800], [34.2400, 132.9400], [34.2200, 132.9000],
                            //     [34.2000, 132.8600], [34.1800, 132.8200]
                            // ]
                        },
                        {
                            id: "kamo",
                            name: "Kamo River",
                            badge: "badge-casual",
                            desc: "–ö–∏–æ—Ç–æ. –†–∞—Å—Å–ª–∞–±–ª–µ–Ω–Ω–∞—è –µ–∑–¥–∞ –≤–¥–æ–ª—å —Ä–µ–∫–∏.",
                            distance: "25 –∫–º",
                            gradient: "–°—Ä–µ–¥–Ω–∏–π: 1%, –ú–∞–∫—Å: 3%",
                            elevation: "+50m",
                            duration: "2-3 —á–∞—Å–∞",
                            difficulty: "–õ–µ–≥–∫–∞—è",
                            highlights: ["–†–µ–∫–∞", "–ü–∞—Ä–∫–∏", "–•—Ä–∞–º—ã"],
                            center: [35.0116, 135.7681],
                            mapLink: "https://www.google.com/maps/d/viewer?mid=1kamo"
                            // track: [
                            //     [35.0400, 135.7681], [35.0350, 135.7700], [35.0250, 135.7720],
                            //     [35.0150, 135.7740], [35.0050, 135.7760], [34.9950, 135.7780],
                            //     [34.9850, 135.7800], [34.9750, 135.7780], [34.9650, 135.7760],
                            //     [34.9750, 135.7740], [34.9850, 135.7720], [35.0000, 135.7700],
                            //     [35.0116, 135.7681]
                            // ]
                        },
                        {
                            id: "itoshima",
                            name: "Itoshima Sunset",
                            badge: "badge-road",
                            desc: "–§—É–∫—É–æ–∫–∞. –ö—Ä–∞—Å–∏–≤–∞—è –¥–æ—Ä–æ–≥–∞ –≤–¥–æ–ª—å –æ–∫–µ–∞–Ω–∞.",
                            distance: "45 –∫–º",
                            gradient: "–°—Ä–µ–¥–Ω–∏–π: 2%, –ú–∞–∫—Å: 6%",
                            elevation: "+200m",
                            duration: "3-4 —á–∞—Å–∞",
                            difficulty: "–°—Ä–µ–¥–Ω—è—è",
                            highlights: ["–ó–∞–∫–∞—Ç—ã", "–ü–ª—è–∂–∏", "–°–µ—Ä—Ñ–∏–Ω–≥"],
                            center: [33.6133, 130.1983],
                            mapLink: "https://www.google.com/maps/d/viewer?mid=1itoshima"
                            // track: [
                            //     [33.5902, 130.4207], [33.5950, 130.3900], [33.6000, 130.3600],
                            //     [33.6050, 130.3300], [33.6100, 130.3000], [33.6133, 130.2700],
                            //     [33.6150, 130.2400], [33.6133, 130.2100], [33.6100, 130.1983],
                            //     [33.6050, 130.1700], [33.6000, 130.1500]
                            // ]
                        },
                        {
                            id: "route308",
                            name: "Route 308 ‚Äî ÊöóÂ≥† (Kuragari Pass)",
                            badge: "badge-road",
                            desc: "Osaka (Higashi-Osaka) ‚Üí Nara (Ikoma). –°–∞–º—ã–π –∂—ë—Å—Ç–∫–∏–π –ø–æ–¥—ä—ë–º –Ω–∞ –≥—Ä–∞–Ω–∏—Ü–µ –ø—Ä–µ—Ñ–µ–∫—Ç—É—Ä.",
                            distance: "‚âà30 –∫–º",
                            gradient: "–£—á–∞—Å—Ç–∫–∞–º–∏ –æ—á–µ–Ω—å –∫—Ä—É—Ç–æ (–ø–µ—Ä–µ–≤–∞–ª ÊöóÂ≥†)",
                            elevation: "+650m",
                            duration: "3‚Äì4 —á–∞—Å–∞",
                            difficulty: "–û—á–µ–Ω—å –≤—ã—Å–æ–∫–∞—è",
                            highlights: ["ÊöóÂ≥† (Kuragari Pass)", "–≥—Ä–∞–Ω–∏—Ü–∞ Osaka‚ÜîNara", "—á–µ–ª–ª–µ–Ω–¥–∂-–ø–æ–¥—ä—ë–º"],
                            center: [34.66583, 135.67139],
                            mapLink: "https://www.google.com/maps?q=34.66583,135.67139"
                            // track: []
                        }
                    ]
                }
            ],
            tips: ["–ü–∞—Ä–æ–º –Ω–∞ –ê–≤–∞–¥–∑–∏ –∏–∑ –ê–∫–∞—Å–∏.", "–ù–∞ –ø–æ–µ–∑–¥–∞—Ö –≤–µ–ª–æ—Å–∏–ø–µ–¥—ã —Ç–æ–ª—å–∫–æ –≤ —á–µ—Ö–ª–∞—Ö."]
        };

        const foodIntel = [
            { id: "osaka", city: "–û—Å–∞–∫–∞", places: [{name:"551 Horai", dish:"Butaman"}, {name:"Endo Sushi", dish:"Sushi"}, {name:"Daruma", dish:"Kushikatsu"}] },
            { id: "kyoto", city: "–ö–∏–æ—Ç–æ", places: [{name:"Honke Owariya", dish:"Soba"}, {name:"Inoda Coffee", dish:"Breakfast"}, {name:"Gogyo", dish:"Burnt Ramen"}] },
            { id: "kobe", city: "–ö–æ–±–µ", places: [{name:"Steakland", dish:"Kobe Beef", why:"–î–æ—Å—Ç—É–ø–Ω—ã–π –ª–∞–Ω—á."}, {name:"Nishimura", dish:"Coffee", why:"–†–µ—Ç—Ä–æ."}, {name:"Roushouki", dish:"Pork Buns", why:"–ß–∞–π–Ω–∞—Ç–∞—É–Ω."}] },
            { id: "kokura", city: "–ö–æ–∫—É—Ä–∞", places: [{name:"Tanga Market", dish:"Uni Don", why:"–†—ã–Ω–æ—á–Ω–∞—è –µ–¥–∞."}, {name:"Tetsunabe", dish:"Iron Gyoza", why:"–ì—ë–¥–∑–∞ –≤ —á—É–≥—É–Ω–µ."}, {name:"Bear Fruits", dish:"Yaki Curry", why:"–ó–∞–ø–µ—á–µ–Ω–Ω–æ–µ –∫–∞—Ä—Ä–∏."}] },
            { id: "fukuoka", city: "–§—É–∫—É–æ–∫–∞", places: [{name:"Shin-Shin", dish:"Tonkotsu"}, {name:"Yatai Stalls", dish:"Street Food"}] },
            { id: "hiroshima", city: "–•–∏—Ä–æ—Å–∏–º–∞", places: [{name:"Hassho", dish:"Okonomiyaki"}, {name:"Bakudanya", dish:"Tsukemen"}] },
            { id: "onomichi", city: "–û–Ω–æ–º–∏—Ç–∏", places: [{name:"U2", dish:"Pasta"}, {name:"Ichibankan", dish:"Ramen"}] }
        ];

        const sightsIntel = [
            { id: "osaka", city: "–û—Å–∞–∫–∞", places: [{name: "Kaiyukan", type: "Aqua", badge: "badge-tech", detail: "–í–µ—á–µ—Ä."}, {name: "TeamLab", type: "Art", badge: "badge-art", detail: "–°–∞–¥."}] },
            { id: "kobe", city: "–ö–æ–±–µ", places: [{name: "Nunobiki Falls", type: "Nature", badge: "badge-nature", detail: "–í–æ–¥–æ–ø–∞–¥ —É –≤–æ–∫–∑–∞–ª–∞."}, {name: "Meriken Park", type: "View", badge: "badge-local", detail: "–ü–æ—Ä—Ç."}] },
            { id: "kyoto", city: "–ö–∏–æ—Ç–æ", places: [{name: "Fushimi Inari", type: "Hike", badge: "badge-history", detail: "–£—Ç—Ä–æ."}, {name: "Arashiyama", type: "Nature", badge: "badge-relax", detail: "–ë–∞–º–±—É–∫."}] },
            { id: "kokura", city: "–ö–æ–∫—É—Ä–∞", places: [{name: "Kokura Castle", type: "History", badge: "badge-history", detail: "–ó–∞–º–æ–∫."}, {name: "Mt. Sarakura", type: "View", badge: "badge-nature", detail: "–ù–æ—á–Ω–æ–π –≤–∏–¥."}] },
            { id: "fukuoka", city: "–§—É–∫—É–æ–∫–∞", places: [{name: "Dazaifu", type: "Shrine", badge: "badge-history", detail: "–•—Ä–∞–º."}, {name: "Canal City", type: "Shop", badge: "badge-tech", detail: "–¢–¶."}] },
            { id: "hiroshima", city: "–•–∏—Ä–æ—Å–∏–º–∞", places: [{name: "Peace Park", type: "History", badge: "badge-history", detail: "–ú—É–∑–µ–π."}, {name: "Miyajima", type: "Nature", badge: "badge-trek", detail: "–ì–æ—Ä–∞ –ú–∏—Å—ç–Ω."}] }
        ];

        const hotelIntel = [
            { id: "osaka", city: "–û—Å–∞–∫–∞", desc: "–ë–∞–∑–∞ 1 & –§–∏–Ω–∞–ª.", places: [{name:"Onyado Nono", type:"Onsen", badge:"badge-onsen", price:"¬•¬•", why:"–¢–∞—Ç–∞–º–∏."}, {name:"The Lively", type:"Vibe", badge:"badge-vibe", price:"¬•¬•¬•", why:"–°—Ç–∏–ª—å."}] },
            { id: "kyoto", city: "–ö–∏–æ—Ç–æ", desc: "–ë–∞–∑–∞ 2.", places: [{name:"Piece Hostel Sanjo", type:"Velo", badge:"badge-local", price:"¬•", why:"–î–ª—è –≤–µ–ª–æ."}] },
            { id: "hiroshima", city: "–•–∏—Ä–æ—Å–∏–º–∞", desc: "–ë–∞–∑–∞ 3.", places: [{name:"Kiro", type:"Design", badge:"badge-design", price:"¬•¬•", why:"–•–∏–ø—Å—Ç–µ—Ä—Å–∫–∏–π."}, {name:"The Knot", type:"Rooftop", badge:"badge-vibe", price:"¬•¬•", why:"–í–∏–¥."}] },
            { id: "kokura", city: "–ö–æ–∫—É—Ä–∞", desc: "–ë–∞–∑–∞ 4.", places: [{name:"JR Kyushu Hotel", type:"Station", badge:"badge-tech", price:"¬•¬•", why:"–ü—Ä—è–º–æ –≤ –≤–æ–∫–∑–∞–ª–µ."}, {name:"Tanga Table", type:"Hostel", badge:"badge-vibe", price:"¬•", why:"–ù–∞–¥ —Ä—ã–Ω–∫–æ–º."}] }
        ];

        const logisticsData = [
            { type: "JR Pass", icon: "üé´", title: "Sanyo-San'in Area Pass", detail: "7 –¥–Ω–µ–π (¬•23,000). –ê–∫—Ç–∏–≤–∞—Ü–∏—è 21.04. –ü–æ–∫—Ä—ã–≤–∞–µ—Ç –•–∏—Ä–æ—Å–∏–º—É, –ö–æ–∫—É—Ä—É –∏ –≤–æ–∑–≤—Ä–∞—Ç.", vital: "–ò–¥–µ–∞–ª—å–Ω–æ." },
            { type: "–ë–∞–≥–∞–∂", icon: "üöö", title: "Yamato", detail: "–ö–∏–æ—Ç–æ -> –•–∏—Ä–æ—Å–∏–º–∞.<br>–•–∏—Ä–æ—Å–∏–º–∞ -> –û—Å–∞–∫–∞.", vital: "–ù–∞–ª–µ–≥–∫–µ." }
        ];
        
        const checklistData = [
            { id: 1, text: "–ö—É–ø–∏—Ç—å Rinko Bags", done: false, urgent: true },
            { id: 2, text: "–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–µ–ª–∏", done: false },
            { id: 3, text: "JR Pass –í–∞—É—á–µ—Ä", done: false }
        ];

        // ============================================
        // üìù CHECKLIST with LocalStorage
        // ============================================
        const CHECKLIST_KEY = 'jp2026_checklist_v1';

        function loadChecklist() {
            const saved = localStorage.getItem(CHECKLIST_KEY);
            if (!saved) return checklistData;
            try { return JSON.parse(saved); } catch { return checklistData; }
        }

        function saveChecklist(list) {
            localStorage.setItem(CHECKLIST_KEY, JSON.stringify(list));
        }

        let checklist = loadChecklist();
        let filteredItinerary = [...itinerary];

        // --- RENDERERS ---
        let currentState = {
            view: 'itinerary',
            infoSubTab: 'logistics',
            selectedFoodCityId: 'osaka',
            selectedSightsCityId: 'osaka',
            selectedHotelCityId: 'osaka',
            mapInstance: null,
            searchQuery: ''
        };

        // ============================================
        // üîó URL STATE MANAGEMENT
        // ============================================
        function readUrlState() {
            const u = new URL(window.location.href);
            const view = u.searchParams.get('view');
            const sub = u.searchParams.get('sub');
            const city = u.searchParams.get('city');

            if (view) currentState.view = view;
            if (sub && currentState.view === 'info') currentState.infoSubTab = sub;

            if (city) {
                if (currentState.view === 'food') currentState.selectedFoodCityId = city;
                if (currentState.view === 'sights') currentState.selectedSightsCityId = city;
                // if (currentState.view === 'hotels') currentState.selectedHotelCityId = city;
            }
        }

        function writeUrlState() {
            const u = new URL(window.location.href);
            u.searchParams.set('view', currentState.view);

            if (currentState.view === 'info') u.searchParams.set('sub', currentState.infoSubTab);
            else u.searchParams.delete('sub');

            if (['food','sights'/* ,'hotels' */].includes(currentState.view)) {
                const city =
                    currentState.view === 'food' ? currentState.selectedFoodCityId :
                    currentState.view === 'sights' ? currentState.selectedSightsCityId :
                    currentState.selectedHotelCityId;
                u.searchParams.set('city', city);
            } else {
                u.searchParams.delete('city');
            }

            history.replaceState(null, '', u.toString());
        }

        // ============================================
        // üó∫Ô∏è YANDEX MAP
        // ============================================
        function loadYandexMap(containerId) {
            const container = document.getElementById(containerId);
            if (!container) return;

            // Show skeleton
            container.innerHTML = '<div class="map-skeleton"></div>';

            if (window.ymaps) {
                ymaps.ready(() => initMap(containerId));
            } else {
                const s = document.createElement('script');
                s.src = `https://api-maps.yandex.ru/2.1/?apikey=${YANDEX_API_KEY}&lang=ru_RU`;
                s.onload = () => ymaps.ready(() => initMap(containerId));
                document.head.appendChild(s);
            }
        }

        function initMap(id) {
            const container = document.getElementById(id);
            if (!container) return;

            // Remove skeleton
            container.innerHTML = '';

            const map = new ymaps.Map(id, {
                center: [34.5, 133.5],
                zoom: 7,
                controls: ['zoomControl']
            });

            // Save reference for quick jump
            window.yandexMap = map;

            const isMobile = window.innerWidth <= 768;

            function makePlacemark({ coords, name, desc, preset, isMobile }) {
                const balloonContent = `
                    <div class="balloon-title">${name}</div>
                    <div class="balloon-desc">${desc}</div>
                `;

                const placemark = new ymaps.Placemark(
                    coords,
                    {
                        iconCaption: name,
                        balloonContentBody: balloonContent
                    },
                    {
                        preset,
                        hideIconOnBalloonOpen: false,
                        balloonOffset: [0, -32],
                        balloonMaxWidth: 280,
                        balloonAutoPan: true,
                        balloonCloseButton: isMobile
                    }
                );

                if (isMobile) {
                    placemark.events.add('click', () => {
                        placemark.balloon.open();
                    });
                } else {
                    placemark.events.add('mouseenter', () => {
                        placemark.balloon.open();
                    });
                    placemark.events.add('mouseleave', () => {
                        placemark.balloon.close();
                    });
                    placemark.events.add('mousedown', () => placemark.balloon.open());
                }

                return placemark;
            }

            const coords = mapLocations.map(l => l.coords);
            map.geoObjects.add(new ymaps.Polyline(coords, {}, {
                strokeColor: "#e11d48",
                strokeWidth: 4
            }));

            mapLocations.forEach(l => {
                const placemark = makePlacemark({
                    coords: l.coords,
                    name: l.name,
                    desc: l.desc,
                    preset: 'islands#redDotIconWithCaption',
                    isMobile
                });
                map.geoObjects.add(placemark);
            });

            pointsOfInterest.forEach(poi => {
                const placemark = makePlacemark({
                    coords: poi.coords,
                    name: poi.name,
                    desc: poi.desc,
                    preset: 'islands#blueDotIconWithCaption',
                    isMobile
                });
                map.geoObjects.add(placemark);
            });

            showToast('–ö–∞—Ä—Ç–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞', 'success');
        }

        // ============================================
        // üîç SEARCH & FILTER
        // ============================================
        function filterItinerary(query) {
            currentState.searchQuery = query.toLowerCase();
            if (!query) {
                filteredItinerary = [...itinerary];
            } else {
                filteredItinerary = itinerary.filter(item =>
                    item.title.toLowerCase().includes(query) ||
                    item.city.toLowerCase().includes(query) ||
                    item.desc.toLowerCase().includes(query)
                );
            }
            renderCurrentView();
        }

        // ============================================
        // üì± SWIPE GESTURES
        // ============================================
        let touchStartX = 0;
        let touchEndX = 0;

        document.addEventListener('touchstart', e => {
            touchStartX = e.touches[0].clientX;
        });

        document.addEventListener('touchend', e => {
            touchEndX = e.changedTouches[0].clientX;
            handleSwipe();
        });

        function handleSwipe() {
            const diff = touchEndX - touchStartX;
            const threshold = 100;

            if (Math.abs(diff) < threshold) return;

            const views = ['itinerary', 'velo', 'map', 'food', /* 'hotels', */ 'info'];
            const currentIndex = views.indexOf(currentState.view);

            if (diff > 0 && currentIndex > 0) {
                // Swipe right - previous
                switchView(views[currentIndex - 1]);
            } else if (diff < 0 && currentIndex < views.length - 1) {
                // Swipe left - next
                switchView(views[currentIndex + 1]);
            }
        }

        // ============================================
        // üé® RENDERING
        // ============================================
        function renderDesktopNav() {
            const tabs = [
                {id:'itinerary',label:'üìÖ –ü–ª–∞–Ω'},
                {id:'map',label:'üó∫Ô∏è –ö–∞—Ä—Ç–∞'},
                {id:'velo',label:'üö¥ –í–µ–ª–æ'},
                // {id:'hotels',label:'üõèÔ∏è –ñ–∏–ª—å–µ'},
                {id:'food',label:'üçú –ï–¥–∞'},
                {id:'sights',label:'‚õ©Ô∏è –ú–µ—Å—Ç–∞'},
                {id:'info',label:'‚ÑπÔ∏è –ò–Ω—Ñ–æ'}
            ];
            document.getElementById('desktop-nav').innerHTML = tabs.map(t =>
                `<button onclick="switchView('${t.id}')" class="px-3 py-2 rounded-md transition-all ${
                    currentState.view === t.id ? 'bg-stone-900 text-white' : 'text-stone-600 hover:bg-stone-100'
                }">${t.label}</button>`
            ).join('');
        }

        function renderMobileNav() {
            const tabs = [
                { id: 'itinerary', label: '–ü–ª–∞–Ω', icon: '<path d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />' },
                { id: 'velo', label: '–í–µ–ª–æ', icon: '<path d="M13 10V3L4 14h7v7l9-11h-7z" />' },
                { id: 'map', label: '–ö–∞—Ä—Ç–∞', icon: '<path d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7" />' },
                { id: 'food', label: '–ï–¥–∞', icon: '<path d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />' },
                // { id: 'hotels', label: '–°–æ–Ω', icon: '<path d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />' },
                { id: 'info', label: '–ò–Ω—Ñ–æ', icon: '<path d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />' }
            ];
            document.getElementById('mobile-bottom-nav').innerHTML = tabs.map(t =>
                `<button onclick="switchView('${t.id}')" class="flex flex-col items-center justify-center w-full transition-colors ${
                    currentState.view === t.id ? 'text-stone-900' : 'text-stone-400'
                }">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">${t.icon}</svg>
                    <span class="text-[10px] font-bold">${t.label}</span>
                </button>`
            ).join('');
        }

        function switchView(id) {
            currentState.view = id;
            currentState.searchQuery = '';
            filteredItinerary = [...itinerary];
            renderDesktopNav();
            renderMobileNav();
            renderCurrentView();
            renderProgressBar();
            writeUrlState();
            window.scrollTo(0,0);
        }

        // Quick jump functions for day cards
        function quickJumpTo(view, cityRef) {
            if (view === 'food') {
                currentState.view = 'food';
                currentState.selectedFoodCityId = cityRef;
            } else if (view === 'sights') {
                currentState.view = 'sights';
                currentState.selectedSightsCityId = cityRef;
            }
            renderDesktopNav();
            renderMobileNav();
            renderCurrentView();
            writeUrlState();
            window.scrollTo(0,0);
        }

        function quickJumpToMap(cityName) {
            currentState.view = 'map';
            renderDesktopNav();
            renderMobileNav();
            renderCurrentView();
            writeUrlState();

            // Focus on city marker after map loads
            setTimeout(() => {
                const cityCoords = mapLocations.find(loc => loc.name === cityName);
                if (cityCoords && window.yandexMap) {
                    window.yandexMap.setCenter(cityCoords.coords, 12, {
                        duration: 500
                    });
                }
            }, 500);
        }

        function renderCurrentView() {
            const el = document.getElementById('app-view');
            el.innerHTML = '';

            if(currentState.view === 'itinerary') renderItinerary(el);
            if(currentState.view === 'map') renderMap(el);
            if(currentState.view === 'sights') renderListWithTabs(el, sightsIntel, currentState.selectedSightsCityId, (id)=>{currentState.selectedSightsCityId=id;renderCurrentView()}, renderSightsDetails, '‚õ©Ô∏è');
            if(currentState.view === 'velo') renderVelo(el);
            if(currentState.view === 'food') renderListWithTabs(el, foodIntel, currentState.selectedFoodCityId, (id)=>{currentState.selectedFoodCityId=id;renderCurrentView()}, renderFoodDetails, 'üçú');
            // if(currentState.view === 'hotels') renderListWithTabs(el, hotelIntel, currentState.selectedHotelCityId, (id)=>{currentState.selectedHotelCityId=id;renderCurrentView()}, renderHotelDetails, 'üõèÔ∏è');
            if(currentState.view === 'info') renderInfo(el);
        }

        function renderItinerary(c) {
            const days = getDaysUntilTrip();

            let h = `
                <div class="space-y-4 pb-20">
                    <!-- Stats -->
                    <div class="grid grid-cols-3 gap-3 mb-6">
                        <div class="stat-card" style="--from: #fef2f2; --to: #fee2e2;">
                            <div class="text-2xl font-bold text-red-600">${days}</div>
                            <div class="text-xs text-red-600">–¥–Ω–µ–π –æ—Å—Ç–∞–ª–æ—Å—å</div>
                        </div>
                        <div class="stat-card" style="--from: #eff6ff; --to: #dbeafe;">
                            <div class="text-2xl font-bold text-blue-600">14</div>
                            <div class="text-xs text-blue-600">–¥–Ω–µ–π –ø–æ–µ–∑–¥–∫–∏</div>
                        </div>
                        <div class="stat-card" style="--from: #f0fdf4; --to: #dcfce7;">
                            <div class="text-2xl font-bold text-green-600">4</div>
                            <div class="text-xs text-green-600">–±–∞–∑–æ–≤—ã—Ö –≥–æ—Ä–æ–¥–∞</div>
                        </div>
                    </div>

                    <!-- Search -->
                    <div class="relative mb-4">
                        <input
                            type="text"
                            id="search-input"
                            placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ –º–∞—Ä—à—Ä—É—Ç—É..."
                            value="${currentState.searchQuery}"
                            oninput="filterItinerary(this.value)"
                            class="w-full px-4 py-3 rounded-lg border border-stone-200 search-input focus:ring-2 focus:ring-red-500 focus:border-transparent focus:outline-none transition-all bg-white"
                        >
                    </div>

                    ${filteredItinerary.length === 0 ?
                        `<div class="text-center py-8 text-stone-500">
                            <div class="text-4xl mb-2">üîç</div>
                            <div>–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</div>
                        </div>` :
                        ''
                    }
            `;

            filteredItinerary.forEach((i, idx) => {
                const badgeClass = i.type === 'base' ? 'badge-base' : 'badge-trip';
                const badgeText = i.type === 'base' ? '–ë–ê–ó–ê' : '–í–´–ï–ó–î';
                const cardClass = i.title.includes("Awaichi") || i.title.includes("308") ? "border-red-200 bg-red-50" : "border-stone-200 bg-white";

                // Convert time to period of day
                const timeOfDay = (() => {
                    const t = i.time;
                    if (t === '–£—Ç—Ä–æ' || t === '–î–µ–Ω—å' || t === '–í–µ—á–µ—Ä') return t;
                    const hour = parseInt(t.split(':')[0]);
                    if (hour >= 6 && hour < 12) return 'üåÖ –£—Ç—Ä–æ';
                    if (hour >= 12 && hour < 18) return '‚òÄÔ∏è –î–µ–Ω—å';
                    return 'üåÜ –í–µ—á–µ—Ä';
                })();

                h += `
                    <div class="flex gap-3 relative">
                        <div class="absolute left-[18px] top-8 bottom-[-16px] w-[2px] timeline-line z-0 ${idx === filteredItinerary.length-1 ? 'hidden' : ''}"></div>
                        <div class="flex-shrink-0 z-10 text-center">
                            <div class="w-10 h-10 rounded-full bg-white border-2 border-stone-300 flex items-center justify-center shadow-sm day-marker">
                                <div class="text-[10px] font-bold text-stone-600 leading-none">
                                    <div class="uppercase text-[8px] text-stone-400">${i.date}</div>
                                    ${i.day.split('.')[0]}
                                </div>
                            </div>
                        </div>
                        <div class="flex-grow ${cardClass} rounded-lg border p-3 shadow-sm card-hover">
                            <div class="flex justify-between items-start mb-2">
                                <div class="flex items-center gap-2">
                                    <span class="badge badge-time">${timeOfDay}</span>
                                    <span class="text-[10px] px-2 py-0.5 rounded-full bg-stone-100 text-stone-600 font-bold">üìç ${i.city}</span>
                                </div>
                                <span class="badge ${badgeClass}">${badgeText}</span>
                            </div>
                            <h3 class="font-bold text-stone-900 text-base mb-2">${i.title}</h3>
                            <p class="text-stone-600 text-xs leading-relaxed mb-3">${i.desc}</p>

                            <!-- Quick Action Buttons -->
                            <div class="flex gap-2 pt-2 border-t border-stone-200">
                                ${i.sight_ref === 'velo' && i.title.toLowerCase().includes('awaichi') ?
                                    `<button onclick="showRouteDetailById('awaichi')" class="flex-1 text-[10px] font-bold py-1.5 rounded bg-blue-50 text-blue-700 hover:bg-blue-100 transition-colors">
                                        üö¥ –ú–∞—Ä—à—Ä—É—Ç
                                    </button>` : ''}
                                ${i.sight_ref === 'velo' && i.title.toLowerCase().includes('—à–∏–º–∞–Ω–∞–º–∏') ?
                                    `<button onclick="showRouteDetailById('shimanami')" class="flex-1 text-[10px] font-bold py-1.5 rounded bg-blue-50 text-blue-700 hover:bg-blue-100 transition-colors">
                                        üö¥ –ú–∞—Ä—à—Ä—É—Ç
                                    </button>` : ''}
                                ${i.sight_ref === 'velo' && i.title.toLowerCase().includes('–∏—Ç–æ—Å–∏–º–∞') ?
                                    `<button onclick="showRouteDetailById('itoshima')" class="flex-1 text-[10px] font-bold py-1.5 rounded bg-blue-50 text-blue-700 hover:bg-blue-100 transition-colors">
                                        üö¥ –ú–∞—Ä—à—Ä—É—Ç
                                    </button>` : ''}
                                ${(i.city === '–ö–æ–±–µ' && i.title.includes('–ì–æ—Ä—ã')) || i.title.includes('308') ?
                                    `<button onclick="showRouteDetailById('route308')" class="flex-1 text-[10px] font-bold py-1.5 rounded bg-red-50 text-red-700 hover:bg-red-100 transition-colors">
                                        üö¥ Route 308
                                    </button>` : ''}
                                <button onclick="quickJumpTo('food', '${i.food_ref}')" class="flex-1 text-[10px] font-bold py-1.5 rounded bg-orange-50 text-orange-700 hover:bg-orange-100 transition-colors">
                                    üçú –ï–¥–∞
                                </button>
                                <button onclick="quickJumpTo('sights', '${i.sight_ref}')" class="flex-1 text-[10px] font-bold py-1.5 rounded bg-purple-50 text-purple-700 hover:bg-purple-100 transition-colors">
                                    ‚õ©Ô∏è –ú–µ—Å—Ç–∞
                                </button>
                                <button onclick="quickJumpToMap('${i.city}')" class="flex-1 text-[10px] font-bold py-1.5 rounded bg-green-50 text-green-700 hover:bg-green-100 transition-colors">
                                    üìç –ö–∞—Ä—Ç–∞
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            });

            c.innerHTML = h + "</div>";
        }

        function renderMap(c) {
            c.innerHTML = `
                <div class="h-full flex flex-col space-y-4">
                    <div class="bg-white p-3 rounded-xl border border-stone-200 shadow-sm">
                        <h2 class="font-bold text-lg">üó∫Ô∏è –ú–∞—Ä—à—Ä—É—Ç (General)</h2>
                        <p class="text-xs text-stone-500">–ß–µ—Ç–∫–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å –±–∞–∑–∞–º–∏. –ù–∞–≤–µ–¥–∏—Ç–µ –Ω–∞ –º–∞—Ä–∫–µ—Ä—ã –¥–ª—è –¥–µ—Ç–∞–ª–µ–π.</p>
                    </div>
                    <div id="map-container" class="flex-grow shadow-md border border-stone-300 relative"></div>
                </div>
            `;
            loadYandexMap('map-container');
        }

        // ============================================
        // üö¥ ROUTE DETAIL BOTTOM SHEET
        // ============================================

        function getAllRoutes() {
            return veloPlan.groups.flatMap(g => g.routes);
        }

        function showRouteDetailById(routeId) {
            const route = getAllRoutes().find(r => r.id === routeId);
            if (!route) return showToast('–ú–∞—Ä—à—Ä—É—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω', 'error');
            showRouteDetail(route);
        }

        function showRouteDetail(route) {
            // Create overlay
            const overlay = document.createElement('div');
            overlay.className = 'bottom-sheet-overlay';
            overlay.onclick = closeRouteDetail;

            // Create bottom sheet
            const sheet = document.createElement('div');
            sheet.className = 'bottom-sheet';
            sheet.id = 'route-detail-sheet';

            // Difficulty color
            const difficultyColor = route.difficulty === '–õ–µ–≥–∫–∞—è' ? 'text-green-600 bg-green-50' :
                                   route.difficulty === '–°—Ä–µ–¥–Ω—è—è' ? 'text-orange-600 bg-orange-50' :
                                   'text-red-600 bg-red-50';

            sheet.innerHTML = `
                <div class="bottom-sheet-handle"></div>
                <div class="px-6 pb-6">
                    <!-- Header -->
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <h2 class="text-2xl font-bold text-stone-900 mb-1">${route.name}</h2>
                            <p class="text-sm text-stone-600">${route.desc}</p>
                        </div>
                        <button onclick="closeRouteDetail()" class="p-2 hover:bg-stone-100 rounded-full transition-colors">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                                <path d="M6 18L18 6M6 6l12 12" />
                            </svg>
                        </button>
                    </div>

                    <!-- Two Column Layout -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <!-- Left Column: Info -->
                        <div>
                            <!-- Stats Grid -->
                            <div class="grid grid-cols-2 gap-3 mb-4">
                                <div class="bg-blue-50 p-3 rounded-lg">
                                    <div class="text-xs text-blue-600 font-bold">–†–∞—Å—Å—Ç–æ—è–Ω–∏–µ</div>
                                    <div class="text-lg font-bold text-blue-900">${route.distance}</div>
                                </div>
                                <div class="bg-purple-50 p-3 rounded-lg">
                                    <div class="text-xs text-purple-600 font-bold">–ù–∞–±–æ—Ä –≤—ã—Å–æ—Ç—ã</div>
                                    <div class="text-lg font-bold text-purple-900">${route.elevation}</div>
                                </div>
                                <div class="bg-green-50 p-3 rounded-lg">
                                    <div class="text-xs text-green-600 font-bold">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å</div>
                                    <div class="text-lg font-bold text-green-900">${route.duration}</div>
                                </div>
                                <div class="${difficultyColor} p-3 rounded-lg">
                                    <div class="text-xs font-bold">–°–ª–æ–∂–Ω–æ—Å—Ç—å</div>
                                    <div class="text-lg font-bold">${route.difficulty}</div>
                                </div>
                            </div>

                            <!-- Gradient -->
                            <div class="bg-white border border-stone-200 rounded-lg p-4 mb-4">
                                <h3 class="font-bold text-sm text-stone-900 mb-2">üìà –ì—Ä–∞–¥–∏–µ–Ω—Ç</h3>
                                <p class="text-sm text-stone-600">${route.gradient}</p>
                            </div>

                            <!-- Highlights -->
                            <div class="mb-4">
                                <h3 class="font-bold text-sm text-stone-900 mb-2">‚ú® –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏</h3>
                                <div class="flex flex-wrap gap-2">
                                    ${route.highlights.map(h => `<span class="tag-pill">${h}</span>`).join('')}
                                </div>
                            </div>
                        </div>

                        <!-- Right Column: Map -->
                        <div class="flex flex-col">
                            <div id="route-map-container" class="route-detail-map bg-stone-100 flex-1"></div>
                        </div>
                    </div>

                    <!-- Actions -->
                    <div class="flex gap-3 mt-4">
                        <a href="${route.mapLink}" target="_blank"
                           class="flex-1 text-center bg-blue-600 text-white font-bold py-3 rounded-lg hover:bg-blue-700 transition-colors">
                            –û—Ç–∫—Ä—ã—Ç—å –≤ Google Maps
                        </a>
                        <button onclick="closeRouteDetail()"
                                class="px-6 bg-stone-200 text-stone-700 font-bold rounded-lg hover:bg-stone-300 transition-colors">
                            –ó–∞–∫—Ä—ã—Ç—å
                        </button>
                    </div>
                </div>
            `;

            document.body.appendChild(overlay);
            document.body.appendChild(sheet);

            // Trigger animations
            setTimeout(() => {
                overlay.classList.add('show');
                sheet.classList.add('show');
            }, 10);

            // Initialize mini map
            setTimeout(() => initRouteMap(route), 300);

            showToast(`–ú–∞—Ä—à—Ä—É—Ç: ${route.name}`, 'info');
        }

        function closeRouteDetail() {
            const overlay = document.querySelector('.bottom-sheet-overlay');
            const sheet = document.getElementById('route-detail-sheet');

            if (overlay) {
                overlay.classList.remove('show');
                setTimeout(() => overlay.remove(), 300);
            }

            if (sheet) {
                sheet.classList.remove('show');
                setTimeout(() => sheet.remove(), 300);
            }
        }

        async function initRouteMap(route) {
            const container = document.getElementById('route-map-container');
            if (!container || !window.ymaps) return;

            ymaps.ready(async () => {
                const map = new ymaps.Map('route-map-container', {
                    center: route.center,
                    zoom: 11,
                    controls: ['zoomControl']
                });

                // 1) –ï—Å–ª–∏ –µ—Å—Ç—å track ‚Äî —Ä–∏—Å—É–µ–º —Å—Ä–∞–∑—É
                if (Array.isArray(route.track) && route.track.length >= 2) {
                    drawTrack(map, route.track, route.name);
                    return;
                }

                // 2) –ï—Å–ª–∏ –µ—Å—Ç—å GPX ‚Äî –≥—Ä—É–∑–∏–º, –ø–∞—Ä—Å–∏–º, —Ä–∏—Å—É–µ–º
                if (route.gpxUrl) {
                    try {
                        const coords = await loadGpxCoords(route.gpxUrl);
                        if (coords.length >= 2) {
                            drawTrack(map, coords, route.name);
                            return;
                        }
                    } catch (e) {
                        console.warn('GPX load/parse failed', e);
                    }
                }

                // 3) Fallback ‚Äî –ø—Ä–æ—Å—Ç–æ –º–∞—Ä–∫–µ—Ä
                const placemark = new ymaps.Placemark(route.center, { balloonContent: route.name }, {
                    preset: 'islands#blueDotIcon'
                });
                map.geoObjects.add(placemark);
            });
        }

        function drawTrack(map, coords, name) {
            const line = new ymaps.Polyline(coords, { hintContent: name }, {
                strokeColor: "#e11d48",
                strokeWidth: 4,
                strokeOpacity: 0.9
            });

            map.geoObjects.add(line);

            // –ú–∞—Ä–∫–µ—Ä—ã "—Å—Ç–∞—Ä—Ç/—Ñ–∏–Ω–∏—à"
            const start = coords[0];
            const end = coords[coords.length - 1];

            map.geoObjects.add(new ymaps.Placemark(start, { iconCaption: 'Start' }, { preset: 'islands#greenDotIcon' }));
            map.geoObjects.add(new ymaps.Placemark(end, { iconCaption: 'Finish' }, { preset: 'islands#redDotIcon' }));

            // –ü–æ–¥–æ–≥–Ω–∞—Ç—å –∫–∞—Ä—Ç—É –ø–æ–¥ –º–∞—Ä—à—Ä—É—Ç
            const bounds = line.geometry.getBounds();
            if (bounds) {
                map.setBounds(bounds, { checkZoomRange: true, zoomMargin: 20 });
            }
        }

        async function loadGpxCoords(url) {
            const res = await fetch(url);
            if (!res.ok) throw new Error(`Failed to fetch GPX: ${res.status}`);
            const text = await res.text();

            const xml = new DOMParser().parseFromString(text, "application/xml");
            const trkpts = Array.from(xml.getElementsByTagName("trkpt"));

            // GPX —Ö—Ä–∞–Ω–∏—Ç lat/lon –≤ –∞—Ç—Ä–∏–±—É—Ç–∞—Ö, Yandex –∂–¥—ë—Ç [lat, lon]
            return trkpts
                .map(p => [Number(p.getAttribute("lat")), Number(p.getAttribute("lon"))])
                .filter(([lat, lon]) => Number.isFinite(lat) && Number.isFinite(lon));
        }

        function renderVelo(c) {
            let h = `
                <div class="space-y-6 pb-20">
                    <div class="bg-stone-50 border border-stone-200 p-4 rounded-xl">
                        <h2 class="font-bold text-lg mb-2">üö¥ –û–±—â–∏–µ –ú–∞—Ä—à—Ä—É—Ç—ã</h2>
                        ${veloPlan.tips.map(t=>`<p class="text-xs text-stone-600 mb-1 border-l-2 border-red-500 pl-2">${t}</p>`).join('')}
                    </div>
            `;

            veloPlan.groups.forEach(g => {
                h += `
                    <div class="rounded-xl overflow-hidden shadow-sm mb-4">
                        <div class="${g.color} p-3 font-bold text-sm">${g.name}</div>
                        <div class="bg-white border-x border-b border-stone-200 p-4 space-y-3">
                `;
                g.routes.forEach(r => h += `
                    <div class="card-hover p-2 rounded-lg cursor-pointer" onclick="showRouteDetailById('${r.id}')">
                        <div class="flex justify-between items-baseline">
                            <h4 class="font-bold text-sm text-stone-800">${r.name}</h4>
                            <span class="badge ${r.badge}">${r.badge.split('-')[1].toUpperCase()}</span>
                        </div>
                        <p class="text-xs text-stone-500 mt-1">${r.desc}</p>
                    </div>
                `);
                h += `</div></div>`;
            });

            c.innerHTML = h + "</div>";
        }

        function renderListWithTabs(c, data, sid, cb, rend, icon) {
            let h = `
                <div class="flex flex-col md:flex-row gap-4 md:gap-6 h-full pb-20">
                    <div class="sticky top-14 md:top-0 z-30 bg-[#fcfbf9] pt-2 pb-2 md:w-1/4">
                        <div class="md:hidden flex overflow-x-auto hide-scroll gap-2 pb-1">
                            ${data.map(i=>`
                                <button onclick="window.upSel('${i.id}')"
                                    class="flex-shrink-0 px-4 py-2 rounded-full border text-xs font-bold whitespace-nowrap transition-all ${
                                        sid===i.id ? 'bg-stone-900 text-white' : 'bg-white text-stone-600 border-stone-200 hover:bg-stone-50'
                                    }">
                                    ${i.city}
                                </button>
                            `).join('')}
                        </div>
                        <div class="hidden md:flex flex-col gap-2">
                            ${data.map(i=>`
                                <button onclick="window.upSel('${i.id}')"
                                    class="text-left px-4 py-3 rounded-lg border transition-all ${
                                        sid===i.id ? 'bg-stone-900 text-white' : 'bg-white text-stone-600 hover:bg-stone-50'
                                    }">
                                    <span class="font-bold text-sm">${i.city}</span>
                                </button>
                            `).join('')}
                        </div>
                    </div>
                    <div class="w-full md:w-3/4">${rend(data.find(x=>x.id===sid), icon)}</div>
                </div>
            `;
            c.innerHTML = h;
            window.upSel = cb;
        }

        function renderSightsDetails(c, i) {
            return `
                <div class="bg-white rounded-xl border border-stone-200 shadow-sm overflow-hidden fade-in">
                    <div class="bg-stone-100 p-4 border-b border-stone-200">
                        <h2 class="text-2xl font-serif font-bold text-stone-900 flex justify-between">
                            ${c.city} <span class="opacity-20">${i}</span>
                        </h2>
                    </div>
                    <div class="divide-y divide-stone-100">
                        ${c.places.map(p=>`
                            <div class="p-4 card-hover">
                                <div class="flex justify-between items-start mb-1">
                                    <h3 class="font-bold text-base text-stone-900">${p.name}</h3>
                                    <span class="badge ${p.badge}">${p.type}</span>
                                </div>
                                <p class="text-stone-600 text-xs mb-2">${p.detail}</p>
                                <a href="https://yandex.ru/maps/?text=${encodeURIComponent(p.name + ' ' + c.city)}"
                                   target="_blank"
                                   class="text-[10px] text-blue-600 font-bold border border-blue-100 bg-blue-50 px-2 py-1 rounded inline-block hover:bg-blue-100 transition-colors">
                                   üìç –ù–∞ –∫–∞—Ä—Ç–µ
                                </a>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        function renderFoodDetails(c, i) {
            return `
                <div class="bg-white rounded-xl border border-stone-200 shadow-sm overflow-hidden fade-in">
                    <div class="bg-stone-100 p-4 border-b border-stone-200">
                        <h2 class="text-2xl font-serif font-bold text-stone-900 flex justify-between">
                            ${c.city} <span class="opacity-20">${i}</span>
                        </h2>
                    </div>
                    <div class="divide-y divide-stone-100">
                        ${c.places.map(p=>`
                            <div class="p-4 card-hover">
                                <div class="flex justify-between items-start">
                                    <h3 class="font-bold text-stone-900">${p.name}</h3>
                                    <span class="text-xs bg-stone-100 px-2 py-0.5 rounded text-stone-600 font-bold">${safe(p.dish,'')}</span>
                                </div>
                                ${p.why ? `<p class="text-stone-600 text-xs mt-1 italic mb-2">"${p.why}"</p>` : ``}
                                ${p.tags?.length ? `<div class="flex flex-wrap gap-2 mb-2">${p.tags.map(t=>`<span class="tag-pill">${t}</span>`).join('')}</div>` : ``}
                                ${p.url ? `<a href="${p.url}" target="_blank" class="text-[10px] text-stone-700 font-bold border border-stone-200 bg-stone-50 px-2 py-1 rounded inline-block mr-2 hover:bg-stone-100 transition-colors">üîó –°–∞–π—Ç</a>` : ``}
                                <a href="https://yandex.ru/maps/?text=${encodeURIComponent(p.name+' '+c.city)}"
                                   target="_blank"
                                   class="text-[10px] text-blue-600 font-bold border border-blue-100 bg-blue-50 px-2 py-1 rounded inline-block hover:bg-blue-100 transition-colors">
                                   üìç –ù–∞ –∫–∞—Ä—Ç–µ
                                </a>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        // TEMPORARILY DISABLED - Hotels tab
        // function renderHotelDetails(c, i) {
        //     return `
        //         <div class="bg-white rounded-xl border border-stone-200 shadow-sm overflow-hidden fade-in">
        //             <div class="bg-stone-100 p-4 border-b border-stone-200">
        //                 <h2 class="text-2xl font-serif font-bold text-stone-900 flex justify-between">
        //                     ${c.city} <span class="opacity-20">${i}</span>
        //                 </h2>
        //                 <p class="text-xs text-stone-600 mt-1 italic">${c.desc}</p>
        //             </div>
        //             <div class="divide-y divide-stone-100">
        //                 ${c.places.map(p=>`
        //                     <div class="p-4 card-hover">
        //                         <div class="flex justify-between items-start mb-1">
        //                             <h3 class="font-bold text-stone-900">${p.name}</h3>
        //                             <span class="badge ${p.badge}">${p.type}</span>
        //                         </div>
        //                         <p class="text-stone-600 text-xs mt-1 leading-relaxed">"${p.why}"</p>
        //                         <div class="flex justify-between items-center mt-3">
        //                             <span class="text-xs font-mono text-stone-500 bg-stone-50 px-2 py-1 rounded">${p.price}</span>
        //                             <a href="https://www.booking.com/searchresults.ru.html?ss=${encodeURIComponent(p.name + ' ' + c.city)}"
        //                                target="_blank"
        //                                class="text-[10px] text-white font-bold bg-blue-600 px-3 py-1.5 rounded hover:bg-blue-700 transition-colors shadow-sm">
        //                                Booking.com &rarr;
        //                             </a>
        //                         </div>
        //                     </div>
        //                 `).join('')}
        //             </div>
        //         </div>
        //     `;
        // }

        function renderChecklistBlock() {
            const urgent = (x) => x.urgent ? 'border-red-200 bg-red-50' : 'border-stone-200 bg-white';
            return `
                <div class="bg-white rounded-xl border border-stone-200 shadow-sm overflow-hidden">
                    <div class="bg-stone-100 p-4 border-b border-stone-200">
                        <h3 class="font-bold text-stone-900">‚úÖ –ß–µ–∫–ª–∏—Å—Ç</h3>
                        <p class="text-xs text-stone-600 mt-1">–°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ –≤ –±—Ä–∞—É–∑–µ—Ä–µ</p>
                    </div>
                    <div class="p-4 space-y-2">
                        ${checklist.map(item => `
                            <label class="flex items-center gap-3 p-3 rounded-lg border ${urgent(item)} cursor-pointer hover:shadow-sm transition-all card-hover">
                                <input type="checkbox" ${item.done ? 'checked' : ''} data-id="${item.id}" class="w-4 h-4 cursor-pointer">
                                <div class="flex-1">
                                    <div class="font-bold text-sm ${item.done ? 'line-through text-stone-400' : 'text-stone-800'}">${item.text}</div>
                                    ${item.note ? `<div class="text-xs text-stone-500 mt-1">${item.note}</div>` : ``}
                                </div>
                                ${item.urgent ? `<span class="badge badge-time badge-urgent">URGENT</span>` : ``}
                            </label>
                        `).join('')}
                        <button id="add-check-item" class="w-full mt-2 text-sm font-bold bg-stone-900 text-white py-2 rounded-lg hover:bg-stone-800 transition-colors">
                            + –î–æ–±–∞–≤–∏—Ç—å
                        </button>
                    </div>
                </div>
            `;
        }

        function bindChecklistHandlers(root=document) {
            qsa('input[type="checkbox"][data-id]', root).forEach(ch => {
                ch.addEventListener('change', (e) => {
                    const id = Number(e.target.getAttribute('data-id'));
                    checklist = checklist.map(x => x.id === id ? {...x, done: e.target.checked} : x);
                    saveChecklist(checklist);
                    showToast(e.target.checked ? '–ó–∞–¥–∞—á–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ ‚úì' : '–û—Ç–º–µ–Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è', 'success');
                });
            });

            const addBtn = qs('#add-check-item', root);
            if (addBtn) addBtn.addEventListener('click', () => {
                const text = prompt('–ù–æ–≤—ã–π –ø—É–Ω–∫—Ç —á–µ–∫–ª–∏—Å—Ç–∞:');
                if (!text) return;
                const id = Math.max(0, ...checklist.map(x => x.id)) + 1;
                checklist = [{ id, text, done:false, urgent:false }, ...checklist];
                saveChecklist(checklist);
                renderCurrentView();
                showToast('–ü—É–Ω–∫—Ç –¥–æ–±–∞–≤–ª–µ–Ω!', 'success');
            });
        }

        function renderInfo(c) {
            c.innerHTML = `
                <div class="space-y-6 pb-20">
                    <div id="info-content">${getInfoHTML()}</div>
                </div>
            `;
            setTimeout(() => bindChecklistHandlers(document.getElementById('app-view')), 0);
        }

        function changeInfo(tab) {
            currentState.infoSubTab = tab;
            renderInfo(document.getElementById('app-view'));
            writeUrlState();
        }

        function getInfoHTML() {
            return `
                <div class="space-y-3">
                    ${logisticsData.map(l=>`
                        <div class="bg-white p-4 rounded-xl border border-stone-200 shadow-sm card-hover">
                            <h3 class="font-bold">${l.icon} ${l.title}</h3>
                            <p class="text-sm mt-1">${l.detail}</p>
                            ${l.vital?`<div class="mt-2 text-xs text-red-600 font-bold bg-red-50 p-2 rounded">${l.vital}</div>`:''}
                        </div>
                    `).join('')}
                    ${renderChecklistBlock()}
                </div>
            `;
        }

        window.upSel = (id) => {
            // if (currentState.view === 'hotels') currentState.selectedHotelCityId = id;
            if (currentState.view === 'sights') currentState.selectedSightsCityId = id;
            else currentState.selectedFoodCityId = id;
            renderCurrentView();
            writeUrlState();
        };

        function init() {
            applyTheme();
            readUrlState();
            loadYandexMap('map-container');
            renderDesktopNav();
            renderMobileNav();
            renderCurrentView();
            renderProgressBar();
            window.addEventListener('popstate', () => {
                readUrlState();
                renderDesktopNav();
                renderMobileNav();
                renderCurrentView();
                renderProgressBar();
            });

            // Show welcome toast
            setTimeout(() => {
                showToast('üóæ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –Ø–ø–æ–Ω–∏–∏ 2026!', 'info');
            }, 500);
        }

        init();
    </script>
</body>
</html>