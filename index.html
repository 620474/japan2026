<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–Ø–ø–æ–Ω–∏—è 2026</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://api-maps.yandex.ru/2.1/?apikey=5912b65b-5a13-482f-bf3c-6a11282b5100&lang=ru_RU" type="text/javascript"></script>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <style>
        * { box-sizing: border-box; }
        
        body {
            font-family: 'Inter', -apple-system, sans-serif;
            background: #fafafa;
            color: #1a1a1a;
            -webkit-tap-highlight-color: transparent;
        }

        @media (prefers-color-scheme: dark) {
            body { background: #0a0a0a; color: #fafafa; }
            .card { background: #141414 !important; border-color: #262626 !important; }
            .bg-white { background: #141414 !important; }
            .border-gray-100 { border-color: #262626 !important; }
            .border-gray-200 { border-color: #262626 !important; }
            .text-gray-500 { color: #737373 !important; }
            .text-gray-600 { color: #a3a3a3 !important; }
            .text-gray-900 { color: #fafafa !important; }
            .bg-gray-50 { background: #1a1a1a !important; }
            .bg-gray-100 { background: #262626 !important; }
            #map-container { background: #262626 !important; }
        }

        .hide-scroll::-webkit-scrollbar { display: none; }
        .hide-scroll { -ms-overflow-style: none; scrollbar-width: none; }

        .card {
            background: white;
            border: 1px solid #e5e5e5;
            border-radius: 8px;
            transition: border-color 0.15s;
        }
        .card:hover { border-color: #d4d4d4; }

        .timeline-line {
            background: #e5e5e5;
        }
        @media (prefers-color-scheme: dark) {
            .timeline-line { background: #262626; }
        }

        .badge {
            display: inline-flex;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .badge-base { background: #dcfce7; color: #166534; }
        .badge-trip { background: #dbeafe; color: #1e40af; }

        @media (prefers-color-scheme: dark) {
            .badge-base { background: #14532d; color: #86efac; }
            .badge-trip { background: #1e3a8a; color: #93c5fd; }
        }

        #map-container {
            height: 100%;
            min-height: 600px;
            width: 100%;
            border-radius: 8px;
            background: #f5f5f5;
            overflow: hidden;
        }

        .nav-btn {
            padding: 8px 16px;
            font-size: 13px;
            font-weight: 500;
            color: #737373;
            border-radius: 6px;
            transition: all 0.15s;
        }
        .nav-btn:hover { color: #1a1a1a; background: #f5f5f5; }
        .nav-btn.active { color: #1a1a1a; background: #f5f5f5; }

        @media (prefers-color-scheme: dark) {
            .nav-btn:hover { color: #fafafa; background: #262626; }
            .nav-btn.active { color: #fafafa; background: #262626; }
        }

        .mobile-nav-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 8px;
            color: #a3a3a3;
            transition: color 0.15s;
        }
        .mobile-nav-btn.active { color: #1a1a1a; }
        .mobile-nav-btn span { font-size: 10px; margin-top: 2px; }

        @media (prefers-color-scheme: dark) {
            .mobile-nav-btn.active { color: #fafafa; }
        }

        .toast {
            position: fixed;
            top: 16px;
            right: 16px;
            padding: 12px 16px;
            background: #1a1a1a;
            color: white;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 500;
            transform: translateY(-100px);
            opacity: 0;
            transition: all 0.2s;
            z-index: 9999;
        }
        .toast.show { transform: translateY(0); opacity: 1; }

        .stat-box {
            text-align: center;
            padding: 16px;
            background: white;
            border: 1px solid #e5e5e5;
            border-radius: 8px;
        }
        .stat-box .num { font-size: 28px; font-weight: 700; color: #1a1a1a; }
        .stat-box .label { font-size: 11px; color: #737373; margin-top: 2px; }

        @media (prefers-color-scheme: dark) {
            .stat-box { background: #141414; border-color: #262626; }
            .stat-box .num { color: #fafafa; }
        }

        .bottom-sheet-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.4);
            z-index: 9998;
            opacity: 0;
            transition: opacity 0.2s;
        }
        .bottom-sheet-overlay.show { opacity: 1; }

        .bottom-sheet {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            border-radius: 12px 12px 0 0;
            max-height: 80vh;
            overflow-y: auto;
            transform: translateY(100%);
            transition: transform 0.3s;
            z-index: 9999;
        }
        .bottom-sheet.show { transform: translateY(0); }

        @media (prefers-color-scheme: dark) {
            .bottom-sheet { background: #141414; }
        }

        .card-hover {
            transition: all 0.15s;
        }
        .card-hover:hover {
            background: #f9fafb;
        }
        @media (prefers-color-scheme: dark) {
            .card-hover:hover { background: #1f1f1f; }
        }

        .tag-pill {
            display: inline-flex;
            padding: 2px 8px;
            background: #f3f4f6;
            color: #4b5563;
            border-radius: 9999px;
            font-size: 11px;
            font-weight: 500;
        }
        @media (prefers-color-scheme: dark) {
            .tag-pill { background: #374151; color: #d1d5db; }
        }

        .fade-in {
            animation: fadeIn 0.2s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(4px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .route-detail-map {
            min-height: 200px;
            border-radius: 8px;
        }

        .bottom-sheet-handle {
            width: 36px;
            height: 4px;
            background: #d1d5db;
            border-radius: 2px;
            margin: 12px auto;
        }
        @media (prefers-color-scheme: dark) {
            .bottom-sheet-handle { background: #4b5563; }
        }

        /* Badge variants for different types */
        .badge-time { background: #fef3c7; color: #92400e; }
        .badge-road { background: #dbeafe; color: #1e40af; }
        .badge-casual { background: #d1fae5; color: #065f46; }
        .badge-history { background: #fce7f3; color: #9d174d; }
        .badge-nature { background: #d1fae5; color: #065f46; }
        .badge-design { background: #ede9fe; color: #5b21b6; }
        .badge-local { background: #fed7aa; color: #9a3412; }
        .badge-vibe { background: #fecaca; color: #991b1b; }
        .badge-tech { background: #e0e7ff; color: #3730a3; }
        .badge-onsen { background: #fce7f3; color: #9d174d; }
        .badge-sweet { background: #fef3c7; color: #92400e; }
        .badge-trek { background: #ccfbf1; color: #0f766e; }
        .badge-relax { background: #fae8ff; color: #86198f; }
        .badge-art { background: #ede9fe; color: #5b21b6; }

        @media (prefers-color-scheme: dark) {
            .badge-time { background: #78350f; color: #fef3c7; }
            .badge-road { background: #1e3a8a; color: #93c5fd; }
            .badge-casual { background: #064e3b; color: #6ee7b7; }
            .badge-history { background: #831843; color: #fbcfe8; }
            .badge-nature { background: #064e3b; color: #6ee7b7; }
            .badge-design { background: #4c1d95; color: #c4b5fd; }
            .badge-local { background: #7c2d12; color: #fed7aa; }
            .badge-vibe { background: #7f1d1d; color: #fecaca; }
            .badge-tech { background: #312e81; color: #c7d2fe; }
            .badge-onsen { background: #831843; color: #fbcfe8; }
            .badge-sweet { background: #78350f; color: #fef3c7; }
            .badge-trek { background: #134e4a; color: #99f6e4; }
            .badge-relax { background: #701a75; color: #f5d0fe; }
            .badge-art { background: #4c1d95; color: #c4b5fd; }
        }
    </style>
</head>
<body class="min-h-screen pb-16 md:pb-0">

    <header class="bg-white border-b border-gray-100 sticky top-0 z-50">
        <div class="max-w-3xl mx-auto px-4 h-14 flex items-center justify-between">
            <div class="flex items-center gap-2">
                <span class="text-lg">üáØüáµ</span>
                <span class="font-semibold text-gray-900">–Ø–ø–æ–Ω–∏—è 2026</span>
            </div>
            <nav class="hidden md:flex gap-1" id="desktop-nav"></nav>
        </div>
    </header>

    <main class="max-w-3xl mx-auto px-4 py-6">
        <div id="app-view"></div>
    </main>

    <nav class="md:hidden fixed bottom-0 left-0 w-full bg-white border-t border-gray-100 z-50">
        <div class="grid grid-cols-5 h-14" id="mobile-bottom-nav"></div>
    </nav>

    <script>
        // ================= HELPERS =================
        const qs = (s, r = document) => r.querySelector(s);
        const qsa = (s, r = document) => r.querySelectorAll(s);
        const safe = (v, d = '') => v ?? d;

        const YANDEX_API_KEY = '5912b65b-5a13-482f-bf3c-6a11282b5100';

        function getDaysUntilTrip() {
            const tripStart = new Date('2026-04-15');
            const today = new Date();
            const diff = tripStart - today;
            return Math.ceil(diff / (1000 * 60 * 60 * 24));
        }

        function showToast(msg, type = 'info') {
            const existing = document.querySelector('.toast');
            if (existing) existing.remove();

            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.textContent = msg;
            document.body.appendChild(toast);

            setTimeout(() => toast.classList.add('show'), 10);
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => toast.remove(), 200);
            }, 2500);
        }

        function applyTheme() {
            // Theme is handled by CSS prefers-color-scheme
        }

        function renderProgressBar() {
            // Progress bar removed in minimalist redesign
        }

        // ================= DATA =================

        // New unified itinerary based on detailed plans
        const itinerary = [
            // –û—Å–∞–∫–∞ (15-18)
            { day: "15", date: "–°—Ä", month: "04", city: "–û—Å–∞–∫–∞", title: "–ü—Ä–∏–±—ã—Ç–∏–µ", type: "base", desc: "–ü—Ä–∏–ª–µ—Ç 11:45. –°–±–æ—Ä–∫–∞ –≤–µ–ª–æ—Å–∏–ø–µ–¥–æ–≤. –í–µ—á–µ—Ä–Ω–∏–π –î–æ—Ç–æ–Ω–±–æ—Ä–∏.", details: null },
            { day: "16", date: "–ß—Ç", month: "04", city: "–û—Å–∞–∫–∞", title: "–Æ–∂–Ω–∞—è –û—Å–∞–∫–∞, —Ä—ã–Ω–∫–∏ –∏ –≥—Ä–∞—Ñ—Ñ–∏—Ç–∏", type: "trip", desc: "Kuromon, Sumiyoshi Taisha, Kitakagaya Art, –°–∏–Ω—Å—ç–∫–∞–π, –ê–º–µ—Ä–∏–∫–∞-–º—É—Ä–∞.", details: "osaka-0" },
            { day: "17", date: "–ü—Ç", month: "04", city: "–ö–æ–±–µ", title: "–í–µ–ª–æ–ø—Ä–æ–±–µ–≥ –≤ –ö–æ–±–µ", type: "trip", desc: "35-40 –∫–º –¥–æ –ö–æ–±–µ. –ß–∞–π–Ω–∞—Ç–∞—É–Ω, –ø–æ—Ä—Ç, Kitano. –û–±—Ä–∞—Ç–Ω–æ –≤–µ–ª–æ –∏–ª–∏ –ø–æ–µ–∑–¥.", details: "osaka-1" },
            { day: "18", date: "–°–±", month: "04", city: "–û—Å–∞–∫–∞ ‚Üí –ö–∏–æ—Ç–æ", title: "–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –û—Å–∞–∫–∞ + –ø–µ—Ä–µ–µ–∑–¥", type: "base", desc: "–ó–∞–º–æ–∫ –û—Å–∞–∫–∞, –ú–æ–Ω–µ—Ç–Ω—ã–π –¥–≤–æ—Ä (—Å–∞–∫—É—Ä–∞), –¢—ç–Ω–º–∞, –ù–∞–∫–∞–¥–∑–∞–∫–∏-—á–æ. –í–µ—á–µ—Ä–æ–º –ø–æ–µ–∑–¥ –≤ –ö–∏–æ—Ç–æ.", details: "osaka-2" },
            // –ö–∏–æ—Ç–æ (18-21)
            { day: "18", date: "–°–±", month: "04", city: "–ö–∏–æ—Ç–æ", title: "–ì–∏–æ–Ω –∏ –•–∏–≥–∞—Å–∏—è–º–∞", type: "base", desc: "–ö–∏—ë–º–∏–¥–∑—É-–¥—ç—Ä–∞, –ø–∞—Ä–∫ –ú—ç—Ä—É—è–º–∞, —Ä–µ–∫–∞ –ö–∞–º–æ, –ü–æ–Ω—Ç—ë-—Ç—ë.", details: "kyoto-0" },
            { day: "19", date: "–í—Å", month: "04", city: "–ö–∏–æ—Ç–æ", title: "–ê—Ä–∞—Å–∏—è–º–∞ –∏ –ø—Ä–∏—Ä–æ–¥–∞", type: "base", desc: "–ë–∞–º–±—É–∫–æ–≤–∞—è —Ä–æ—â–∞, –º–æ—Å—Ç –¢–æ–≥—ç—Ü—É–∫—ë, –ø–∞—Ä–∫ –æ–±–µ–∑—å—è–Ω, –æ–Ω—Å—ç–Ω.", details: "kyoto-1" },
            { day: "20", date: "–ü–Ω", month: "04", city: "–ö–∏–æ—Ç–æ", title: "–°–µ–≤–µ—Ä–Ω—ã–π –ö–∏–æ—Ç–æ + –§–∏–ª–æ—Å–æ—Ñ—Å–∫–∏–π –ø—É—Ç—å", type: "base", desc: "–ö–∏–Ω–∫–∞–∫—É-–¥–∑–∏, –†—ë–∞–Ω–¥–∑–∏, –ì–∏–Ω–∫–∞–∫—É–¥–∑–∏, –§–∏–ª–æ—Å–æ—Ñ—Å–∫–∏–π –ø—É—Ç—å.", details: "kyoto-2" },
            // –§—É–∫—É–æ–∫–∞ (21-24)
            { day: "21", date: "–í—Ç", month: "04", city: "–§—É–∫—É–æ–∫–∞", title: "–ü—Ä–∏–µ–∑–¥ + –ü–∞—Ä–∫–∏ –∏ —Ä–∞–º–µ–Ω", type: "base", desc: "–°–∏–Ω–∫–∞–Ω—Å—ç–Ω –∏–∑ –ö–∏–æ—Ç–æ. –ü–∞—Ä–∫ –ú–∞–∏–¥–∑—É—Ä—É, Y's Road, —Ä–∞–º–µ–Ω ShinShin.", details: "fukuoka-0" },
            { day: "22", date: "–°—Ä", month: "04", city: "–§—É–∫—É–æ–∫–∞", title: "–ü–æ–±–µ—Ä–µ–∂—å–µ Munakata-Shikanoshima", type: "trip", desc: "51 –∫–º –≤–µ–ª–æ. –°–≤—è—Ç–∏–ª–∏—â–µ –ú—É–Ω–∞–∫–∞—Ç–∞, –æ—Å—Ç—Ä–æ–≤ –®–∏–∫–∞–Ω–æ—Å–∏–º–∞.", details: "fukuoka-1" },
            { day: "23", date: "–ß—Ç", month: "04", city: "–ò—Ç–æ—Å–∏–º–∞", title: "–ò—Ç–æ—Å–∏–º–∞ –∏ –æ–Ω—Å—ç–Ω", type: "trip", desc: "30 –∫–º –≤–µ–ª–æ. –°–∫–∞–ª—ã Futamigaura, –º–æ—Ä—Å–∫–∞—è –¥–æ—Ä–æ–≥–∞, –æ–Ω—Å—ç–Ω Kirara-no-Yu.", details: "fukuoka-2" },
            // –•–∏—Ä–æ—Å–∏–º–∞ (24-27)
            { day: "24", date: "–ü—Ç", month: "04", city: "–•–∏—Ä–æ—Å–∏–º–∞", title: "–ü—Ä–∏–µ–∑–¥ + –ò—Å—Ç–æ—Ä–∏—è", type: "base", desc: "–°–∏–Ω–∫–∞–Ω—Å—ç–Ω –∏–∑ –§—É–∫—É–æ–∫–∏. Peace Memorial Park, —Ä–∞–º–µ–Ω Youki.", details: "hiroshima-0" },
            { day: "25", date: "–°–±", month: "04", city: "–ú–∏—è–¥–∑–∏–º–∞", title: "–•–∞–π–∫–∏–Ω–≥: Miyajima + Mt. Misen", type: "trip", desc: "–•—Ä–∞–º –ò—Ü—É–∫—É—Å–∏–º–∞, –ø–ª–∞–≤–∞—é—â–∏–µ —Ç–æ—Ä–∏–∏, —Ö–∞–π–∫ –Ω–∞ –≥–æ—Ä—É –ú–∏—Å—ç–Ω.", details: "hiroshima-1" },
            { day: "26", date: "–í—Å", month: "04", city: "–û–Ω–æ–º–∏—Ç–∏", title: "–í–µ–ª–æ–¥–µ–Ω—å: Shimanami Kaido", type: "trip", desc: "50-70 –∫–º. –ú–æ—Å—Ç—ã —á–µ—Ä–µ–∑ –æ—Å—Ç—Ä–æ–≤–∞. ONOMICHI U2, Grumpy Bike Shop.", details: "hiroshima-2" },
            // –§–∏–Ω–∞–ª
            { day: "27", date: "–ü–Ω", month: "04", city: "–û—Å–∞–∫–∞", title: "–í–æ–∑–≤—Ä–∞—â–µ–Ω–∏–µ", type: "base", desc: "–°–∏–Ω–∫–∞–Ω—Å—ç–Ω –•–∏—Ä–æ—Å–∏–º–∞ ‚Üí –û—Å–∞–∫–∞. –§–∏–Ω–∞–ª—å–Ω–∞—è –±–∞–∑–∞.", details: null },
            { day: "28", date: "–í—Ç", month: "04", city: "–û—Å–∞–∫–∞", title: "–í—ã–ª–µ—Ç", type: "base", desc: "–¢—Ä–∞–Ω—Å—Ñ–µ—Ä –≤ –∞—ç—Ä–æ–ø–æ—Ä—Ç KIX. 18:10.", details: null }
        ];

        const mapLocations = [
            { name: "–û—Å–∞–∫–∞", coords: [34.6937, 135.5023], desc: "–ë–∞–∑–∞ 1 (3) + –§–∏–Ω–∞–ª (2)" },
            { name: "–ö–∏–æ—Ç–æ", coords: [35.0116, 135.7681], desc: "–ë–∞–∑–∞ 2 (3 –Ω–æ—á–∏)" },
            { name: "–§—É–∫—É–æ–∫–∞", coords: [33.5902, 130.4207], desc: "–ë–∞–∑–∞ 3 (3 –Ω–æ—á–∏)" },
            { name: "–•–∏—Ä–æ—Å–∏–º–∞", coords: [34.3853, 132.4553], desc: "–ë–∞–∑–∞ 4 (3 –Ω–æ—á–∏)" }
        ];

        const pointsOfInterest = [
            { name: "–ê–≤–∞–¥–∑–∏", coords: [34.5930, 135.0190], desc: "–í–µ–ª–æ-–¥–µ–Ω—å: –ö—Ä—É–≥ –≤–æ–∫—Ä—É–≥ –æ—Å—Ç—Ä–æ–≤–∞ –ê–≤–∞–¥–∑–∏ (Awaichi). –ü–æ–ª–Ω—ã–π 150–∫–º –∏–ª–∏ —á–∞—Å—Ç—å." },
            { name: "–ö–æ–±–µ", coords: [34.6901, 135.1955], desc: "–ì–æ—Ä—ã –∏ –ü–æ—Ä—Ç: –í–æ–¥–æ–ø–∞–¥ Nunobiki, Meriken Park, –∫–æ—Ñ–µ –∏ –≥–æ–≤—è–¥–∏–Ω–∞ –ö–æ–±–µ." },
            { name: "–®–∏–º–∞–Ω–∞–º–∏ –ö–∞–π–¥–æ", coords: [34.2563, 133.0256], desc: "–í–µ–ª–æ-–º–∞—Ä—à—Ä—É—Ç: 70–∫–º —á–µ—Ä–µ–∑ 6 –æ—Å—Ç—Ä–æ–≤–æ–≤ –∏ –º–æ—Å—Ç—ã. –ö–ª–∞—Å—Å–∏–∫–∞ —è–ø–æ–Ω—Å–∫–æ–≥–æ –≤–µ–ª–æ—Ç—É—Ä–∏–∑–º–∞." },
            { name: "–ò—Ç–æ—Å–∏–º–∞", coords: [33.6133, 130.1983], desc: "–í–µ–ª–æ-—Å–ø–æ—Ç: –ö—Ä–∞—Å–∏–≤–∞—è –¥–æ—Ä–æ–≥–∞ –≤–¥–æ–ª—å –æ–∫–µ–∞–Ω–∞ –Ω–∞ –∑–∞–∫–∞—Ç–µ. –ò–¥–µ–∞–ª—å–Ω–æ –¥–ª—è –≤–µ—á–µ—Ä–Ω–µ–π –ø–æ–µ–∑–¥–∫–∏." },
            { name: "–ú–∏—è–¥–∑–∏–º–∞", coords: [34.2958, 132.3197], desc: "–°–≤—è—â–µ–Ω–Ω—ã–π –æ—Å—Ç—Ä–æ–≤: –ü–ª–∞–≤–∞—é—â–∏–µ –≤–æ—Ä–æ—Ç–∞ —Ç–æ—Ä–∏–∏, –≥–æ—Ä–∞ –ú–∏—Å—ç–Ω, –æ–ª–µ–Ω–∏." },
            { name: "–û–Ω–æ–º–∏—Ç–∏", coords: [34.4095, 133.2049], desc: "–°—Ç–∞—Ä—Ç –®–∏–º–∞–Ω–∞–º–∏: –†–µ—Ç—Ä–æ-–≥–æ—Ä–æ–¥, —Ö—Ä–∞–º—ã –Ω–∞ —Ö–æ–ª–º–∞—Ö, U2 –≤–µ–ª–æ–∫–æ–º–ø–ª–µ–∫—Å." }
        ];

        const veloPlan = {
            title: "–í–µ–ª–æ-–ì–∏–¥",
            groups: [
                {
                    name: "üö¥ –û—Å–Ω–æ–≤–Ω—ã–µ –ú–∞—Ä—à—Ä—É—Ç—ã",
                    color: "bg-blue-900 text-white",
                    routes: [
                        {
                            id: "awaichi",
                            name: "Awaichi (Awaji)",
                            badge: "badge-road",
                            desc: "–ö—Ä—É–≥ –≤–æ–∫—Ä—É–≥ –æ—Å—Ç—Ä–æ–≤–∞ –ê–≤–∞–¥–∑–∏. –ü–æ–ª–Ω—ã–π 150–∫–º –∏–ª–∏ —á–∞—Å—Ç—å.",
                            distance: "150 –∫–º",
                            gradient: "–°—Ä–µ–¥–Ω–∏–π: 2%, –ú–∞–∫—Å: 8%",
                            elevation: "+800m",
                            duration: "6-8 —á–∞—Å–æ–≤",
                            difficulty: "–°—Ä–µ–¥–Ω—è—è",
                            highlights: ["–ü–ª—è–∂–∏", "–•—Ä–∞–º—ã", "–í–∏–¥—ã –Ω–∞ –æ–∫–µ–∞–Ω"],
                            center: [34.5930, 135.0190],
                            mapLink: "https://www.google.com/maps/d/viewer?mid=1XnKFzYFJH6LkGC_awaichi"
                            // track: [
                            //     [34.5930, 135.0190], [34.6100, 135.0100], [34.6400, 134.9800],
                            //     [34.6800, 134.9500], [34.7000, 134.9300], [34.7100, 134.9100],
                            //     [34.7000, 134.8900], [34.6700, 134.8800], [34.6300, 134.8700],
                            //     [34.5800, 134.8800], [34.5400, 134.9100], [34.5200, 134.9500],
                            //     [34.5100, 135.0000], [34.5300, 135.0400], [34.5600, 135.0600],
                            //     [34.5930, 135.0190]
                            // ]
                        },
                        {
                            id: "shimanami",
                            name: "Shimanami Kaido",
                            badge: "badge-road",
                            desc: "70–∫–º —á–µ—Ä–µ–∑ 6 –æ—Å—Ç—Ä–æ–≤–æ–≤ –∏ –º–æ—Å—Ç—ã. –ö–ª–∞—Å—Å–∏–∫–∞.",
                            distance: "70 –∫–º",
                            gradient: "–°—Ä–µ–¥–Ω–∏–π: 3%, –ú–∞–∫—Å: 12%",
                            elevation: "+600m",
                            duration: "4-6 —á–∞—Å–æ–≤",
                            difficulty: "–°—Ä–µ–¥–Ω—è—è-–í—ã—Å–æ–∫–∞—è",
                            highlights: ["6 –º–æ—Å—Ç–æ–≤", "–û—Å—Ç—Ä–æ–≤–∞", "–í–∏–¥—ã —Å –º–æ—Å—Ç–æ–≤"],
                            center: [34.2563, 133.0256],
                            mapLink: "https://www.google.com/maps/d/viewer?mid=1shimanami"
                            // track: [
                            //     [34.4095, 133.2049], [34.4000, 133.1800], [34.3700, 133.1400],
                            //     [34.3400, 133.1000], [34.3100, 133.0600], [34.2800, 133.0200],
                            //     [34.2563, 132.9800], [34.2400, 132.9400], [34.2200, 132.9000],
                            //     [34.2000, 132.8600], [34.1800, 132.8200]
                            // ]
                        },
                        {
                            id: "kamo",
                            name: "Kamo River",
                            badge: "badge-casual",
                            desc: "–ö–∏–æ—Ç–æ. –†–∞—Å—Å–ª–∞–±–ª–µ–Ω–Ω–∞—è –µ–∑–¥–∞ –≤–¥–æ–ª—å —Ä–µ–∫–∏.",
                            distance: "25 –∫–º",
                            gradient: "–°—Ä–µ–¥–Ω–∏–π: 1%, –ú–∞–∫—Å: 3%",
                            elevation: "+50m",
                            duration: "2-3 —á–∞—Å–∞",
                            difficulty: "–õ–µ–≥–∫–∞—è",
                            highlights: ["–†–µ–∫–∞", "–ü–∞—Ä–∫–∏", "–•—Ä–∞–º—ã"],
                            center: [35.0116, 135.7681],
                            mapLink: "https://www.google.com/maps/d/viewer?mid=1kamo"
                            // track: [
                            //     [35.0400, 135.7681], [35.0350, 135.7700], [35.0250, 135.7720],
                            //     [35.0150, 135.7740], [35.0050, 135.7760], [34.9950, 135.7780],
                            //     [34.9850, 135.7800], [34.9750, 135.7780], [34.9650, 135.7760],
                            //     [34.9750, 135.7740], [34.9850, 135.7720], [35.0000, 135.7700],
                            //     [35.0116, 135.7681]
                            // ]
                        },
                        {
                            id: "itoshima",
                            name: "Itoshima Sunset",
                            badge: "badge-road",
                            desc: "–§—É–∫—É–æ–∫–∞. –ö—Ä–∞—Å–∏–≤–∞—è –¥–æ—Ä–æ–≥–∞ –≤–¥–æ–ª—å –æ–∫–µ–∞–Ω–∞.",
                            distance: "45 –∫–º",
                            gradient: "–°—Ä–µ–¥–Ω–∏–π: 2%, –ú–∞–∫—Å: 6%",
                            elevation: "+200m",
                            duration: "3-4 —á–∞—Å–∞",
                            difficulty: "–°—Ä–µ–¥–Ω—è—è",
                            highlights: ["–ó–∞–∫–∞—Ç—ã", "–ü–ª—è–∂–∏", "–°–µ—Ä—Ñ–∏–Ω–≥"],
                            center: [33.6133, 130.1983],
                            mapLink: "https://www.google.com/maps/d/viewer?mid=1itoshima"
                            // track: [
                            //     [33.5902, 130.4207], [33.5950, 130.3900], [33.6000, 130.3600],
                            //     [33.6050, 130.3300], [33.6100, 130.3000], [33.6133, 130.2700],
                            //     [33.6150, 130.2400], [33.6133, 130.2100], [33.6100, 130.1983],
                            //     [33.6050, 130.1700], [33.6000, 130.1500]
                            // ]
                        },
                        {
                            id: "route308",
                            name: "Route 308 ‚Äî ÊöóÂ≥† (Kuragari Pass)",
                            badge: "badge-road",
                            desc: "Osaka (Higashi-Osaka) ‚Üí Nara (Ikoma). –°–∞–º—ã–π –∂—ë—Å—Ç–∫–∏–π –ø–æ–¥—ä—ë–º –Ω–∞ –≥—Ä–∞–Ω–∏—Ü–µ –ø—Ä–µ—Ñ–µ–∫—Ç—É—Ä.",
                            distance: "‚âà30 –∫–º",
                            gradient: "–£—á–∞—Å—Ç–∫–∞–º–∏ –æ—á–µ–Ω—å –∫—Ä—É—Ç–æ (–ø–µ—Ä–µ–≤–∞–ª ÊöóÂ≥†)",
                            elevation: "+650m",
                            duration: "3‚Äì4 —á–∞—Å–∞",
                            difficulty: "–û—á–µ–Ω—å –≤—ã—Å–æ–∫–∞—è",
                            highlights: ["ÊöóÂ≥† (Kuragari Pass)", "–≥—Ä–∞–Ω–∏—Ü–∞ Osaka‚ÜîNara", "—á–µ–ª–ª–µ–Ω–¥–∂-–ø–æ–¥—ä—ë–º"],
                            center: [34.66583, 135.67139],
                            mapLink: "https://www.google.com/maps?q=34.66583,135.67139"
                            // track: []
                        }
                    ]
                }
            ],
            tips: ["–ü–∞—Ä–æ–º –Ω–∞ –ê–≤–∞–¥–∑–∏ –∏–∑ –ê–∫–∞—Å–∏.", "–ù–∞ –ø–æ–µ–∑–¥–∞—Ö –≤–µ–ª–æ—Å–∏–ø–µ–¥—ã —Ç–æ–ª—å–∫–æ –≤ —á–µ—Ö–ª–∞—Ö."],
            shops: [
                {
                    city: "–û—Å–∞–∫–∞",
                    places: [
                        { name: "Rapport Osaka", type: "–ë—É—Ç–∏–∫", badge: "badge-design", desc: "Must-visit. –ì—Ä–∞–≤–µ–ª/–∞–¥–≤–µ–Ω—á–µ—Ä/lifestyle. PAS Normal Studios, Polymer Workshop, Dyed in the Wool. Curated –≤—ã–±–æ—Ä, —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –≤–µ—â–∏.", mapLink: "https://maps.app.goo.gl/RapportOsaka" },
                        { name: "Y's Road Osaka Wear Kan", type: "–°–µ—Ç—å", badge: "badge-road", desc: "–ö—Ä—É–ø–Ω–µ–π—à–∏–π –≤ –ö–∞–Ω—Å–∞–∏. –û–≥—Ä–æ–º–Ω—ã–π –≤—ã–±–æ—Ä –≤–µ–ª–æ—Ñ–æ—Ä–º—ã: Pearl Izumi, Assos, Rapha. –ü—Ä–µ–º–∏—É–º-–∫–ª–∞—Å—Å.", mapLink: "https://maps.app.goo.gl/YsRoadOsakaWear" },
                        { name: "Uemura Cycle Parts", type: "–î–∏—Å–∫–æ–Ω—Ç", badge: "badge-casual", desc: "–û–≥—Ä–æ–º–Ω—ã–π –¥–∏—Å–∫–æ–Ω—Ç. –ü—Ä–æ—à–ª—ã–µ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ —Å–æ —Å–∫–∏–¥–∫–∞–º–∏ –¥–æ 50%. –®–∏—Ä–æ–∫–∏–π –≤—ã–±–æ—Ä, –µ—Å—Ç—å –ø—Ä–∏–º–µ—Ä–æ—á–Ω—ã–µ.", mapLink: "https://maps.app.goo.gl/UemuraCycleParts" },
                        { name: "Silbest Cycle (Herbis Umeda)", type: "–ë—É—Ç–∏–∫", badge: "badge-design", desc: "–ü—Ä–µ—Å—Ç–∏–∂–Ω—ã–π –±—É—Ç–∏–∫. Bianchi, Pinarello, Trek, Castelli, Rapha. –ë–∞–π–∫—Ñ–∏—Ç—Ç–∏–Ω–≥.", mapLink: "https://maps.app.goo.gl/SilbestCycle" },
                        { name: "Beckon (Honmachi)", type: "–°–ø–æ—Ä—Ç", badge: "badge-road", desc: "–ö—Ä—É–ø–Ω—ã–π —Å–ø–æ—Ä—Ç–∏–≤–Ω—ã–π –º–∞–≥–∞–∑–∏–Ω. 150+ –≤–µ–ª–æ—Å–∏–ø–µ–¥–æ–≤, –ø–æ–ª–Ω—ã–π –∞—Å—Å–æ—Ä—Ç–∏–º–µ–Ω—Ç –æ–¥–µ–∂–¥—ã. One-stop shop.", mapLink: "https://maps.app.goo.gl/BeckonHonmachi" }
                    ]
                },
                {
                    city: "–ö–∏–æ—Ç–æ",
                    places: [
                        { name: "Y's Road Kyoto", type: "–°–µ—Ç—å", badge: "badge-road", desc: "–ö—Ä—É–ø–Ω–µ–π—à–∏–π –≤ –ö–∏–æ—Ç–æ. –°–æ—Ç–Ω–∏ –≤–µ–ª–æ—Å–∏–ø–µ–¥–æ–≤, –æ–±—à–∏—Ä–Ω—ã–π –≤—ã–±–æ—Ä –≤–µ–ª–æ–∫–æ—Å—Ç—é–º–æ–≤. –°—Ä–µ–¥–Ω–∏–µ —Ü–µ–Ω—ã.", mapLink: "https://maps.app.goo.gl/YsRoadKyoto" },
                        { name: "Cycle Shop Eirin (Marutamachi)", type: "–°–ø–æ—Ä—Ç", badge: "badge-casual", desc: "–ö—Ä—É–ø–Ω–∞—è —Å–µ—Ç—å. –®–æ—Å—Å–µ–π–Ω–∏–∫–∏, –≥—Ä–∞–≤–∏–π–Ω–∏–∫–∏, –∞–∫—Å–µ—Å—Å—É–∞—Ä—ã. –ö–æ–Ω—Ü–µ–ø—Ç-–æ—Ç–¥–µ–ª Cycle Hatena —Å –æ–¥–µ–∂–¥–æ–π –¥–ª—è –≤–µ–ª–æ—Ç—É—Ä–∏–∑–º–∞.", mapLink: "https://maps.app.goo.gl/CycleShopEirin" },
                        { name: "KON'S CYCLE", type: "–õ–æ–∫–∞–ª", badge: "badge-local", desc: "–ú–µ—Å—Ç–Ω–∞—è —Å–µ—Ç—å. –û–¥–µ–∂–¥–∞ –Ω–∞ –≤—Å–µ —Å–µ–∑–æ–Ω—ã, —è–ø–æ–Ω—Å–∫–∏–µ –±—Ä–µ–Ω–¥—ã. –£–º–µ—Ä–µ–Ω–Ω—ã–µ —Ü–µ–Ω—ã.", mapLink: "https://maps.app.goo.gl/KonsCycleKyoto" }
                    ]
                },
                {
                    city: "–§—É–∫—É–æ–∫–∞",
                    places: [
                        { name: "Y's Road Fukuoka Tenjin", type: "–°–µ—Ç—å", badge: "badge-road", desc: "–ö—Ä—É–ø–Ω–µ–π—à–∏–π –≤ –ö—é—Å—é. 300+ –≤–µ–ª–æ—Å–∏–ø–µ–¥–æ–≤, Cannondale, Trek, Bianchi. Pearl Izumi –∏ –∑–∞—Ä—É–±–µ–∂–Ω—ã–µ –±—Ä–µ–Ω–¥—ã.", mapLink: "https://maps.app.goo.gl/YsRoadFukuoka" },
                        { name: "Uemura Cycle Parts Fukuoka", type: "–î–∏—Å–∫–æ–Ω—Ç", badge: "badge-casual", desc: "–î–∏—Å–∫–æ–Ω—Ç-—Ñ–∏–ª–∏–∞–ª. –°–∫–∏–¥–∫–∏ –Ω–∞ –ø—Ä–æ—à–ª—ã–µ –∫–æ–ª–ª–µ–∫—Ü–∏–∏, —à–∏—Ä–æ–∫–∏–π –≤—ã–±–æ—Ä –±–∞–∑–æ–≤–æ–π —ç–∫–∏–ø–∏—Ä–æ–≤–∫–∏.", mapLink: "https://maps.app.goo.gl/UemuraFukuoka" },
                        { name: "Giant Store Fukuoka", type: "–ë—Ä–µ–Ω–¥", badge: "badge-tech", desc: "–§–ª–∞–≥–º–∞–Ω Giant/Liv. –§–∏—Ä–º–µ–Ω–Ω–∞—è —ç–∫–∏–ø–∏—Ä–æ–≤–∫–∞, —Ö–æ—Ä–æ—à–æ —Å–∏–¥–∏—Ç –Ω–∞ –∞–∑–∏–∞—Ç—Å–∫–∏—Ö —Ñ–∏–≥—É—Ä–∞—Ö. –°—Ä–µ–¥–Ω–∏–µ —Ü–µ–Ω—ã.", mapLink: "https://maps.app.goo.gl/GiantStoreFukuoka" }
                    ]
                },
                {
                    city: "–ö–æ–±–µ",
                    places: [
                        { name: "Y's Road Kobe", type: "–°–µ—Ç—å", badge: "badge-road", desc: "–ö—Ä—É–ø–Ω—ã–π –º–∞–≥–∞–∑–∏–Ω. Bianchi, Pinarello, Specialized. Pearl Izumi, Shimano, Gore-Tex. –í–µ–ª–æ-—Å–µ—Ä–≤–∏—Å.", mapLink: "https://maps.app.goo.gl/YsRoadKobe" },
                        { name: "Cicli17 (Kitakyu Ward)", type: "–ë—É—Ç–∏–∫", badge: "badge-design", desc: "–ò—Ç–∞–ª—å—è–Ω—Å–∫–∏–π —É–∫–ª–æ–Ω. –ï–≤—Ä–æ–ø–µ–π—Å–∫–∏–µ –≤–µ–ª–æ—Å–∏–ø–µ–¥—ã –∏ –≤–µ–ª–æ–æ–¥–µ–∂–¥–∞. –ê–≤—Ç–æ—Ä—Å–∫–∏–µ –∏ —Ä–µ–¥–∫–∏–µ –≤–µ—â–∏.", mapLink: "https://maps.app.goo.gl/Cicli17Kobe" },
                        { name: "Cycle Base Asahi Kobe", type: "–°–µ—Ç—å", badge: "badge-casual", desc: "–ö—Ä—É–ø–Ω–∞—è —Å–µ—Ç—å. –†–∞–∑–Ω—ã–µ —Å–µ–≥–º–µ–Ω—Ç—ã, —á–∞—Å—Ç—ã–µ —Ä–∞—Å–ø—Ä–æ–¥–∞–∂–∏. –ë–∞–∑–æ–≤–∞—è —ç–∫–∏–ø–∏—Ä–æ–≤–∫–∞.", mapLink: "https://maps.app.goo.gl/CycleBaseAsahiKobe" }
                    ]
                },
                {
                    city: "–•–∏—Ä–æ—Å–∏–º–∞",
                    places: [
                        { name: "Nekomoto TREK Bicycle Shop", type: "–°–ø–æ—Ä—Ç", badge: "badge-road", desc: "–°—Ç–∞—Ä–µ–π—à–∏–π –º–∞–≥–∞–∑–∏–Ω, —Ñ–æ–∫—É—Å –Ω–∞ Trek. –°–ø–æ—Ä—Ç–∏–≤–Ω–∞—è —Ñ–æ—Ä–º–∞, —è–ø–æ–Ω—Å–∫–∏–µ –∏ –µ–≤—Ä–æ–ø–µ–π—Å–∫–∏–µ –±—Ä–µ–Ω–¥—ã. –ü—Ä–µ–º–∏—É–º –∫–∞—á–µ—Å—Ç–≤–æ.", address: "2-7-13 Futabanosato, Higashi Ward", mapLink: "https://www.google.com/maps/place/Nekomoto+TREK+Bicycle+Shop/@34.4048,132.4789" },
                        { name: "Cycle Shop Grumpy (Nishi-ku)", type: "–í–∞–π–±", badge: "badge-vibe", desc: "–ú–∞–≥–∞–∑–∏–Ω + –∫–æ—Ñ–µ-–±–∞—Ä (Dopey's Cafe). Surly, All-City, Cielo. –£—Ä–±–∞–Ω/–±–∞–π–∫–ø—ç–∫–∏–Ω–≥ —Å—Ç–∏–ª–∏—Å—Ç–∏–∫–∞. –û—Å–æ–±–∞—è –∞—Ç–º–æ—Å—Ñ–µ—Ä–∞.", mapLink: "https://maps.app.goo.gl/GrumpyHiroshima" },
                        { name: "Kimura Jitensha", type: "–õ–æ–∫–∞–ª", badge: "badge-local", desc: "–õ–æ–∫–∞–ª—å–Ω—ã–π –º–∞–≥–∞–∑–∏–Ω. –†–µ–º–æ–Ω—Ç, –≤–µ–ª–æ—Å–∏–ø–µ–¥—ã, –±–∞–∑–æ–≤–∞—è —ç–∫–∏–ø–∏—Ä–æ–≤–∫–∞. Pearl Izumi, Quoc.", mapLink: "https://maps.app.goo.gl/KimuraJitensha" },
                        { name: "Wish (Dream Hiroshima)", type: "–ú–∞—Å—Å", badge: "badge-casual", desc: "–ú–µ—Å—Ç–Ω–∞—è —Å–µ—Ç—å. –ë–∞–∑–æ–≤–∞—è —ç–∫–∏–ø–∏—Ä–æ–≤–∫–∞, –¥–µ–º–æ–∫—Ä–∞—Ç–∏—á–Ω—ã–µ —Ü–µ–Ω—ã. –°—Ç–∞—Ä—Ç–æ–≤—ã–π –∫–æ–º–ø–ª–µ–∫—Ç.", mapLink: "https://maps.app.goo.gl/WishHiroshima" }
                    ]
                },
                {
                    city: "–û–Ω–æ–º–∏—Ç–∏",
                    places: [
                        { name: "ONOMICHI U2", type: "–ö–æ–º–ø–ª–µ–∫—Å", badge: "badge-design", desc: "–í–µ–ª–æ–∫–æ–º–ø–ª–µ–∫—Å –Ω–∞ —Å—Ç–∞—Ä—Ç–µ Shimanami. Giant Store, –æ—Ç–µ–ª—å, —Ä–µ—Å—Ç–æ—Ä–∞–Ω. –°—Ç–∏–ª—å–Ω–æ–µ –º–µ—Å—Ç–æ.", mapLink: "https://maps.app.goo.gl/OnomichiU2" }
                    ]
                }
            ]
        };

        // –Ø–ø–æ–Ω—Å–∫–∏–µ –±—Ä–µ–Ω–¥—ã –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è
        const japanBrands = [
            { name: "Pearl Izumi", type: "–û–¥–µ–∂–¥–∞", desc: "–ö–ª–∞—Å—Å–∏–∫–∞ —è–ø–æ–Ω—Å–∫–æ–π –≤–µ–ª–æ–æ–¥–µ–∂–¥—ã. –û—Ç–ª–∏—á–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ, –∞–¥–µ–∫–≤–∞—Ç–Ω—ã–µ —Ü–µ–Ω—ã –≤ –Ø–ø–æ–Ω–∏–∏." },
            { name: "Shimano", type: "–û–¥–µ–∂–¥–∞/–û–±—É–≤—å", desc: "–ù–µ —Ç–æ–ª—å–∫–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã. –í–µ–ª–æ–æ–±—É–≤—å –∏ –æ–¥–µ–∂–¥–∞ –≤—ã—Å–æ–∫–æ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞." },
            { name: "being", type: "–û—á–∫–∏/–ê–∫—Å–µ—Å—Å—É–∞—Ä—ã", desc: "–Ø–ø–æ–Ω—Å–∫–∏–π –±—Ä–µ–Ω–¥. –û—á–∫–∏ ~10,000 –∏–µ–Ω. –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –±–µ–∑ –ø–∞—Ñ–æ—Å–∞." },
            { name: "Kapelmuur", type: "–û–¥–µ–∂–¥–∞", desc: "–Ø–ø–æ–Ω—Å–∫–∏–π –±—Ä–µ–Ω–¥ casual –≤–µ–ª–æ–æ–¥–µ–∂–¥—ã. –°—Ç–∏–ª—å–Ω–æ –∏ –ø—Ä–∞–∫—Ç–∏—á–Ω–æ." }
        ];

        const foodIntel = [
            { id: "osaka", city: "–û—Å–∞–∫–∞", places: [{name:"551 Horai", dish:"Butaman"}, {name:"Endo Sushi", dish:"Sushi"}, {name:"Daruma", dish:"Kushikatsu"}] },
            { id: "kyoto", city: "–ö–∏–æ—Ç–æ", places: [{name:"Honke Owariya", dish:"Soba"}, {name:"Inoda Coffee", dish:"Breakfast"}, {name:"Gogyo", dish:"Burnt Ramen"}] },
            { id: "kobe", city: "–ö–æ–±–µ", places: [{name:"Steakland", dish:"Kobe Beef", why:"–î–æ—Å—Ç—É–ø–Ω—ã–π –ª–∞–Ω—á."}, {name:"Nishimura", dish:"Coffee", why:"–†–µ—Ç—Ä–æ."}, {name:"Roushouki", dish:"Pork Buns", why:"–ß–∞–π–Ω–∞—Ç–∞—É–Ω."}] },
            { id: "kokura", city: "–ö–æ–∫—É—Ä–∞", places: [{name:"Tanga Market", dish:"Uni Don", why:"–†—ã–Ω–æ—á–Ω–∞—è –µ–¥–∞."}, {name:"Tetsunabe", dish:"Iron Gyoza", why:"–ì—ë–¥–∑–∞ –≤ —á—É–≥—É–Ω–µ."}, {name:"Bear Fruits", dish:"Yaki Curry", why:"–ó–∞–ø–µ—á–µ–Ω–Ω–æ–µ –∫–∞—Ä—Ä–∏."}] },
            { id: "fukuoka", city: "–§—É–∫—É–æ–∫–∞", places: [{name:"Shin-Shin", dish:"Tonkotsu"}, {name:"Yatai Stalls", dish:"Street Food"}] },
            { id: "hiroshima", city: "–•–∏—Ä–æ—Å–∏–º–∞", places: [{name:"Hassho", dish:"Okonomiyaki"}, {name:"Bakudanya", dish:"Tsukemen"}] },
            { id: "onomichi", city: "–û–Ω–æ–º–∏—Ç–∏", places: [{name:"U2", dish:"Pasta"}, {name:"Ichibankan", dish:"Ramen"}] }
        ];

        const sightsIntel = [
            { id: "osaka", city: "–û—Å–∞–∫–∞", places: [{name: "Kaiyukan", type: "Aqua", badge: "badge-tech", detail: "–í–µ—á–µ—Ä."}, {name: "TeamLab", type: "Art", badge: "badge-art", detail: "–°–∞–¥."}] },
            { id: "kobe", city: "–ö–æ–±–µ", places: [{name: "Nunobiki Falls", type: "Nature", badge: "badge-nature", detail: "–í–æ–¥–æ–ø–∞–¥ —É –≤–æ–∫–∑–∞–ª–∞."}, {name: "Meriken Park", type: "View", badge: "badge-local", detail: "–ü–æ—Ä—Ç."}] },
            { id: "kyoto", city: "–ö–∏–æ—Ç–æ", places: [{name: "Fushimi Inari", type: "Hike", badge: "badge-history", detail: "–£—Ç—Ä–æ."}, {name: "Arashiyama", type: "Nature", badge: "badge-relax", detail: "–ë–∞–º–±—É–∫."}] },
            { id: "kokura", city: "–ö–æ–∫—É—Ä–∞", places: [{name: "Kokura Castle", type: "History", badge: "badge-history", detail: "–ó–∞–º–æ–∫."}, {name: "Mt. Sarakura", type: "View", badge: "badge-nature", detail: "–ù–æ—á–Ω–æ–π –≤–∏–¥."}] },
            { id: "fukuoka", city: "–§—É–∫—É–æ–∫–∞", places: [{name: "Dazaifu", type: "Shrine", badge: "badge-history", detail: "–•—Ä–∞–º."}, {name: "Canal City", type: "Shop", badge: "badge-tech", detail: "–¢–¶."}] },
            { id: "hiroshima", city: "–•–∏—Ä–æ—Å–∏–º–∞", places: [{name: "Peace Park", type: "History", badge: "badge-history", detail: "–ú—É–∑–µ–π."}, {name: "Miyajima", type: "Nature", badge: "badge-trek", detail: "–ì–æ—Ä–∞ –ú–∏—Å—ç–Ω."}] }
        ];

        const accommodations = [
            { 
                id: "osaka", 
                city: "–û—Å–∞–∫–∞", 
                dates: "15-18.04 & 27-28.04",
                desc: "–ë–∞–∑–∞ 1 (3 –Ω–æ—á–∏) + –§–∏–Ω–∞–ª (1 –Ω–æ—á—å)", 
                status: "pending",
                coords: [34.6937, 135.5023],
                booking: null
            },
            { 
                id: "kyoto", 
                city: "–ö–∏–æ—Ç–æ", 
                dates: "18-21.04",
                desc: "–ë–∞–∑–∞ 2 (3 –Ω–æ—á–∏)", 
                status: "booked",
                coords: [34.9987, 135.7780],
                booking: {
                    name: "–¢–∞—É–Ω—Ö–∞—É—Å –≤ –•–∏–≥–∞—Å–∏—è–º–∞-–∫—É",
                    type: "–¢–∞—É–Ω—Ö–∞—É—Å",
                    badge: "badge-local",
                    rating: "4.86",
                    rooms: "2 —Å–ø–∞–ª—å–Ω–∏",
                    beds: "9 –∫—Ä–æ–≤–∞—Ç–µ–π",
                    bath: "1,5 –≤–∞–Ω–Ω–æ–π",
                    link: "https://www.airbnb.ru/rooms/1197837020382401498",
                    district: "–•–∏–≥–∞—Å–∏—è–º–∞-–∫—É",
                    photo: "https://a0.muscache.com/im/pictures/hosting/Hosting-1197837020382401498/original/7c6a8e6e-8c1a-4e8a-9c1a-4e8a9c1a4e8a.jpeg"
                }
            },
            { 
                id: "kokura", 
                city: "–§—É–∫—É–æ–∫–∞ / –ö–æ–∫—É—Ä–∞", 
                dates: "21-24.04",
                desc: "–ë–∞–∑–∞ 3 (3 –Ω–æ—á–∏)", 
                status: "booked",
                coords: [33.5903, 130.4181],
                booking: {
                    name: "–î–æ–º –≤ –•–∞–∫–∞—Ç–∞-–∫—É",
                    type: "–î–æ–º",
                    badge: "badge-vibe",
                    rating: "4.64",
                    rooms: "4 —Å–ø–∞–ª—å–Ω–∏",
                    beds: "4 –∫—Ä–æ–≤–∞—Ç–∏",
                    bath: "1 –≤–∞–Ω–Ω–∞—è",
                    link: "https://www.airbnb.ru/rooms/50755487",
                    district: "–•–∞–∫–∞—Ç–∞-–∫—É",
                    photo: "https://a0.muscache.com/im/pictures/miso/Hosting-50755487/original/a1b2c3d4-e5f6-7890-abcd-ef1234567890.jpeg"
                }
            },
            { 
                id: "hiroshima", 
                city: "–•–∏—Ä–æ—Å–∏–º–∞", 
                dates: "24-27.04",
                desc: "–ë–∞–∑–∞ 4 (3 –Ω–æ—á–∏)", 
                status: "booked",
                coords: [34.3963, 132.4467],
                booking: {
                    name: "–ñ–∏–ª—å—ë –≤ –ù–∏—Å–∏",
                    type: "–ñ–∏–ª—å—ë",
                    badge: "badge-design",
                    rating: "4.89",
                    rooms: "4 —Å–ø–∞–ª—å–Ω–∏",
                    beds: "7 –∫—Ä–æ–≤–∞—Ç–µ–π",
                    bath: "1,5 –≤–∞–Ω–Ω–æ–π",
                    link: "https://www.airbnb.ru/rooms/1347366679538438479",
                    district: "–ù–∏—Å–∏-–∫—É",
                    photo: "https://a0.muscache.com/im/pictures/hosting/Hosting-1347366679538438479/original/12345678-abcd-efgh-ijkl-mnopqrstuvwx.jpeg"
                }
            }
        ];

        // ============================================
        // üìã DETAILED DAILY PLANS
        // ============================================
        const detailedPlans = {
            osaka: {
                city: "–û—Å–∞–∫–∞",
                dates: "15-18 –∞–ø—Ä–µ–ª—è",
                days: [
                    {
                        date: "16 –∞–ø—Ä–µ–ª—è",
                        title: "–Æ–∂–Ω–∞—è –û—Å–∞–∫–∞, —Ä—ã–Ω–∫–∏ –∏ –≥—Ä–∞—Ñ—Ñ–∏—Ç–∏",
                        distance: "~20 –∫–º –≤–µ–ª–æ + 8-10 –∫–º –ø–µ—à–∫–æ–º",
                        items: [
                            { time: "08:00-09:00", title: "–†—ã–Ω–æ–∫ Kuromon Ichiba", desc: "–ó–∞–≤—Ç—Ä–∞–∫ –Ω–∞ –∑–Ω–∞–º–µ–Ω–∏—Ç–æ–º —Ä—ã–Ω–∫–µ. –°—É—à–∏, —Å–∞—à–∏–º–∏, —É—Å—Ç—Ä–∏—Ü—ã, —Ç–∞–∫–æ-—è–∫–∏ –æ—Ç Takoyaki Wanaka.", type: "food", coords: [34.6628, 135.5058] },
                            { time: "09:30-11:00", title: "–°–≤—è—Ç–∏–ª–∏—â–µ Sumiyoshi Taisha", desc: "7 –∫–º –Ω–∞ —é–≥. –î—Ä–µ–≤–Ω–µ–π—à–∏–π —Ö—Ä–∞–º III –≤–µ–∫–∞, –∫—Ä–∞—Å–Ω—ã–π –º–æ—Å—Ç Taiko-bashi.", type: "sight", coords: [34.6128, 135.4928] },
                            { time: "11:00-12:30", title: "Kitakagaya Art District", desc: "3 –∫–º. –ö–≤–∞—Ä—Ç–∞–ª —Å—Ç—Ä–∏—Ç-–∞—Ä—Ç–∞, –º—É—Ä–∞–ª—ã Ben Eine, –≥–∞–ª–µ—Ä–µ–∏ Chidori-Bunka.", type: "art", coords: [34.6283, 135.4683] },
                            { time: "13:00-14:30", title: "–°–∏–Ω—Å—ç–∫–∞–π + –±–∞—à–Ω—è Ts≈´tenkaku", desc: "4 –∫–º. –†–µ—Ç—Ä–æ-—Ä–∞–π–æ–Ω, –∫—É—à–∏–∫–∞—Ü—É –≤ Daruma, —Ä–µ—Ç—Ä–æ-–∏–≥—Ä—ã Smartball.", type: "sight", coords: [34.6525, 135.5063] },
                            { time: "15:00-17:00", title: "–ê–º–µ—Ä–∏–∫–∞-–º—É—Ä–∞", desc: "2 –∫–º. –ú–æ–ª–æ–¥—ë–∂–Ω–∞—è –∫—É–ª—å—Ç—É—Ä–∞, –≥—Ä–∞—Ñ—Ñ–∏—Ç–∏ Peace on Earth, –≤–∏–Ω—Ç–∞–∂.", type: "art", coords: [34.6722, 135.4997] },
                            { time: "18:00-21:00", title: "–í–µ—á–µ—Ä –≤ –ù–∞–º–±–∞", desc: "–†–∞–º–µ–Ω Ryukishin RIZE –∏–ª–∏ Hanamaruken, –ø—Ä–æ–≥—É–ª–∫–∞ –ø–æ –î–æ—Ç–æ–Ω–±–æ—Ä–∏.", type: "food", coords: [34.6687, 135.5013] }
                        ]
                    },
                    {
                        date: "17 –∞–ø—Ä–µ–ª—è",
                        title: "–í–µ–ª–æ–ø—Ä–æ–±–µ–≥ –≤ –ö–æ–±–µ",
                        distance: "~80 –∫–º (—Ç—É–¥–∞-–æ–±—Ä–∞—Ç–Ω–æ) –∏–ª–∏ 40 –∫–º + –ø–æ–µ–∑–¥",
                        items: [
                            { time: "07:30-11:30", title: "–û—Å–∞–∫–∞ ‚Üí –ö–æ–±–µ", desc: "35-40 –∫–º –ø–æ —Ç—Ä–∞—Å—Å–µ ‚Ññ2. –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤ –ù–∏—Å–∏–Ω–æ–º–∏—è, –º—É–∑–µ–π —Å–∞–∫–µ Hakutsuru.", type: "velo", coords: [34.6901, 135.1955] },
                            { time: "12:00-14:00", title: "–ß–∞–π–Ω–∞—Ç–∞—É–Ω –ù–∞–Ω–∫–∏–Ω–º–∞—Ç–∏", desc: "–°—è–æ–ª—É–Ω–±–∞–æ, –º–∞–Ω—å—Ç–æ—É, —É–ª–∏—á–Ω–∞—è –µ–¥–∞. –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: Ramen Kai (—Ü—É–∫—ç–º–µ–Ω —Å –Ω–∏–±–æ—Å–∏).", type: "food", coords: [34.6878, 135.1783] },
                            { time: "14:00-16:30", title: "–ü–æ—Ä—Ç –ö–æ–±–µ", desc: "Meriken Park, BE KOBE, Harborland, –∫–æ–ª–µ—Å–æ –æ–±–æ–∑—Ä–µ–Ω–∏—è, Kitano Ijinkan.", type: "sight", coords: [34.6833, 135.1867] },
                            { time: "17:00-20:30", title: "–í–æ–∑–≤—Ä–∞—â–µ–Ω–∏–µ + –æ–Ω—Å—ç–Ω", desc: "–û–±—Ä–∞—Ç–Ω–æ –≤–µ–ª–æ –∏–ª–∏ –ø–æ–µ–∑–¥ Hanshin. Spa World –∏–ª–∏ Naniwa no Yu.", type: "relax", coords: [34.6525, 135.5063] }
                        ]
                    },
                    {
                        date: "18 –∞–ø—Ä–µ–ª—è",
                        title: "–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –∏ —Å–µ–≤–µ—Ä–Ω–∞—è –û—Å–∞–∫–∞",
                        distance: "~25 –∫–º –≤–µ–ª–æ + 5-7 –∫–º –ø–µ—à–∫–æ–º",
                        items: [
                            { time: "09:00-11:00", title: "–ó–∞–º–æ–∫ –û—Å–∞–∫–∞", desc: "5 –∫–º. –ü–∞—Ä–∫ —Å —Å–∞–∫—É—Ä–æ–π, –º—É–∑–µ–π –≤ –∑–∞–º–∫–µ, —Å–∞–¥ Nishinomaru.", type: "sight", coords: [34.6873, 135.5262] },
                            { time: "11:00-12:30", title: "–ú–æ–Ω–µ—Ç–Ω—ã–π –¥–≤–æ—Ä (Sakura no Torinuke)", desc: "2 –∫–º. 560–º –∞–ª–ª–µ—è –∏–∑ 350 –¥–µ—Ä–µ–≤—å–µ–≤ —Å–∞–∫—É—Ä—ã (11-17 –∞–ø—Ä–µ–ª—è).", type: "nature", coords: [34.6917, 135.5183] },
                            { time: "13:00-14:30", title: "–¢—ç–Ω–º–∞ + –¢—ç–Ω–¥–∑–∏–Ω–±–∞—à–∏-—Å—É–¥–∑–∏", desc: "–°–∞–º–∞—è –¥–ª–∏–Ω–Ω–∞—è —Ç–æ—Ä–≥–æ–≤–∞—è –≥–∞–ª–µ—Ä–µ—è (2.6 –∫–º). –û–∫–æ–Ω–æ–º–∏—è–∫–∏ –≤ Ajinoya.", type: "food", coords: [34.7033, 135.5117] },
                            { time: "15:00-17:00", title: "–ù–∞–∫–∞–¥–∑–∞–∫–∏-—á–æ", desc: "2 –∫–º. –•–∏–ø—Å—Ç–µ—Ä—Å–∫–∏–π –∫–≤–∞—Ä—Ç–∞–ª, –≤–∏–Ω—Ç–∞–∂, –∫–∞—Ñ–µ –≤ —Å—Ç–∞—Ä—ã—Ö –¥–æ–º–∞—Ö.", type: "art", coords: [34.7083, 135.5067] },
                            { time: "17:30-19:30", title: "Umeda Sky Building", desc: "–ó–∞–∫–∞—Ç —Å –≤—ã—Å–æ—Ç—ã 173–º. –†–∞–º–µ–Ω Kadoya Shokudo –∏–ª–∏ Butakin.", type: "sight", coords: [34.7050, 135.4900] }
                        ]
                    }
                ]
            },
            kyoto: {
                city: "–ö–∏–æ—Ç–æ",
                dates: "18-21 –∞–ø—Ä–µ–ª—è (–≤—ã–µ–∑–¥ —É—Ç—Ä–æ–º 21)",
                days: [
                    {
                        date: "18 –∞–ø—Ä–µ–ª—è",
                        title: "–ì–∏–æ–Ω –∏ –•–∏–≥–∞—Å–∏—è–º–∞",
                        distance: "~5 –∫–º –ø–µ—à–∫–æ–º",
                        items: [
                            { time: "–£—Ç—Ä–æ", title: "–ö–∏—ë–º–∏–¥–∑—É-–¥—ç—Ä–∞", desc: "–î–µ—Ä–µ–≤—è–Ω–Ω—ã–π —Ö—Ä–∞–º –Ω–∞ —Ö–æ–ª–º–µ. –ü–æ–¥—ä—ë–º –ø–æ –ù–∏–Ω–µ–Ω-–¥–∑–∞–∫–∞/–°–∞–Ω–Ω–µ–Ω-–¥–∑–∞–∫–∞.", type: "sight", coords: [34.9949, 135.7850] },
                            { time: "–î–µ–Ω—å", title: "–ü–∞—Ä–∫ –ú—ç—Ä—É—è–º–∞ + –Ø—Å–∞–∫–∞", desc: "–ì–ª–∞–≤–Ω—ã–π –ø–∞—Ä–∫ —Å–∞–∫—É—Ä—ã —Å –≥–∏–≥–∞–Ω—Ç—Å–∫–æ–π –ø–ª–∞–∫—É—á–µ–π –≤–∏—à–Ω–µ–π. –í–µ—á–µ—Ä–Ω—è—è –ø–æ–¥—Å–≤–µ—Ç–∫–∞.", type: "nature", coords: [35.0036, 135.7808] },
                            { time: "–í–µ—á–µ—Ä", title: "–†–µ–∫–∞ –ö–∞–º–æ + –ü–æ–Ω—Ç—ë-—Ç—ë", desc: "–ü—Ä–æ–≥—É–ª–∫–∞ –≤–¥–æ–ª—å —Ä–µ–∫–∏, —Å—Ç–∞—Ä–∏–Ω–Ω–∞—è –∞–ª–ª–µ—è —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤.", type: "food", coords: [35.0050, 135.7700] },
                            { time: "–£–∂–∏–Ω", title: "Menya Inoichi", desc: "Michelin-—Ä–∞–º–µ–Ω —Å –±—É–ª—å–æ–Ω–æ–º –∏–∑ –º–æ—Ä–µ–ø—Ä–æ–¥—É–∫—Ç–æ–≤.", type: "food", coords: [35.0033, 135.7683] }
                        ]
                    },
                    {
                        date: "19 –∞–ø—Ä–µ–ª—è",
                        title: "–ê—Ä–∞—Å–∏—è–º–∞ –∏ –ø—Ä–∏—Ä–æ–¥–∞",
                        distance: "~16 –∫–º –≤–µ–ª–æ",
                        items: [
                            { time: "–£—Ç—Ä–æ", title: "–ë–∞–º–±—É–∫–æ–≤–∞—è —Ä–æ—â–∞", desc: "8 –∫–º –æ—Ç —Ü–µ–Ω—Ç—Ä–∞. –ó–Ω–∞–º–µ–Ω–∏—Ç–∞—è –∞–ª–ª–µ—è –≤—ã—Å–æ–∫–∏—Ö –±–∞–º–±—É–∫–æ–≤.", type: "nature", coords: [35.0168, 135.6713] },
                            { time: "–î–µ–Ω—å", title: "–ú–æ—Å—Ç –¢–æ–≥—ç—Ü—É–∫—ë + —Ä–µ–∫–∞ –•–æ–∑—É", desc: "–§–æ—Ç–æ–≥–µ–Ω–∏—á–Ω—ã–π –¥–µ—Ä–µ–≤—è–Ω–Ω—ã–π –º–æ—Å—Ç, –≤–∏–¥ –Ω–∞ —Ö–æ–ª–º—ã.", type: "sight", coords: [35.0142, 135.6778] },
                            { time: "–î–µ–Ω—å", title: "–ü–∞—Ä–∫ –æ–±–µ–∑—å—è–Ω –ò–≤–∞—Ç–∞—è–º–∞", desc: "15-20 –º–∏–Ω –ø–æ–¥—ä—ë–º, –ø–∞–Ω–æ—Ä–∞–º–∞ –ö–∏–æ—Ç–æ, –º–∞–∫–∞–∫–∏.", type: "nature", coords: [35.0108, 135.6742] },
                            { time: "–ü–æ–ª–¥–µ–Ω—å", title: "–û–Ω—Å—ç–Ω Arashiyama", desc: "Sagano Onsen Tenzanoyu ‚Äî —Ö–ª–æ—Ä–∏–¥–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏.", type: "relax", coords: [35.0183, 135.6817] }
                        ]
                    },
                    {
                        date: "20 –∞–ø—Ä–µ–ª—è",
                        title: "–°–µ–≤–µ—Ä–Ω—ã–π –ö–∏–æ—Ç–æ + –§–∏–ª–æ—Å–æ—Ñ—Å–∫–∏–π –ø—É—Ç—å",
                        distance: "~15 –∫–º –≤–µ–ª–æ/–ø–µ—à–∫–æ–º",
                        items: [
                            { time: "–£—Ç—Ä–æ", title: "–ö–∏–Ω–∫–∞–∫—É-–¥–∑–∏ (–ó–æ–ª–æ—Ç–æ–π –ø–∞–≤–∏–ª—å–æ–Ω)", desc: "–ó–æ–ª–æ—Ç–æ–π –ø–∞–≤–∏–ª—å–æ–Ω –Ω–∞ –ø—Ä—É–¥—É.", type: "sight", coords: [35.0394, 135.7292] },
                            { time: "–î–µ–Ω—å", title: "–†—ë–∞–Ω–¥–∑–∏ + –ù–∏–Ω–Ω–∞-–¥–∑–∏", desc: "–ö–∞–º–µ–Ω–Ω—ã–π —Å–∞–¥. –û–º—É—Ä–æ-—Å–∞–∫—É—Ä–∞ ‚Äî —Ü–≤–µ—Ç—ë—Ç –ø–æ–∑–∂–µ –æ–±—ã—á–Ω–æ–π.", type: "sight", coords: [35.0345, 135.7183] },
                            { time: "–î–µ–Ω—å", title: "–ì–∏–Ω–∫–∞–∫—É–¥–∑–∏ + –§–∏–ª–æ—Å–æ—Ñ—Å–∫–∏–π –ø—É—Ç—å", desc: "2-3 –∫–º –≤–¥–æ–ª—å –∫–∞–Ω–∞–ª–∞ —Å —Å–∞–∫—É—Ä–æ–π –¥–æ –ù–∞–Ω–∑—ç–Ω-–¥–∑–∏.", type: "nature", coords: [35.0267, 135.7983] },
                            { time: "–í–µ—á–µ—Ä", title: "Honke Daiichi Asahi", desc: "–ê—É—Ç–µ–Ω—Ç–∏—á–Ω—ã–π —Ä–∞–º–µ–Ω —É —Å—Ç–∞–Ω—Ü–∏–∏ –ö–∏–æ—Ç–æ. –ü–æ—Å–ª–µ–¥–Ω–∏–π –≤–µ—á–µ—Ä!", type: "food", coords: [34.9858, 135.7583] }
                        ]
                    }
                ]
            },
            fukuoka: {
                city: "–§—É–∫—É–æ–∫–∞",
                dates: "21-24 –∞–ø—Ä–µ–ª—è (–≤—ã–µ–∑–¥ —É—Ç—Ä–æ–º 24)",
                days: [
                    {
                        date: "21 –∞–ø—Ä–µ–ª—è",
                        title: "–ü—Ä–∏–µ–∑–¥ + –ü–∞—Ä–∫–∏ –∏ —Ä–∞–º–µ–Ω",
                        distance: "~15 –∫–º –≤–µ–ª–æ",
                        items: [
                            { time: "–£—Ç—Ä–æ", title: "–ü—Ä–∏–µ–∑–¥ –∏–∑ –ö–∏–æ—Ç–æ", desc: "–°–∏–Ω–∫–∞–Ω—Å—ç–Ω –ö–∏–æ—Ç–æ ‚Üí –•–∞–∫–∞—Ç–∞ (~2.5 —á–∞—Å–∞).", type: "transport", coords: [33.5897, 130.4208] },
                            { time: "12:00-13:00", title: "–†–∞–º–µ–Ω ShinShin", desc: "40+ –ª–µ—Ç. –ö—Ä–µ–º–æ–≤—ã–π —Ç–æ–Ω–∫–æ—Ü—É, —Ç–æ–Ω–∫–∞—è –ª–∞–ø—à–∞.", type: "food", coords: [33.5897, 130.4208] },
                            { time: "14:00-16:00", title: "–ü–∞—Ä–∫ –ú–∞–∏–¥–∑—É—Ä—É + –û—Ö–æ—Ä–∏", desc: "–†—É–∏–Ω—ã –∑–∞–º–∫–∞ –§—É–∫—É–æ–∫–∞, 1000 —Å–∞–∫—É—Ä, –æ–∑–µ—Ä–æ.", type: "nature", coords: [33.5858, 130.3842] },
                            { time: "16:30-18:00", title: "Y's Road Fukuoka Tenjin", desc: "–ö—Ä—É–ø–Ω–µ–π—à–∏–π –≤–µ–ª–æ–º–∞–≥–∞–∑–∏–Ω. 300+ –≤–µ–ª–æ—Å–∏–ø–µ–¥–æ–≤, –æ–¥–µ–∂–¥–∞.", type: "shop", coords: [33.5892, 130.3983] },
                            { time: "19:00-20:30", title: "Ichiran –∏–ª–∏ IPPUDO", desc: "–ö—É–ª—å—Ç–æ–≤—ã–π —Ç–æ–Ω–∫–æ—Ü—É-—Ä–∞–º–µ–Ω.", type: "food", coords: [33.5897, 130.4208] }
                        ]
                    },
                    {
                        date: "22 –∞–ø—Ä–µ–ª—è",
                        title: "–ü–æ–±–µ—Ä–µ–∂—å–µ Munakata-Shikanoshima",
                        distance: "~51 –∫–º –≤–µ–ª–æ",
                        items: [
                            { time: "09:00-10:00", title: "–°–≤—è—Ç–∏–ª–∏—â–µ –ú—É–Ω–∞–∫–∞—Ç–∞ –¢–∞–π—Å—è", desc: "–í—Å–µ–º–∏—Ä–Ω–æ–µ –Ω–∞—Å–ª–µ–¥–∏–µ, —Ç—Ä–∏ –±–æ–≥–∏–Ω–∏ –º–æ—Ä—è.", type: "sight", coords: [33.8300, 130.5133] },
                            { time: "10:15-11:00", title: "Michi-no-Eki Munakata", desc: "–§–µ—Ä–º–µ—Ä—Å–∫–∏–π —Ä—ã–Ω–æ–∫, —Ä—ã–±–∞, –ø–µ–∫–∞—Ä–Ω—è.", type: "food", coords: [33.8117, 130.5283] },
                            { time: "11:00-13:00", title: "–í–µ–ª–æ –≤–¥–æ–ª—å –ø–æ–±–µ—Ä–µ–∂—å—è", desc: "Miyajidake Shrine (11–º —à–∏–º—ç–Ω–∞–≤–∞), –æ—Å—Ç—Ä–æ–≤ –®–∏–∫–∞–Ω–æ—Å–∏–º–∞.", type: "velo", coords: [33.6833, 130.3167] },
                            { time: "14:00-16:00", title: "–ü–ª—è–∂–∏ –®–∏–∫–∞–Ω–æ—à–∏–º—ã", desc: "–ú–∞—è–∫, –ø–ª—è–∂ Umi, –º–æ—Ä—Å–∫–∏–µ –ø–∞–Ω–æ—Ä–∞–º—ã.", type: "nature", coords: [33.6833, 130.3167] },
                            { time: "19:00-20:30", title: "Ramen Stadium", desc: "–§—É–¥-–∫–æ—Ä—Ç –≤ Canal City. –ù–µ—Å–∫–æ–ª—å–∫–æ –≤–∏–¥–æ–≤ —Ä–∞–º–µ–Ω–∞.", type: "food", coords: [33.5897, 130.4108] }
                        ]
                    },
                    {
                        date: "23 –∞–ø—Ä–µ–ª—è",
                        title: "–ò—Ç–æ—Å–∏–º–∞ –∏ –æ–Ω—Å—ç–Ω",
                        distance: "~30 –∫–º –≤–µ–ª–æ",
                        items: [
                            { time: "09:00-10:30", title: "Sakurai Futamigaura", desc: "–°–∫–∞–ª—ã-—Å—É–ø—Ä—É–≥–∏ —Å —Ä–∏—Ç—É–∞–ª—å–Ω—ã–º –∫–∞–Ω–∞—Ç–æ–º.", type: "sight", coords: [33.6117, 130.1617] },
                            { time: "10:45-12:00", title: "–ú–æ—Ä—Å–∫–∞—è –¥–æ—Ä–æ–≥–∞ –ò—Ç–æ—à–∏–º–∞", desc: "Keya no Oto ‚Äî –º–æ—Ä—Å–∫–∞—è –∞—Ä–∫–∞, —Å–∫–∞–ª–∏—Å—Ç—ã–µ –ø–ª—è–∂–∏.", type: "nature", coords: [33.6283, 130.1283] },
                            { time: "12:15-13:15", title: "–û–±–µ–¥ –≤ –ò—Ç–æ—à–∏–º–∞", desc: "–°–≤–µ–∂–∏–µ —É—Å—Ç—Ä–∏—Ü—ã, –∫—Ä–µ–≤–µ—Ç–∫–∏, —Ç–∞–∫–æ—è–∫–∏.", type: "food", coords: [33.6117, 130.1617] },
                            { time: "13:30-15:30", title: "Onsen Nijo Kirara-no-Yu", desc: "–†–∞–¥–æ–Ω–æ–≤—ã–π –æ–Ω—Å—ç–Ω. –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –∏ –æ—Ç–∫—Ä—ã—Ç—ã–µ –≤–∞–Ω–Ω—ã.", type: "relax", coords: [33.5283, 130.2117] },
                            { time: "18:00-19:30", title: "–†–∞–º–µ–Ω Ichiryu", desc: "–ù–∞—Å—ã—â–µ–Ω–Ω—ã–π —Ç–æ–Ω–∫–æ—Ü—É. –ü–æ—Å–ª–µ–¥–Ω–∏–π –≤–µ—á–µ—Ä –≤ –§—É–∫—É–æ–∫–µ!", type: "food", coords: [33.5897, 130.4208] }
                        ]
                    }
                ]
            },
            hiroshima: {
                city: "–•–∏—Ä–æ—Å–∏–º–∞",
                dates: "24-27 –∞–ø—Ä–µ–ª—è (–≤—ã–µ–∑–¥ —É—Ç—Ä–æ–º 27)",
                days: [
                    {
                        date: "24 –∞–ø—Ä–µ–ª—è",
                        title: "–ü—Ä–∏–µ–∑–¥ + –ò—Å—Ç–æ—Ä–∏—è",
                        distance: "~10 –∫–º –≤–µ–ª–æ",
                        items: [
                            { time: "–£—Ç—Ä–æ", title: "–ü—Ä–∏–µ–∑–¥ –∏–∑ –§—É–∫—É–æ–∫–∏", desc: "–°–∏–Ω–∫–∞–Ω—Å—ç–Ω –•–∞–∫–∞—Ç–∞ ‚Üí –•–∏—Ä–æ—Å–∏–º–∞ (~1 —á–∞—Å).", type: "transport", coords: [34.3853, 132.4553] },
                            { time: "–î–µ–Ω—å", title: "–ó–∞—Å–µ–ª–µ–Ω–∏–µ + —Ä–∞—Å–∫–∞—Ç–∫–∞", desc: "30-60 –º–∏–Ω –≤–¥–æ–ª—å —Ä–µ–∫, –ø–ª–æ—Å–∫–æ –¥–ª—è —Ñ–∏–∫—Å–æ–≤.", type: "velo", coords: [34.3853, 132.4553] },
                            { time: "–í–µ—á–µ—Ä", title: "Peace Memorial Park", desc: "A-Bomb Dome, –º—É–∑–µ–π, –º–µ–º–æ—Ä–∏–∞–ª.", type: "sight", coords: [34.3955, 132.4536] },
                            { time: "–£–∂–∏–Ω", title: "Chukasoba Youki (ÈôΩÊ∞ó)", desc: "–ö–ª–∞—Å—Å–∏–∫–∞ —Ö–∏—Ä–æ—Å–∏–º—Å–∫–æ–≥–æ —Ä–∞–º–µ–Ω–∞.", type: "food", coords: [34.3917, 132.4583] }
                        ]
                    },
                    {
                        date: "25 –∞–ø—Ä–µ–ª—è",
                        title: "–•–∞–π–∫–∏–Ω–≥: Miyajima + Mt. Misen",
                        distance: "–•–∞–π–∫–∏–Ω–≥ ~6 –∫–º",
                        items: [
                            { time: "–£—Ç—Ä–æ", title: "–ü–æ–µ–∑–¥ –¥–æ Miyajimaguchi", desc: "–í–µ–ª–æ—Å–∏–ø–µ–¥—ã –æ—Å—Ç–∞–≤–∏—Ç—å –Ω–∞ –º–∞—Ç–µ—Ä–∏–∫–µ.", type: "transport", coords: [34.2958, 132.3197] },
                            { time: "–î–µ–Ω—å", title: "–û—Å—Ç—Ä–æ–≤ –ú–∏—è–¥–∑–∏–º–∞", desc: "–•—Ä–∞–º –ò—Ü—É–∫—É—Å–∏–º–∞, –ø–ª–∞–≤–∞—é—â–∏–µ —Ç–æ—Ä–∏–∏, –æ–ª–µ–Ω–∏.", type: "sight", coords: [34.2958, 132.3197] },
                            { time: "–î–µ–Ω—å", title: "Mt. Misen —Ö–∞–π–∫", desc: "–í–≤–µ—Ä—Ö –ø–µ—à–∫–æ–º, –≤–Ω–∏–∑ ropeway (–∏–ª–∏ –Ω–∞–æ–±–æ—Ä–æ—Ç).", type: "nature", coords: [34.2783, 132.3117] },
                            { time: "–í–µ—á–µ—Ä", title: "Hiroshima tsukemen", desc: "–•–æ–ª–æ–¥–Ω–∞—è –ª–∞–ø—à–∞ + –æ—Å—Ç—Ä—ã–π —Å–æ—É—Å.", type: "food", coords: [34.3917, 132.4583] }
                        ]
                    },
                    {
                        date: "26 –∞–ø—Ä–µ–ª—è",
                        title: "–í–µ–ª–æ–¥–µ–Ω—å: Onomichi + Shimanami",
                        distance: "~50-70 –∫–º –≤–µ–ª–æ",
                        items: [
                            { time: "–£—Ç—Ä–æ", title: "–ü–æ–µ–∑–¥ –¥–æ Onomichi", desc: "–†–µ—Ç—Ä–æ-–≥–æ—Ä–æ–¥, —Ö—Ä–∞–º—ã –Ω–∞ —Ö–æ–ª–º–∞—Ö.", type: "transport", coords: [34.4095, 133.2049] },
                            { time: "–î–µ–Ω—å", title: "Shimanami Kaido out&back", desc: "–ú–æ—Å—Ç—ã —á–µ—Ä–µ–∑ –æ—Å—Ç—Ä–æ–≤–∞. –¢–µ–º–ø –¥–ª—è —Ñ–∏–∫—Å–æ–≤.", type: "velo", coords: [34.3667, 133.0833] },
                            { time: "–ü–∏—Ç-—Å—Ç–æ–ø", title: "ONOMICHI U2 + GIANT STORE", desc: "–í–µ–ª–æ–∫–æ–º–ø–ª–µ–∫—Å, –∫–æ—Ñ–µ, –º–∞–≥–∞–∑–∏–Ω.", type: "shop", coords: [34.4083, 133.2017] },
                            { time: "–í–µ—á–µ—Ä", title: "Grumpy Bike Shop + —É–∂–∏–Ω", desc: "–û–¥–µ–∂–¥–∞/–∞–∫—Å–µ—Å—Å—É–∞—Ä—ã. –ü–æ—Å–ª–µ–¥–Ω–∏–π –≤–µ—á–µ—Ä!", type: "shop", coords: [34.3917, 132.4583] }
                        ]
                    }
                ]
            }
        };

        const logisticsData = [
            { 
                type: "JR Pass", 
                icon: "üé´", 
                title: "Sanyo-San'in Area Pass", 
                detail: "7 –¥–Ω–µ–π (¬•23,000). –ê–∫—Ç–∏–≤–∞—Ü–∏—è 21.04. –ü–æ–∫—Ä—ã–≤–∞–µ—Ç –•–∏—Ä–æ—Å–∏–º—É, –ö–æ–∫—É—Ä—É –∏ –≤–æ–∑–≤—Ä–∞—Ç.", 
                vital: "–ò–¥–µ–∞–ª—å–Ω–æ.",
                links: [
                    { name: "–û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π —Å–∞–π—Ç JR West", url: "https://www.westjr.co.jp/travel-information/en/tickets-passes/jrwest-rail-pass/sanyo_sanin/#agree" },
                    { name: "Trip.com", url: "https://us.trip.com/things-to-do/detail/54934141/" },
                    { name: "Klook", url: "https://www.klook.com/en-US/activity/2729-7-day-jr-sanyo-san-in-area-pass-jr-pass/" }
                ]
            },
            { 
                type: "–û–±–º–µ–Ω –≤–∞–ª—é—Ç—ã", 
                icon: "ÔøΩ", 
                title: "Namba Currency Exchange", 
                detail: "–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–π –æ–±–º–µ–Ω–Ω—ã–π –∞–≤—Ç–æ–º–∞—Ç –≤ –û—Å–∞–∫–µ. –ù–∏–∫–∞–∫–∏—Ö –∫–æ–º–∏—Å—Å–∏–π! –ó–∞—Ö–æ–¥–∏—Ç–µ –≤–Ω—É—Ç—Ä—å, –∞–≤—Ç–æ–º–∞—Ç —Å–ø—Ä–∞–≤–∞. –°–ª–µ–≤–∞ –∫–Ω–∏–≥–∞ –æ—Ç–∑—ã–≤–æ–≤ –æ—Ç —Ç—É—Ä–∏—Å—Ç–æ–≤ –∏–∑ –†–æ—Å—Å–∏–∏ üá∑üá∫", 
                vital: "‚ö†Ô∏è –û—Å—Ç–µ—Ä–µ–≥–∞–π—Ç–µ—Å—å –æ–±–º–µ–Ω–Ω–∏–∫–æ–≤ —è–∫—É–¥–∑—ã —Å–æ —Å–∫—Ä—ã—Ç–æ–π –∫–æ–º–∏—Å—Å–∏–µ–π 10%. –í—Å–µ–≥–¥–∞ —É—Ç–æ—á–Ω—è–π—Ç–µ —Å—É–º–º—É –Ω–∞ —Ä—É–∫–∏!",
                links: [
                    { name: "üìç –ö–∞—Ä—Ç–∞", url: "https://maps.app.goo.gl/MQtMaq4afm8rz5sE9" },
                    { name: "üíπ –ê–∫—Ç—É–∞–ª—å–Ω—ã–π –∫—É—Ä—Å", url: "https://yen-exchange.jp/rate/" },
                    { name: "üìñ –ü–æ–¥—Ä–æ–±–Ω–µ–µ", url: "https://wrenjapan.com/yaponiya/kak-vygodno-menyat-yaponskie-ieny/" }
                ]
            },
            { type: "–ë–∞–≥–∞–∂", icon: "üöö", title: "Yamato", detail: "–ö–∏–æ—Ç–æ -> –•–∏—Ä–æ—Å–∏–º–∞.<br>–•–∏—Ä–æ—Å–∏–º–∞ -> –û—Å–∞–∫–∞.", vital: "–ù–∞–ª–µ–≥–∫–µ." }
        ];
        
        const checklistData = [
            { id: 1, text: "–ö—É–ø–∏—Ç—å Rinko Bags", done: false, urgent: true },
            { id: 2, text: "–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–µ–ª–∏", done: false },
            { id: 3, text: "JR Pass –í–∞—É—á–µ—Ä", done: false }
        ];

        // ============================================
        // üìù CHECKLIST with LocalStorage
        // ============================================
        const CHECKLIST_KEY = 'jp2026_checklist_v1';

        function loadChecklist() {
            const saved = localStorage.getItem(CHECKLIST_KEY);
            if (!saved) return checklistData;
            try { return JSON.parse(saved); } catch { return checklistData; }
        }

        function saveChecklist(list) {
            localStorage.setItem(CHECKLIST_KEY, JSON.stringify(list));
        }

        let checklist = loadChecklist();
        let filteredItinerary = [...itinerary];

        // --- RENDERERS ---
        let currentState = {
            view: 'itinerary',
            infoSubTab: 'logistics',
            selectedFoodCityId: 'osaka',
            selectedSightsCityId: 'osaka',
            selectedHotelCityId: 'osaka',
            mapInstance: null,
            searchQuery: ''
        };

        // ============================================
        // üîó URL STATE MANAGEMENT
        // ============================================
        function readUrlState() {
            const u = new URL(window.location.href);
            const view = u.searchParams.get('view');
            const sub = u.searchParams.get('sub');
            const city = u.searchParams.get('city');

            if (view) currentState.view = view;
            if (sub && currentState.view === 'info') currentState.infoSubTab = sub;

            if (city) {
                if (currentState.view === 'food') currentState.selectedFoodCityId = city;
                if (currentState.view === 'sights') currentState.selectedSightsCityId = city;
                // if (currentState.view === 'hotels') currentState.selectedHotelCityId = city;
            }
        }

        function writeUrlState() {
            const u = new URL(window.location.href);
            u.searchParams.set('view', currentState.view);

            if (currentState.view === 'info') u.searchParams.set('sub', currentState.infoSubTab);
            else u.searchParams.delete('sub');

            if (['food','sights'/* ,'hotels' */].includes(currentState.view)) {
                const city =
                    currentState.view === 'food' ? currentState.selectedFoodCityId :
                    currentState.view === 'sights' ? currentState.selectedSightsCityId :
                    currentState.selectedHotelCityId;
                u.searchParams.set('city', city);
            } else {
                u.searchParams.delete('city');
            }

            history.replaceState(null, '', u.toString());
        }

        // ============================================
        // üó∫Ô∏è YANDEX MAP
        // ============================================
        function loadYandexMap(containerId) {
            const container = document.getElementById(containerId);
            if (!container) return;

            // Show skeleton
            container.innerHTML = '<div class="map-skeleton"></div>';

            if (window.ymaps) {
                ymaps.ready(() => initMap(containerId));
            } else {
                const s = document.createElement('script');
                s.src = `https://api-maps.yandex.ru/2.1/?apikey=${YANDEX_API_KEY}&lang=ru_RU`;
                s.onload = () => ymaps.ready(() => initMap(containerId));
                document.head.appendChild(s);
            }
        }

        function initMap(id) {
            const container = document.getElementById(id);
            if (!container) return;

            // Remove skeleton
            container.innerHTML = '';

            const map = new ymaps.Map(id, {
                center: [34.5, 133.5],
                zoom: 7,
                controls: ['zoomControl']
            });

            // Save reference for quick jump
            window.yandexMap = map;

            const isMobile = window.innerWidth <= 768;

            function makePlacemark({ coords, name, desc, preset, isMobile }) {
                const balloonContent = `
                    <div class="balloon-title">${name}</div>
                    <div class="balloon-desc">${desc}</div>
                `;

                const placemark = new ymaps.Placemark(
                    coords,
                    {
                        iconCaption: name,
                        balloonContentBody: balloonContent
                    },
                    {
                        preset,
                        hideIconOnBalloonOpen: false,
                        balloonOffset: [0, -32],
                        balloonMaxWidth: 280,
                        balloonAutoPan: true,
                        balloonCloseButton: isMobile
                    }
                );

                if (isMobile) {
                    placemark.events.add('click', () => {
                        placemark.balloon.open();
                    });
                } else {
                    placemark.events.add('mouseenter', () => {
                        placemark.balloon.open();
                    });
                    placemark.events.add('mouseleave', () => {
                        placemark.balloon.close();
                    });
                    placemark.events.add('mousedown', () => placemark.balloon.open());
                }

                return placemark;
            }

            // Route line removed - only city markers
            // const coords = mapLocations.map(l => l.coords);
            // map.geoObjects.add(new ymaps.Polyline(coords, {}, {
            //     strokeColor: "#e11d48",
            //     strokeWidth: 4
            // }));

            mapLocations.forEach(l => {
                const placemark = makePlacemark({
                    coords: l.coords,
                    name: l.name,
                    desc: l.desc,
                    preset: 'islands#redDotIconWithCaption',
                    isMobile
                });
                map.geoObjects.add(placemark);
            });

            pointsOfInterest.forEach(poi => {
                const placemark = makePlacemark({
                    coords: poi.coords,
                    name: poi.name,
                    desc: poi.desc,
                    preset: 'islands#blueDotIconWithCaption',
                    isMobile
                });
                map.geoObjects.add(placemark);
            });

            showToast('–ö–∞—Ä—Ç–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞', 'success');
        }

        // ============================================
        // üîç SEARCH & FILTER
        // ============================================
        function filterItinerary(query) {
            currentState.searchQuery = query.toLowerCase();
            if (!query) {
                filteredItinerary = [...itinerary];
            } else {
                filteredItinerary = itinerary.filter(item =>
                    item.title.toLowerCase().includes(query) ||
                    item.city.toLowerCase().includes(query) ||
                    item.desc.toLowerCase().includes(query)
                );
            }
            renderCurrentView();
        }

        // ============================================
        // üì± SWIPE GESTURES
        // ============================================
        let touchStartX = 0;
        let touchEndX = 0;

        document.addEventListener('touchstart', e => {
            touchStartX = e.touches[0].clientX;
        });

        document.addEventListener('touchend', e => {
            touchEndX = e.changedTouches[0].clientX;
            handleSwipe();
        });

        function handleSwipe() {
            const diff = touchEndX - touchStartX;
            const threshold = 100;

            if (Math.abs(diff) < threshold) return;

            const views = ['itinerary', 'map', 'velo', 'accommodation', 'info'];
            const currentIndex = views.indexOf(currentState.view);

            if (diff > 0 && currentIndex > 0) {
                // Swipe right - previous
                switchView(views[currentIndex - 1]);
            } else if (diff < 0 && currentIndex < views.length - 1) {
                // Swipe left - next
                switchView(views[currentIndex + 1]);
            }
        }

        // ============================================
        // üé® RENDERING
        // ============================================
        function renderDesktopNav() {
            const tabs = [
                {id:'itinerary',label:'–ü–ª–∞–Ω'},
                {id:'map',label:'–ö–∞—Ä—Ç–∞'},
                {id:'velo',label:'–í–µ–ª–æ'},
                {id:'accommodation',label:'–ñ–∏–ª—å—ë'},
                {id:'info',label:'–ò–Ω—Ñ–æ'}
            ];
            document.getElementById('desktop-nav').innerHTML = tabs.map(t =>
                `<button onclick="switchView('${t.id}')" class="nav-btn ${currentState.view === t.id ? 'active' : ''}">${t.label}</button>`
            ).join('');
        }

        function renderMobileNav() {
            const tabs = [
                { id: 'itinerary', label: '–ü–ª–∞–Ω', icon: 'üìÖ' },
                { id: 'map', label: '–ö–∞—Ä—Ç–∞', icon: 'üó∫Ô∏è' },
                { id: 'velo', label: '–í–µ–ª–æ', icon: 'üö¥' },
                { id: 'accommodation', label: '–ñ–∏–ª—å—ë', icon: 'üè†' },
                { id: 'info', label: '–ò–Ω—Ñ–æ', icon: '‚ÑπÔ∏è' }
            ];
            document.getElementById('mobile-bottom-nav').innerHTML = tabs.map(t =>
                `<button onclick="switchView('${t.id}')" class="mobile-nav-btn ${currentState.view === t.id ? 'active' : ''}">
                    <span class="text-lg">${t.icon}</span>
                    <span>${t.label}</span>
                </button>`
            ).join('');
        }

        function switchView(id) {
            currentState.view = id;
            currentState.searchQuery = '';
            filteredItinerary = [...itinerary];
            renderDesktopNav();
            renderMobileNav();
            renderCurrentView();
            renderProgressBar();
            writeUrlState();
            window.scrollTo(0,0);
        }

        // Quick jump functions for day cards
        function quickJumpTo(view, cityRef) {
            if (view === 'food') {
                currentState.view = 'food';
                currentState.selectedFoodCityId = cityRef;
            } else if (view === 'sights') {
                currentState.view = 'sights';
                currentState.selectedSightsCityId = cityRef;
            }
            renderDesktopNav();
            renderMobileNav();
            renderCurrentView();
            writeUrlState();
            window.scrollTo(0,0);
        }

        function quickJumpToMap(cityName) {
            currentState.view = 'map';
            renderDesktopNav();
            renderMobileNav();
            renderCurrentView();
            writeUrlState();

            // Focus on city marker after map loads
            setTimeout(() => {
                const cityCoords = mapLocations.find(loc => loc.name === cityName);
                if (cityCoords && window.yandexMap) {
                    window.yandexMap.setCenter(cityCoords.coords, 12, {
                        duration: 500
                    });
                }
            }, 500);
        }

        function renderCurrentView() {
            const el = document.getElementById('app-view');
            el.innerHTML = '';

            if(currentState.view === 'itinerary') renderItinerary(el);
            if(currentState.view === 'map') renderMap(el);
            if(currentState.view === 'velo') renderVelo(el);
            if(currentState.view === 'accommodation') renderAccommodation(el);
            if(currentState.view === 'info') renderInfo(el);
        }

        function renderItinerary(c) {
            const days = getDaysUntilTrip();

            const getDetails = (detailsKey) => {
                if (!detailsKey) return null;
                const [city, dayIdx] = detailsKey.split('-');
                const plan = detailedPlans[city];
                if (!plan || !plan.days[dayIdx]) return null;
                return plan.days[dayIdx];
            };

            const typeIcon = (type) => {
                const icons = { food: 'üçú', sight: '‚õ©Ô∏è', art: '', nature: 'üå∏', velo: 'üö¥', relax: '‚ô®Ô∏è', shop: 'üõí', transport: 'üöÉ' };
                return icons[type] || 'üìç';
            };

            let h = `
                <div class="space-y-6 pb-8">
                    <!-- Stats -->
                    <div class="grid grid-cols-3 gap-3">
                        <div class="stat-box">
                            <div class="num">${days}</div>
                            <div class="label">–¥–Ω–µ–π –¥–æ —Å—Ç–∞—Ä—Ç–∞</div>
                        </div>
                        <div class="stat-box">
                            <div class="num">14</div>
                            <div class="label">–¥–Ω–µ–π –ø–æ–µ–∑–¥–∫–∏</div>
                        </div>
                        <div class="stat-box">
                            <div class="num">4</div>
                            <div class="label">–≥–æ—Ä–æ–¥–∞</div>
                        </div>
                    </div>

                    <!-- Timeline -->
                    <div class="space-y-3">
            `;

            filteredItinerary.forEach((item, idx) => {
                const isExpanded = expandedItineraryDays[idx];
                const details = getDetails(item.details);

                h += `
                    <div class="flex gap-3">
                        <div class="flex flex-col items-center">
                            <div class="w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center text-xs font-semibold text-gray-600">
                                ${item.day}
                            </div>
                            ${idx < filteredItinerary.length - 1 ? '<div class="w-px flex-1 bg-gray-200 my-1"></div>' : ''}
                        </div>
                        <div class="flex-1 card ${details ? 'cursor-pointer' : ''} mb-1" ${details ? `onclick="toggleItineraryDay(${idx})"` : ''}>
                            <div class="p-4">
                                <div class="flex items-start justify-between mb-1">
                                    <div class="text-xs text-gray-500">${item.city}</div>
                                    <span class="badge ${item.type === 'base' ? 'badge-base' : 'badge-trip'}">${item.type === 'base' ? '–±–∞–∑–∞' : '–≤—ã–µ–∑–¥'}</span>
                                </div>
                                <div class="font-semibold text-gray-900 mb-1">${item.title}</div>
                                <div class="text-sm text-gray-500">${item.desc}</div>
                                
                                ${details ? `
                                    <div class="flex items-center justify-between mt-3 pt-3 border-t border-gray-100 text-xs text-gray-400">
                                        <span>${details.distance}</span>
                                        <span class="flex items-center gap-1">
                                            ${isExpanded ? '‚Üë –°–≤–µ—Ä–Ω—É—Ç—å' : '‚Üì –ü–æ–¥—Ä–æ–±–Ω–µ–µ'}
                                        </span>
                                    </div>
                                ` : ''}
                            </div>
                            
                            ${isExpanded && details ? `
                                <div class="border-t border-gray-100 bg-gray-50">
                                    ${details.items.map(spot => `
                                        <div class="p-4 border-b border-gray-100 last:border-b-0 flex gap-3">
                                            <div class="text-lg">${typeIcon(spot.type)}</div>
                                            <div class="flex-1">
                                                <div class="text-xs text-gray-400 mb-0.5">${spot.time}</div>
                                                <div class="font-medium text-gray-900 text-sm">${spot.title}</div>
                                                <div class="text-xs text-gray-500 mt-0.5">${spot.desc}</div>
                                                ${spot.coords ? `
                                                    <a href="https://www.google.com/maps?q=${spot.coords[0]},${spot.coords[1]}" 
                                                       target="_blank" onclick="event.stopPropagation()"
                                                       class="inline-block text-xs text-blue-600 mt-1 hover:underline">
                                                        ‚Üí –ö–∞—Ä—Ç–∞
                                                    </a>
                                                ` : ''}
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                            ` : ''}
                        </div>
                    </div>
                `;
            });

            c.innerHTML = h + "</div></div>";
        }

        let expandedItineraryDays = {};
        window.toggleItineraryDay = (idx) => {
            expandedItineraryDays[idx] = !expandedItineraryDays[idx];
            renderCurrentView();
        };

        function renderMap(c) {
            c.innerHTML = `
                <div class="h-full flex flex-col space-y-4">
                    <div class="bg-white p-3 rounded-xl border border-gray-200 shadow-sm">
                        <h2 class="font-bold text-lg">üó∫Ô∏è –ú–∞—Ä—à—Ä—É—Ç (General)</h2>
                        <p class="text-xs text-gray-500">–ß–µ—Ç–∫–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å –±–∞–∑–∞–º–∏. –ù–∞–≤–µ–¥–∏—Ç–µ –Ω–∞ –º–∞—Ä–∫–µ—Ä—ã –¥–ª—è –¥–µ—Ç–∞–ª–µ–π.</p>
                    </div>
                    <div id="map-container" class="flex-grow shadow-md border border-gray-300 relative"></div>
                </div>
            `;
            loadYandexMap('map-container');
        }

        // ============================================
        // üö¥ ROUTE DETAIL BOTTOM SHEET
        // ============================================

        function getAllRoutes() {
            return veloPlan.groups.flatMap(g => g.routes);
        }

        function showRouteDetailById(routeId) {
            const route = getAllRoutes().find(r => r.id === routeId);
            if (!route) return showToast('–ú–∞—Ä—à—Ä—É—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω', 'error');
            showRouteDetail(route);
        }

        function showRouteDetail(route) {
            // Create overlay
            const overlay = document.createElement('div');
            overlay.className = 'bottom-sheet-overlay';
            overlay.onclick = closeRouteDetail;

            // Create bottom sheet
            const sheet = document.createElement('div');
            sheet.className = 'bottom-sheet';
            sheet.id = 'route-detail-sheet';

            // Difficulty color
            const difficultyColor = route.difficulty === '–õ–µ–≥–∫–∞—è' ? 'text-green-600 bg-green-50' :
                                   route.difficulty === '–°—Ä–µ–¥–Ω—è—è' ? 'text-orange-600 bg-orange-50' :
                                   'text-red-600 bg-red-50';

            sheet.innerHTML = `
                <div class="bottom-sheet-handle"></div>
                <div class="px-6 pb-6">
                    <!-- Header -->
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <h2 class="text-2xl font-bold text-gray-900 mb-1">${route.name}</h2>
                            <p class="text-sm text-gray-600">${route.desc}</p>
                        </div>
                        <button onclick="closeRouteDetail()" class="p-2 hover:bg-gray-100 rounded-full transition-colors">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                                <path d="M6 18L18 6M6 6l12 12" />
                            </svg>
                        </button>
                    </div>

                    <!-- Two Column Layout -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <!-- Left Column: Info -->
                        <div>
                            <!-- Stats Grid -->
                            <div class="grid grid-cols-2 gap-3 mb-4">
                                <div class="bg-blue-50 p-3 rounded-lg">
                                    <div class="text-xs text-blue-600 font-bold">–†–∞—Å—Å—Ç–æ—è–Ω–∏–µ</div>
                                    <div class="text-lg font-bold text-blue-900">${route.distance}</div>
                                </div>
                                <div class="bg-purple-50 p-3 rounded-lg">
                                    <div class="text-xs text-purple-600 font-bold">–ù–∞–±–æ—Ä –≤—ã—Å–æ—Ç—ã</div>
                                    <div class="text-lg font-bold text-purple-900">${route.elevation}</div>
                                </div>
                                <div class="bg-green-50 p-3 rounded-lg">
                                    <div class="text-xs text-green-600 font-bold">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å</div>
                                    <div class="text-lg font-bold text-green-900">${route.duration}</div>
                                </div>
                                <div class="${difficultyColor} p-3 rounded-lg">
                                    <div class="text-xs font-bold">–°–ª–æ–∂–Ω–æ—Å—Ç—å</div>
                                    <div class="text-lg font-bold">${route.difficulty}</div>
                                </div>
                            </div>

                            <!-- Gradient -->
                            <div class="bg-white border border-gray-200 rounded-lg p-4 mb-4">
                                <h3 class="font-bold text-sm text-gray-900 mb-2">üìà –ì—Ä–∞–¥–∏–µ–Ω—Ç</h3>
                                <p class="text-sm text-gray-600">${route.gradient}</p>
                            </div>

                            <!-- Highlights -->
                            <div class="mb-4">
                                <h3 class="font-bold text-sm text-gray-900 mb-2">‚ú® –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏</h3>
                                <div class="flex flex-wrap gap-2">
                                    ${route.highlights.map(h => `<span class="tag-pill">${h}</span>`).join('')}
                                </div>
                            </div>
                        </div>

                        <!-- Right Column: Map -->
                        <div class="flex flex-col">
                            <div id="route-map-container" class="route-detail-map bg-gray-100 flex-1"></div>
                        </div>
                    </div>

                    <!-- Actions -->
                    <div class="flex gap-3 mt-4">
                        <a href="${route.mapLink}" target="_blank"
                           class="flex-1 text-center bg-blue-600 text-white font-bold py-3 rounded-lg hover:bg-blue-700 transition-colors">
                            –û—Ç–∫—Ä—ã—Ç—å –≤ Google Maps
                        </a>
                        <button onclick="closeRouteDetail()"
                                class="px-6 bg-gray-200 text-gray-700 font-bold rounded-lg hover:bg-gray-300 transition-colors">
                            –ó–∞–∫—Ä—ã—Ç—å
                        </button>
                    </div>
                </div>
            `;

            document.body.appendChild(overlay);
            document.body.appendChild(sheet);

            // Trigger animations
            setTimeout(() => {
                overlay.classList.add('show');
                sheet.classList.add('show');
            }, 10);

            // Initialize mini map
            setTimeout(() => initRouteMap(route), 300);

            showToast(`–ú–∞—Ä—à—Ä—É—Ç: ${route.name}`, 'info');
        }

        function closeRouteDetail() {
            const overlay = document.querySelector('.bottom-sheet-overlay');
            const sheet = document.getElementById('route-detail-sheet');

            if (overlay) {
                overlay.classList.remove('show');
                setTimeout(() => overlay.remove(), 300);
            }

            if (sheet) {
                sheet.classList.remove('show');
                setTimeout(() => sheet.remove(), 300);
            }
        }

        async function initRouteMap(route) {
            const container = document.getElementById('route-map-container');
            if (!container || !window.ymaps) return;

            ymaps.ready(async () => {
                const map = new ymaps.Map('route-map-container', {
                    center: route.center,
                    zoom: 11,
                    controls: ['zoomControl']
                });

                // 1) –ï—Å–ª–∏ –µ—Å—Ç—å track ‚Äî —Ä–∏—Å—É–µ–º —Å—Ä–∞–∑—É
                if (Array.isArray(route.track) && route.track.length >= 2) {
                    drawTrack(map, route.track, route.name);
                    return;
                }

                // 2) –ï—Å–ª–∏ –µ—Å—Ç—å GPX ‚Äî –≥—Ä—É–∑–∏–º, –ø–∞—Ä—Å–∏–º, —Ä–∏—Å—É–µ–º
                if (route.gpxUrl) {
                    try {
                        const coords = await loadGpxCoords(route.gpxUrl);
                        if (coords.length >= 2) {
                            drawTrack(map, coords, route.name);
                            return;
                        }
                    } catch (e) {
                        console.warn('GPX load/parse failed', e);
                    }
                }

                // 3) Fallback ‚Äî –ø—Ä–æ—Å—Ç–æ –º–∞—Ä–∫–µ—Ä
                const placemark = new ymaps.Placemark(route.center, { balloonContent: route.name }, {
                    preset: 'islands#blueDotIcon'
                });
                map.geoObjects.add(placemark);
            });
        }

        function drawTrack(map, coords, name) {
            const line = new ymaps.Polyline(coords, { hintContent: name }, {
                strokeColor: "#e11d48",
                strokeWidth: 4,
                strokeOpacity: 0.9
            });

            map.geoObjects.add(line);

            // –ú–∞—Ä–∫–µ—Ä—ã "—Å—Ç–∞—Ä—Ç/—Ñ–∏–Ω–∏—à"
            const start = coords[0];
            const end = coords[coords.length - 1];

            map.geoObjects.add(new ymaps.Placemark(start, { iconCaption: 'Start' }, { preset: 'islands#greenDotIcon' }));
            map.geoObjects.add(new ymaps.Placemark(end, { iconCaption: 'Finish' }, { preset: 'islands#redDotIcon' }));

            // –ü–æ–¥–æ–≥–Ω–∞—Ç—å –∫–∞—Ä—Ç—É –ø–æ–¥ –º–∞—Ä—à—Ä—É—Ç
            const bounds = line.geometry.getBounds();
            if (bounds) {
                map.setBounds(bounds, { checkZoomRange: true, zoomMargin: 20 });
            }
        }

        async function loadGpxCoords(url) {
            const res = await fetch(url);
            if (!res.ok) throw new Error(`Failed to fetch GPX: ${res.status}`);
            const text = await res.text();

            const xml = new DOMParser().parseFromString(text, "application/xml");
            const trkpts = Array.from(xml.getElementsByTagName("trkpt"));

            // GPX —Ö—Ä–∞–Ω–∏—Ç lat/lon –≤ –∞—Ç—Ä–∏–±—É—Ç–∞—Ö, Yandex –∂–¥—ë—Ç [lat, lon]
            return trkpts
                .map(p => [Number(p.getAttribute("lat")), Number(p.getAttribute("lon"))])
                .filter(([lat, lon]) => Number.isFinite(lat) && Number.isFinite(lon));
        }

        let veloActiveTab = 'routes';

        function renderVelo(c) {
            let h = `
                <div class="space-y-4 pb-20">
                    <!-- –í–∫–ª–∞–¥–∫–∏ -->
                    <div class="flex gap-2 bg-gray-100 p-1 rounded-lg">
                        <button onclick="switchVeloTab('routes')" id="velo-tab-routes"
                            class="flex-1 py-2 px-4 rounded-md text-sm font-medium transition-all ${veloActiveTab === 'routes' ? 'bg-white text-gray-900 shadow-sm' : 'text-gray-600 hover:text-gray-900'}">
                            üö¥ –ú–∞—Ä—à—Ä—É—Ç—ã
                        </button>
                        <button onclick="switchVeloTab('shops')" id="velo-tab-shops"
                            class="flex-1 py-2 px-4 rounded-md text-sm font-medium transition-all ${veloActiveTab === 'shops' ? 'bg-white text-gray-900 shadow-sm' : 'text-gray-600 hover:text-gray-900'}">
                            üõçÔ∏è –ú–∞–≥–∞–∑–∏–Ω—ã
                        </button>
                    </div>

                    <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –º–∞—Ä—à—Ä—É—Ç–æ–≤ -->
                    <div id="velo-content-routes" class="${veloActiveTab === 'routes' ? '' : 'hidden'}">
                        <div class="bg-gray-50 border border-gray-200 p-4 rounded-xl mb-4">
                            <h2 class="font-bold text-lg mb-2">üö¥ –û–±—â–∏–µ –ú–∞—Ä—à—Ä—É—Ç—ã</h2>
                            ${veloPlan.tips.map(t=>`<p class="text-xs text-gray-600 mb-1 border-l-2 border-red-500 pl-2">${t}</p>`).join('')}
                        </div>
            `;

            veloPlan.groups.forEach(g => {
                h += `
                    <div class="rounded-xl overflow-hidden shadow-sm mb-4">
                        <div class="${g.color} p-3 font-bold text-sm">${g.name}</div>
                        <div class="bg-white border-x border-b border-gray-200 p-4 space-y-3">
                `;
                g.routes.forEach(r => h += `
                    <div class="card-hover p-2 rounded-lg cursor-pointer" onclick="showRouteDetailById('${r.id}')">
                        <div class="flex justify-between items-baseline">
                            <h4 class="font-bold text-sm text-gray-800">${r.name}</h4>
                            <span class="badge ${r.badge}">${r.badge.split('-')[1].toUpperCase()}</span>
                        </div>
                        <p class="text-xs text-gray-500 mt-1">${r.desc}</p>
                    </div>
                `);
                h += `</div></div>`;
            });

            h += `</div>`;

            // –ö–æ–Ω—Ç–µ–Ω—Ç –º–∞–≥–∞–∑–∏–Ω–æ–≤
            h += `
                    <div id="velo-content-shops" class="${veloActiveTab === 'shops' ? '' : 'hidden'}">
                        <div class="bg-emerald-50 border border-emerald-200 p-4 rounded-xl mb-4">
                            <h2 class="font-bold text-lg mb-2">üõçÔ∏è –ú–∞–≥–∞–∑–∏–Ω—ã –≤–µ–ª–æ–æ–¥–µ–∂–¥—ã</h2>
                            <p class="text-xs text-gray-600 border-l-2 border-emerald-500 pl-2">–§–∏–∑–∏—á–µ—Å–∫–∏–µ –º–∞–≥–∞–∑–∏–Ω—ã —Å –≤–µ–ª–æ–æ–¥–µ–∂–¥–æ–π. –Ø–ø–æ–Ω—Å–∫–∏–µ –±—Ä–µ–Ω–¥—ã, –ø—Ä–∏–º–µ—Ä–æ—á–Ω—ã–µ, —Å–∫–∏–¥–∫–∏.</p>
                        </div>
            `;

            veloPlan.shops.forEach(cityShops => {
                h += `
                    <div class="rounded-xl overflow-hidden shadow-sm mb-4">
                        <div class="bg-emerald-800 text-white p-3 font-bold text-sm">${cityShops.city}</div>
                        <div class="bg-white border-x border-b border-gray-200 p-4 space-y-2">
                `;
                cityShops.places.forEach(shop => {
                    h += `
                        <div class="card-hover p-3 rounded-lg border border-gray-100">
                            <div class="flex justify-between items-start mb-1">
                                <h4 class="font-bold text-sm text-gray-800">${shop.name}</h4>
                                <span class="badge ${shop.badge}">${shop.type}</span>
                            </div>
                            <p class="text-xs text-gray-500 mb-1">${shop.desc}</p>
                            ${shop.address ? `<p class="text-[10px] text-gray-400 mb-2">üìç ${shop.address}</p>` : ''}
                            <a href="${shop.mapLink || 'https://www.google.com/maps/search/' + encodeURIComponent(shop.name + ' ' + cityShops.city + ' Japan')}"
                               target="_blank"
                               class="text-[10px] text-emerald-600 font-bold border border-emerald-100 bg-emerald-50 px-2 py-1 rounded inline-block hover:bg-emerald-100 transition-colors">
                               üó∫Ô∏è –ö–∞—Ä—Ç–∞
                            </a>
                        </div>
                    `;
                });
                h += `</div></div>`;
            });

            // –Ø–ø–æ–Ω—Å–∫–∏–µ –±—Ä–µ–Ω–¥—ã
            h += `
                <div class="bg-white rounded-xl border border-gray-200 p-4">
                    <h3 class="font-bold text-sm text-gray-700 mb-3">üáØüáµ –Ø–ø–æ–Ω—Å–∫–∏–µ –±—Ä–µ–Ω–¥—ã (–∏—Å–∫–∞—Ç—å)</h3>
                    <div class="space-y-2">
            `;
            japanBrands.forEach(b => {
                h += `
                    <div class="flex items-center gap-2">
                        <span class="tag-pill">${b.name}</span>
                        <span class="text-xs text-gray-500">${b.type} ‚Äî ${b.desc}</span>
                    </div>
                `;
            });
            h += `</div></div></div>`;

            c.innerHTML = h + "</div>";
        }

        function switchVeloTab(tab) {
            veloActiveTab = tab;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∏–ª–∏ –≤–∫–ª–∞–¥–æ–∫
            document.getElementById('velo-tab-routes').className = `flex-1 py-2 px-4 rounded-md text-sm font-medium transition-all ${tab === 'routes' ? 'bg-white text-gray-900 shadow-sm' : 'text-gray-600 hover:text-gray-900'}`;
            document.getElementById('velo-tab-shops').className = `flex-1 py-2 px-4 rounded-md text-sm font-medium transition-all ${tab === 'shops' ? 'bg-white text-gray-900 shadow-sm' : 'text-gray-600 hover:text-gray-900'}`;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç
            document.getElementById('velo-content-routes').className = tab === 'routes' ? '' : 'hidden';
            document.getElementById('velo-content-shops').className = tab === 'shops' ? '' : 'hidden';
        }

        function renderListWithTabs(c, data, sid, cb, rend, icon) {
            let h = `
                <div class="flex flex-col md:flex-row gap-4 md:gap-6 h-full pb-20">
                    <div class="sticky top-14 md:top-0 z-30 bg-gray-50 pt-2 pb-2 md:w-1/4">
                        <div class="md:hidden flex overflow-x-auto hide-scroll gap-2 pb-1">
                            ${data.map(i=>`
                                <button onclick="window.upSel('${i.id}')"
                                    class="flex-shrink-0 px-4 py-2 rounded-full border text-xs font-bold whitespace-nowrap transition-all ${
                                        sid===i.id ? 'bg-gray-900 text-white' : 'bg-white text-gray-600 border-gray-200 hover:bg-gray-50'
                                    }">
                                    ${i.city}
                                </button>
                            `).join('')}
                        </div>
                        <div class="hidden md:flex flex-col gap-2">
                            ${data.map(i=>`
                                <button onclick="window.upSel('${i.id}')"
                                    class="text-left px-4 py-3 rounded-lg border transition-all ${
                                        sid===i.id ? 'bg-gray-900 text-white' : 'bg-white text-gray-600 hover:bg-gray-50'
                                    }">
                                    <span class="font-bold text-sm">${i.city}</span>
                                </button>
                            `).join('')}
                        </div>
                    </div>
                    <div class="w-full md:w-3/4">${rend(data.find(x=>x.id===sid), icon)}</div>
                </div>
            `;
            c.innerHTML = h;
            window.upSel = cb;
        }

        function renderSightsDetails(c, i) {
            return `
                <div class="bg-white rounded-xl border border-gray-200 shadow-sm overflow-hidden fade-in">
                    <div class="bg-gray-100 p-4 border-b border-gray-200">
                        <h2 class="text-2xl font-semibold text-gray-900 flex justify-between">
                            ${c.city} <span class="opacity-20">${i}</span>
                        </h2>
                    </div>
                    <div class="divide-y divide-gray-100">
                        ${c.places.map(p=>`
                            <div class="p-4 card-hover">
                                <div class="flex justify-between items-start mb-1">
                                    <h3 class="font-bold text-base text-gray-900">${p.name}</h3>
                                    <span class="badge ${p.badge}">${p.type}</span>
                                </div>
                                <p class="text-gray-600 text-xs mb-2">${p.detail}</p>
                                <a href="https://yandex.ru/maps/?text=${encodeURIComponent(p.name + ' ' + c.city)}"
                                   target="_blank"
                                   class="text-[10px] text-blue-600 font-bold border border-blue-100 bg-blue-50 px-2 py-1 rounded inline-block hover:bg-blue-100 transition-colors">
                                   üìç –ù–∞ –∫–∞—Ä—Ç–µ
                                </a>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        function renderFoodDetails(c, i) {
            return `
                <div class="bg-white rounded-xl border border-gray-200 shadow-sm overflow-hidden fade-in">
                    <div class="bg-gray-100 p-4 border-b border-gray-200">
                        <h2 class="text-2xl font-semibold text-gray-900 flex justify-between">
                            ${c.city} <span class="opacity-20">${i}</span>
                        </h2>
                    </div>
                    <div class="divide-y divide-gray-100">
                        ${c.places.map(p=>`
                            <div class="p-4 card-hover">
                                <div class="flex justify-between items-start">
                                    <h3 class="font-bold text-gray-900">${p.name}</h3>
                                    <span class="text-xs bg-gray-100 px-2 py-0.5 rounded text-gray-600 font-bold">${safe(p.dish,'')}</span>
                                </div>
                                ${p.why ? `<p class="text-gray-600 text-xs mt-1 italic mb-2">"${p.why}"</p>` : ``}
                                ${p.tags?.length ? `<div class="flex flex-wrap gap-2 mb-2">${p.tags.map(t=>`<span class="tag-pill">${t}</span>`).join('')}</div>` : ``}
                                ${p.url ? `<a href="${p.url}" target="_blank" class="text-[10px] text-gray-700 font-bold border border-gray-200 bg-gray-50 px-2 py-1 rounded inline-block mr-2 hover:bg-gray-100 transition-colors">üîó –°–∞–π—Ç</a>` : ``}
                                <a href="https://yandex.ru/maps/?text=${encodeURIComponent(p.name+' '+c.city)}"
                                   target="_blank"
                                   class="text-[10px] text-blue-600 font-bold border border-blue-100 bg-blue-50 px-2 py-1 rounded inline-block hover:bg-blue-100 transition-colors">
                                   üìç –ù–∞ –∫–∞—Ä—Ç–µ
                                </a>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        // TEMPORARILY DISABLED - Hotels tab
        // function renderHotelDetails(c, i) {
        //     return `
        //         <div class="bg-white rounded-xl border border-gray-200 shadow-sm overflow-hidden fade-in">
        //             <div class="bg-gray-100 p-4 border-b border-gray-200">
        //                 <h2 class="text-2xl font-semibold text-gray-900 flex justify-between">
        //                     ${c.city} <span class="opacity-20">${i}</span>
        //                 </h2>
        //                 <p class="text-xs text-gray-600 mt-1 italic">${c.desc}</p>
        //             </div>
        //             <div class="divide-y divide-gray-100">
        //                 ${c.places.map(p=>`
        //                     <div class="p-4 card-hover">
        //                         <div class="flex justify-between items-start mb-1">
        //                             <h3 class="font-bold text-gray-900">${p.name}</h3>
        //                             <span class="badge ${p.badge}">${p.type}</span>
        //                         </div>
        //                         <p class="text-gray-600 text-xs mt-1 leading-relaxed">"${p.why}"</p>
        //                         <div class="flex justify-between items-center mt-3">
        //                             <span class="text-xs font-mono text-gray-500 bg-gray-50 px-2 py-1 rounded">${p.price}</span>
        //                             <a href="https://www.booking.com/searchresults.ru.html?ss=${encodeURIComponent(p.name + ' ' + c.city)}"
        //                                target="_blank"
        //                                class="text-[10px] text-white font-bold bg-blue-600 px-3 py-1.5 rounded hover:bg-blue-700 transition-colors shadow-sm">
        //                                Booking.com &rarr;
        //                             </a>
        //                         </div>
        //                     </div>
        //                 `).join('')}
        //             </div>
        //         </div>
        //     `;
        // }

        function renderAccommodation(el) {
            const statusBadge = (status) => {
                if (status === 'booked') return '<span class="badge badge-base">‚úì –ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–æ</span>';
                return '<span class="badge badge-time">‚è≥ –ò—â–µ–º</span>';
            };

            const renderBookingCard = (acc, index) => {
                if (!acc.booking) {
                    return `
                        <div class="p-6 text-center">
                            <div class="text-4xl mb-3">üîç</div>
                            <p class="text-gray-500 text-sm">–ñ–∏–ª—å—ë –ø–æ–∫–∞ –Ω–µ –≤—ã–±—Ä–∞–Ω–æ</p>
                            <a href="https://www.airbnb.ru/s/${encodeURIComponent(acc.city + ', –Ø–ø–æ–Ω–∏—è')}/homes" 
                               target="_blank"
                               class="inline-block mt-4 text-sm font-bold bg-gradient-to-r from-rose-500 to-pink-500 text-white px-4 py-2 rounded-lg hover:opacity-90 transition-opacity shadow-md">
                                –ò—Å–∫–∞—Ç—å –Ω–∞ Airbnb ‚Üí
                            </a>
                        </div>
                    `;
                }

                const b = acc.booking;
                return `
                    <div class="p-4">
                        <div class="flex justify-between items-start mb-3">
                            <div>
                                <h3 class="font-bold text-gray-900 text-lg">${b.name}</h3>
                                <div class="flex items-center gap-2 mt-1">
                                    <span class="badge ${b.badge}">${b.type}</span>
                                    <span class="text-yellow-500 text-sm">‚òÖ ${b.rating}</span>
                                    ${b.district ? `<span class="text-xs text-gray-400">üìç ${b.district}</span>` : ''}
                                </div>
                            </div>
                        </div>
                        
                        <!-- Mini Map -->
                        <div id="acc-map-${acc.id}" class="h-40 w-full rounded-lg mb-4 bg-gray-100 overflow-hidden"></div>
                        
                        <div class="grid grid-cols-3 gap-2 text-xs text-gray-600 mb-4">
                            <div class="bg-gray-50 p-2 rounded text-center">
                                <div class="font-bold text-gray-800">ÔøΩÔ∏è ${b.rooms}</div>
                            </div>
                            <div class="bg-gray-50 p-2 rounded text-center">
                                <div class="font-bold text-gray-800">ÔøΩÔ∏è ${b.beds}</div>
                            </div>
                            <div class="bg-gray-50 p-2 rounded text-center">
                                <div class="font-bold text-gray-800">üöø ${b.bath}</div>
                            </div>
                        </div>
                        <a href="${b.link}" 
                           target="_blank"
                           class="block w-full text-center text-sm font-bold bg-gradient-to-r from-rose-500 to-pink-500 text-white px-4 py-3 rounded-lg hover:opacity-90 transition-opacity shadow-md">
                            –û—Ç–∫—Ä—ã—Ç—å –Ω–∞ Airbnb ‚Üí
                        </a>
                    </div>
                `;
            };

            el.innerHTML = `
                <div class="space-y-4 pb-20">
                    <div class="text-center mb-6">
                        <h1 class="text-2xl font-semibold text-gray-900">üè† –ñ–∏–ª—å—ë</h1>
                        <p class="text-sm text-gray-500 mt-1">–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–µ—Å—Ç–∞ –¥–ª—è –Ω–æ—á—ë–≤–æ–∫</p>
                    </div>
                    
                    <div class="grid gap-4">
                        ${accommodations.map((acc, i) => `
                            <div class="bg-white rounded-xl border border-gray-200 shadow-sm overflow-hidden card-hover fade-in">
                                <div class="bg-gray-100 p-4 border-b border-gray-200">
                                    <div class="flex justify-between items-start">
                                        <div>
                                            <h2 class="text-xl font-semibold text-gray-900">${acc.city}</h2>
                                            <p class="text-xs text-gray-500 mt-1">${acc.dates}</p>
                                        </div>
                                        ${statusBadge(acc.status)}
                                    </div>
                                    <p class="text-xs text-gray-600 mt-2 italic">${acc.desc}</p>
                                </div>
                                ${renderBookingCard(acc, i)}
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;

            // Initialize mini maps after DOM is ready
            setTimeout(() => initAccommodationMaps(), 100);
        }

        function initAccommodationMaps() {
            if (typeof ymaps === 'undefined') return;
            
            ymaps.ready(() => {
                accommodations.forEach(acc => {
                    if (!acc.booking || !acc.coords) return;
                    
                    const mapContainer = document.getElementById(`acc-map-${acc.id}`);
                    if (!mapContainer) return;
                    
                    const miniMap = new ymaps.Map(mapContainer, {
                        center: acc.coords,
                        zoom: 15,
                        controls: ['zoomControl']
                    }, {
                        suppressMapOpenBlock: true
                    });

                    const b = acc.booking;
                    const balloonContent = `
                        <div style="width: 220px; font-family: 'Noto Sans', sans-serif;">
                            <div style="width: 100%; height: 120px; background: linear-gradient(135deg, #f43f5e 0%, #ec4899 100%); border-radius: 8px 8px 0 0; display: flex; align-items: center; justify-content: center;">
                                <span style="font-size: 48px;">üè†</span>
                            </div>
                            <div style="padding: 12px;">
                                <div style="font-weight: 700; font-size: 14px; color: #1c1917; margin-bottom: 4px;">${b.name}</div>
                                <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                                    <span style="color: #f59e0b; font-size: 12px;">‚òÖ ${b.rating}</span>
                                    <span style="font-size: 11px; color: #78716c;">${b.district || acc.city}</span>
                                </div>
                                <div style="font-size: 11px; color: #57534e; margin-bottom: 10px;">
                                    ${b.rooms} ¬∑ ${b.beds} ¬∑ ${b.bath}
                                </div>
                                <a href="${b.link}" target="_blank" 
                                   style="display: block; text-align: center; background: linear-gradient(135deg, #f43f5e 0%, #ec4899 100%); 
                                          color: white; padding: 8px 12px; border-radius: 6px; text-decoration: none; 
                                          font-size: 12px; font-weight: 600;">
                                    –û—Ç–∫—Ä—ã—Ç—å –Ω–∞ Airbnb ‚Üí
                                </a>
                            </div>
                        </div>
                    `;

                    const placemark = new ymaps.Placemark(acc.coords, {
                        balloonContent: balloonContent,
                        hintContent: `üè† ${b.name} ‚òÖ${b.rating}`
                    }, {
                        preset: 'islands#redHomeIcon',
                        balloonPanelMaxMapArea: 0,
                        hideIconOnBalloonOpen: false
                    });

                    miniMap.geoObjects.add(placemark);
                    miniMap.behaviors.disable('scrollZoom');
                    
                    // Open balloon on marker hover
                    placemark.events.add('mouseenter', function() {
                        placemark.balloon.open();
                    });
                });
            });
        }

        // ============================================
        // üìã DETAILED PLANS RENDERING
        // ============================================
        let selectedPlanCity = 'osaka';
        let expandedDays = {};

        function renderDetailedPlans(el) {
            const cities = Object.keys(detailedPlans);
            const plan = detailedPlans[selectedPlanCity];

            const typeIcon = (type) => {
                const icons = {
                    food: 'üçú',
                    sight: '‚õ©Ô∏è',
                    art: 'üé®',
                    nature: 'üå∏',
                    velo: 'üö¥',
                    relax: '‚ô®Ô∏è',
                    shop: 'üõí',
                    transport: 'üöÉ'
                };
                return icons[type] || 'üìç';
            };

            const typeBadge = (type) => {
                const badges = {
                    food: 'badge-sweet',
                    sight: 'badge-history',
                    art: 'badge-design',
                    nature: 'badge-nature',
                    velo: 'badge-road',
                    relax: 'badge-onsen',
                    shop: 'badge-tech',
                    transport: 'badge-trip'
                };
                return badges[type] || 'badge-local';
            };

            el.innerHTML = `
                <div class="space-y-4 pb-20">
                    <div class="text-center mb-4">
                        <h1 class="text-2xl font-semibold text-gray-900">üìã –î–µ—Ç–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω</h1>
                        <p class="text-sm text-gray-500 mt-1">–ü–æ–¥—Ä–æ–±–Ω–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –ø–æ –¥–Ω—è–º</p>
                    </div>

                    <!-- City Tabs -->
                    <div class="flex gap-2 overflow-x-auto hide-scroll pb-2">
                        ${cities.map(cityId => {
                            const c = detailedPlans[cityId];
                            return `
                                <button onclick="selectPlanCity('${cityId}')" 
                                    class="flex-shrink-0 px-4 py-2 rounded-full text-sm font-bold transition-all ${
                                        selectedPlanCity === cityId 
                                            ? 'bg-gray-900 text-white' 
                                            : 'bg-gray-100 text-gray-600 hover:bg-gray-200'
                                    }">
                                    ${c.city}
                                </button>
                            `;
                        }).join('')}
                    </div>

                    <!-- City Header -->
                    <div class="bg-gray-900 rounded-xl p-4 text-white">
                        <h2 class="text-xl font-bold">${plan.city}</h2>
                        <p class="text-sm opacity-90">${plan.dates}</p>
                        <p class="text-xs mt-2 opacity-75">${plan.days.length} –¥–Ω–µ–π –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ</p>
                    </div>

                    <!-- Days -->
                    <div class="space-y-3">
                        ${plan.days.map((day, dayIndex) => {
                            const isExpanded = expandedDays[`${selectedPlanCity}-${dayIndex}`];
                            return `
                                <div class="bg-white rounded-xl border border-gray-200 shadow-sm overflow-hidden">
                                    <button onclick="togglePlanDay('${selectedPlanCity}', ${dayIndex})" 
                                        class="w-full p-4 flex justify-between items-center hover:bg-gray-50 transition-colors">
                                        <div class="text-left">
                                            <div class="font-bold text-gray-900">${day.date}</div>
                                            <div class="text-sm text-gray-600">${day.title}</div>
                                            <div class="text-xs text-gray-400 mt-1">${day.distance}</div>
                                        </div>
                                        <svg class="w-5 h-5 text-gray-400 transition-transform ${isExpanded ? 'rotate-180' : ''}" 
                                             fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                                        </svg>
                                    </button>
                                    
                                    ${isExpanded ? `
                                        <div class="border-t border-gray-100 divide-y divide-gray-50">
                                            ${day.items.map(item => `
                                                <div class="p-4 hover:bg-gray-50 transition-colors">
                                                    <div class="flex gap-3">
                                                        <div class="text-2xl">${typeIcon(item.type)}</div>
                                                        <div class="flex-1">
                                                            <div class="flex items-start justify-between gap-2">
                                                                <div>
                                                                    <span class="text-xs text-gray-400 font-mono">${item.time}</span>
                                                                    <h4 class="font-bold text-gray-900">${item.title}</h4>
                                                                </div>
                                                                <span class="badge ${typeBadge(item.type)} flex-shrink-0">${item.type}</span>
                                                            </div>
                                                            <p class="text-sm text-gray-600 mt-1">${item.desc}</p>
                                                            ${item.coords ? `
                                                                <a href="https://www.google.com/maps?q=${item.coords[0]},${item.coords[1]}" 
                                                                   target="_blank"
                                                                   class="inline-flex items-center gap-1 text-xs text-blue-600 mt-2 hover:underline">
                                                                    <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                                                                              d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                                                                              d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
                                                                    </svg>
                                                                    –û—Ç–∫—Ä—ã—Ç—å –Ω–∞ –∫–∞—Ä—Ç–µ
                                                                </a>
                                                            ` : ''}
                                                        </div>
                                                    </div>
                                                </div>
                                            `).join('')}
                                        </div>
                                    ` : ''}
                                </div>
                            `;
                        }).join('')}
                    </div>
                </div>
            `;
        }

        window.selectPlanCity = (cityId) => {
            selectedPlanCity = cityId;
            renderCurrentView();
        };

        window.togglePlanDay = (cityId, dayIndex) => {
            const key = `${cityId}-${dayIndex}`;
            expandedDays[key] = !expandedDays[key];
            renderCurrentView();
        };

        function renderChecklistBlock() {
            const urgent = (x) => x.urgent ? 'border-red-200 bg-red-50' : 'border-gray-200 bg-white';
            return `
                <div class="bg-white rounded-xl border border-gray-200 shadow-sm overflow-hidden">
                    <div class="bg-gray-100 p-4 border-b border-gray-200">
                        <h3 class="font-bold text-gray-900">‚úÖ –ß–µ–∫–ª–∏—Å—Ç</h3>
                        <p class="text-xs text-gray-600 mt-1">–°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ –≤ –±—Ä–∞—É–∑–µ—Ä–µ</p>
                    </div>
                    <div class="p-4 space-y-2">
                        ${checklist.map(item => `
                            <label class="flex items-center gap-3 p-3 rounded-lg border ${urgent(item)} cursor-pointer hover:shadow-sm transition-all card-hover">
                                <input type="checkbox" ${item.done ? 'checked' : ''} data-id="${item.id}" class="w-4 h-4 cursor-pointer">
                                <div class="flex-1">
                                    <div class="font-bold text-sm ${item.done ? 'line-through text-gray-400' : 'text-gray-800'}">${item.text}</div>
                                    ${item.note ? `<div class="text-xs text-gray-500 mt-1">${item.note}</div>` : ``}
                                </div>
                                ${item.urgent ? `<span class="badge badge-time badge-urgent">URGENT</span>` : ``}
                            </label>
                        `).join('')}
                        <button id="add-check-item" class="w-full mt-2 text-sm font-bold bg-gray-900 text-white py-2 rounded-lg hover:bg-gray-800 transition-colors">
                            + –î–æ–±–∞–≤–∏—Ç—å
                        </button>
                    </div>
                </div>
            `;
        }

        function bindChecklistHandlers(root=document) {
            qsa('input[type="checkbox"][data-id]', root).forEach(ch => {
                ch.addEventListener('change', (e) => {
                    const id = Number(e.target.getAttribute('data-id'));
                    checklist = checklist.map(x => x.id === id ? {...x, done: e.target.checked} : x);
                    saveChecklist(checklist);
                    showToast(e.target.checked ? '–ó–∞–¥–∞—á–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ ‚úì' : '–û—Ç–º–µ–Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è', 'success');
                });
            });

            const addBtn = qs('#add-check-item', root);
            if (addBtn) addBtn.addEventListener('click', () => {
                const text = prompt('–ù–æ–≤—ã–π –ø—É–Ω–∫—Ç —á–µ–∫–ª–∏—Å—Ç–∞:');
                if (!text) return;
                const id = Math.max(0, ...checklist.map(x => x.id)) + 1;
                checklist = [{ id, text, done:false, urgent:false }, ...checklist];
                saveChecklist(checklist);
                renderCurrentView();
                showToast('–ü—É–Ω–∫—Ç –¥–æ–±–∞–≤–ª–µ–Ω!', 'success');
            });
        }

        function renderInfo(c) {
            c.innerHTML = `
                <div class="space-y-6 pb-20">
                    <div id="info-content">${getInfoHTML()}</div>
                </div>
            `;
            setTimeout(() => bindChecklistHandlers(document.getElementById('app-view')), 0);
        }

        function changeInfo(tab) {
            currentState.infoSubTab = tab;
            renderInfo(document.getElementById('app-view'));
            writeUrlState();
        }

        function getInfoHTML() {
            return `
                <div class="space-y-3">
                    ${logisticsData.map(l=>`
                        <div class="bg-white p-4 rounded-xl border border-gray-200 shadow-sm card-hover">
                            <h3 class="font-bold">${l.icon} ${l.title}</h3>
                            <p class="text-sm mt-1">${l.detail}</p>
                            ${l.vital?`<div class="mt-2 text-xs text-red-600 font-bold bg-red-50 p-2 rounded">${l.vital}</div>`:''}
                            ${l.links ? `
                                <div class="mt-3 flex flex-wrap gap-2">
                                    ${l.links.map(link => `
                                        <a href="${link.url}" target="_blank" 
                                           class="text-xs font-medium text-blue-600 bg-blue-50 px-3 py-1.5 rounded-lg hover:bg-blue-100 transition-colors">
                                            ${link.name} ‚Üí
                                        </a>
                                    `).join('')}
                                </div>
                            ` : ''}
                        </div>
                    `).join('')}
                    ${renderChecklistBlock()}
                </div>
            `;
        }

        window.upSel = (id) => {
            // if (currentState.view === 'hotels') currentState.selectedHotelCityId = id;
            if (currentState.view === 'sights') currentState.selectedSightsCityId = id;
            else currentState.selectedFoodCityId = id;
            renderCurrentView();
            writeUrlState();
        };

        function init() {
            applyTheme();
            readUrlState();
            loadYandexMap('map-container');
            renderDesktopNav();
            renderMobileNav();
            renderCurrentView();
            renderProgressBar();
            window.addEventListener('popstate', () => {
                readUrlState();
                renderDesktopNav();
                renderMobileNav();
                renderCurrentView();
                renderProgressBar();
            });

            // Show welcome toast
            setTimeout(() => {
                showToast('üóæ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –Ø–ø–æ–Ω–∏–∏ 2026!', 'info');
            }, 500);
        }

        init();
    </script>
</body>
</html>