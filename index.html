<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–Ø–ø–æ–Ω–∏—è 2026: Ultimate Edition</title>
    
    <!-- LIBRARIES -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Merriweather:ital,wght@0,700;1,400&display=swap" rel="stylesheet">

    <style>
        /* CORE STYLES */
        body {
            font-family: 'Noto Sans', sans-serif;
            background-color: #fcfbf9;
            color: #292524;
            -webkit-tap-highlight-color: transparent;
        }
        h1, h2, h3, .serif-font { font-family: 'Merriweather', serif; }
        
        /* UTILS */
        .hide-scroll::-webkit-scrollbar { display: none; }
        .hide-scroll { -ms-overflow-style: none; scrollbar-width: none; }
        .mobile-safe-bottom { padding-bottom: env(safe-area-inset-bottom); }
        .fade-in { animation: fadeIn 0.3s cubic-bezier(0.16, 1, 0.3, 1); }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        
        /* COMPONENTS */
        #map-container { height: 100%; width: 100%; border-radius: 12px; z-index: 1; }

        .badge { display: inline-flex; align-items: center; padding: 2px 8px; border-radius: 4px; font-size: 0.65rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.05em; }
        .badge-base { background: #f0fdf4; color: #15803d; border: 1px solid #bbf7d0; } /* –ó–µ–ª–µ–Ω—ã–π - –ë–∞–∑–∞ */
        .badge-trip { background: #eff6ff; color: #1d4ed8; border: 1px solid #bfdbfe; } /* –°–∏–Ω–∏–π - –í—ã–µ–∑–¥ */
        
        /* Food Badges */
        .badge-history { background: #fff1f2; color: #9f1239; border: 1px solid #fecdd3; }
        .badge-local { background: #f0fdf4; color: #15803d; border: 1px solid #bbf7d0; }
        .badge-sweet { background: #fff7ed; color: #c2410c; border: 1px solid #fed7aa; }
        .badge-tech { background: #eff6ff; color: #1d4ed8; border: 1px solid #bfdbfe; }
        .badge-soul { background: #fdf4ff; color: #86198f; border: 1px solid #f0abfc; }

        .segmented-control { background: #e7e5e4; padding: 4px; border-radius: 8px; display: flex; }
        .segment-btn { flex: 1; text-align: center; padding: 8px 0; font-size: 13px; font-weight: 600; border-radius: 6px; color: #57534e; transition: all 0.2s; }
        .segment-active { background: white; color: #1c1917; box-shadow: 0 1px 2px rgba(0,0,0,0.1); }
    </style>
</head>
<body class="antialiased flex flex-col min-h-screen pb-20 md:pb-0">

    <!-- HEADER -->
    <header class="bg-white border-b border-stone-200 sticky top-0 z-50 shadow-sm safe-top">
        <div class="max-w-6xl mx-auto px-4 h-14 md:h-16 flex items-center justify-between">
            <div class="flex items-center gap-3">
                <div class="w-8 h-8 bg-stone-800 rounded flex items-center justify-center text-white font-serif font-bold text-lg">J</div>
                <div>
                    <div class="font-bold text-base md:text-lg leading-tight text-stone-900">Japan 2026</div>
                    <div class="text-[10px] md:text-xs text-stone-500 font-medium">Full Guide</div>
                </div>
            </div>
            <nav class="hidden md:flex gap-1" id="desktop-nav"></nav>
        </div>
    </header>

    <!-- MAIN CONTENT -->
    <main class="flex-grow w-full max-w-6xl mx-auto px-3 md:px-4 py-4 md:py-8 h-[calc(100vh-60px)] md:h-auto">
        <div id="app-view" class="fade-in h-full"></div>
    </main>

    <!-- MOBILE NAV -->
    <nav class="md:hidden fixed bottom-0 left-0 w-full bg-white border-t border-stone-200 z-50 mobile-safe-bottom shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.05)]">
        <div class="grid grid-cols-5 h-16" id="mobile-bottom-nav"></div>
    </nav>

    <!-- JAVASCRIPT -->
    <script>
        // ================= DATA =================

        // 1. ITINERARY (Clean, NO Velo details)
        const itinerary = [
            // PHASE 1: OSAKA BASE
            { day: "15.04", date: "–°—Ä", city: "–û—Å–∞–∫–∞", title: "–ü—Ä–∏–±—ã—Ç–∏–µ", type: "base", desc: "–ë–∞–∑–∞: –û—Å–∞–∫–∞ (3 –Ω–æ—á–∏). –ó–∞—Å–µ–ª–µ–Ω–∏–µ, –î–æ—Ç–æ–Ω–±–æ—Ä–∏.", food_ref: "osaka", sight_ref: "osaka" },
            { day: "16.04", date: "–ß—Ç", city: "–û—Å–∞–∫–∞", title: "–ö–ª–∞—Å—Å–∏–∫–∞", type: "base", desc: "–û—Å–∞–∫—Å–∫–∏–π –∑–∞–º–æ–∫, –£–º–µ–¥–∞ –°–∫–∞–π –ë–∏–ª–¥–∏–Ω–≥.", food_ref: "osaka", sight_ref: "osaka" },
            { day: "17.04", date: "–ü—Ç", city: "–ö–æ–±–µ", title: "–í—ã–µ–∑–¥ –∫ –º–æ—Ä—é", type: "trip", desc: "–≠–ª–µ–∫—Ç—Ä–∏—á–∫–∞ (20 –º–∏–Ω). –ù–∞–±–µ—Ä–µ–∂–Ω–∞—è, –ö–∏—Ç–∞–π—Å–∫–∏–π –∫–≤–∞—Ä—Ç–∞–ª.", food_ref: "kobe", sight_ref: "kobe" },
            
            // PHASE 2: KYOTO BASE
            { day: "18.04", date: "–°–±", city: "–ö–∏–æ—Ç–æ", title: "–°–º–µ–Ω–∞ –ë–∞–∑—ã", type: "base", desc: "–ü–µ—Ä–µ–µ–∑–¥ (30 –º–∏–Ω). –í–µ—á–µ—Ä–Ω–∏–π –ì–∏–æ–Ω. –ë–∞–∑–∞: –ö–∏–æ—Ç–æ (3 –Ω–æ—á–∏).", food_ref: "kyoto", sight_ref: "kyoto" },
            { day: "19.04", date: "–í—Å", city: "–ö–∏–æ—Ç–æ", title: "–°—Ç–∞—Ä—ã–π –ì–æ—Ä–æ–¥", type: "base", desc: "–ó–æ–ª–æ—Ç–æ–π –ø–∞–≤–∏–ª—å–æ–Ω, –†–µ–∫–∞ –ö–∞–º–æ, –ò–º–ø–µ—Ä–∞—Ç–æ—Ä—Å–∫–∏–π –¥–≤–æ—Ä–µ—Ü.", food_ref: "kyoto", sight_ref: "kyoto" },
            { day: "20.04", date: "–ü–Ω", city: "–ù–∞—Ä–∞", title: "–î—Ä–µ–≤–Ω—è—è —Å—Ç–æ–ª–∏—Ü–∞", type: "trip", desc: "–†–∞–¥–∏–∞–ª—å–Ω—ã–π –≤—ã–µ–∑–¥. –ë–æ–ª—å—à–æ–π –ë—É–¥–¥–∞ –∏ –û–ª–µ–Ω–∏.", food_ref: "nara", sight_ref: "nara" },
            
            // PHASE 3: OKAYAMA BASE
            { day: "21.04", date: "–í—Ç", city: "–û–∫–∞—è–º–∞", title: "–°–∏–Ω–∫–∞–Ω—Å—ç–Ω", type: "base", desc: "–ü–µ—Ä–µ–µ–∑–¥ (1 —á–∞—Å). –ó–∞–º–æ–∫ –û–∫–∞—è–º–∞ + –°–∞–¥ –ö–æ—Ä–∞–∫—É—ç–Ω. –ë–∞–∑–∞: –û–∫–∞—è–º–∞ (2 –Ω–æ—á–∏).", food_ref: "okayama", sight_ref: "okayama" },
            { day: "22.04", date: "–°—Ä", city: "–û–Ω–æ–º–∏—Ç–∏", title: "–®–∏–º–∞–Ω–∞–º–∏ –ö–∞–π–¥–æ", type: "trip", desc: "–†–∞–¥–∏–∞–ª—å–Ω—ã–π –≤—ã–µ–∑–¥ –Ω–∞ –≤–µ—Å—å –¥–µ–Ω—å –∫ –í–Ω—É—Ç—Ä–µ–Ω–Ω–µ–º—É –º–æ—Ä—é.", food_ref: "onomichi", sight_ref: "velo" },
            
            // PHASE 4: HIROSHIMA BASE
            { day: "23.04", date: "–ß—Ç", city: "–•–∏—Ä–æ—Å–∏–º–∞", title: "–ü–µ—Ä–µ–µ–∑–¥", type: "base", desc: "–°–∏–Ω–∫–∞–Ω—Å—ç–Ω (35 –º–∏–Ω). –ü–∞—Ä–∫ –ú–∏—Ä–∞. –ë–∞–∑–∞: –•–∏—Ä–æ—Å–∏–º–∞ (2 –Ω–æ—á–∏).", food_ref: "hiroshima", sight_ref: "hiroshima" },
            { day: "24.04", date: "–ü—Ç", city: "–ú–∏—è–¥–∑–∏–º–∞", title: "–°–≤—è—â–µ–Ω–Ω—ã–π –æ—Å—Ç—Ä–æ–≤", type: "trip", desc: "–ü–∞—Ä–æ–º. –•—Ä–∞–º –ò—Ü—É–∫—É—Å–∏–º–∞, –≥–æ—Ä–∞ –ú–∏—Å—ç–Ω.", food_ref: "miyajima", sight_ref: "miyajima" },
            
            // PHASE 5: SHIMONOSEKI & RETURN
            { day: "25.04", date: "–°–±", city: "–°–∏–º–æ–Ω–æ—Å–µ–∫–∏", title: "–§—É–≥—É –∏ –†—ã–Ω–æ–∫", type: "base", desc: "–°–∏–Ω–∫–∞–Ω—Å—ç–Ω (1 —á–∞—Å). –†—ã–Ω–æ–∫ –ö–∞—Ä–∞—Ç–æ. –ë–∞–∑–∞: –°–∏–º–æ–Ω–æ—Å–µ–∫–∏ (1 –Ω–æ—á—å).", food_ref: "shimonoseki", sight_ref: "shimonoseki" },
            { day: "26.04", date: "–í—Å", city: "–¢–æ–Ω–Ω–µ–ª—å/–û—Å–∞–∫–∞", title: "–í–æ–∑–≤—Ä–∞—â–µ–Ω–∏–µ", type: "trip", desc: "–£—Ç—Ä–æ: –¢–æ–Ω–Ω–µ–ª—å –ö–∞–Ω–º–æ–Ω. –í–µ—á–µ—Ä: –°–∏–Ω–∫–∞–Ω—Å—ç–Ω –≤ –û—Å–∞–∫—É (2.5 —á–∞—Å–∞).", food_ref: "shimonoseki", sight_ref: "shimonoseki" },
            
            // FINAL: OSAKA
            { day: "27.04", date: "–ü–Ω", city: "–û—Å–∞–∫–∞", title: "–®–æ–ø–∏–Ω–≥ –î–µ–Ω—å", type: "base", desc: "Orange Street, Shinsaibashi, Den Den Town.", food_ref: "osaka", sight_ref: "osaka" },
            { day: "28.04", date: "–í—Ç", city: "–í—ã–ª–µ—Ç", title: "–î–æ–º–æ–π", type: "base", desc: "–¢—Ä–∞–Ω—Å—Ñ–µ—Ä –≤ KIX.", food_ref: "osaka", sight_ref: "osaka" }
        ];

        // 2. EXTENSIVE FOOD DATA (Restored)
        const foodIntel = [
            {
                id: "osaka",
                city: "–û—Å–∞–∫–∞",
                places: [
                    { name: "551 Horai", type: "Soul Food", badge: "badge-soul", dish: "Butaman (–°–≤–∏–Ω. –±—É–ª–∫–∞)", why: "–ó–∞–ø–∞—Ö –û—Å–∞–∫–∏. –ö—É–ø–∏—Ç–µ –≥–æ—Ä—è—á—É—é –Ω–∞ –≤–æ–∫–∑–∞–ª–µ.", price: "¬•420" },
                    { name: "Endo Sushi", type: "–†—ã–Ω–æ–∫", badge: "badge-local", dish: "Maze-Zushi", why: "–¢–µ–ø–ª—ã–µ —Å—É—à–∏ –Ω–∞ –æ–ø—Ç–æ–≤–æ–º —Ä—ã–Ω–∫–µ. –°–µ—Ç –∏–∑ 5 —à—Ç—É–∫.", price: "¬•1,500" },
                    { name: "Kushikatsu Daruma", type: "–ö–ª–∞—Å—Å–∏–∫–∞", badge: "badge-history", dish: "–ö—É—à–∏–∫–∞—Ü—É", why: "–°–∏–º–≤–æ–ª —Ä–∞–π–æ–Ω–∞ Shinsekai. –ù–µ –º–∞–∫–∞—Ç—å –¥–≤–∞–∂–¥—ã!", price: "¬•2,000" },
                    { name: "Rikuro Ojisan", type: "–î–µ—Å–µ—Ä—Ç", badge: "badge-sweet", dish: "–ß–∏–∑–∫–µ–π–∫", why: "–î—Ä–æ–∂–∞—â–∏–π –ø–∏—Ä–æ–≥-—Å—É—Ñ–ª–µ. –ü–µ–∫—É—Ç –ø—Ä–∏ –≤–∞—Å.", price: "¬•900" },
                    { name: "Takoyaki Wanaka", type: "–°—Ç—Ä–∏—Ç", badge: "badge-local", dish: "–¢–∞–∫–æ—è–∫–∏", why: "–õ—É—á—à–µ–µ —Ç–µ—Å—Ç–æ –≤ –≥–æ—Ä–æ–¥–µ. –•—Ä—É—Å—Ç –∏ –Ω–µ–∂–Ω–æ—Å—Ç—å.", price: "¬•600" }
                ]
            },
            {
                id: "kyoto",
                city: "–ö–∏–æ—Ç–æ",
                places: [
                    { name: "Honke Owariya", type: "–õ–µ–≥–µ–Ω–¥–∞", badge: "badge-history", dish: "Hourai Soba", why: "–†–µ—Å—Ç–æ—Ä–∞–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç —Å 1465 –≥–æ–¥–∞.", price: "¬•2,500" },
                    { name: "Inoda Coffee", type: "–ó–∞–≤—Ç—Ä–∞–∫", badge: "badge-local", dish: "Kyoto Breakfast", why: "–£—Ç—Ä–æ –∞—Ä–∏—Å—Ç–æ–∫—Ä–∞—Ç–∞. –¢–æ–ª—Å—Ç—ã–µ —Ç–æ—Å—Ç—ã.", price: "¬•1,600" },
                    { name: "Miyako Yasai Kamo", type: "–û–±–∞–Ω–∑–∞–π", badge: "badge-local", dish: "–û–≤–æ—â–Ω–æ–π –±—É—Ñ–µ—Ç", why: "–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–∏–æ—Ç—Å–∫–∏–µ –æ–≤–æ—â–∏ –Ω–∞ –∑–∞–≤—Ç—Ä–∞–∫.", price: "¬•600" },
                    { name: "Gogyo Ramen", type: "–ú–æ–¥–µ—Ä–Ω", badge: "badge-tech", dish: "Burnt Miso", why: "–°—É–ø —Å–∂–∏–≥–∞—é—Ç –ø—Ä–∏ 300¬∞C. –í–∫—É—Å –¥—ã–º–∞.", price: "¬•1,300" }
                ]
            },
            {
                id: "kobe",
                city: "–ö–æ–±–µ",
                places: [
                    { name: "Steakland Kobe", type: "–¢—É—Ä–∏—Å—Ç", badge: "badge-tech", dish: "Kobe Beef Lunch", why: "–î–æ—Å—Ç—É–ø–Ω–∞—è –ª–µ–≥–µ–Ω–¥–∞. –®–æ—É –ø–æ–≤–∞—Ä–∞.", price: "¬•3,500" },
                    { name: "Roushouki", type: "Chinatown", badge: "badge-history", dish: "Butaman", why: "–û—á–µ—Ä–µ–¥—å –Ω–∞ —á–∞—Å. –¢–µ—Å—Ç–æ –Ω–∞ –∑–∞–∫–≤–∞—Å–∫–µ.", price: "¬•100" },
                    { name: "Nagomi", type: "Soul Food", badge: "badge-soul", dish: "Bokkake", why: "–¢—É—à–µ–Ω—ã–µ —Å—É—Ö–æ–∂–∏–ª–∏—è ‚Äî —Å–µ–∫—Ä–µ—Ç —Ä–∞–±–æ—á–∏—Ö.", price: "¬•900" },
                    { name: "Freundlieb", type: "–ê—Ç–º–æ—Å—Ñ–µ—Ä–∞", badge: "badge-history", dish: "Roast Beef", why: "–ö–∞—Ñ–µ –≤ —Å—Ç–∞—Ä–æ–π –Ω–µ–º–µ—Ü–∫–æ–π —Ü–µ—Ä–∫–≤–∏.", price: "¬•1,800" }
                ]
            },
            {
                id: "nara",
                city: "–ù–∞—Ä–∞",
                places: [
                    { name: "Nakatanidou", type: "–®–æ—É", badge: "badge-sweet", dish: "Yomogi Mochi", why: "–°–∞–º—ã–µ –±—ã—Å—Ç—Ä—ã–µ —Ä—É–∫–∏ –Ø–ø–æ–Ω–∏–∏ (–æ—Ç–±–∏–≤–∞—é—Ç –º–æ—Ç–∏).", price: "¬•180" },
                    { name: "Kakinoha Sushi", type: "–¢—Ä–∞–¥–∏—Ü–∏—è", badge: "badge-history", dish: "–°—É—à–∏ –≤ —Ö—É—Ä–º–µ", why: "–î—Ä–µ–≤–Ω–∏–π –º–µ—Ç–æ–¥ –∫–æ–Ω—Å–µ—Ä–≤–∞—Ü–∏–∏ —Ä—ã–±—ã.", price: "¬•1,200" },
                    { name: "Kamaiki", type: "–£–¥–æ–Ω", badge: "badge-local", dish: "Kama-Udon", why: "–ù–µ–∂–Ω—ã–π —É–¥–æ–Ω, –ø–æ–ø—É–ª—è—Ä–Ω—ã–π —É –º–µ—Å—Ç–Ω—ã—Ö.", price: "¬•900" }
                ]
            },
            {
                id: "okayama",
                city: "–û–∫–∞—è–º–∞",
                places: [
                    { name: "Nomura", type: "–õ–æ–∫–∞–ª", badge: "badge-soul", dish: "Demi-Katsudon", why: "–ö–æ—Ç–ª–µ—Ç–∞ –ø–æ–¥ —Å–æ—É—Å–æ–º –¥–µ–º–∏–≥–ª—è—Å (–Ω–µ —è–π—Ü–æ!).", price: "¬•1,000" },
                    { name: "Aeon Mall", type: "–®–æ–ø–∏–Ω–≥", badge: "badge-tech", dish: "Fruit Parfait", why: "–û–∫–∞—è–º–∞ ‚Äî —Å—Ç–æ–ª–∏—Ü–∞ —Ñ—Ä—É–∫—Ç–æ–≤ (–ø–µ—Ä—Å–∏–∫–∏/–≤–∏–Ω–æ–≥—Ä–∞–¥).", price: "¬•1,500" },
                    { name: "Kabaku", type: "–ò–¥–∑–∞–∫–∞—è", badge: "badge-local", dish: "Sake & Fish", why: "–ú–µ—Å—Ç–Ω–∞—è —Ä—ã–±–∞ –∏–∑ –í–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –º–æ—Ä—è.", price: "¬•3,500" }
                ]
            },
            {
                id: "onomichi",
                city: "–û–Ω–æ–º–∏—Ç–∏",
                places: [
                    { name: "Ichibankan", type: "–†–∞–º–µ–Ω", badge: "badge-local", dish: "Kakuni Ramen", why: "–†–∞–º–µ–Ω —Å –∂–∏—Ä–æ–º –¥–ª—è –¥–æ–∫–µ—Ä–æ–≤.", price: "¬•1,200" },
                    { name: "U2 Restaurant", type: "–°—Ç–∏–ª—å", badge: "badge-tech", dish: "Cafe / Pasta", why: "–í–µ–ª–æ-—Å–∫–ª–∞–¥ —Ö–∏–ø—Å—Ç–µ—Ä–æ–≤.", price: "¬•1,500" },
                    { name: "Oyatsu to Yamaneko", type: "–î–µ—Å–µ—Ä—Ç", badge: "badge-sweet", dish: "–ü—É–¥–∏–Ω–≥", why: "–†—ã–±–∫–∞ —Å –ª–∏–º–æ–Ω–Ω—ã–º —Å–∏—Ä–æ–ø–æ–º.", price: "¬•450" },
                    { name: "Karasa", type: "–°–Ω—ç–∫", badge: "badge-local", dish: "Ika-ten", why: "–ñ–∞—Ä–µ–Ω—ã–π –∫–∞–ª—å–º–∞—Ä –∫ –ø–∏–≤—É.", price: "¬•500" }
                ]
            },
            {
                id: "hiroshima",
                city: "–•–∏—Ä–æ—Å–∏–º–∞",
                places: [
                    { name: "Hassho", type: "–ö—É–ª—å—Ç", badge: "badge-local", dish: "Soba-iri", why: "–û–∫–æ–Ω–æ–º–∏—è–∫–∏ —Å —Ö—Ä—É—Å—Ç—è—â–µ–π –ª–∞–ø—à–æ–π.", price: "¬•1,300" },
                    { name: "Beer Stand Shigetomi", type: "–£–Ω–∏–∫–∞–ª—å–Ω–æ", badge: "badge-tech", dish: "Draft Beer", why: "–ú–∞—Å—Ç–µ—Ä –Ω–∞–ª–∏–≤–∞ (2 —á–∞—Å–∞ –≤ –¥–µ–Ω—å!).", price: "¬•700" },
                    { name: "Musubi Musashi", type: "Soul Food", badge: "badge-soul", dish: "Onigiri Bento", why: "–í–∫—É—Å –º–∞–º—ã. –õ—É—á—à–∏–µ —Ä–∏—Å–æ–≤—ã–µ —à–∞—Ä–∏–∫–∏.", price: "¬•800" },
                    { name: "Bakudan-ya", type: "–û—Å—Ç—Ä–æ—Ç–∞", badge: "badge-tech", dish: "Tsukemen", why: "–•–æ–ª–æ–¥–Ω–∞—è –æ—Å—Ç—Ä–∞—è –ª–∞–ø—à–∞.", price: "¬•1,100" }
                ]
            },
            {
                id: "miyajima",
                city: "–ú–∏—è–¥–∑–∏–º–∞",
                places: [
                    { name: "Anagomeshi Ueno", type: "–ú–∏—à–ª–µ–Ω", badge: "badge-history", dish: "–ê–Ω–∞–≥–æ (–£–≥–æ—Ä—å)", why: "–õ—É—á—à–∏–π —É–≥–æ—Ä—å. –ë–µ—Ä–∏—Ç–µ –ë—ç–Ω—Ç–æ –±–µ–∑ –æ—á–µ—Ä–µ–¥–∏.", price: "¬•2,500" },
                    { name: "Momijido", type: "–°–Ω—ç–∫", badge: "badge-sweet", dish: "Agemomiji", why: "–ñ–∞—Ä–µ–Ω—ã–π –ø–∏—Ä–æ–∂–æ–∫-–∫–ª–µ–Ω.", price: "¬•200" },
                    { name: "Kakiya", type: "–ú–æ–¥–µ—Ä–Ω", badge: "badge-local", dish: "Kaki Oil", why: "–£—Å—Ç—Ä–∏—á–Ω—ã–π –±–∞—Ä. –ù–∏–∫–∞–∫–æ–≥–æ –∑–∞–ø–∞—Ö–∞.", price: "¬•1,500" },
                    { name: "Big Seto", type: "–°–Ω—ç–∫", badge: "badge-soul", dish: "Oyster Curry Bread", why: "–£—Å—Ç—Ä–∏—Ü–∞ –≤–Ω—É—Ç—Ä–∏ –∫–∞—Ä—Ä–∏-—Ö–ª–µ–±–∞.", price: "¬•400" }
                ]
            },
            {
                id: "shimonoseki",
                city: "–°–∏–º–æ–Ω–æ—Å–µ–∫–∏",
                places: [
                    { name: "Karato Market", type: "–†—ã–Ω–æ–∫", badge: "badge-local", dish: "Sushi Battle", why: "–°—É—à–∏ –ø–æ—à—Ç—É—á–Ω–æ (–ü—Ç-–í—Å).", price: "¬•1,500" },
                    { name: "Kawara Soba Takase", type: "–õ–µ–≥–µ–Ω–¥–∞", badge: "badge-history", dish: "Kawara Soba", why: "–ó–µ–ª–µ–Ω–∞—è —Å–æ–±–∞ –Ω–∞ –≥–æ—Ä—è—á–µ–π —á–µ—Ä–µ–ø–∏—Ü–µ.", price: "¬•1,300" },
                    { name: "Kamon Wharf", type: "–£–¥–æ–±–Ω–æ", badge: "badge-tech", dish: "Kaiten Zushi", why: "–°—É—à–∏ —Å –≤–∏–¥–æ–º –Ω–∞ –∫–æ—Ä–∞–±–ª–∏.", price: "¬•2,000" }
                ]
            }
        ];

        // 3. VELO PLAN (All cycling info here)
        const veloPlan = {
            title: "–í–µ–ª–æ-–ì–∏–¥ –ø–æ –ú–∞—Ä—à—Ä—É—Ç—É",
            subtitle: "–û—Ç –ø—Ä–æ–≥—É–ª–æ–∫ –≤ –ø–∞—Ä–∫–µ –¥–æ —ç–ø–∏—á–Ω—ã—Ö –º–æ—Å—Ç–æ–≤",
            routes: [
                {
                    id: "osaka_castle",
                    city: "–û—Å–∞–∫–∞ (16.04)",
                    name: "–ü–∞—Ä–∫ –ó–∞–º–∫–∞",
                    tag: "–õ–∞–π—Ç",
                    desc: "–ê—Ä–µ–Ω–¥—É–π—Ç–µ 'HUBchari' (–≥–æ—Ä–æ–¥—Å–∫–æ–π –±–∞–π–∫). –ü–∞—Ä–∫ –≤–æ–∫—Ä—É–≥ –∑–∞–º–∫–∞ –æ–≥—Ä–æ–º–Ω—ã–π –∏ –ø–ª–æ—Å–∫–∏–π. –û—Ç–ª–∏—á–Ω—ã–π –≤–∏–¥ –Ω–∞ —Å—Ç–µ–Ω—ã –∏ —Ä–≤—ã –±–µ–∑ —É—Å—Ç–∞–ª–æ—Å—Ç–∏.",
                    steps: ["–°—Ç–∞—Ä—Ç: Morinomiya Station", "–ö—Ä—É–≥ –ø–æ –ø–∞—Ä–∫—É", "–§–∏–Ω–∏—à —É JO-TERRACE (–∫–∞—Ñ–µ)"]
                },
                {
                    id: "kyoto_kamo",
                    city: "–ö–∏–æ—Ç–æ (19.04)",
                    name: "–†–µ–∫–∞ –ö–∞–º–æ",
                    tag: "–†–µ–ª–∞–∫—Å",
                    desc: "–°–∞–º—ã–π –ª—é–±–∏–º—ã–π –º–∞—Ä—à—Ä—É—Ç –º–µ—Å—Ç–Ω—ã—Ö. –í–¥–æ–ª—å —Ä–µ–∫–∏ –ø—Ä–æ–ª–æ–∂–µ–Ω—ã –¥–æ—Ä–æ–∂–∫–∏, –Ω–µ—Ç –º–∞—à–∏–Ω, –º–æ–∂–Ω–æ –µ—Ö–∞—Ç—å –∫–∏–ª–æ–º–µ—Ç—Ä—ã, –Ω–∞—Å–ª–∞–∂–¥–∞—è—Å—å –≤–∏–¥–æ–º –≥–æ—Ä.",
                    steps: ["–ê—Ä–µ–Ω–¥–∞: Kyoto Station", "–í–≤–µ—Ä—Ö –ø–æ —Ç–µ—á–µ–Ω–∏—é –¥–æ Demachiyanagi", "–ü–∏–∫–Ω–∏–∫ –Ω–∞ '–ß–µ—Ä–µ–ø–∞—à—å–∏—Ö –∫–∞–º–Ω—è—Ö'"]
                },
                {
                    id: "nara_park",
                    city: "–ù–∞—Ä–∞ (20.04)",
                    name: "–ü–∞—Ä–∫ –û–ª–µ–Ω–µ–π",
                    tag: "–ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ",
                    desc: "–ü–∞—Ä–∫ –ù–∞—Ä–∞ –æ–≥—Ä–æ–º–µ–Ω. –ü–µ—à–∫–æ–º –¥–æ –¥–∞–ª—å–Ω–∏—Ö —Ö—Ä–∞–º–æ–≤ –∏–¥—Ç–∏ –¥–æ–ª–≥–æ. –í–µ–ª–æ—Å–∏–ø–µ–¥ –ø–æ–∑–≤–æ–ª—è–µ—Ç —É–≤–∏–¥–µ—Ç—å –≤—Å—ë –∏ –æ–±—ä–µ—Ö–∞—Ç—å —Ç–æ–ª–ø—ã —É –≤—Ö–æ–¥–∞.",
                    steps: ["–ê—Ä–µ–Ω–¥–∞: Kintetsu-Nara", "Todai-ji (–ë—É–¥–¥–∞)", "Kasuga Taisha (–õ–µ—Å)", "–ö–æ—Ä–º–ª–µ–Ω–∏–µ –æ–ª–µ–Ω–µ–π"]
                },
                {
                    id: "shimanami",
                    city: "–û–Ω–æ–º–∏—Ç–∏/–°–µ—Ç–æ–¥–∞ (22.04)",
                    name: "Shimanami: –õ–∏–º–æ–Ω–Ω–∞—è –î–æ–ª–∏–Ω–∞",
                    tag: "–•–∞–π–ª–∞–π—Ç",
                    desc: "–ì–ª–∞–≤–Ω–æ–µ –≤–µ–ª–æ-—Å–æ–±—ã—Ç–∏–µ. –ú—ã –±–µ—Ä–µ–º '–õ–∞–π—Ç' –≤–µ—Ä—Å–∏—é: –ø–∞—Ä–æ–º –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç —Å–ª–æ–∂–Ω—ã–µ —É—á–∞—Å—Ç–∫–∏, –æ—Å—Ç–∞–≤–ª—è—è –≤–∞–º –∫—Ä–∞—Å–∏–≤—ã–µ –ø–ª—è–∂–∏ –∏ –ø–ª–æ—Å–∫–∏–µ –¥–æ—Ä–æ–≥–∏ –æ—Å—Ç—Ä–æ–≤–∞ –ò–∫—É—á–∏–¥–∑–∏–º–∞.",
                    steps: ["09:00 –ü–∞—Ä–æ–º –û–Ω–æ–º–∏—Ç–∏ -> –°–µ—Ç–æ–¥–∞", "10:00 –ê—Ä–µ–Ω–¥–∞ –≤ –ø–æ—Ä—Ç—É", "–ü–ª—è–∂ Sunset Beach", "–•—Ä–∞–º Kosanji", "15:00 –°–¥–∞—á–∞ –∏ –ø–∞—Ä–æ–º –æ–±—Ä–∞—Ç–Ω–æ"]
                },
                {
                    id: "kanmon",
                    city: "–°–∏–º–æ–Ω–æ—Å–µ–∫–∏ (26.04)",
                    name: "–¢–æ–Ω–Ω–µ–ª—å –ö–∞–Ω–º–æ–Ω",
                    tag: "–£–Ω–∏–∫–∞–ª—å–Ω–æ",
                    desc: "–ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–µ –º–µ—Å—Ç–æ –≤ –º–∏—Ä–µ, –≥–¥–µ –º–æ–∂–Ω–æ –ø–µ—Ä–µ–π—Ç–∏ –ø—Ä–æ–ª–∏–≤ –ø–æ –¥–Ω—É –æ–∫–µ–∞–Ω–∞. –í–µ–ª–æ—Å–∏–ø–µ–¥ –∫–∞—Ç–∏–º —Ä—É–∫–∞–º–∏ (400–º), –∞ –Ω–∞ —Ç–æ–π —Å—Ç–æ—Ä–æ–Ω–µ (–ö—é—Å—é) –∫–∞—Ç–∞–µ–º—Å—è –ø–æ —Ä–µ—Ç—Ä–æ-–ø–æ—Ä—Ç—É –ú–æ–¥–∑–∏–∫–æ.",
                    steps: ["–ê—Ä–µ–Ω–¥–∞ —É –º–æ—Å—Ç–∞", "–°–ø—É—Å–∫ –Ω–∞ –ª–∏—Ñ—Ç–µ", "–ü—Ä–æ—Ö–æ–¥ –ø–æ–¥ –º–æ—Ä–µ–º", "–ú–æ–¥–∑–∏–∫–æ –†–µ—Ç—Ä–æ", "–í–æ–∑–≤—Ä–∞—Ç –Ω–∞ –ø–∞—Ä–æ–º–µ"]
                }
            ]
        };

        // 4. MAP & SIGHTS
        const mapLocations = [
            { name: "–û—Å–∞–∫–∞ (–ë–∞–∑–∞ 1)", coords: [34.6937, 135.5023], desc: "15-17.04" },
            { name: "–ö–æ–±–µ", coords: [34.6901, 135.1955], desc: "–†–∞–¥–∏–∞–ª—å–Ω—ã–π –≤—ã–µ–∑–¥" },
            { name: "–ö–∏–æ—Ç–æ (–ë–∞–∑–∞ 2)", coords: [35.0116, 135.7681], desc: "18-20.04" },
            { name: "–ù–∞—Ä–∞", coords: [34.6851, 135.8048], desc: "–û–ª–µ–Ω–∏ –∏ –í–µ–ª–æ" },
            { name: "–û–∫–∞—è–º–∞ (–ë–∞–∑–∞ 3)", coords: [34.6617, 133.9196], desc: "21-22.04" },
            { name: "–°–µ—Ç–æ–¥–∞ (–í–µ–ª–æ)", coords: [34.3073, 133.0911], desc: "–õ–∏–º–æ–Ω–Ω—ã–π –æ—Å—Ç—Ä–æ–≤" },
            { name: "–•–∏—Ä–æ—Å–∏–º–∞ (–ë–∞–∑–∞ 4)", coords: [34.3853, 132.4553], desc: "23-24.04" },
            { name: "–°–∏–º–æ–Ω–æ—Å–µ–∫–∏ (–ë–∞–∑–∞ 5)", coords: [33.9515, 130.9272], desc: "25-26.04" }
        ];

        const sightsIntel = [
            { id: "osaka", city: "–û—Å–∞–∫–∞", places: [{name: "Namba Yasaka", type: "–§–æ—Ç–æ", badge: "badge-spiritual", detail: "–û–≥—Ä–æ–º–Ω–∞—è –≥–æ–ª–æ–≤–∞ –ª—å–≤–∞."}, {name: "TeamLab", type: "–ê—Ä—Ç", badge: "badge-art", detail: "–ù–æ—á–Ω–æ–π —Å–∞–¥."}] },
            { id: "kyoto", city: "–ö–∏–æ—Ç–æ", places: [{name: "Fushimi Inari", type: "–•–∞–π–∫", badge: "badge-nature", detail: "1000 –≤–æ—Ä–æ—Ç."}, {name: "Nanzen-ji", type: "–î–∑–µ–Ω", badge: "badge-history", detail: "–ê–∫–≤–µ–¥—É–∫."}] },
            { id: "nara", city: "–ù–∞—Ä–∞", places: [{name: "Todai-ji", type: "–ë—É–¥–¥–∞", badge: "badge-spiritual", detail: "–ì–∏–≥–∞–Ω—Ç—Å–∫–∏–π –ë—É–¥–¥–∞."}, {name: "–ü–∞—Ä–∫ –ù–∞—Ä–∞", type: "–ü—Ä–∏—Ä–æ–¥–∞", badge: "badge-nature", detail: "–û–ª–µ–Ω–∏."}] },
            { id: "okayama", city: "–û–∫–∞—è–º–∞", places: [{name: "Korakuen", type: "–°–∞–¥", badge: "badge-nature", detail: "–¢–æ–ø-3 —Å–∞–¥ –Ø–ø–æ–Ω–∏–∏."}, {name: "Kurashiki", type: "–ö–∞–Ω–∞–ª", badge: "badge-history", detail: "–ë–µ–ª—ã–µ —Å–∫–ª–∞–¥—ã."}] },
            { id: "hiroshima", city: "–•–∏—Ä–æ—Å–∏–º–∞", places: [{name: "–ü–∞—Ä–∫ –ú–∏—Ä–∞", type: "–ü–∞–º—è—Ç—å", badge: "badge-history", detail: "–ú—É–∑–µ–π."}, {name: "Orizuru Tower", type: "–í–∏–¥", badge: "badge-tech", detail: "–û—Ä–∏–≥–∞–º–∏."}] },
            { id: "miyajima", city: "–ú–∏—è–¥–∑–∏–º–∞", places: [{name: "Daisho-in", type: "–•—Ä–∞–º", badge: "badge-spiritual", detail: "500 —Å—Ç–∞—Ç—É–π."}, {name: "Mt. Misen", type: "–•–∞–π–∫", badge: "badge-nature", detail: "–í–µ—Ä—à–∏–Ω–∞."}] },
            { id: "shimonoseki", city: "–°–∏–º–æ–Ω–æ—Å–µ–∫–∏", places: [{name: "Kanmon Tunnel", type: "–ü–æ–¥ –≤–æ–¥–æ–π", badge: "badge-tech", detail: "–ü–µ—à–∫–æ–º –Ω–∞ –ö—é—Å—é."}, {name: "Akama", type: "–•—Ä–∞–º", badge: "badge-history", detail: "–î–≤–æ—Ä–µ—Ü –¥—Ä–∞–∫–æ–Ω–∞."}] }
        ];

        // 5. INFO
        const logisticsData = [
            { type: "JR Pass", icon: "üé´", title: "JR Sanyo-San'in Area Pass", detail: "7 –¥–Ω–µ–π ($150). –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å 19 –ê–ø—Ä–µ–ª—è! –ü–æ–∫—Ä–æ–µ—Ç –ø–µ—Ä–µ–µ–∑–¥ –≤ –û–∫–∞—è–º—É –∏ –¥–∞–ª–µ–µ.", vital: "–í—ã–≥–æ–¥–∞ > $150" },
            { type: "–ë–∞–≥–∞–∂", icon: "üöö", title: "Yamato Transport", detail: "1. 21.04: –ö–∏–æ—Ç–æ -> –•–∏—Ä–æ—Å–∏–º–∞ (–≤ –û–∫–∞—è–º—É —Å —Ä—é–∫–∑–∞–∫–æ–º).<br>2. 25.04: –•–∏—Ä–æ—Å–∏–º–∞ -> –û—Å–∞–∫–∞ (—Ñ–∏–Ω–∞–ª).", vital: null }
        ];
        const checklistData = [{ id: 1, text: "–ö—É–ø–∏—Ç—å –∞–≤–∏–∞–±–∏–ª–µ—Ç—ã", done: true }, { id: 2, text: "–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å 5 –æ—Ç–µ–ª–µ–π", done: true }, { id: 3, text: "–í–∞—É—á–µ—Ä JR Pass", done: false }];
        const budgetData = { labels: ['–û—Ç–µ–ª–∏', '–ï–¥–∞', '–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç', '–®–æ–ø–∏–Ω–≥'], data: [170000, 95000, 35000, 80000], total: 380000 };

        // --- APP STATE ---
        let currentState = {
            view: 'itinerary',
            infoSubTab: 'logistics',
            selectedFoodCityId: 'osaka',
            selectedSightsCityId: 'osaka',
            mapInstance: null
        };

        // --- RENDERERS ---
        function init() {
            renderDesktopNav();
            renderMobileNav();
            renderCurrentView();
        }

        function renderDesktopNav() {
            const tabs = [
                { id: 'itinerary', label: 'üìÖ –ü–ª–∞–Ω' },
                { id: 'map', label: 'üó∫Ô∏è –ö–∞—Ä—Ç–∞' },
                { id: 'sights', label: '‚õ©Ô∏è –ú–µ—Å—Ç–∞' },
                { id: 'velo', label: 'üö¥ –í–µ–ª–æ' },
                { id: 'food', label: 'üçú –ï–¥–∞' },
                { id: 'info', label: '‚ÑπÔ∏è –ò–Ω—Ñ–æ' }
            ];
            document.getElementById('desktop-nav').innerHTML = tabs.map(t => `<button onclick="switchView('${t.id}')" class="px-3 py-2 rounded-md ${currentState.view === t.id ? 'bg-stone-100 font-bold' : 'text-stone-600 hover:bg-stone-50'}">${t.label}</button>`).join('');
        }

        function renderMobileNav() {
            const tabs = [
                { id: 'itinerary', label: '–ü–ª–∞–Ω', icon: '<path d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />' },
                { id: 'map', label: '–ö–∞—Ä—Ç–∞', icon: '<path d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7" />' },
                { id: 'velo', label: '–í–µ–ª–æ', icon: '<circle cx="12" cy="12" r="10" />' },
                { id: 'food', label: '–ï–¥–∞', icon: '<path d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />' },
                { id: 'info', label: '–ò–Ω—Ñ–æ', icon: '<path d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />' }
            ];
            document.getElementById('mobile-bottom-nav').innerHTML = tabs.map(t => `
                <button onclick="switchView('${t.id}')" class="flex flex-col items-center justify-center w-full ${currentState.view === t.id ? 'text-stone-900' : 'text-stone-400'}">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">${t.id === 'velo' ? '<path d="M15 6h-3l-3 7h5l2-6z"/><circle cx="5.5" cy="17.5" r="3.5"/><circle cx="18.5" cy="17.5" r="3.5"/>' : t.icon}</svg>
                    <span class="text-[10px] font-bold">${t.label}</span>
                </button>
            `).join('');
        }

        function switchView(id) {
            currentState.view = id;
            renderDesktopNav();
            renderMobileNav();
            renderCurrentView();
            window.scrollTo(0,0);
        }

        function renderCurrentView() {
            const el = document.getElementById('app-view');
            el.innerHTML = '';
            if(currentState.view === 'itinerary') renderItinerary(el);
            if(currentState.view === 'map') renderMap(el);
            if(currentState.view === 'sights') renderListWithTabs(el, sightsIntel, currentState.selectedSightsCityId, (id)=>{currentState.selectedSightsCityId=id;renderCurrentView()}, renderSightsDetails, '‚õ©Ô∏è');
            if(currentState.view === 'velo') renderVelo(el);
            if(currentState.view === 'food') renderListWithTabs(el, foodIntel, currentState.selectedFoodCityId, (id)=>{currentState.selectedFoodCityId=id;renderCurrentView()}, renderFoodDetails, 'üçú');
            if(currentState.view === 'info') renderInfo(el);
        }

        // --- VIEWS ---

        function renderItinerary(c) {
            let h = `<div class="space-y-4 pb-20">`;
            itinerary.forEach((i, idx) => {
                const badgeClass = i.type === 'base' ? 'badge-base' : 'badge-trip';
                const badgeText = i.type === 'base' ? '–ë–ê–ó–ê' : '–í–´–ï–ó–î';
                h += `
                <div class="flex gap-3 relative">
                    <div class="absolute left-[18px] top-8 bottom-[-16px] w-[2px] bg-stone-200 z-0 ${idx === itinerary.length-1 ? 'hidden' : ''}"></div>
                    <div class="flex-shrink-0 z-10 text-center">
                        <div class="w-10 h-10 rounded-full bg-white border-2 border-stone-300 flex items-center justify-center shadow-sm">
                            <div class="text-[10px] font-bold text-stone-600 leading-none">
                                <div class="uppercase text-[8px] text-stone-400">${i.date}</div>${i.day.split('.')[0]}
                            </div>
                        </div>
                    </div>
                    <div class="flex-grow bg-white rounded-lg border border-stone-200 p-3 shadow-sm">
                        <div class="flex justify-between items-start mb-1">
                            <h3 class="font-bold text-stone-900 text-sm">${i.title}</h3>
                            <span class="badge ${badgeClass}">${badgeText}</span>
                        </div>
                        <div class="text-[10px] text-stone-400 font-bold mb-1">üìç ${i.city}</div>
                        <p class="text-stone-600 text-xs mb-2">${i.desc}</p>
                    </div>
                </div>`;
            });
            c.innerHTML = h + "</div>";
        }

        function renderMap(c) {
            c.innerHTML = `<div class="h-full flex flex-col space-y-4"><div class="bg-white p-3 rounded-xl border border-stone-200 shadow-sm"><h2 class="font-bold text-lg">üó∫Ô∏è –ú–∞—Ä—à—Ä—É—Ç</h2><p class="text-xs text-stone-500">–û—Å–∞–∫–∞ -> –ö–∏–æ—Ç–æ -> –û–∫–∞—è–º–∞ -> –•–∏—Ä–æ—Å–∏–º–∞ -> –°–∏–º–æ–Ω–æ—Å–µ–∫–∏ -> –û—Å–∞–∫–∞</p></div><div id="map-container" class="flex-grow shadow-md border border-stone-300"></div></div>`;
            setTimeout(() => {
                const map = L.map('map-container').setView([34.5, 134], 7);
                L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', { attribution: '&copy; OpenStreetMap' }).addTo(map);
                const points = mapLocations.map(l => l.coords);
                mapLocations.forEach(l => L.marker(l.coords).addTo(map).bindPopup(`<b>${l.name}</b><br>${l.desc}`));
                L.polyline(points, {color: '#e11d48', weight: 3}).addTo(map);
            }, 100);
        }

        function renderVelo(c) {
            let h = `<div class="space-y-6 pb-20"><div class="bg-blue-50 border border-blue-100 p-5 rounded-xl"><h2 class="font-bold text-xl text-blue-900">üö¥ –í–µ–ª–æ-–ú–∞—Ä—à—Ä—É—Ç—ã</h2><p class="text-xs text-blue-700 mb-4">–í –∫–∞–∂–¥–æ–º –∫–ª—é—á–µ–≤–æ–º –≥–æ—Ä–æ–¥–µ</p>`;
            veloPlan.routes.forEach(r => {
                h += `<div class="bg-white p-4 rounded-lg shadow-sm mb-3"><div class="flex justify-between mb-1"><h3 class="font-bold text-sm">${r.city}: ${r.name}</h3><span class="text-[10px] bg-blue-100 text-blue-800 px-2 rounded pt-0.5">${r.tag}</span></div><p class="text-xs text-stone-600 italic mb-2">${r.desc}</p><ul class="list-disc list-inside text-xs text-stone-700">${r.steps.map(s=>`<li>${s}</li>`).join('')}</ul></div>`;
            });
            c.innerHTML = h + "</div></div>";
        }

        function renderListWithTabs(c, data, sid, cb, rend, icon) {
             let h=`<div class="flex flex-col md:flex-row gap-4 md:gap-6 h-full pb-20"><div class="sticky top-14 md:top-0 z-30 bg-[#fcfbf9] pt-2 pb-2 md:w-1/4"><div class="md:hidden flex overflow-x-auto hide-scroll gap-2 pb-1">${data.map(i=>`<button onclick="window.upSel('${i.id}')" class="flex-shrink-0 px-4 py-2 rounded-full border text-xs font-bold whitespace-nowrap transition-all ${sid===i.id?'bg-stone-800 text-white border-stone-800':'bg-white text-stone-600 border-stone-200'}">${i.city}</button>`).join('')}</div><div class="hidden md:flex flex-col gap-2">${data.map(i=>`<button onclick="window.upSel('${i.id}')" class="text-left px-4 py-3 rounded-lg border transition-all ${sid===i.id?'bg-stone-800 text-white':'bg-white text-stone-600 hover:bg-stone-50'}"><span class="font-bold text-sm">${i.city}</span></button>`).join('')}</div></div><div class="w-full md:w-3/4">${rend(data.find(x=>x.id===sid), icon)}</div></div>`;
             c.innerHTML=h; window.upSel=cb;
        }

        function renderSightsDetails(c,i) { return `<div class="bg-white rounded-xl border border-stone-200 shadow-sm overflow-hidden fade-in"><div class="bg-stone-100 p-4 border-b border-stone-200"><h2 class="text-2xl font-serif font-bold text-stone-900 flex justify-between">${c.city} <span class="opacity-20">${i}</span></h2></div><div class="divide-y divide-stone-100">${c.places.map(p=>`<div class="p-4"><div class="flex justify-between items-start mb-1"><h3 class="font-bold text-base text-stone-900">${p.name}</h3><span class="badge ${p.badge}">${p.type}</span></div><p class="text-stone-600 text-xs">${p.detail}</p></div>`).join('')}</div></div>`; }
        
        function renderFoodDetails(c,i) { return `<div class="bg-white rounded-xl border border-stone-200 shadow-sm overflow-hidden fade-in"><div class="bg-stone-100 p-4 border-b border-stone-200"><h2 class="text-2xl font-serif font-bold text-stone-900 flex justify-between">${c.city} <span class="opacity-20">${i}</span></h2></div><div class="divide-y divide-stone-100">${c.places.map(p=>`<div class="p-4"><div class="flex justify-between items-start"><h3 class="font-bold text-stone-900">${p.name}</h3><span class="text-xs bg-stone-100 px-2 py-0.5 rounded text-stone-600 font-bold">${p.dish}</span></div><p class="text-stone-600 text-xs mt-1 italic">"${p.why}"</p><div class="text-[10px] text-stone-400 mt-1 font-mono">${p.price}</div></div>`).join('')}</div></div>`; }

        function renderInfo(c) {
            c.innerHTML = `
            <div class="space-y-6 pb-20">
                <div class="segmented-control sticky top-0 z-20">
                    <button onclick="changeInfo('logistics')" class="segment-btn ${currentState.infoSubTab==='logistics'?'segment-active':''}">–õ–æ–≥–∏—Å—Ç–∏–∫–∞</button>
                    <button onclick="changeInfo('budget')" class="segment-btn ${currentState.infoSubTab==='budget'?'segment-active':''}">–ë—é–¥–∂–µ—Ç</button>
                </div>
                <div id="info-content">${getInfoHTML()}</div>
            </div>`;
            if(currentState.infoSubTab==='budget') setTimeout(initChart, 100);
        }

        function changeInfo(tab) { currentState.infoSubTab = tab; renderInfo(document.getElementById('app-view')); }

        function getInfoHTML() {
            if(currentState.infoSubTab === 'logistics') return `
                <div class="space-y-3">
                    ${logisticsData.map(l=>`<div class="bg-white p-4 rounded-xl border border-stone-200 shadow-sm"><h3 class="font-bold">${l.icon} ${l.title}</h3><p class="text-sm mt-1">${l.detail}</p>${l.vital?`<div class="mt-2 text-xs text-red-600 font-bold bg-red-50 p-2 rounded">${l.vital}</div>`:''}</div>`).join('')}
                </div>`;
            return `<div class="bg-white p-6 rounded-xl border border-stone-200 shadow-sm"><canvas id="budgetChart"></canvas><div class="text-center mt-4 font-bold text-xl">~¬•380,000</div><p class="text-center text-xs text-stone-500">–Ω–∞ 1 —á–µ–ª (–±–µ–∑ –∞–≤–∏–∞)</p></div>`;
        }

        function initChart() {
            new Chart(document.getElementById('budgetChart'), {
                type: 'doughnut',
                data: { labels: budgetData.labels, datasets: [{ data: budgetData.data, backgroundColor: ['#e7e5e4','#f97316','#047857','#d6d3d1'], borderWidth:0 }] },
                options: { plugins: { legend: { position: 'bottom' } } }
            });
        }

        function jumpToFood(id){currentState.selectedFoodCityId=id;switchView('food');}
        function jumpToSights(id){if(id==='velo'){switchView('velo');return;}currentState.selectedSightsCityId=id;switchView('sights');}

        init();
    </script>
</body>
</html>
